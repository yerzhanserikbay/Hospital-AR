function ColorFresnel(a){var b=[[1,1,1],[1,1,1],1,0,1];5===arguments.length?b=Array.prototype.slice.call(arguments):Array.isArray(a)&&(b=a),this.isColorFresnel=!0,this.center=b[0],this.edge=b[1],this.centerBias=b[2],this.edgeBias=b[3],this.power=b[4]}function ScalarFresnel(a){var b=[1,1,1,0,1];5===arguments.length?b=Array.prototype.slice.call(arguments):Array.isArray(a)&&(b=a),this.isScalarFresnel=!0,this.center=b[0],this.edge=b[1],this.centerBias=b[2],this.edgeBias=b[3],this.power=b[4]}function unpackChapterLights(a){"use strict";var b,c={},d=0,e=0,f=Human.assets.lights.lightIds,g=Human.renderer.lights.defaultLightIds;if(a.lights.length)for(d=0;d<a.lights.length;d++)c[a.lights[d]]=!0;if(a.libraries.length)for(d=0;d<a.libraries.length;d++)if(b=a.libraries[d],f.hasOwnProperty(b))for(e=0;e<f[b].length;e++)c[f[b][e]]=!0;else if("default"===b)for(e=0;e<g.length;e++)c[g[e]]=!0;return c}!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=!!a&&"length"in a&&a.length,c=na.type(a);return"function"===c||na.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function d(a,b,c){if(na.isFunction(b))return na.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return na.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(xa.test(b))return na.filter(b,a,c);b=na.filter(b,a)}return na.grep(a,function(a){return na.inArray(a,b)>-1!==c})}function e(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function f(a){var b={};return na.each(a.match(Da)||[],function(a,c){b[c]=!0}),b}function g(){da.addEventListener?(da.removeEventListener("DOMContentLoaded",h),a.removeEventListener("load",h)):(da.detachEvent("onreadystatechange",h),a.detachEvent("onload",h))}function h(){(da.addEventListener||"load"===a.event.type||"complete"===da.readyState)&&(g(),na.ready())}function i(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(Ia,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:Ha.test(c)?na.parseJSON(c):c}catch(e){}na.data(a,b,c)}else c=void 0}return c}function j(a){var b;for(b in a)if(("data"!==b||!na.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function k(a,b,c,d){if(Ga(a)){var e,f,g=na.expando,h=a.nodeType,i=h?na.cache:a,j=h?a[g]:a[g]&&g;if(j&&i[j]&&(d||i[j].data)||void 0!==c||"string"!=typeof b)return j||(j=h?a[g]=ca.pop()||na.guid++:g),i[j]||(i[j]=h?{}:{toJSON:na.noop}),("object"==typeof b||"function"==typeof b)&&(d?i[j]=na.extend(i[j],b):i[j].data=na.extend(i[j].data,b)),f=i[j],d||(f.data||(f.data={}),f=f.data),void 0!==c&&(f[na.camelCase(b)]=c),"string"==typeof b?(e=f[b],null==e&&(e=f[na.camelCase(b)])):e=f,e}}function l(a,b,c){if(Ga(a)){var d,e,f=a.nodeType,g=f?na.cache:a,h=f?a[na.expando]:na.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){na.isArray(b)?b=b.concat(na.map(b,na.camelCase)):b in d?b=[b]:(b=na.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;for(;e--;)delete d[b[e]];if(c?!j(d):!na.isEmptyObject(d))return}(c||(delete g[h].data,j(g[h])))&&(f?na.cleanData([a],!0):la.deleteExpando||g!=g.window?delete g[h]:g[h]=void 0)}}}function m(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return na.css(a,b,"")},i=h(),j=c&&c[3]||(na.cssNumber[b]?"":"px"),k=(na.cssNumber[b]||"px"!==j&&+i)&&Ka.exec(na.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,na.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}function n(a){var b=Sa.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function o(a,b){var c,d,e=0,f="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||na.nodeName(d,b)?f.push(d):na.merge(f,o(d,b));return void 0===b||b&&na.nodeName(a,b)?na.merge([a],f):f}function p(a,b){for(var c,d=0;null!=(c=a[d]);d++)na._data(c,"globalEval",!b||na._data(b[d],"globalEval"))}function q(a){Oa.test(a.type)&&(a.defaultChecked=a.checked)}function r(a,b,c,d,e){for(var f,g,h,i,j,k,l,m=a.length,r=n(b),s=[],t=0;m>t;t++)if(g=a[t],g||0===g)if("object"===na.type(g))na.merge(s,g.nodeType?[g]:g);else if(Ua.test(g)){for(i=i||r.appendChild(b.createElement("div")),j=(Pa.exec(g)||["",""])[1].toLowerCase(),l=Ta[j]||Ta._default,i.innerHTML=l[1]+na.htmlPrefilter(g)+l[2],f=l[0];f--;)i=i.lastChild;if(!la.leadingWhitespace&&Ra.test(g)&&s.push(b.createTextNode(Ra.exec(g)[0])),!la.tbody)for(g="table"!==j||Va.test(g)?"<table>"!==l[1]||Va.test(g)?0:i:i.firstChild,f=g&&g.childNodes.length;f--;)na.nodeName(k=g.childNodes[f],"tbody")&&!k.childNodes.length&&g.removeChild(k);for(na.merge(s,i.childNodes),i.textContent="";i.firstChild;)i.removeChild(i.firstChild);i=r.lastChild}else s.push(b.createTextNode(g));for(i&&r.removeChild(i),la.appendChecked||na.grep(o(s,"input"),q),t=0;g=s[t++];)if(d&&na.inArray(g,d)>-1)e&&e.push(g);else if(h=na.contains(g.ownerDocument,g),i=o(r.appendChild(g),"script"),h&&p(i),c)for(f=0;g=i[f++];)Qa.test(g.type||"")&&c.push(g);return i=null,r}function s(){return!0}function t(){return!1}function u(){try{return da.activeElement}catch(a){}}function v(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)v(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=t;else if(!e)return a;return 1===f&&(g=e,e=function(a){return na().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=na.guid++)),a.each(function(){na.event.add(this,b,e,d,c)})}function w(a,b){return na.nodeName(a,"table")&&na.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function x(a){return a.type=(null!==na.find.attr(a,"type"))+"/"+a.type,a}function y(a){var b=eb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function z(a,b){if(1===b.nodeType&&na.hasData(a)){var c,d,e,f=na._data(a),g=na._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)na.event.add(b,c,h[c][d])}g.data&&(g.data=na.extend({},g.data))}}function A(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!la.noCloneEvent&&b[na.expando]){e=na._data(b);for(d in e.events)na.removeEvent(b,d,e.handle);b.removeAttribute(na.expando)}"script"===c&&b.text!==a.text?(x(b).text=a.text,y(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),la.html5Clone&&a.innerHTML&&!na.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Oa.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function B(a,b,c,d){b=fa.apply([],b);var e,f,g,h,i,j,k=0,l=a.length,m=l-1,n=b[0],p=na.isFunction(n);if(p||l>1&&"string"==typeof n&&!la.checkClone&&db.test(n))return a.each(function(e){var f=a.eq(e);p&&(b[0]=n.call(this,e,f.html())),B(f,b,c,d)});if(l&&(j=r(b,a[0].ownerDocument,!1,a,d),e=j.firstChild,1===j.childNodes.length&&(j=e),e||d)){for(h=na.map(o(j,"script"),x),g=h.length;l>k;k++)f=j,k!==m&&(f=na.clone(f,!0,!0),g&&na.merge(h,o(f,"script"))),c.call(a[k],f,k);if(g)for(i=h[h.length-1].ownerDocument,na.map(h,y),k=0;g>k;k++)f=h[k],Qa.test(f.type||"")&&!na._data(f,"globalEval")&&na.contains(i,f)&&(f.src?na._evalUrl&&na._evalUrl(f.src):na.globalEval((f.text||f.textContent||f.innerHTML||"").replace(fb,"")));j=e=null}return a}function C(a,b,c){for(var d,e=b?na.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||na.cleanData(o(d)),d.parentNode&&(c&&na.contains(d.ownerDocument,d)&&p(o(d,"script")),d.parentNode.removeChild(d));return a}function D(a,b){var c=na(b.createElement(a)).appendTo(b.body),d=na.css(c[0],"display");return c.detach(),d}function E(a){var b=da,c=jb[a];return c||(c=D(a,b),"none"!==c&&c||(ib=(ib||na("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(ib[0].contentWindow||ib[0].contentDocument).document,b.write(),b.close(),c=D(a,b),ib.detach()),jb[a]=c),c}function F(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function G(a){if(a in yb)return a;for(var b=a.charAt(0).toUpperCase()+a.slice(1),c=xb.length;c--;)if(a=xb[c]+b,a in yb)return a}function H(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=na._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&Ma(d)&&(f[g]=na._data(d,"olddisplay",E(d.nodeName)))):(e=Ma(d),(c&&"none"!==c||!e)&&na._data(d,"olddisplay",e?c:na.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function I(a,b,c){var d=ub.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function J(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=na.css(a,c+La[f],!0,e)),d?("content"===c&&(g-=na.css(a,"padding"+La[f],!0,e)),"margin"!==c&&(g-=na.css(a,"border"+La[f]+"Width",!0,e))):(g+=na.css(a,"padding"+La[f],!0,e),"padding"!==c&&(g+=na.css(a,"border"+La[f]+"Width",!0,e)));return g}function K(b,c,d){var e=!0,f="width"===c?b.offsetWidth:b.offsetHeight,g=ob(b),h=la.boxSizing&&"border-box"===na.css(b,"boxSizing",!1,g);if(da.msFullscreenElement&&a.top!==a&&b.getClientRects().length&&(f=Math.round(100*b.getBoundingClientRect()[c])),0>=f||null==f){if(f=pb(b,c,g),(0>f||null==f)&&(f=b.style[c]),lb.test(f))return f;e=h&&(la.boxSizingReliable()||f===b.style[c]),f=parseFloat(f)||0}return f+J(b,c,d||(h?"border":"content"),e,g)+"px"}function L(a,b,c,d,e){return new L.prototype.init(a,b,c,d,e)}function M(){return a.setTimeout(function(){zb=void 0}),zb=na.now()}function N(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=La[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function O(a,b,c){for(var d,e=(R.tweeners[b]||[]).concat(R.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function P(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&Ma(a),p=na._data(a,"fxshow");c.queue||(h=na._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,na.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=na.css(a,"display"),k="none"===j?na._data(a,"olddisplay")||E(a.nodeName):j,"inline"===k&&"none"===na.css(a,"float")&&(la.inlineBlockNeedsLayout&&"inline"!==E(a.nodeName)?n.zoom=1:n.display="inline-block")),c.overflow&&(n.overflow="hidden",la.shrinkWrapBlocks()||l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Bb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||na.style(a,d)}else j=void 0;if(na.isEmptyObject(m))"inline"===("none"===j?E(a.nodeName):j)&&(n.display=j);else{p?"hidden"in p&&(o=p.hidden):p=na._data(a,"fxshow",{}),f&&(p.hidden=!o),o?na(a).show():l.done(function(){na(a).hide()}),l.done(function(){var b;na._removeData(a,"fxshow");for(b in m)na.style(a,b,m[b])});for(d in m)g=O(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Q(a,b){var c,d,e,f,g;for(c in a)if(d=na.camelCase(c),e=b[d],f=a[c],na.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=na.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function R(a,b,c){var d,e,f=0,g=R.prefilters.length,h=na.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=zb||M(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:na.extend({},b),opts:na.extend(!0,{specialEasing:{},easing:na.easing._default},c),originalProperties:b,originalOptions:c,startTime:zb||M(),duration:c.duration,tweens:[],createTween:function(b,c){var d=na.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Q(k,j.opts.specialEasing);g>f;f++)if(d=R.prefilters[f].call(j,a,k,j.opts))return na.isFunction(d.stop)&&(na._queueHooks(j.elem,j.opts.queue).stop=na.proxy(d.stop,d)),d;return na.map(k,O,j),na.isFunction(j.opts.start)&&j.opts.start.call(a,j),na.fx.timer(na.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function S(a){return na.attr(a,"class")||""}function T(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(Da)||[];if(na.isFunction(c))for(;d=f[e++];)"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function U(a,b,c,d){function e(h){var i;return f[h]=!0,na.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===Zb;return e(b.dataTypes[0])||!f["*"]&&e("*")}function V(a,b){var c,d,e=na.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&na.extend(!0,a,c),a}function W(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function X(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function Y(a){return a.style&&a.style.display||na.css(a,"display")}function Z(a){for(;a&&1===a.nodeType;){if("none"===Y(a)||"hidden"===a.type)return!0;a=a.parentNode}return!1}function $(a,b,c,d){var e;if(na.isArray(b))na.each(b,function(b,e){c||cc.test(a)?d(a,e):$(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==na.type(b))d(a,b);else for(e in b)$(a+"["+e+"]",b[e],c,d)}function _(){try{return new a.XMLHttpRequest}catch(b){}}function aa(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ba(a){return na.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var ca=[],da=a.document,ea=ca.slice,fa=ca.concat,ga=ca.push,ha=ca.indexOf,ia={},ja=ia.toString,ka=ia.hasOwnProperty,la={},ma="1.12.0",na=function(a,b){return new na.fn.init(a,b)},oa=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,pa=/^-ms-/,qa=/-([\da-z])/gi,ra=function(a,b){return b.toUpperCase()};na.fn=na.prototype={jquery:ma,constructor:na,selector:"",length:0,toArray:function(){return ea.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:ea.call(this)},pushStack:function(a){var b=na.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return na.each(this,a)},map:function(a){return this.pushStack(na.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(ea.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:ga,sort:ca.sort,splice:ca.splice},na.extend=na.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||na.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(na.isPlainObject(c)||(b=na.isArray(c)))?(b?(b=!1,f=a&&na.isArray(a)?a:[]):f=a&&na.isPlainObject(a)?a:{},g[d]=na.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},na.extend({expando:"jQuery"+(ma+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===na.type(a)},isArray:Array.isArray||function(a){return"array"===na.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!na.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==na.type(a)||a.nodeType||na.isWindow(a))return!1;try{if(a.constructor&&!ka.call(a,"constructor")&&!ka.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(!la.ownFirst)for(b in a)return ka.call(a,b);for(b in a);return void 0===b||ka.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?ia[ja.call(a)]||"object":typeof a},globalEval:function(b){b&&na.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(pa,"ms-").replace(qa,ra)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var d,e=0;if(c(a))for(d=a.length;d>e&&b.call(a[e],e,a[e])!==!1;e++);else for(e in a)if(b.call(a[e],e,a[e])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(oa,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?na.merge(d,"string"==typeof a?[a]:a):ga.call(d,a)),d},inArray:function(a,b,c){var d;if(b){if(ha)return ha.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;)a[e++]=b[d++];if(c!==c)for(;void 0!==b[d];)a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f,g=0,h=[];if(c(a))for(e=a.length;e>g;g++)f=b(a[g],g,d),null!=f&&h.push(f);else for(g in a)f=b(a[g],g,d),null!=f&&h.push(f);return fa.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(e=a[b],b=a,a=e),na.isFunction(a)?(c=ea.call(arguments,2),d=function(){return a.apply(b||this,c.concat(ea.call(arguments)))},d.guid=a.guid=a.guid||na.guid++,d):void 0},now:function(){return+new Date},support:la}),"function"==typeof Symbol&&(na.fn[Symbol.iterator]=ca[Symbol.iterator]),na.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){ia["[object "+b+"]"]=b.toLowerCase()});var sa=function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,n,o=b&&b.ownerDocument,p=b?b.nodeType:9;if(c=c||[],"string"!=typeof a||!a||1!==p&&9!==p&&11!==p)return c;if(!d&&((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,I)){if(11!==p&&(j=ra.exec(a)))if(e=j[1]){if(9===p){if(!(g=b.getElementById(e)))return c;if(g.id===e)return c.push(g),c}else if(o&&(g=o.getElementById(e))&&M(b,g)&&g.id===e)return c.push(g),c}else{if(j[2])return $.apply(c,b.getElementsByTagName(a)),c;if((e=j[3])&&v.getElementsByClassName&&b.getElementsByClassName)return $.apply(c,b.getElementsByClassName(e)),c}if(!(!v.qsa||T[a+" "]||J&&J.test(a))){if(1!==p)o=b,n=a;else if("object"!==b.nodeName.toLowerCase()){for((h=b.getAttribute("id"))?h=h.replace(ta,"\\$&"):b.setAttribute("id",h=N),l=z(a),f=l.length,i=ma.test(h)?"#"+h:"[id='"+h+"']";f--;)l[f]=i+" "+m(l[f]);n=l.join(","),o=sa.test(a)&&k(b.parentNode)||b}if(n)try{return $.apply(c,o.querySelectorAll(n)),c}catch(q){}finally{h===N&&b.removeAttribute("id")}}}return B(a.replace(ha,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>w.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=c.length;d--;)w.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||V)-(~a.sourceIndex||V);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function l(){}function m(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(j=b[N]||(b[N]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===P&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,r=d||p(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:q(r,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=q(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?aa(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=q(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):$.apply(g,t)})}function s(a){for(var b,c,d,e=a.length,f=w.relative[a[0].type],g=f||w.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return aa(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];e>h;h++)if(c=w.relative[a[h].type])k=[n(o(k),c)];else{if(c=w.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!w.relative[a[d].type];d++);return r(h>1&&o(k),h>1&&m(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ha,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&m(a))}k.push(c)}return o(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&w.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g===G||g||j);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0,g||k.ownerDocument===G||(F(k),h=!I);m=a[l++];)if(m(k,g||G,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Y.call(i));r=q(r)}$.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+1*new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V=1<<31,W={}.hasOwnProperty,X=[],Y=X.pop,Z=X.push,$=X.push,_=X.slice,aa=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},ba="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ca="[\\x20\\t\\r\\n\\f]",da="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ea="\\["+ca+"*("+da+")(?:"+ca+"*([*^$|!~]?=)"+ca+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+da+"))|)"+ca+"*\\]",fa=":("+da+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ea+")*)|.*)\\)|)",ga=new RegExp(ca+"+","g"),ha=new RegExp("^"+ca+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ca+"+$","g"),ia=new RegExp("^"+ca+"*,"+ca+"*"),ja=new RegExp("^"+ca+"*([>+~]|"+ca+")"+ca+"*"),ka=new RegExp("="+ca+"*([^\\]'\"]*?)"+ca+"*\\]","g"),la=new RegExp(fa),ma=new RegExp("^"+da+"$"),na={ID:new RegExp("^#("+da+")"),CLASS:new RegExp("^\\.("+da+")"),TAG:new RegExp("^("+da+"|[*])"),ATTR:new RegExp("^"+ea),PSEUDO:new RegExp("^"+fa),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ca+"*(even|odd|(([+-]|)(\\d*)n|)"+ca+"*(?:([+-]|)"+ca+"*(\\d+)|))"+ca+"*\\)|)","i"),bool:new RegExp("^(?:"+ba+")$","i"),needsContext:new RegExp("^"+ca+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ca+"*((?:-\\d)?\\d*)"+ca+"*\\)|)(?=[^-]|$)","i")},oa=/^(?:input|select|textarea|button)$/i,pa=/^h\d$/i,qa=/^[^{]+\{\s*\[native \w/,ra=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,sa=/[+~]/,ta=/'|\\/g,ua=new RegExp("\\\\([\\da-f]{1,6}"+ca+"?|("+ca+")|.)","ig"),va=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},wa=function(){F()};try{$.apply(X=_.call(O.childNodes),O.childNodes),X[O.childNodes.length].nodeType}catch(xa){$={apply:X.length?function(a,b){Z.apply(a,_.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}v=b.support={},y=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},F=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:O;return d!==G&&9===d.nodeType&&d.documentElement?(G=d,H=G.documentElement,I=!y(G),(c=G.defaultView)&&c.top!==c&&(c.addEventListener?c.addEventListener("unload",wa,!1):c.attachEvent&&c.attachEvent("onunload",wa)),v.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),v.getElementsByTagName=e(function(a){return a.appendChild(G.createComment("")),!a.getElementsByTagName("*").length}),v.getElementsByClassName=qa.test(G.getElementsByClassName),v.getById=e(function(a){return H.appendChild(a).id=N,!G.getElementsByName||!G.getElementsByName(N).length}),v.getById?(w.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&I){var c=b.getElementById(a);return c?[c]:[]}},w.filter.ID=function(a){var b=a.replace(ua,va);return function(a){return a.getAttribute("id")===b}}):(delete w.find.ID,w.filter.ID=function(a){var b=a.replace(ua,va);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),w.find.TAG=v.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):v.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},w.find.CLASS=v.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&I?b.getElementsByClassName(a):void 0},K=[],J=[],(v.qsa=qa.test(G.querySelectorAll))&&(e(function(a){H.appendChild(a).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&J.push("[*^$]="+ca+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+ca+"*(?:value|"+ba+")"),a.querySelectorAll("[id~="+N+"-]").length||J.push("~="),a.querySelectorAll(":checked").length||J.push(":checked"),a.querySelectorAll("a#"+N+"+*").length||J.push(".#.+[+~]")}),e(function(a){var b=G.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+ca+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(v.matchesSelector=qa.test(L=H.matches||H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){v.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",fa)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=qa.test(H.compareDocumentPosition),M=b||qa.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!v.sortDetached&&b.compareDocumentPosition(a)===c?a===G||a.ownerDocument===O&&M(O,a)?-1:b===G||b.ownerDocument===O&&M(O,b)?1:D?aa(D,a)-aa(D,b):0:4&c?-1:1)}:function(a,b){if(a===b)return E=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===G?-1:b===G?1:e?-1:f?1:D?aa(D,a)-aa(D,b):0;if(e===f)return g(a,b);for(c=a;c=c.parentNode;)h.unshift(c);for(c=b;c=c.parentNode;)i.unshift(c);for(;h[d]===i[d];)d++;return d?g(h[d],i[d]):h[d]===O?-1:i[d]===O?1:0},G):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(ka,"='$1']"),!(!v.matchesSelector||!I||T[c+" "]||K&&K.test(c)||J&&J.test(c)))try{var d=L.call(a,c);if(d||v.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=w.attrHandle[b.toLowerCase()],d=c&&W.call(w.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:v.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!v.detectDuplicates,D=!v.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},x=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=x(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=x(b);return c},w=b.selectors={cacheLength:50,createPseudo:d,match:na,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ua,va),a[3]=(a[3]||a[4]||a[5]||"").replace(ua,va),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return na.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&la.test(c)&&(b=z(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ua,va).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+ca+")"+a+"("+ca+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"");

})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(ga," ")+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){for(;p;){for(m=b;m=m[p];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(m=q,l=m[N]||(m[N]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===P&&j[1],t=n&&j[2],m=n&&q.childNodes[n];m=++n&&m&&m[p]||(t=n=0)||o.pop();)if(1===m.nodeType&&++t&&m===b){k[a]=[P,n,t];break}}else if(s&&(m=b,l=m[N]||(m[N]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===P&&j[1],t=n),t===!1)for(;(m=++n&&m&&m[p]||(t=n=0)||o.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++t||(s&&(l=m[N]||(m[N]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[P,t]),m!==b)););return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,c){var e,f=w.pseudos[a]||w.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],w.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=aa(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=A(a.replace(ha,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(ua,va),function(b){return(b.textContent||b.innerText||x(b)).indexOf(a)>-1}}),lang:d(function(a){return ma.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(ua,va).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!w.pseudos.empty(a)},header:function(a){return pa.test(a.nodeName)},input:function(a){return oa.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[0>c?c+b:c]}),even:j(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},w.pseudos.nth=w.pseudos.eq;for(u in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[u]=h(u);for(u in{submit:!0,reset:!0})w.pseudos[u]=i(u);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,z=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=w.preFilter;h;){(!d||(e=ia.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ja.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ha," ")}),h=h.slice(d.length));for(g in w.filter)!(e=na[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)},A=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=z(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d)),f.selector=a}return f},B=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,l=!d&&z(a=j.selector||a);if(c=c||[],1===l.length){if(f=l[0]=l[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&v.getById&&9===b.nodeType&&I&&w.relative[f[1].type]){if(b=(w.find.ID(g.matches[0].replace(ua,va),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=na.needsContext.test(a)?0:f.length;e--&&(g=f[e],!w.relative[h=g.type]);)if((i=w.find[h])&&(d=i(g.matches[0].replace(ua,va),sa.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return $.apply(c,d),c;break}}return(j||A(a,l))(d,b,!I,c,!b||sa.test(a)&&k(b.parentNode)||b),c},v.sortStable=N.split("").sort(U).join("")===N,v.detectDuplicates=!!E,F(),v.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),v.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(ba,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);na.find=sa,na.expr=sa.selectors,na.expr[":"]=na.expr.pseudos,na.uniqueSort=na.unique=sa.uniqueSort,na.text=sa.getText,na.isXMLDoc=sa.isXML,na.contains=sa.contains;var ta=function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&na(a).is(c))break;d.push(a)}return d},ua=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},va=na.expr.match.needsContext,wa=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,xa=/^.[^:#\[\.,]*$/;na.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?na.find.matchesSelector(d,a)?[d]:[]:na.find.matches(a,na.grep(b,function(a){return 1===a.nodeType}))},na.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(na(a).filter(function(){for(b=0;e>b;b++)if(na.contains(d[b],this))return!0}));for(b=0;e>b;b++)na.find(a,d[b],c);return c=this.pushStack(e>1?na.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&va.test(a)?na(a):a||[],!1).length}});var ya,za=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Aa=na.fn.init=function(a,b,c){var d,e;if(!a)return this;if(c=c||ya,"string"==typeof a){if(d="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:za.exec(a),!d||!d[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(d[1]){if(b=b instanceof na?b[0]:b,na.merge(this,na.parseHTML(d[1],b&&b.nodeType?b.ownerDocument||b:da,!0)),wa.test(d[1])&&na.isPlainObject(b))for(d in b)na.isFunction(this[d])?this[d](b[d]):this.attr(d,b[d]);return this}if(e=da.getElementById(d[2]),e&&e.parentNode){if(e.id!==d[2])return ya.find(a);this.length=1,this[0]=e}return this.context=da,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):na.isFunction(a)?"undefined"!=typeof c.ready?c.ready(a):a(na):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),na.makeArray(a,this))};Aa.prototype=na.fn,ya=na(da);var Ba=/^(?:parents|prev(?:Until|All))/,Ca={children:!0,contents:!0,next:!0,prev:!0};na.fn.extend({has:function(a){var b,c=na(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(na.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=va.test(a)||"string"!=typeof a?na(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&na.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?na.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?na.inArray(this[0],na(a)):na.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(na.uniqueSort(na.merge(this.get(),na(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),na.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return ta(a,"parentNode")},parentsUntil:function(a,b,c){return ta(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return ta(a,"nextSibling")},prevAll:function(a){return ta(a,"previousSibling")},nextUntil:function(a,b,c){return ta(a,"nextSibling",c)},prevUntil:function(a,b,c){return ta(a,"previousSibling",c)},siblings:function(a){return ua((a.parentNode||{}).firstChild,a)},children:function(a){return ua(a.firstChild)},contents:function(a){return na.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:na.merge([],a.childNodes)}},function(a,b){na.fn[a]=function(c,d){var e=na.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=na.filter(d,e)),this.length>1&&(Ca[a]||(e=na.uniqueSort(e)),Ba.test(a)&&(e=e.reverse())),this.pushStack(e)}});var Da=/\S+/g;na.Callbacks=function(a){a="string"==typeof a?f(a):na.extend({},a);var b,c,d,e,g=[],h=[],i=-1,j=function(){for(e=a.once,d=b=!0;h.length;i=-1)for(c=h.shift();++i<g.length;)g[i].apply(c[0],c[1])===!1&&a.stopOnFalse&&(i=g.length,c=!1);a.memory||(c=!1),b=!1,e&&(g=c?[]:"")},k={add:function(){return g&&(c&&!b&&(i=g.length-1,h.push(c)),function d(b){na.each(b,function(b,c){na.isFunction(c)?a.unique&&k.has(c)||g.push(c):c&&c.length&&"string"!==na.type(c)&&d(c)})}(arguments),c&&!b&&j()),this},remove:function(){return na.each(arguments,function(a,b){for(var c;(c=na.inArray(b,g,c))>-1;)g.splice(c,1),i>=c&&i--}),this},has:function(a){return a?na.inArray(a,g)>-1:g.length>0},empty:function(){return g&&(g=[]),this},disable:function(){return e=h=[],g=c="",this},disabled:function(){return!g},lock:function(){return e=!0,c||k.disable(),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],h.push(c),b||j()),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},na.extend({Deferred:function(a){var b=[["resolve","done",na.Callbacks("once memory"),"resolved"],["reject","fail",na.Callbacks("once memory"),"rejected"],["notify","progress",na.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return na.Deferred(function(c){na.each(b,function(b,f){var g=na.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&na.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?na.extend(a,d):d}},e={};return d.pipe=d.then,na.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=ea.call(arguments),g=f.length,h=1!==g||a&&na.isFunction(a.promise)?g:0,i=1===h?a:na.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?ea.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&na.isFunction(f[e].promise)?f[e].promise().progress(j(e,c,b)).done(j(e,d,f)).fail(i.reject):--h;return h||i.resolveWith(d,f),i.promise()}});var Ea;na.fn.ready=function(a){return na.ready.promise().done(a),this},na.extend({isReady:!1,readyWait:1,holdReady:function(a){a?na.readyWait++:na.ready(!0)},ready:function(a){(a===!0?--na.readyWait:na.isReady)||(na.isReady=!0,a!==!0&&--na.readyWait>0||(Ea.resolveWith(da,[na]),na.fn.triggerHandler&&(na(da).triggerHandler("ready"),na(da).off("ready"))))}}),na.ready.promise=function(b){if(!Ea)if(Ea=na.Deferred(),"complete"===da.readyState)a.setTimeout(na.ready);else if(da.addEventListener)da.addEventListener("DOMContentLoaded",h),a.addEventListener("load",h);else{da.attachEvent("onreadystatechange",h),a.attachEvent("onload",h);var c=!1;try{c=null==a.frameElement&&da.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!na.isReady){try{c.doScroll("left")}catch(b){return a.setTimeout(e,50)}g(),na.ready()}}()}return Ea.promise(b)},na.ready.promise();var Fa;for(Fa in na(la))break;la.ownFirst="0"===Fa,la.inlineBlockNeedsLayout=!1,na(function(){var a,b,c,d;c=da.getElementsByTagName("body")[0],c&&c.style&&(b=da.createElement("div"),d=da.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",la.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=da.createElement("div");la.deleteExpando=!0;try{delete a.test}catch(b){la.deleteExpando=!1}a=null}();var Ga=function(a){var b=na.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b},Ha=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ia=/([A-Z])/g;na.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?na.cache[a[na.expando]]:a[na.expando],!!a&&!j(a)},data:function(a,b,c){return k(a,b,c)},removeData:function(a,b){return l(a,b)},_data:function(a,b,c){return k(a,b,c,!0)},_removeData:function(a,b){return l(a,b,!0)}}),na.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=na.data(f),1===f.nodeType&&!na._data(f,"parsedAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=na.camelCase(d.slice(5)),i(f,d,e[d])));na._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){na.data(this,a)}):arguments.length>1?this.each(function(){na.data(this,a,b)}):f?i(f,a,na.data(f,a)):void 0},removeData:function(a){return this.each(function(){na.removeData(this,a)})}}),na.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=na._data(a,b),c&&(!d||na.isArray(c)?d=na._data(a,b,na.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=na.queue(a,b),d=c.length,e=c.shift(),f=na._queueHooks(a,b),g=function(){na.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return na._data(a,c)||na._data(a,c,{empty:na.Callbacks("once memory").add(function(){na._removeData(a,b+"queue"),na._removeData(a,c)})})}}),na.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?na.queue(this[0],a):void 0===b?this:this.each(function(){var c=na.queue(this,a,b);na._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&na.dequeue(this,a)})},dequeue:function(a){return this.each(function(){na.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=na.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=na._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}}),function(){var a;la.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return c=da.getElementsByTagName("body")[0],c&&c.style?(b=da.createElement("div"),d=da.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(da.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Ja=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ka=new RegExp("^(?:([+-])=|)("+Ja+")([a-z%]*)$","i"),La=["Top","Right","Bottom","Left"],Ma=function(a,b){return a=b||a,"none"===na.css(a,"display")||!na.contains(a.ownerDocument,a)},Na=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===na.type(c)){e=!0;for(h in c)Na(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,na.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(na(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Oa=/^(?:checkbox|radio)$/i,Pa=/<([\w:-]+)/,Qa=/^$|\/(?:java|ecma)script/i,Ra=/^\s+/,Sa="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";!function(){var a=da.createElement("div"),b=da.createDocumentFragment(),c=da.createElement("input");a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",la.leadingWhitespace=3===a.firstChild.nodeType,la.tbody=!a.getElementsByTagName("tbody").length,la.htmlSerialize=!!a.getElementsByTagName("link").length,la.html5Clone="<:nav></:nav>"!==da.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,b.appendChild(c),la.appendChecked=c.checked,a.innerHTML="<textarea>x</textarea>",la.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,b.appendChild(a),c=da.createElement("input"),c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),a.appendChild(c),la.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,la.noCloneEvent=!!a.addEventListener,a[na.expando]=1,la.attributes=!a.getAttribute(na.expando)}();var Ta={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:la.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};Ta.optgroup=Ta.option,Ta.tbody=Ta.tfoot=Ta.colgroup=Ta.caption=Ta.thead,Ta.th=Ta.td;var Ua=/<|&#?\w+;/,Va=/<tbody/i;!function(){var b,c,d=da.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(la[b]=c in a)||(d.setAttribute(c,"t"),la[b]=d.attributes[c].expando===!1);d=null}();var Wa=/^(?:input|select|textarea)$/i,Xa=/^key/,Ya=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Za=/^(?:focusinfocus|focusoutblur)$/,$a=/^([^.]*)(?:\.(.+)|)/;na.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=na._data(a);if(q){for(c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=na.guid++),(g=q.events)||(g=q.events={}),(k=q.handle)||(k=q.handle=function(a){return"undefined"==typeof na||a&&na.event.triggered===a.type?void 0:na.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(Da)||[""],h=b.length;h--;)f=$a.exec(b[h])||[],n=p=f[1],o=(f[2]||"").split(".").sort(),n&&(j=na.event.special[n]||{},n=(e?j.delegateType:j.bindType)||n,j=na.event.special[n]||{},l=na.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&na.expr.match.needsContext.test(e),namespace:o.join(".")},i),(m=g[n])||(m=g[n]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,o,k)!==!1||(a.addEventListener?a.addEventListener(n,k,!1):a.attachEvent&&a.attachEvent("on"+n,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),na.event.global[n]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=na.hasData(a)&&na._data(a);if(q&&(k=q.events)){for(b=(b||"").match(Da)||[""],j=b.length;j--;)if(h=$a.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=na.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=k[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;f--;)g=m[f],!e&&p!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||na.removeEvent(a,n,q.handle),delete k[n])}else for(n in k)na.event.remove(a,n+b[j],c,d,!0);na.isEmptyObject(k)&&(delete q.handle,na._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||da],n=ka.call(b,"type")?b.type:b,o=ka.call(b,"namespace")?b.namespace.split("."):[];if(h=k=d=d||da,3!==d.nodeType&&8!==d.nodeType&&!Za.test(n+na.event.triggered)&&(n.indexOf(".")>-1&&(o=n.split("."),n=o.shift(),o.sort()),g=n.indexOf(":")<0&&"on"+n,b=b[na.expando]?b:new na.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:na.makeArray(c,[b]),j=na.event.special[n]||{},e||!j.trigger||j.trigger.apply(d,c)!==!1)){if(!e&&!j.noBubble&&!na.isWindow(d)){for(i=j.delegateType||n,Za.test(i+n)||(h=h.parentNode);h;h=h.parentNode)m.push(h),k=h;k===(d.ownerDocument||da)&&m.push(k.defaultView||k.parentWindow||a)}for(l=0;(h=m[l++])&&!b.isPropagationStopped();)b.type=l>1?i:j.bindType||n,f=(na._data(h,"events")||{})[b.type]&&na._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&Ga(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=n,!e&&!b.isDefaultPrevented()&&(!j._default||j._default.apply(m.pop(),c)===!1)&&Ga(d)&&g&&d[n]&&!na.isWindow(d)){k=d[g],k&&(d[g]=null),na.event.triggered=n;try{d[n]()}catch(p){}na.event.triggered=void 0,k&&(d[g]=k)}return b.result}},dispatch:function(a){a=na.event.fix(a);var b,c,d,e,f,g=[],h=ea.call(arguments),i=(na._data(this,"events")||{})[a.type]||[],j=na.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=na.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!a.isImmediatePropagationStopped();)(!a.rnamespace||a.rnamespace.test(f.namespace))&&(a.handleObj=f,a.data=f.data,d=((na.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?na(e,this).index(i)>-1:na.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[na.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Ya.test(e)?this.mouseHooks:Xa.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new na.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||da),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||da,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==u()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===u()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return na.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return na.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c){var d=na.extend(new na.Event,c,{type:a,isSimulated:!0});na.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}},na.removeEvent=da.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},na.Event=function(a,b){return this instanceof na.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?s:t):this.type=a,b&&na.extend(this,b),this.timeStamp=a&&a.timeStamp||na.now(),void(this[na.expando]=!0)):new na.Event(a,b)},na.Event.prototype={constructor:na.Event,isDefaultPrevented:t,isPropagationStopped:t,isImmediatePropagationStopped:t,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=s,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=s,a&&!this.isSimulated&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=s,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},na.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){na.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!na.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),la.submit||(na.event.special.submit={setup:function(){return na.nodeName(this,"form")?!1:void na.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=na.nodeName(b,"input")||na.nodeName(b,"button")?na.prop(b,"form"):void 0;c&&!na._data(c,"submit")&&(na.event.add(c,"submit._submit",function(a){a._submitBubble=!0}),na._data(c,"submit",!0))})},postDispatch:function(a){a._submitBubble&&(delete a._submitBubble,this.parentNode&&!a.isTrigger&&na.event.simulate("submit",this.parentNode,a))},teardown:function(){return na.nodeName(this,"form")?!1:void na.event.remove(this,"._submit")}}),la.change||(na.event.special.change={setup:function(){return Wa.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(na.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._justChanged=!0)}),na.event.add(this,"click._change",function(a){this._justChanged&&!a.isTrigger&&(this._justChanged=!1),na.event.simulate("change",this,a)})),!1):void na.event.add(this,"beforeactivate._change",function(a){var b=a.target;Wa.test(b.nodeName)&&!na._data(b,"change")&&(na.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||na.event.simulate("change",this.parentNode,a)}),na._data(b,"change",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return na.event.remove(this,"._change"),!Wa.test(this.nodeName)}}),la.focusin||na.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){na.event.simulate(b,a.target,na.event.fix(a))};na.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=na._data(d,b);e||d.addEventListener(a,c,!0),na._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=na._data(d,b)-1;e?na._data(d,b,e):(d.removeEventListener(a,c,!0),na._removeData(d,b))}}}),na.fn.extend({on:function(a,b,c,d){return v(this,a,b,c,d)},one:function(a,b,c,d){return v(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,na(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=t),this.each(function(){na.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){na.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?na.event.trigger(a,b,c,!0):void 0}});var _a=/ jQuery\d+="(?:null|\d+)"/g,ab=new RegExp("<(?:"+Sa+")[\\s/>]","i"),bb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,cb=/<script|<style|<link/i,db=/checked\s*(?:[^=]|=\s*.checked.)/i,eb=/^true\/(.*)/,fb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gb=n(da),hb=gb.appendChild(da.createElement("div"));na.extend({htmlPrefilter:function(a){return a.replace(bb,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h,i=na.contains(a.ownerDocument,a);if(la.html5Clone||na.isXMLDoc(a)||!ab.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(hb.innerHTML=a.outerHTML,hb.removeChild(f=hb.firstChild)),!(la.noCloneEvent&&la.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||na.isXMLDoc(a)))for(d=o(f),h=o(a),g=0;null!=(e=h[g]);++g)d[g]&&A(e,d[g]);if(b)if(c)for(h=h||o(a),d=d||o(f),g=0;null!=(e=h[g]);g++)z(e,d[g]);else z(a,f);return d=o(f,"script"),d.length>0&&p(d,!i&&o(a,"script")),d=h=e=null,f},cleanData:function(a,b){for(var c,d,e,f,g=0,h=na.expando,i=na.cache,j=la.attributes,k=na.event.special;null!=(c=a[g]);g++)if((b||Ga(c))&&(e=c[h],f=e&&i[e])){if(f.events)for(d in f.events)k[d]?na.event.remove(c,d):na.removeEvent(c,d,f.handle);i[e]&&(delete i[e],j||"undefined"==typeof c.removeAttribute?c[h]=void 0:c.removeAttribute(h),ca.push(e))}}}),na.fn.extend({domManip:B,detach:function(a){return C(this,a,!0)},remove:function(a){return C(this,a)},text:function(a){return Na(this,function(a){return void 0===a?na.text(this):this.empty().append((this[0]&&this[0].ownerDocument||da).createTextNode(a))},null,a,arguments.length)},append:function(){return B(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=w(this,a);b.appendChild(a)}})},prepend:function(){return B(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=w(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return B(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return B(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&na.cleanData(o(a,!1));a.firstChild;)a.removeChild(a.firstChild);

a.options&&na.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return na.clone(this,a,b)})},html:function(a){return Na(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(_a,""):void 0;if(!("string"!=typeof a||cb.test(a)||!la.htmlSerialize&&ab.test(a)||!la.leadingWhitespace&&Ra.test(a)||Ta[(Pa.exec(a)||["",""])[1].toLowerCase()])){a=na.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(na.cleanData(o(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return B(this,arguments,function(b){var c=this.parentNode;na.inArray(this,a)<0&&(na.cleanData(o(this)),c&&c.replaceChild(b,this))},a)}}),na.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){na.fn[a]=function(a){for(var c,d=0,e=[],f=na(a),g=f.length-1;g>=d;d++)c=d===g?this:this.clone(!0),na(f[d])[b](c),ga.apply(e,c.get());return this.pushStack(e)}});var ib,jb={HTML:"block",BODY:"block"},kb=/^margin/,lb=new RegExp("^("+Ja+")(?!px)[a-z%]+$","i"),mb=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},nb=da.documentElement;!function(){function b(){var b,k,l=da.documentElement;l.appendChild(i),j.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",c=e=h=!1,d=g=!0,a.getComputedStyle&&(k=a.getComputedStyle(j),c="1%"!==(k||{}).top,h="2px"===(k||{}).marginLeft,e="4px"===(k||{width:"4px"}).width,j.style.marginRight="50%",d="4px"===(k||{marginRight:"4px"}).marginRight,b=j.appendChild(da.createElement("div")),b.style.cssText=j.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",b.style.marginRight=b.style.width="0",j.style.width="1px",g=!parseFloat((a.getComputedStyle(b)||{}).marginRight),j.removeChild(b)),j.style.display="none",f=0===j.getClientRects().length,f&&(j.style.display="",j.innerHTML="<table><tr><td></td><td>t</td></tr></table>",b=j.getElementsByTagName("td"),b[0].style.cssText="margin:0;border:0;padding:0;display:none",f=0===b[0].offsetHeight,f&&(b[0].style.display="",b[1].style.display="none",f=0===b[0].offsetHeight)),l.removeChild(i)}var c,d,e,f,g,h,i=da.createElement("div"),j=da.createElement("div");j.style&&(j.style.cssText="float:left;opacity:.5",la.opacity="0.5"===j.style.opacity,la.cssFloat=!!j.style.cssFloat,j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",la.clearCloneStyle="content-box"===j.style.backgroundClip,i=da.createElement("div"),i.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",j.innerHTML="",i.appendChild(j),la.boxSizing=""===j.style.boxSizing||""===j.style.MozBoxSizing||""===j.style.WebkitBoxSizing,na.extend(la,{reliableHiddenOffsets:function(){return null==c&&b(),f},boxSizingReliable:function(){return null==c&&b(),e},pixelMarginRight:function(){return null==c&&b(),d},pixelPosition:function(){return null==c&&b(),c},reliableMarginRight:function(){return null==c&&b(),g},reliableMarginLeft:function(){return null==c&&b(),h}}))}();var ob,pb,qb=/^(top|right|bottom|left)$/;a.getComputedStyle?(ob=function(b){var c=b.ownerDocument.defaultView;return c.opener||(c=a),c.getComputedStyle(b)},pb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||ob(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||na.contains(a.ownerDocument,a)||(g=na.style(a,b)),!la.pixelMarginRight()&&lb.test(g)&&kb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):nb.currentStyle&&(ob=function(a){return a.currentStyle},pb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||ob(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),lb.test(g)&&!qb.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});var rb=/alpha\([^)]*\)/i,sb=/opacity\s*=\s*([^)]*)/i,tb=/^(none|table(?!-c[ea]).+)/,ub=new RegExp("^("+Ja+")(.*)$","i"),vb={position:"absolute",visibility:"hidden",display:"block"},wb={letterSpacing:"0",fontWeight:"400"},xb=["Webkit","O","Moz","ms"],yb=da.createElement("div").style;na.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=pb(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":la.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=na.camelCase(b),i=a.style;if(b=na.cssProps[h]||(na.cssProps[h]=G(h)||h),g=na.cssHooks[b]||na.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Ka.exec(c))&&e[1]&&(c=m(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(na.cssNumber[h]?"":"px")),la.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=na.camelCase(b);return b=na.cssProps[h]||(na.cssProps[h]=G(h)||h),g=na.cssHooks[b]||na.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=pb(a,b,d)),"normal"===f&&b in wb&&(f=wb[b]),""===c||c?(e=parseFloat(f),c===!0||isFinite(e)?e||0:f):f}}),na.each(["height","width"],function(a,b){na.cssHooks[b]={get:function(a,c,d){return c?tb.test(na.css(a,"display"))&&0===a.offsetWidth?mb(a,vb,function(){return K(a,b,d)}):K(a,b,d):void 0},set:function(a,c,d){var e=d&&ob(a);return I(a,c,d?J(a,b,d,la.boxSizing&&"border-box"===na.css(a,"boxSizing",!1,e),e):0)}}}),la.opacity||(na.cssHooks.opacity={get:function(a,b){return sb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=na.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===na.trim(f.replace(rb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=rb.test(f)?f.replace(rb,e):f+" "+e)}}),na.cssHooks.marginRight=F(la.reliableMarginRight,function(a,b){return b?mb(a,{display:"inline-block"},pb,[a,"marginRight"]):void 0}),na.cssHooks.marginLeft=F(la.reliableMarginLeft,function(a,b){return b?(parseFloat(pb(a,"marginLeft"))||(na.contains(a.ownerDocument,a)?a.getBoundingClientRect().left-mb(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}):0))+"px":void 0}),na.each({margin:"",padding:"",border:"Width"},function(a,b){na.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+La[d]+b]=f[d]||f[d-2]||f[0];return e}},kb.test(a)||(na.cssHooks[a+b].set=I)}),na.fn.extend({css:function(a,b){return Na(this,function(a,b,c){var d,e,f={},g=0;if(na.isArray(b)){for(d=ob(a),e=b.length;e>g;g++)f[b[g]]=na.css(a,b[g],!1,d);return f}return void 0!==c?na.style(a,b,c):na.css(a,b)},a,b,arguments.length>1)},show:function(){return H(this,!0)},hide:function(){return H(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){Ma(this)?na(this).show():na(this).hide()})}}),na.Tween=L,L.prototype={constructor:L,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||na.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(na.cssNumber[c]?"":"px")},cur:function(){var a=L.propHooks[this.prop];return a&&a.get?a.get(this):L.propHooks._default.get(this)},run:function(a){var b,c=L.propHooks[this.prop];return this.pos=b=this.options.duration?na.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):L.propHooks._default.set(this),this}},L.prototype.init.prototype=L.prototype,L.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=na.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){na.fx.step[a.prop]?na.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[na.cssProps[a.prop]]&&!na.cssHooks[a.prop]?a.elem[a.prop]=a.now:na.style(a.elem,a.prop,a.now+a.unit)}}},L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},na.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},na.fx=L.prototype.init,na.fx.step={};var zb,Ab,Bb=/^(?:toggle|show|hide)$/,Cb=/queueHooks$/;na.Animation=na.extend(R,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return m(c.elem,a,Ka.exec(b),c),c}]},tweener:function(a,b){na.isFunction(a)?(b=a,a=["*"]):a=a.match(Da);for(var c,d=0,e=a.length;e>d;d++)c=a[d],R.tweeners[c]=R.tweeners[c]||[],R.tweeners[c].unshift(b)},prefilters:[P],prefilter:function(a,b){b?R.prefilters.unshift(a):R.prefilters.push(a)}}),na.speed=function(a,b,c){var d=a&&"object"==typeof a?na.extend({},a):{complete:c||!c&&b||na.isFunction(a)&&a,duration:a,easing:c&&b||b&&!na.isFunction(b)&&b};return d.duration=na.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in na.fx.speeds?na.fx.speeds[d.duration]:na.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){na.isFunction(d.old)&&d.old.call(this),d.queue&&na.dequeue(this,d.queue)},d},na.fn.extend({fadeTo:function(a,b,c,d){return this.filter(Ma).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=na.isEmptyObject(a),f=na.speed(b,c,d),g=function(){var b=R(this,na.extend({},a),f);(e||na._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=na.timers,g=na._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Cb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&na.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=na._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=na.timers,g=d?d.length:0;for(c.finish=!0,na.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),na.each(["toggle","show","hide"],function(a,b){var c=na.fn[b];na.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(N(b,!0),a,d,e)}}),na.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){na.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),na.timers=[],na.fx.tick=function(){var a,b=na.timers,c=0;for(zb=na.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||na.fx.stop(),zb=void 0},na.fx.timer=function(a){na.timers.push(a),a()?na.fx.start():na.timers.pop()},na.fx.interval=13,na.fx.start=function(){Ab||(Ab=a.setInterval(na.fx.tick,na.fx.interval))},na.fx.stop=function(){a.clearInterval(Ab),Ab=null},na.fx.speeds={slow:600,fast:200,_default:400},na.fn.delay=function(b,c){return b=na.fx?na.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a,b=da.createElement("input"),c=da.createElement("div"),d=da.createElement("select"),e=d.appendChild(da.createElement("option"));c=da.createElement("div"),c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],b.setAttribute("type","checkbox"),c.appendChild(b),a=c.getElementsByTagName("a")[0],a.style.cssText="top:1px",la.getSetAttribute="t"!==c.className,la.style=/top/.test(a.getAttribute("style")),la.hrefNormalized="/a"===a.getAttribute("href"),la.checkOn=!!b.value,la.optSelected=e.selected,la.enctype=!!da.createElement("form").enctype,d.disabled=!0,la.optDisabled=!e.disabled,b=da.createElement("input"),b.setAttribute("value",""),la.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),la.radioValue="t"===b.value}();var Db=/\r/g;na.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=na.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,na(this).val()):a,null==e?e="":"number"==typeof e?e+="":na.isArray(e)&&(e=na.map(e,function(a){return null==a?"":a+""})),b=na.valHooks[this.type]||na.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=na.valHooks[e.type]||na.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(Db,""):null==c?"":c)):void 0}}),na.extend({valHooks:{option:{get:function(a){var b=na.find.attr(a,"value");return null!=b?b:na.trim(na.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(la.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&na.nodeName(c.parentNode,"optgroup"))){if(b=na(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=na.makeArray(b),g=e.length;g--;)if(d=e[g],na.inArray(na.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),na.each(["radio","checkbox"],function(){na.valHooks[this]={set:function(a,b){return na.isArray(b)?a.checked=na.inArray(na(a).val(),b)>-1:void 0}},la.checkOn||(na.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var Eb,Fb,Gb=na.expr.attrHandle,Hb=/^(?:checked|selected)$/i,Ib=la.getSetAttribute,Jb=la.input;na.fn.extend({attr:function(a,b){return Na(this,na.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){na.removeAttr(this,a)})}}),na.extend({attr:function(a,b,c){var d,e,f=a.nodeType;return 3!==f&&8!==f&&2!==f?"undefined"==typeof a.getAttribute?na.prop(a,b,c):(1===f&&na.isXMLDoc(a)||(b=b.toLowerCase(),e=na.attrHooks[b]||(na.expr.match.bool.test(b)?Fb:Eb)),void 0!==c?null===c?void na.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=na.find.attr(a,b),null==d?void 0:d)):void 0},attrHooks:{type:{set:function(a,b){if(!la.radioValue&&"radio"===b&&na.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(Da);if(f&&1===a.nodeType)for(;c=f[e++];)d=na.propFix[c]||c,na.expr.match.bool.test(c)?Jb&&Ib||!Hb.test(c)?a[d]=!1:a[na.camelCase("default-"+c)]=a[d]=!1:na.attr(a,c,""),a.removeAttribute(Ib?c:d)}}),Fb={set:function(a,b,c){return b===!1?na.removeAttr(a,c):Jb&&Ib||!Hb.test(c)?a.setAttribute(!Ib&&na.propFix[c]||c,c):a[na.camelCase("default-"+c)]=a[c]=!0,c}},na.each(na.expr.match.bool.source.match(/\w+/g),function(a,b){var c=Gb[b]||na.find.attr;Gb[b]=Jb&&Ib||!Hb.test(b)?function(a,b,d){var e,f;return d||(f=Gb[b],Gb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,Gb[b]=f),e}:function(a,b,c){return c?void 0:a[na.camelCase("default-"+b)]?b.toLowerCase():null}}),Jb&&Ib||(na.attrHooks.value={set:function(a,b,c){return na.nodeName(a,"input")?void(a.defaultValue=b):Eb&&Eb.set(a,b,c)}}),Ib||(Eb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},Gb.id=Gb.name=Gb.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},na.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:Eb.set},na.attrHooks.contenteditable={set:function(a,b,c){Eb.set(a,""===b?!1:b,c)}},na.each(["width","height"],function(a,b){na.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),la.style||(na.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var Kb=/^(?:input|select|textarea|button|object)$/i,Lb=/^(?:a|area)$/i;na.fn.extend({prop:function(a,b){return Na(this,na.prop,a,b,arguments.length>1)},removeProp:function(a){return a=na.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),na.extend({prop:function(a,b,c){var d,e,f=a.nodeType;return 3!==f&&8!==f&&2!==f?(1===f&&na.isXMLDoc(a)||(b=na.propFix[b]||b,e=na.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]):void 0},propHooks:{tabIndex:{get:function(a){var b=na.find.attr(a,"tabindex");return b?parseInt(b,10):Kb.test(a.nodeName)||Lb.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),la.hrefNormalized||na.each(["href","src"],function(a,b){na.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),la.optSelected||(na.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),na.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){na.propFix[this.toLowerCase()]=this}),la.enctype||(na.propFix.enctype="encoding");var Mb=/[\t\r\n\f]/g;na.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(na.isFunction(a))return this.each(function(b){na(this).addClass(a.call(this,b,S(this)))});if("string"==typeof a&&a)for(b=a.match(Da)||[];c=this[i++];)if(e=S(c),d=1===c.nodeType&&(" "+e+" ").replace(Mb," ")){for(g=0;f=b[g++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=na.trim(d),e!==h&&na.attr(c,"class",h)}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(na.isFunction(a))return this.each(function(b){na(this).removeClass(a.call(this,b,S(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a)for(b=a.match(Da)||[];c=this[i++];)if(e=S(c),d=1===c.nodeType&&(" "+e+" ").replace(Mb," ")){for(g=0;f=b[g++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");h=na.trim(d),e!==h&&na.attr(c,"class",h)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(na.isFunction(a)?function(c){na(this).toggleClass(a.call(this,c,S(this),b),b)}:function(){var b,d,e,f;if("string"===c)for(d=0,e=na(this),f=a.match(Da)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(void 0===a||"boolean"===c)&&(b=S(this),b&&na._data(this,"__className__",b),na.attr(this,"class",b||a===!1?"":na._data(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;for(b=" "+a+" ";c=this[d++];)if(1===c.nodeType&&(" "+S(c)+" ").replace(Mb," ").indexOf(b)>-1)return!0;return!1}}),na.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){na.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),na.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Nb=a.location,Ob=na.now(),Pb=/\?/,Qb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;na.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=na.trim(b+"");return e&&!na.trim(e.replace(Qb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():na.error("Invalid JSON: "+b)},na.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new a.DOMParser,c=d.parseFromString(b,"text/xml")):(c=new a.ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||na.error("Invalid XML: "+b),c};var Rb=/#.*$/,Sb=/([?&])_=[^&]*/,Tb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ub=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Vb=/^(?:GET|HEAD)$/,Wb=/^\/\//,Xb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Yb={},Zb={},$b="*/".concat("*"),_b=Nb.href,ac=Xb.exec(_b.toLowerCase())||[];na.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:_b,type:"GET",isLocal:Ub.test(ac[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$b,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":na.parseJSON,"text xml":na.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?V(V(a,na.ajaxSettings),b):V(na.ajaxSettings,a)},ajaxPrefilter:T(Yb),ajaxTransport:T(Zb),ajax:function(b,c){function d(b,c,d,e){var f,l,s,t,v,x=c;2!==u&&(u=2,i&&a.clearTimeout(i),k=void 0,h=e||"",w.readyState=b>0?4:0,f=b>=200&&300>b||304===b,d&&(t=W(m,w,d)),t=X(m,t,w,f),f?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(na.lastModified[g]=v),v=w.getResponseHeader("etag"),v&&(na.etag[g]=v)),204===b||"HEAD"===m.type?x="nocontent":304===b?x="notmodified":(x=t.state,l=t.data,s=t.error,f=!s)):(s=x,(b||!x)&&(x="error",0>b&&(b=0))),w.status=b,w.statusText=(c||x)+"",f?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=void 0,j&&o.trigger(f?"ajaxSuccess":"ajaxError",[w,m,f?l:s]),q.fireWith(n,[w,x]),j&&(o.trigger("ajaxComplete",[w,m]),--na.active||na.event.trigger("ajaxStop")))}"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m=na.ajaxSetup({},c),n=m.context||m,o=m.context&&(n.nodeType||n.jquery)?na(n):na.event,p=na.Deferred(),q=na.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!l)for(l={};b=Tb.exec(h);)l[b[1].toLowerCase()]=b[2];b=l[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?h:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return k&&k.abort(b),d(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,m.url=((b||m.url||_b)+"").replace(Rb,"").replace(Wb,ac[1]+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=na.trim(m.dataType||"*").toLowerCase().match(Da)||[""],null==m.crossDomain&&(e=Xb.exec(m.url.toLowerCase()),m.crossDomain=!(!e||e[1]===ac[1]&&e[2]===ac[2]&&(e[3]||("http:"===e[1]?"80":"443"))===(ac[3]||("http:"===ac[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=na.param(m.data,m.traditional)),U(Yb,m,c,w),2===u)return w;j=na.event&&m.global,j&&0===na.active++&&na.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Vb.test(m.type),g=m.url,m.hasContent||(m.data&&(g=m.url+=(Pb.test(g)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=Sb.test(g)?g.replace(Sb,"$1_="+Ob++):g+(Pb.test(g)?"&":"?")+"_="+Ob++)),m.ifModified&&(na.lastModified[g]&&w.setRequestHeader("If-Modified-Since",na.lastModified[g]),na.etag[g]&&w.setRequestHeader("If-None-Match",na.etag[g])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+$b+"; q=0.01":""):m.accepts["*"]);for(f in m.headers)w.setRequestHeader(f,m.headers[f]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(f in{success:1,error:1,complete:1})w[f](m[f]);if(k=U(Zb,m,c,w)){if(w.readyState=1,j&&o.trigger("ajaxSend",[w,m]),2===u)return w;m.async&&m.timeout>0&&(i=a.setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,k.send(s,d)}catch(x){if(!(2>u))throw x;d(-1,x)}}else d(-1,"No Transport");return w},getJSON:function(a,b,c){return na.get(a,b,c,"json")},getScript:function(a,b){return na.get(a,void 0,b,"script")}}),na.each(["get","post"],function(a,b){na[b]=function(a,c,d,e){return na.isFunction(c)&&(e=e||d,d=c,c=void 0),na.ajax(na.extend({url:a,type:b,dataType:e,data:c,success:d},na.isPlainObject(a)&&a))}}),na._evalUrl=function(a){return na.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},na.fn.extend({wrapAll:function(a){if(na.isFunction(a))return this.each(function(b){na(this).wrapAll(a.call(this,b))});if(this[0]){var b=na(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(na.isFunction(a)?function(b){na(this).wrapInner(a.call(this,b))}:function(){var b=na(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=na.isFunction(a);return this.each(function(c){na(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){na.nodeName(this,"body")||na(this).replaceWith(this.childNodes)}).end()}}),na.expr.filters.hidden=function(a){return la.reliableHiddenOffsets()?a.offsetWidth<=0&&a.offsetHeight<=0&&!a.getClientRects().length:Z(a)},na.expr.filters.visible=function(a){return!na.expr.filters.hidden(a)};var bc=/%20/g,cc=/\[\]$/,dc=/\r?\n/g,ec=/^(?:submit|button|image|reset|file)$/i,fc=/^(?:input|select|textarea|keygen)/i;na.param=function(a,b){var c,d=[],e=function(a,b){b=na.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=na.ajaxSettings&&na.ajaxSettings.traditional),na.isArray(a)||a.jquery&&!na.isPlainObject(a))na.each(a,function(){e(this.name,this.value)});else for(c in a)$(c,a[c],b,e);return d.join("&").replace(bc,"+")},na.fn.extend({serialize:function(){return na.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=na.prop(this,"elements");return a?na.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!na(this).is(":disabled")&&fc.test(this.nodeName)&&!ec.test(a)&&(this.checked||!Oa.test(a))}).map(function(a,b){var c=na(this).val();return null==c?null:na.isArray(c)?na.map(c,function(a){return{name:b.name,value:a.replace(dc,"\r\n")}}):{name:b.name,value:c.replace(dc,"\r\n")}}).get()}}),na.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return this.isLocal?aa():da.documentMode>8?_():/^(get|post|head|put|delete|options)$/i.test(this.type)&&_()||aa()}:_;var gc=0,hc={},ic=na.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in hc)hc[a](void 0,!0)}),la.cors=!!ic&&"withCredentials"in ic,ic=la.ajax=!!ic,ic&&na.ajaxTransport(function(b){if(!b.crossDomain||la.cors){var c;return{send:function(d,e){var f,g=b.xhr(),h=++gc;if(g.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(f in b.xhrFields)g[f]=b.xhrFields[f];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)void 0!==d[f]&&g.setRequestHeader(f,d[f]+"");g.send(b.hasContent&&b.data||null),c=function(a,d){var f,i,j;if(c&&(d||4===g.readyState))if(delete hc[h],c=void 0,g.onreadystatechange=na.noop,d)4!==g.readyState&&g.abort();else{j={},f=g.status,"string"==typeof g.responseText&&(j.text=g.responseText);try{i=g.statusText}catch(k){i=""}f||!b.isLocal||b.crossDomain?1223===f&&(f=204):f=j.text?200:404}j&&e(f,i,j,g.getAllResponseHeaders())},b.async?4===g.readyState?a.setTimeout(c):g.onreadystatechange=hc[h]=c:c()},abort:function(){c&&c(void 0,!0)}}}}),na.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),na.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return na.globalEval(a),a}}}),na.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),na.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=da.head||na("head")[0]||da.documentElement;return{send:function(d,e){b=da.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var jc=[],kc=/(=)\?(?=&|$)|\?\?/;na.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=jc.pop()||na.expando+"_"+Ob++;return this[a]=!0,a}}),na.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(kc.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&kc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=na.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(kc,"$1"+e):b.jsonp!==!1&&(b.url+=(Pb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||na.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?na(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,jc.push(e)),g&&na.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),la.createHTMLDocument=function(){if(!da.implementation.createHTMLDocument)return!1;var a=da.implementation.createHTMLDocument("");return a.body.innerHTML="<form></form><form></form>",2===a.body.childNodes.length}(),na.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||(la.createHTMLDocument?da.implementation.createHTMLDocument(""):da);var d=wa.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=r([a],b,e),e&&e.length&&na(e).remove(),na.merge([],d.childNodes))};var lc=na.fn.load;na.fn.load=function(a,b,c){if("string"!=typeof a&&lc)return lc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=na.trim(a.slice(h,a.length)),a=a.slice(0,h)),na.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&na.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?na("<div>").append(na.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(g,f||[a.responseText,b,a])})}),this},na.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){na.fn[b]=function(a){return this.on(b,a)}}),na.expr.filters.animated=function(a){return na.grep(na.timers,function(b){return a===b.elem}).length},na.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=na.css(a,"position"),l=na(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=na.css(a,"top"),i=na.css(a,"left"),j=("absolute"===k||"fixed"===k)&&na.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),na.isFunction(b)&&(b=b.call(a,c,na.extend({},h))),
null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},na.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){na.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;return f?(b=f.documentElement,na.contains(b,e)?("undefined"!=typeof e.getBoundingClientRect&&(d=e.getBoundingClientRect()),c=ba(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d):void 0},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===na.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),na.nodeName(a[0],"html")||(c=a.offset()),c.top+=na.css(a[0],"borderTopWidth",!0)-a.scrollTop(),c.left+=na.css(a[0],"borderLeftWidth",!0)-a.scrollLeft()),{top:b.top-c.top-na.css(d,"marginTop",!0),left:b.left-c.left-na.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&!na.nodeName(a,"html")&&"static"===na.css(a,"position");)a=a.offsetParent;return a||nb})}}),na.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);na.fn[a]=function(d){return Na(this,function(a,d,e){var f=ba(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?na(f).scrollLeft():e,c?e:na(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),na.each(["top","left"],function(a,b){na.cssHooks[b]=F(la.pixelPosition,function(a,c){return c?(c=pb(a,b),lb.test(c)?na(a).position()[b]+"px":c):void 0})}),na.each({Height:"height",Width:"width"},function(a,b){na.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){na.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return Na(this,function(b,c,d){var e;return na.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?na.css(b,c,g):na.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),na.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),na.fn.size=function(){return this.length},na.fn.andSelf=na.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return na});var mc=a.jQuery,nc=a.$;return na.noConflict=function(b){return a.$===na&&(a.$=nc),b&&a.jQuery===na&&(a.jQuery=mc),na},b||(a.jQuery=a.$=na),na}),function(a,b,c){"use strict";function d(a){return function(){var b,c=arguments[0];for(b="["+(a?a+":":"")+c+"] http://errors.angularjs.org/1.3.15/"+(a?a+"/":"")+c,c=1;c<arguments.length;c++){b=b+(1==c?"?":"&")+"p"+(c-1)+"=";var d,e=encodeURIComponent;d=arguments[c],d="function"==typeof d?d.toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof d?"undefined":"string"!=typeof d?JSON.stringify(d):d,b+=e(d)}return Error(b)}}function e(a){if(null==a||y(a))return!1;var b=a.length;return a.nodeType===Pc&&b?!0:t(a)||Ic(a)||0===b||"number"==typeof b&&b>0&&b-1 in a}function f(a,b,c){var d,g;if(a)if(w(a))for(d in a)"prototype"==d||"length"==d||"name"==d||a.hasOwnProperty&&!a.hasOwnProperty(d)||b.call(c,a[d],d,a);else if(Ic(a)||e(a)){var h="object"!=typeof a;for(d=0,g=a.length;g>d;d++)(h||d in a)&&b.call(c,a[d],d,a)}else if(a.forEach&&a.forEach!==f)a.forEach(b,c,a);else for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}function g(a,b,c){for(var d=Object.keys(a).sort(),e=0;e<d.length;e++)b.call(c,a[d[e]],d[e]);return d}function h(a){return function(b,c){a(c,b)}}function i(){return++Gc}function j(a,b){b?a.$$hashKey=b:delete a.$$hashKey}function k(a){for(var b=a.$$hashKey,c=1,d=arguments.length;d>c;c++){var e=arguments[c];if(e)for(var f=Object.keys(e),g=0,h=f.length;h>g;g++){var i=f[g];a[i]=e[i]}}return j(a,b),a}function l(a){return parseInt(a,10)}function m(a,b){return k(Object.create(a),b)}function n(){}function o(a){return a}function p(a){return function(){return a}}function q(a){return"undefined"==typeof a}function r(a){return"undefined"!=typeof a}function s(a){return null!==a&&"object"==typeof a}function t(a){return"string"==typeof a}function u(a){return"number"==typeof a}function v(a){return"[object Date]"===Dc.call(a)}function w(a){return"function"==typeof a}function x(a){return"[object RegExp]"===Dc.call(a)}function y(a){return a&&a.window===a}function z(a){return a&&a.$evalAsync&&a.$watch}function A(a){return"boolean"==typeof a}function B(a){return!(!a||!(a.nodeName||a.prop&&a.attr&&a.find))}function C(a){var b={};a=a.split(",");var c;for(c=0;c<a.length;c++)b[a[c]]=!0;return b}function D(a){return xc(a.nodeName||a[0]&&a[0].nodeName)}function E(a,b){var c=a.indexOf(b);return c>=0&&a.splice(c,1),b}function F(a,b,c,d){if(y(a)||z(a))throw Ec("cpws");if(b){if(a===b)throw Ec("cpi");if(c=c||[],d=d||[],s(a)){var e=c.indexOf(a);if(-1!==e)return d[e];c.push(a),d.push(b)}if(Ic(a))for(var g=b.length=0;g<a.length;g++)e=F(a[g],null,c,d),s(a[g])&&(c.push(a[g]),d.push(e)),b.push(e);else{var h=b.$$hashKey;Ic(b)?b.length=0:f(b,function(a,c){delete b[c]});for(g in a)a.hasOwnProperty(g)&&(e=F(a[g],null,c,d),s(a[g])&&(c.push(a[g]),d.push(e)),b[g]=e);j(b,h)}}else(b=a)&&(Ic(a)?b=F(a,[],c,d):v(a)?b=new Date(a.getTime()):x(a)?(b=new RegExp(a.source,a.toString().match(/[^\/]*$/)[0]),b.lastIndex=a.lastIndex):s(a)&&(e=Object.create(Object.getPrototypeOf(a)),b=F(a,e,c,d)));return b}function G(a,b){if(Ic(a)){b=b||[];for(var c=0,d=a.length;d>c;c++)b[c]=a[c]}else if(s(a))for(c in b=b||{},a)("$"!==c.charAt(0)||"$"!==c.charAt(1))&&(b[c]=a[c]);return b||a}function H(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a!==a&&b!==b)return!0;var d,e=typeof a;if(e==typeof b&&"object"==e){if(!Ic(a)){if(v(a))return v(b)?H(a.getTime(),b.getTime()):!1;if(x(a))return x(b)?a.toString()==b.toString():!1;if(z(a)||z(b)||y(a)||y(b)||Ic(b)||v(b)||x(b))return!1;e={};for(d in a)if("$"!==d.charAt(0)&&!w(a[d])){if(!H(a[d],b[d]))return!1;e[d]=!0}for(d in b)if(!e.hasOwnProperty(d)&&"$"!==d.charAt(0)&&b[d]!==c&&!w(b[d]))return!1;return!0}if(!Ic(b))return!1;if((e=a.length)==b.length){for(d=0;e>d;d++)if(!H(a[d],b[d]))return!1;return!0}}return!1}function I(a,b,c){return a.concat(Ac.call(b,c))}function J(a,b){var c=2<arguments.length?Ac.call(arguments,2):[];return!w(b)||b instanceof RegExp?b:c.length?function(){return arguments.length?b.apply(a,I(c,arguments,0)):b.apply(a,c)}:function(){return arguments.length?b.apply(a,arguments):b.call(a)}}function K(a,d){var e=d;return"string"==typeof a&&"$"===a.charAt(0)&&"$"===a.charAt(1)?e=c:y(d)?e="$WINDOW":d&&b===d?e="$DOCUMENT":z(d)&&(e="$SCOPE"),e}function L(a,b){return"undefined"==typeof a?c:(u(b)||(b=b?2:null),JSON.stringify(a,K,b))}function M(a){return t(a)?JSON.parse(a):a}function N(a){a=tc(a).clone();try{a.empty()}catch(b){}var c=tc("<div>").append(a).html();try{return a[0].nodeType===Qc?xc(c):c.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+xc(b)})}catch(d){return xc(c)}}function O(a){try{return decodeURIComponent(a)}catch(b){}}function P(a){var b,c,d={};return f((a||"").split("&"),function(a){a&&(b=a.replace(/\+/g,"%20").split("="),c=O(b[0]),r(c)&&(a=r(b[1])?O(b[1]):!0,yc.call(d,c)?Ic(d[c])?d[c].push(a):d[c]=[d[c],a]:d[c]=a))}),d}function Q(a){var b=[];return f(a,function(a,c){Ic(a)?f(a,function(a){b.push(S(c,!0)+(!0===a?"":"="+S(a,!0)))}):b.push(S(c,!0)+(!0===a?"":"="+S(a,!0)))}),b.length?b.join("&"):""}function R(a){return S(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function S(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,b?"%20":"+")}function T(a,b){var c,d,e=Mc.length;for(a=tc(a),d=0;e>d;++d)if(c=Mc[d]+b,t(c=a.attr(c)))return c;return null}function U(a,b){var c,d,e={};f(Mc,function(b){b+="app",!c&&a.hasAttribute&&a.hasAttribute(b)&&(c=a,d=a.getAttribute(b))}),f(Mc,function(b){b+="app";var e;!c&&(e=a.querySelector("["+b.replace(":","\\:")+"]"))&&(c=e,d=e.getAttribute(b))}),c&&(e.strictDi=null!==T(c,"strict-di"),b(c,d?[d]:[],e))}function V(c,d,e){s(e)||(e={}),e=k({strictDi:!1},e);var g=function(){if(c=tc(c),c.injector()){var a=c[0]===b?"document":N(c);throw Ec("btstrpd",a.replace(/</,"&lt;").replace(/>/,"&gt;"))}return d=d||[],d.unshift(["$provide",function(a){a.value("$rootElement",c)}]),e.debugInfoEnabled&&d.push(["$compileProvider",function(a){a.debugInfoEnabled(!0)}]),d.unshift("ng"),a=Ga(d,e.strictDi),a.invoke(["$rootScope","$rootElement","$compile","$injector",function(a,b,c,d){a.$apply(function(){b.data("$injector",d),c(b)(a)})}]),a},h=/^NG_ENABLE_DEBUG_INFO!/,i=/^NG_DEFER_BOOTSTRAP!/;return a&&h.test(a.name)&&(e.debugInfoEnabled=!0,a.name=a.name.replace(h,"")),a&&!i.test(a.name)?g():(a.name=a.name.replace(i,""),Fc.resumeBootstrap=function(a){return f(a,function(a){d.push(a)}),g()},void(w(Fc.resumeDeferredBootstrap)&&Fc.resumeDeferredBootstrap()))}function W(){a.name="NG_ENABLE_DEBUG_INFO!"+a.name,a.location.reload()}function X(a){if(a=Fc.element(a).injector(),!a)throw Ec("test");return a.get("$$testability")}function Y(a,b){return b=b||"_",a.replace(Nc,function(a,c){return(c?b:"")+a.toLowerCase()})}function Z(){var b;Oc||((uc=a.jQuery)&&uc.fn.on?(tc=uc,k(uc.fn,{scope:bd.scope,isolateScope:bd.isolateScope,controller:bd.controller,injector:bd.injector,inheritedData:bd.inheritedData}),b=uc.cleanData,uc.cleanData=function(a){var c;if(Hc)Hc=!1;else for(var d,e=0;null!=(d=a[e]);e++)(c=uc._data(d,"events"))&&c.$destroy&&uc(d).triggerHandler("$destroy");b(a)}):tc=ja,Fc.element=tc,Oc=!0)}function $(a,b,c){if(!a)throw Ec("areq",b||"?",c||"required");return a}function _(a,b,c){return c&&Ic(a)&&(a=a[a.length-1]),$(w(a),b,"not a function, got "+(a&&"object"==typeof a?a.constructor.name||"Object":typeof a)),a}function aa(a,b){if("hasOwnProperty"===a)throw Ec("badname",b)}function ba(a,b,c){if(!b)return a;b=b.split(".");for(var d,e=a,f=b.length,g=0;f>g;g++)d=b[g],a&&(a=(e=a)[d]);return!c&&w(a)?J(e,a):a}function ca(a){var b=a[0];a=a[a.length-1];var c=[b];do{if(b=b.nextSibling,!b)break;c.push(b)}while(b!==a);return tc(c)}function da(){return Object.create(null)}function ea(a){function b(a,b,c){return a[b]||(a[b]=c())}var c=d("$injector"),e=d("ng");return a=b(a,"angular",Object),a.$$minErr=a.$$minErr||d,b(a,"module",function(){var a={};return function(d,f,g){if("hasOwnProperty"===d)throw e("badname","module");return f&&a.hasOwnProperty(d)&&(a[d]=null),b(a,d,function(){function a(a,c,d,e){return e||(e=b),function(){return e[d||"push"]([a,c,arguments]),j}}if(!f)throw c("nomod",d);var b=[],e=[],h=[],i=a("$injector","invoke","push",e),j={_invokeQueue:b,_configBlocks:e,_runBlocks:h,requires:f,name:d,provider:a("$provide","provider"),factory:a("$provide","factory"),service:a("$provide","service"),value:a("$provide","value"),constant:a("$provide","constant","unshift"),animation:a("$animateProvider","register"),filter:a("$filterProvider","register"),controller:a("$controllerProvider","register"),directive:a("$compileProvider","directive"),config:i,run:function(a){return h.push(a),this}};return g&&i(g),j})}})}function fa(b){k(b,{bootstrap:V,copy:F,extend:k,equals:H,element:tc,forEach:f,injector:Ga,noop:n,bind:J,toJson:L,fromJson:M,identity:o,isUndefined:q,isDefined:r,isString:t,isFunction:w,isObject:s,isNumber:u,isElement:B,isArray:Ic,version:Rc,isDate:v,lowercase:xc,uppercase:zc,callbacks:{counter:0},getTestability:X,$$minErr:d,$$csp:Lc,reloadWithDebugInfo:W}),vc=ea(a);try{vc("ngLocale")}catch(c){vc("ngLocale",[]).provider("$locale",cb)}vc("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:Gb}),a.provider("$compile",Na).directive({a:Vd,input:je,textarea:je,form:Zd,script:We,select:Ze,style:_e,option:$e,ngBind:me,ngBindHtml:oe,ngBindTemplate:ne,ngClass:qe,ngClassEven:se,ngClassOdd:re,ngCloak:te,ngController:ue,ngForm:$d,ngHide:Qe,ngIf:xe,ngInclude:ye,ngInit:Ae,ngNonBindable:Me,ngPluralize:Ne,ngRepeat:Oe,ngShow:Pe,ngStyle:Re,ngSwitch:Se,ngSwitchWhen:Te,ngSwitchDefault:Ue,ngOptions:Ye,ngTransclude:Ve,ngModel:Je,ngList:Be,ngChange:pe,pattern:bf,ngPattern:bf,required:af,ngRequired:af,minlength:df,ngMinlength:df,maxlength:cf,ngMaxlength:cf,ngValue:le,ngModelOptions:Le}).directive({ngInclude:ze}).directive(Wd).directive(ve),a.provider({$anchorScroll:Ha,$animate:ld,$browser:Ka,$cacheFactory:La,$controller:Ra,$document:Sa,$exceptionHandler:Ta,$filter:Sb,$interpolate:ab,$interval:bb,$http:Ya,$httpBackend:$a,$location:pb,$log:qb,$parse:Ab,$rootScope:Fb,$q:Bb,$$q:Cb,$sce:Kb,$sceDelegate:Jb,$sniffer:Lb,$templateCache:Ma,$templateRequest:Mb,$$testability:Nb,$timeout:Ob,$window:Rb,$$rAF:Eb,$$asyncCallback:Ia,$$jqLite:Ca})}])}function ga(a){return a.replace(Uc,function(a,b,c,d){return d?c.toUpperCase():c}).replace(Vc,"Moz$1")}function ha(a){return a=a.nodeType,a===Pc||!a||9===a}function ia(a,b){var c,d,e=b.createDocumentFragment(),g=[];if(Zc.test(a)){for(c=c||e.appendChild(b.createElement("div")),d=($c.exec(a)||["",""])[1].toLowerCase(),d=ad[d]||ad._default,c.innerHTML=d[1]+a.replace(_c,"<$1></$2>")+d[2],d=d[0];d--;)c=c.lastChild;g=I(g,c.childNodes),c=e.firstChild,c.textContent=""}else g.push(b.createTextNode(a));return e.textContent="",e.innerHTML="",f(g,function(a){e.appendChild(a)}),e}function ja(a){if(a instanceof ja)return a;var c;if(t(a)&&(a=Jc(a),c=!0),!(this instanceof ja)){if(c&&"<"!=a.charAt(0))throw Xc("nosel");return new ja(a)}if(c){c=b;var d;a=(d=Yc.exec(a))?[c.createElement(d[1])]:(d=ia(a,c))?d.childNodes:[]}ta(this,a)}function ka(a){return a.cloneNode(!0)}function la(a,b){if(b||na(a),a.querySelectorAll)for(var c=a.querySelectorAll("*"),d=0,e=c.length;e>d;d++)na(c[d])}function ma(a,b,c,d){if(r(d))throw Xc("offargs");var e=(d=oa(a))&&d.events,g=d&&d.handle;if(g)if(b)f(b.split(" "),function(b){if(r(c)){var d=e[b];if(E(d||[],c),d&&0<d.length)return}a.removeEventListener(b,g,!1),delete e[b]});else for(b in e)"$destroy"!==b&&a.removeEventListener(b,g,!1),delete e[b]}function na(a,b){var d=a.ng339,e=d&&Sc[d];e&&(b?delete e.data[b]:(e.handle&&(e.events.$destroy&&e.handle({},"$destroy"),ma(a)),delete Sc[d],a.ng339=c))}function oa(a,b){var d=a.ng339,d=d&&Sc[d];return b&&!d&&(a.ng339=d=++Tc,d=Sc[d]={events:{},data:{},handle:c}),d}function pa(a,b,c){if(ha(a)){var d=r(c),e=!d&&b&&!s(b),f=!b;if(a=(a=oa(a,!e))&&a.data,d)a[b]=c;else{if(f)return a;if(e)return a&&a[b];k(a,b)}}}function qa(a,b){return a.getAttribute?-1<(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+b+" "):!1}function ra(a,b){b&&a.setAttribute&&f(b.split(" "),function(b){a.setAttribute("class",Jc((" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+Jc(b)+" "," ")))})}function sa(a,b){if(b&&a.setAttribute){var c=(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");f(b.split(" "),function(a){a=Jc(a),-1===c.indexOf(" "+a+" ")&&(c+=a+" ")}),a.setAttribute("class",Jc(c))}}function ta(a,b){if(b)if(b.nodeType)a[a.length++]=b;else{var c=b.length;if("number"==typeof c&&b.window!==b){if(c)for(var d=0;c>d;d++)a[a.length++]=b[d]}else a[a.length++]=b}}function ua(a,b){return va(a,"$"+(b||"ngController")+"Controller")}function va(a,b,d){for(9==a.nodeType&&(a=a.documentElement),b=Ic(b)?b:[b];a;){for(var e=0,f=b.length;f>e;e++)if((d=tc.data(a,b[e]))!==c)return d;a=a.parentNode||11===a.nodeType&&a.host}}function wa(a){for(la(a,!0);a.firstChild;)a.removeChild(a.firstChild)}function xa(a,b){b||la(a);var c=a.parentNode;c&&c.removeChild(a)}function ya(b,c){c=c||a,"complete"===c.document.readyState?c.setTimeout(b):tc(c).on("load",b)}function za(a,b){var c=cd[b.toLowerCase()];return c&&dd[D(a)]&&c}function Aa(a,b){var c=a.nodeName;return("INPUT"===c||"TEXTAREA"===c)&&ed[b]}function Ba(a,b){var c=function(c,d){c.isDefaultPrevented=function(){return c.defaultPrevented};var e=b[d||c.type],f=e?e.length:0;if(f){if(q(c.immediatePropagationStopped)){var g=c.stopImmediatePropagation;c.stopImmediatePropagation=function(){c.immediatePropagationStopped=!0,c.stopPropagation&&c.stopPropagation(),g&&g.call(c)}}c.isImmediatePropagationStopped=function(){return!0===c.immediatePropagationStopped},f>1&&(e=G(e));for(var h=0;f>h;h++)c.isImmediatePropagationStopped()||e[h].call(a,c)}};return c.elem=a,c}function Ca(){this.$get=function(){return k(ja,{hasClass:function(a,b){return a.attr&&(a=a[0]),qa(a,b)},addClass:function(a,b){return a.attr&&(a=a[0]),sa(a,b)},removeClass:function(a,b){return a.attr&&(a=a[0]),ra(a,b)}})}}function Da(a,b){var c=a&&a.$$hashKey;return c?("function"==typeof c&&(c=a.$$hashKey()),c):(c=typeof a,c="function"==c||"object"==c&&null!==a?a.$$hashKey=c+":"+(b||i)():c+":"+a)}function Ea(a,b){if(b){var c=0;this.nextUid=function(){return++c}}f(a,this.put,this)}function Fa(a){return(a=a.toString().replace(id,"").match(fd))?"function("+(a[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}function Ga(a,b){function d(a){return function(b,c){return s(b)?void f(b,h(a)):a(b,c)}}function e(a,b){if(aa(a,"service"),(w(b)||Ic(b))&&(b=u.instantiate(b)),!b.$get)throw jd("pget",a);return r[a+"Provider"]=b}function g(a,b){return function(){var c=x.invoke(b,this);if(q(c))throw jd("undef",a);return c}}function i(a,b,c){return e(a,{$get:!1!==c?g(a,b):b})}function j(a){var b,c=[];return f(a,function(a){function d(a){var b,c;for(b=0,c=a.length;c>b;b++){var d=a[b],e=u.get(d[0]);e[d[1]].apply(e,d[2])}}if(!o.get(a)){o.put(a,!0);try{t(a)?(b=vc(a),c=c.concat(j(b.requires)).concat(b._runBlocks),d(b._invokeQueue),d(b._configBlocks)):w(a)?c.push(u.invoke(a)):Ic(a)?c.push(u.invoke(a)):_(a,"module")}catch(e){throw Ic(a)&&(a=a[a.length-1]),e.message&&e.stack&&-1==e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),jd("modulerr",a,e.stack||e.message||e)}}}),c}function k(a,c){function d(b,d){if(a.hasOwnProperty(b)){if(a[b]===l)throw jd("cdep",b+" <- "+m.join(" <- "));return a[b]}try{return m.unshift(b),a[b]=l,a[b]=c(b,d)}catch(e){throw a[b]===l&&delete a[b],e}finally{m.shift()}}function e(a,c,e,f){"string"==typeof e&&(f=e,e=null);var g,h,i,j=[],k=Ga.$$annotate(a,b,f);for(h=0,g=k.length;g>h;h++){if(i=k[h],"string"!=typeof i)throw jd("itkn",i);j.push(e&&e.hasOwnProperty(i)?e[i]:d(i,f))}return Ic(a)&&(a=a[g]),a.apply(c,j)}return{invoke:e,instantiate:function(a,b,c){var d=Object.create((Ic(a)?a[a.length-1]:a).prototype||null);return a=e(a,d,b,c),s(a)||w(a)?a:d},get:d,annotate:Ga.$$annotate,has:function(b){return r.hasOwnProperty(b+"Provider")||a.hasOwnProperty(b)}}}b=!0===b;var l={},m=[],o=new Ea([],!0),r={$provide:{provider:d(e),factory:d(i),service:d(function(a,b){return i(a,["$injector",function(a){return a.instantiate(b)}])}),value:d(function(a,b){return i(a,p(b),!1)}),constant:d(function(a,b){aa(a,"constant"),r[a]=b,v[a]=b}),decorator:function(a,b){var c=u.get(a+"Provider"),d=c.$get;c.$get=function(){var a=x.invoke(d,c);return x.invoke(b,null,{$delegate:a})}}}},u=r.$injector=k(r,function(a,b){throw Fc.isString(b)&&m.push(b),jd("unpr",m.join(" <- "))}),v={},x=v.$injector=k(v,function(a,b){var d=u.get(a+"Provider",b);return x.invoke(d.$get,d,c,a)});return f(j(a),function(a){x.invoke(a||n)}),x}function Ha(){var a=!0;this.disableAutoScrolling=function(){a=!1},this.$get=["$window","$location","$rootScope",function(b,c,d){function e(a){var b=null;return Array.prototype.some.call(a,function(a){return"a"===D(a)?(b=a,!0):void 0}),b}function f(a){if(a){a.scrollIntoView();var c;c=g.yOffset,w(c)?c=c():B(c)?(c=c[0],c="fixed"!==b.getComputedStyle(c).position?0:c.getBoundingClientRect().bottom):u(c)||(c=0),c&&(a=a.getBoundingClientRect().top,b.scrollBy(0,a-c))}else b.scrollTo(0,0)}function g(){var a,b=c.hash();b?(a=h.getElementById(b))?f(a):(a=e(h.getElementsByName(b)))?f(a):"top"===b&&f(null):f(null)}var h=b.document;return a&&d.$watch(function(){return c.hash()},function(a,b){a===b&&""===a||ya(function(){d.$evalAsync(g)})}),g}]}function Ia(){this.$get=["$$rAF","$timeout",function(a,b){return a.supported?function(b){return a(b)}:function(a){return b(a,0,!1)}}]}function Ja(a,b,d,e){function g(a){try{a.apply(null,Ac.call(arguments,1))}finally{if(w--,0===w)for(;x.length;)try{x.pop()()}catch(b){d.error(b)}}}function h(a,b){!function c(){f(z,function(a){a()}),y=b(c,a)}()}function i(){j(),k()}function j(){a:{try{A=r.state;break a}catch(a){}A=void 0}A=q(A)?null:A,H(A,I)&&(A=I),I=A}function k(){(C!==m.url()||B!==A)&&(C=m.url(),B=A,f(F,function(a){a(m.url(),A)}))}function l(a){try{return decodeURIComponent(a)}catch(b){return a}}var m=this,o=b[0],p=a.location,r=a.history,s=a.setTimeout,u=a.clearTimeout,v={};m.isMock=!1;var w=0,x=[];m.$$completeOutstandingRequest=g,m.$$incOutstandingRequestCount=function(){w++},m.notifyWhenNoOutstandingRequests=function(a){f(z,function(a){a()}),0===w?a():x.push(a)};var y,z=[];m.addPollFn=function(a){return q(y)&&h(100,s),z.push(a),a};var A,B,C=p.href,D=b.find("base"),E=null;j(),B=A,m.url=function(b,c,d){if(q(d)&&(d=null),p!==a.location&&(p=a.location),r!==a.history&&(r=a.history),b){var f=B===d;if(C===b&&(!e.history||f))return m;var g=C&&hb(C)===hb(b);return C=b,B=d,!e.history||g&&f?(g||(E=b),c?p.replace(b):g?(c=p,d=b.indexOf("#"),b=-1===d?"":b.substr(d+1),c.hash=b):p.href=b):(r[c?"replaceState":"pushState"](d,"",b),j(),B=A),m}return E||p.href.replace(/%27/g,"'")},m.state=function(){return A};var F=[],G=!1,I=null;m.onUrlChange=function(b){return G||(e.history&&tc(a).on("popstate",i),tc(a).on("hashchange",i),G=!0),F.push(b),b},m.$$checkUrlChange=k,m.baseHref=function(){var a=D.attr("href");return a?a.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var J={},K="",L=m.baseHref();m.cookies=function(a,b){var e,f,g,h;if(!a){if(o.cookie!==K)for(K=o.cookie,e=K.split("; "),J={},g=0;g<e.length;g++)f=e[g],h=f.indexOf("="),h>0&&(a=l(f.substring(0,h)),J[a]===c&&(J[a]=l(f.substring(h+1))));return J}b===c?o.cookie=encodeURIComponent(a)+"=;path="+L+";expires=Thu, 01 Jan 1970 00:00:00 GMT":t(b)&&(e=(o.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+";path="+L).length+1,e>4096&&d.warn("Cookie '"+a+"' possibly not set or overflowed because it was too large ("+e+" > 4096 bytes)!"))},m.defer=function(a,b){var c;return w++,c=s(function(){delete v[c],g(a)},b||0),v[c]=!0,c},m.defer.cancel=function(a){return v[a]?(delete v[a],u(a),g(n),!0):!1}}function Ka(){this.$get=["$window","$log","$sniffer","$document",function(a,b,c,d){return new Ja(a,d,b,c)}]}function La(){this.$get=function(){function a(a,c){function e(a){a!=m&&(n?n==a&&(n=a.n):n=a,f(a.n,a.p),f(a,m),m=a,m.n=null)}function f(a,b){a!=b&&(a&&(a.p=b),b&&(b.n=a))}if(a in b)throw d("$cacheFactory")("iid",a);var g=0,h=k({},c,{id:a}),i={},j=c&&c.capacity||Number.MAX_VALUE,l={},m=null,n=null;return b[a]={put:function(a,b){if(j<Number.MAX_VALUE){var c=l[a]||(l[a]={key:a});e(c)}return q(b)?void 0:(a in i||g++,i[a]=b,g>j&&this.remove(n.key),b)},get:function(a){if(j<Number.MAX_VALUE){var b=l[a];if(!b)return;e(b)}return i[a]},remove:function(a){if(j<Number.MAX_VALUE){var b=l[a];if(!b)return;b==m&&(m=b.p),b==n&&(n=b.n),f(b.n,b.p),delete l[a]}delete i[a],g--},removeAll:function(){i={},g=0,l={},m=n=null},destroy:function(){l=h=i=null,delete b[a]},info:function(){return k({},h,{size:g})}}}var b={};return a.info=function(){var a={};return f(b,function(b,c){a[c]=b.info()}),a},a.get=function(a){return b[a]},a}}function Ma(){this.$get=["$cacheFactory",function(a){return a("templates")}]}function Na(a,d){function e(a,b){var c=/^\s*([@&]|=(\*?))(\??)\s*(\w*)\s*$/,d={};return f(a,function(a,e){var f=a.match(c);if(!f)throw md("iscp",b,e,a);d[e]={mode:f[1][0],collection:"*"===f[2],optional:"?"===f[3],attrName:f[4]||e}}),d}var g={},i=/^\s*directive\:\s*([\w\-]+)\s+(.*)$/,j=/(([\w\-]+)(?:\:([^;]+))?;?)/,l=C("ngSrc,ngSrcset,src,srcset"),q=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,u=/^(on[a-z]+|formaction)$/;this.directive=function x(b,c){return aa(b,"directive"),t(b)?($(c,"directiveFactory"),g.hasOwnProperty(b)||(g[b]=[],a.factory(b+"Directive",["$injector","$exceptionHandler",function(a,c){var d=[];return f(g[b],function(f,g){try{var h=a.invoke(f);w(h)?h={compile:p(h)}:!h.compile&&h.link&&(h.compile=p(h.link)),h.priority=h.priority||0,h.index=g,h.name=h.name||b,h.require=h.require||h.controller&&h.name,h.restrict=h.restrict||"EA",s(h.scope)&&(h.$$isolateBindings=e(h.scope,h.name)),d.push(h)}catch(i){c(i)}}),d}])),g[b].push(c)):f(b,h(x)),this},this.aHrefSanitizationWhitelist=function(a){return r(a)?(d.aHrefSanitizationWhitelist(a),this):d.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(a){return r(a)?(d.imgSrcSanitizationWhitelist(a),this):d.imgSrcSanitizationWhitelist()};var v=!0;this.debugInfoEnabled=function(a){return r(a)?(v=a,this):v},this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(a,d,e,h,p,r,x,y,A,B,C){function F(a,b){try{a.addClass(b)}catch(c){}}function G(a,b,c,d,e){a instanceof tc||(a=tc(a)),f(a,function(b,c){b.nodeType==Qc&&b.nodeValue.match(/\S+/)&&(a[c]=tc(b).wrap("<span></span>").parent()[0])});var g=I(a,b,a,c,d,e);G.$$addScopeClass(a);var h=null;return function(b,c,d){$(b,"scope"),d=d||{};var e=d.parentBoundTranscludeFn,f=d.transcludeControllers;if(d=d.futureParentElement,e&&e.$$boundTransclude&&(e=e.$$boundTransclude),h||(h=(d=d&&d[0])&&"foreignobject"!==D(d)&&d.toString().match(/SVG/)?"svg":"html"),d="html"!==h?tc(X(h,tc("<div>").append(a).html())):c?bd.clone.call(a):a,f)for(var i in f)d.data("$"+i+"Controller",f[i].instance);return G.$$addScopeInfo(d,b),c&&c(d,b),g&&g(b,d,d,e),d}}function I(a,b,d,e,f,g){function h(a,d,e,f){var g,h,i,j,k,l,o;if(m)for(o=Array(d.length),j=0;j<n.length;j+=3)g=n[j],o[g]=d[g];else o=d;for(j=0,k=n.length;k>j;)h=o[n[j++]],d=n[j++],g=n[j++],d?(d.scope?(i=a.$new(),G.$$addScopeInfo(tc(h),i)):i=a,l=d.transcludeOnThisElement?J(a,d.transclude,f,d.elementTranscludeOnThisElement):!d.templateOnThisElement&&f?f:!f&&b?J(a,b):null,d(g,i,h,e,l)):g&&g(a,h.childNodes,c,f)}for(var i,j,k,l,m,n=[],o=0;o<a.length;o++)i=new ea,j=K(a[o],[],i,0===o?e:c,f),(g=j.length?O(j,a[o],i,b,d,null,[],[],g):null)&&g.scope&&G.$$addScopeClass(i.$$element),i=g&&g.terminal||!(k=a[o].childNodes)||!k.length?null:I(k,g?(g.transcludeOnThisElement||!g.templateOnThisElement)&&g.transclude:b),(g||i)&&(n.push(o,g,i),l=!0,m=m||g),g=null;return l?h:null}function J(a,b,c){return function(d,e,f,g,h){return d||(d=a.$new(!1,h),d.$$transcluded=!0),b(d,e,{parentBoundTranscludeFn:c,transcludeControllers:f,futureParentElement:g})}}function K(a,b,c,d,e){var f,g=c.$attr;switch(a.nodeType){case Pc:Q(b,Oa(D(a)),"E",d,e);for(var h,k,l,m=a.attributes,n=0,o=m&&m.length;o>n;n++){var p=!1,q=!1;h=m[n],f=h.name,k=Jc(h.value),h=Oa(f),(l=ia.test(h))&&(f=f.replace(nd,"").substr(8).replace(/_(.)/g,function(a,b){return b.toUpperCase()}));var r=h.replace(/(Start|End)$/,"");R(r)&&h===r+"Start"&&(p=f,q=f.substr(0,f.length-5)+"end",f=f.substr(0,f.length-6)),h=Oa(f.toLowerCase()),g[h]=f,(l||!c.hasOwnProperty(h))&&(c[h]=k,za(a,h)&&(c[h]=!0)),_(a,b,k,h,l),Q(b,h,"A",d,e,p,q)}if(a=a.className,s(a)&&(a=a.animVal),t(a)&&""!==a)for(;f=j.exec(a);)h=Oa(f[2]),Q(b,h,"C",d,e)&&(c[h]=Jc(f[3])),a=a.substr(f.index+f[0].length);break;case Qc:W(b,a.nodeValue);break;case 8:try{(f=i.exec(a.nodeValue))&&(h=Oa(f[1]),Q(b,h,"M",d,e)&&(c[h]=Jc(f[2])))}catch(u){}}return b.sort(U),b}function L(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw md("uterdir",b,c);a.nodeType==Pc&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--),d.push(a),a=a.nextSibling}while(e>0)}else d.push(a);return tc(d)}function M(a,b,c){return function(d,e,f,g,h){return e=L(e[0],b,c),a(d,e,f,g,h)}}function O(a,g,h,i,j,k,l,m,n){function o(a,b,c,d){a&&(c&&(a=M(a,c,d)),a.require=A.require,a.directiveName=B,(I===A||A.$$isolateScope)&&(a=ba(a,{isolateScope:!0})),l.push(a)),b&&(c&&(b=M(b,c,d)),b.require=A.require,b.directiveName=B,(I===A||A.$$isolateScope)&&(b=ba(b,{isolateScope:!0})),m.push(b))}function u(a,b,c,d){var e,g,h="data",i=!1,j=c;if(t(b)){if(g=b.match(q),b=b.substring(g[0].length),g[3]&&(g[1]?g[3]=null:g[1]=g[3]),"^"===g[1]?h="inheritedData":"^^"===g[1]&&(h="inheritedData",j=c.parent()),"?"===g[2]&&(i=!0),e=null,d&&"data"===h&&(e=d[b])&&(e=e.instance),e=e||j[h]("$"+b+"Controller"),!e&&!i)throw md("ctreq",b,a);return e||null}return Ic(b)&&(e=[],f(b,function(b){e.push(u(a,b,c,d))})),e}function v(a,b,e,i,j){function k(a,b,d){var e;return z(a)||(d=b,b=a,a=c),U&&(e=t),d||(d=U?w.parent():w),j(a,b,e,d,B)}var n,o,q,s,t,v,w,x;if(g===e?(x=h,w=h.$$element):(w=tc(e),x=new ea(w,h)),I&&(s=b.$new(!0)),j&&(v=k,v.$$boundTransclude=j),F&&(y={},t={},f(F,function(a){var c={$scope:a===I||a.$$isolateScope?s:b,$element:w,$attrs:x,$transclude:v};q=a.controller,"@"==q&&(q=x[a.name]),c=r(q,c,!0,a.controllerAs),t[a.name]=c,U||w.data("$"+a.name+"Controller",c.instance),y[a.name]=c})),I){G.$$addScopeInfo(w,s,!0,!(J&&(J===I||J===I.$$originalDirective))),G.$$addScopeClass(w,!0),i=y&&y[I.name];var A=s;i&&i.identifier&&!0===I.bindToController&&(A=i.instance),f(s.$$isolateBindings=I.$$isolateBindings,function(a,c){var e,f,g,h,i=a.attrName,j=a.optional;switch(a.mode){case"@":x.$observe(i,function(a){A[c]=a}),x.$$observers[i].$$scope=b,x[i]&&(A[c]=d(x[i])(b));break;case"=":if(j&&!x[i])break;f=p(x[i]),h=f.literal?H:function(a,b){return a===b||a!==a&&b!==b},g=f.assign||function(){throw e=A[c]=f(b),md("nonassign",x[i],I.name)},e=A[c]=f(b),j=function(a){return h(a,A[c])||(h(a,e)?g(b,a=A[c]):A[c]=a),e=a},j.$stateful=!0,j=a.collection?b.$watchCollection(x[i],j):b.$watch(p(x[i],j),null,f.literal),s.$on("$destroy",j);break;case"&":f=p(x[i]),A[c]=function(a){return f(b,a)}}})}for(y&&(f(y,function(a){a()}),y=null),i=0,n=l.length;n>i;i++)o=l[i],ca(o,o.isolateScope?s:b,w,x,o.require&&u(o.directiveName,o.require,w,t),v);var B=b;for(I&&(I.template||null===I.templateUrl)&&(B=s),a&&a(B,e.childNodes,c,j),i=m.length-1;i>=0;i--)o=m[i],ca(o,o.isolateScope?s:b,w,x,o.require&&u(o.directiveName,o.require,w,t),v)}n=n||{};for(var x,y,A,B,C,D,E=-Number.MAX_VALUE,F=n.controllerDirectives,I=n.newIsolateScopeDirective,J=n.templateDirective,O=n.nonTlbTranscludeDirective,Q=!1,R=!1,U=n.hasElementTranscludeDirective,W=h.$$element=tc(g),Y=i,Z=0,$=a.length;$>Z;Z++){A=a[Z];var _=A.$$start,da=A.$$end;if(_&&(W=L(g,_,da)),C=c,E>A.priority)break;if((C=A.scope)&&(A.templateUrl||(s(C)?(V("new/isolated scope",I||x,A,W),I=A):V("new/isolated scope",I,A,W)),x=x||A),B=A.name,!A.templateUrl&&A.controller&&(C=A.controller,F=F||{},V("'"+B+"' controller",F[B],A,W),F[B]=A),(C=A.transclude)&&(Q=!0,A.$$tlb||(V("transclusion",O,A,W),O=A),"element"==C?(U=!0,E=A.priority,C=W,W=h.$$element=tc(b.createComment(" "+B+": "+h[B]+" ")),g=W[0],aa(j,Ac.call(C,0),g),Y=G(C,i,E,k&&k.name,{nonTlbTranscludeDirective:O})):(C=tc(ka(g)).contents(),W.empty(),Y=G(C,i))),A.template)if(R=!0,V("template",J,A,W),J=A,C=w(A.template)?A.template(W,h):A.template,C=ha(C),A.replace){if(k=A,C=Zc.test(C)?Qa(X(A.templateNamespace,Jc(C))):[],g=C[0],1!=C.length||g.nodeType!==Pc)throw md("tplrt",B,"");aa(j,W,g),$={$attr:{}},C=K(g,[],$);var fa=a.splice(Z+1,a.length-(Z+1));I&&P(C),a=a.concat(C).concat(fa),S(h,$),$=a.length}else W.html(C);if(A.templateUrl)R=!0,V("template",J,A,W),J=A,A.replace&&(k=A),v=T(a.splice(Z,a.length-Z),W,h,j,Q&&Y,l,m,{controllerDirectives:F,newIsolateScopeDirective:I,templateDirective:J,nonTlbTranscludeDirective:O}),$=a.length;else if(A.compile)try{D=A.compile(W,h,Y),w(D)?o(null,D,_,da):D&&o(D.pre,D.post,_,da)}catch(ga){e(ga,N(W))}A.terminal&&(v.terminal=!0,E=Math.max(E,A.priority))}return v.scope=x&&!0===x.scope,v.transcludeOnThisElement=Q,v.elementTranscludeOnThisElement=U,v.templateOnThisElement=R,v.transclude=Y,n.hasElementTranscludeDirective=U,v}function P(a){for(var b=0,c=a.length;c>b;b++)a[b]=m(a[b],{$$isolateScope:!0})}function Q(b,d,f,h,i,j,k){if(d===i)return null;if(i=null,g.hasOwnProperty(d)){var l;d=a.get(d+"Directive");for(var n=0,o=d.length;o>n;n++)try{l=d[n],(h===c||h>l.priority)&&-1!=l.restrict.indexOf(f)&&(j&&(l=m(l,{$$start:j,$$end:k
})),b.push(l),i=l)}catch(p){e(p)}}return i}function R(b){if(g.hasOwnProperty(b))for(var c=a.get(b+"Directive"),d=0,e=c.length;e>d;d++)if(b=c[d],b.multiElement)return!0;return!1}function S(a,b){var c=b.$attr,d=a.$attr,e=a.$$element;f(a,function(d,e){"$"!=e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))}),f(b,function(b,f){"class"==f?(F(e,b),a["class"]=(a["class"]?a["class"]+" ":"")+b):"style"==f?(e.attr("style",e.attr("style")+";"+b),a.style=(a.style?a.style+";":"")+b):"$"==f.charAt(0)||a.hasOwnProperty(f)||(a[f]=b,d[f]=c[f])})}function T(a,b,c,d,e,g,i,j){var k,l,n=[],o=b[0],p=a.shift(),q=m(p,{templateUrl:null,transclude:null,replace:null,$$originalDirective:p}),r=w(p.templateUrl)?p.templateUrl(b,c):p.templateUrl,t=p.templateNamespace;return b.empty(),h(A.getTrustedResourceUrl(r)).then(function(h){var m,u;if(h=ha(h),p.replace){if(h=Zc.test(h)?Qa(X(t,Jc(h))):[],m=h[0],1!=h.length||m.nodeType!==Pc)throw md("tplrt",p.name,r);h={$attr:{}},aa(d,b,m);var v=K(m,[],h);s(p.scope)&&P(v),a=v.concat(a),S(c,h)}else m=o,b.html(h);for(a.unshift(q),k=O(a,m,c,e,b,p,g,i,j),f(d,function(a,c){a==m&&(d[c]=b[0])}),l=I(b[0].childNodes,e);n.length;){h=n.shift(),u=n.shift();var w=n.shift(),x=n.shift(),v=b[0];if(!h.$$destroyed){if(u!==o){var y=u.className;j.hasElementTranscludeDirective&&p.replace||(v=ka(m)),aa(w,tc(u),v),F(tc(v),y)}u=k.transcludeOnThisElement?J(h,k.transclude,x):x,k(l,h,v,d,u)}}n=null}),function(a,b,c,d,e){a=e,b.$$destroyed||(n?n.push(b,c,d,a):(k.transcludeOnThisElement&&(a=J(b,k.transclude,e)),k(l,b,c,d,a)))}}function U(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function V(a,b,c,d){if(b)throw md("multidir",b.name,c.name,a,N(d))}function W(a,b){var c=d(b,!0);c&&a.push({priority:0,compile:function(a){a=a.parent();var b=!!a.length;return b&&G.$$addBindingClass(a),function(a,d){var e=d.parent();b||G.$$addBindingClass(e),G.$$addBindingInfo(e,c.expressions),a.$watch(c,function(a){d[0].nodeValue=a})}}})}function X(a,c){switch(a=xc(a||"html")){case"svg":case"math":var d=b.createElement("div");return d.innerHTML="<"+a+">"+c+"</"+a+">",d.childNodes[0].childNodes;default:return c}}function Z(a,b){if("srcdoc"==b)return A.HTML;var c=D(a);return"xlinkHref"==b||"form"==c&&"action"==b||"img"!=c&&("src"==b||"ngSrc"==b)?A.RESOURCE_URL:void 0}function _(a,b,c,e,f){var g=Z(a,e);f=l[e]||f;var h=d(c,!0,g,f);if(h){if("multiple"===e&&"select"===D(a))throw md("selmulti",N(a));b.push({priority:100,compile:function(){return{pre:function(a,b,i){if(b=i.$$observers||(i.$$observers={}),u.test(e))throw md("nodomevents");var j=i[e];j!==c&&(h=j&&d(j,!0,g,f),c=j),h&&(i[e]=h(a),(b[e]||(b[e]=[])).$$inter=!0,(i.$$observers&&i.$$observers[e].$$scope||a).$watch(h,function(a,b){"class"===e&&a!=b?i.$updateClass(a,b):i.$set(e,a)}))}}}})}}function aa(a,c,d){var e,f,g=c[0],h=c.length,i=g.parentNode;if(a)for(e=0,f=a.length;f>e;e++)if(a[e]==g){a[e++]=d,f=e+h-1;for(var j=a.length;j>e;e++,f++)j>f?a[e]=a[f]:delete a[e];a.length-=h-1,a.context===g&&(a.context=d);break}for(i&&i.replaceChild(d,g),a=b.createDocumentFragment(),a.appendChild(g),tc(d).data(tc(g).data()),uc?(Hc=!0,uc.cleanData([g])):delete tc.cache[g[tc.expando]],g=1,h=c.length;h>g;g++)i=c[g],tc(i).remove(),a.appendChild(i),delete c[g];c[0]=d,c.length=1}function ba(a,b){return k(function(){return a.apply(null,arguments)},a,b)}function ca(a,b,c,d,f,g){try{a(b,c,d,f,g)}catch(h){e(h,N(c))}}var ea=function(a,b){if(b){var c,d,e,f=Object.keys(b);for(c=0,d=f.length;d>c;c++)e=f[c],this[e]=b[e]}else this.$attr={};this.$$element=a};ea.prototype={$normalize:Oa,$addClass:function(a){a&&0<a.length&&B.addClass(this.$$element,a)},$removeClass:function(a){a&&0<a.length&&B.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=Pa(a,b);c&&c.length&&B.addClass(this.$$element,c),(c=Pa(b,a))&&c.length&&B.removeClass(this.$$element,c)},$set:function(a,b,d,g){var h=this.$$element[0],i=za(h,a),j=Aa(h,a),h=a;if(i?(this.$$element.prop(a,b),g=i):j&&(this[j]=b,h=j),this[a]=b,g?this.$attr[a]=g:(g=this.$attr[a])||(this.$attr[a]=g=Y(a,"-")),i=D(this.$$element),"a"===i&&"href"===a||"img"===i&&"src"===a)this[a]=b=C(b,"src"===a);else if("img"===i&&"srcset"===a){for(var i="",j=Jc(b),k=/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/,k=/\s/.test(j)?k:/(,)/,j=j.split(k),k=Math.floor(j.length/2),l=0;k>l;l++)var m=2*l,i=i+C(Jc(j[m]),!0),i=i+(" "+Jc(j[m+1]));j=Jc(j[2*l]).split(/\s/),i+=C(Jc(j[0]),!0),2===j.length&&(i+=" "+Jc(j[1])),this[a]=b=i}!1!==d&&(null===b||b===c?this.$$element.removeAttr(g):this.$$element.attr(g,b)),(a=this.$$observers)&&f(a[h],function(a){try{a(b)}catch(c){e(c)}})},$observe:function(a,b){var c=this,d=c.$$observers||(c.$$observers=da()),e=d[a]||(d[a]=[]);return e.push(b),x.$evalAsync(function(){!e.$$inter&&c.hasOwnProperty(a)&&b(c[a])}),function(){E(e,b)}}};var fa=d.startSymbol(),ga=d.endSymbol(),ha="{{"==fa||"}}"==ga?o:function(a){return a.replace(/\{\{/g,fa).replace(/}}/g,ga)},ia=/^ngAttr[A-Z]/;return G.$$addBindingInfo=v?function(a,b){var c=a.data("$binding")||[];Ic(b)?c=c.concat(b):c.push(b),a.data("$binding",c)}:n,G.$$addBindingClass=v?function(a){F(a,"ng-binding")}:n,G.$$addScopeInfo=v?function(a,b,c,d){a.data(c?d?"$isolateScopeNoTemplate":"$isolateScope":"$scope",b)}:n,G.$$addScopeClass=v?function(a,b){F(a,b?"ng-isolate-scope":"ng-scope")}:n,G}]}function Oa(a){return ga(a.replace(nd,""))}function Pa(a,b){var c="",d=a.split(/\s+/),e=b.split(/\s+/),f=0;a:for(;f<d.length;f++){for(var g=d[f],h=0;h<e.length;h++)if(g==e[h])continue a;c+=(0<c.length?" ":"")+g}return c}function Qa(a){a=tc(a);var b=a.length;if(1>=b)return a;for(;b--;)8===a[b].nodeType&&Bc.call(a,b,1);return a}function Ra(){var a={},b=!1,e=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(b,c){aa(b,"controller"),s(b)?k(a,b):a[b]=c},this.allowGlobals=function(){b=!0},this.$get=["$injector","$window",function(f,g){function h(a,b,c,e){if(!a||!s(a.$scope))throw d("$controller")("noscp",e,b);a.$scope[b]=c}return function(d,i,j,l){var m,n,o;if(j=!0===j,l&&t(l)&&(o=l),t(d)){if(l=d.match(e),!l)throw od("ctrlfmt",d);n=l[1],o=o||l[3],d=a.hasOwnProperty(n)?a[n]:ba(i.$scope,n,!0)||(b?ba(g,n,!0):c),_(d,n,!0)}return j?(j=(Ic(d)?d[d.length-1]:d).prototype,m=Object.create(j||null),o&&h(i,o,m,n||d.name),k(function(){return f.invoke(d,m,i,n),m},{instance:m,identifier:o})):(m=f.instantiate(d,i,n),o&&h(i,o,m,n||d.name),m)}}]}function Sa(){this.$get=["$window",function(a){return tc(a.document)}]}function Ta(){this.$get=["$log",function(a){return function(){a.error.apply(a,arguments)}}]}function Ua(a,b){if(t(a)){var c=a.replace(td,"").trim();if(c){var d=b("Content-Type");(d=d&&0===d.indexOf(pd))||(d=(d=c.match(rd))&&sd[d[0]].test(c)),d&&(a=M(c))}}return a}function Va(a){var b,c,d,e=da();return a?(f(a.split("\n"),function(a){d=a.indexOf(":"),b=xc(Jc(a.substr(0,d))),c=Jc(a.substr(d+1)),b&&(e[b]=e[b]?e[b]+", "+c:c)}),e):e}function Wa(a){var b=s(a)?a:c;return function(c){return b||(b=Va(a)),c?(c=b[xc(c)],void 0===c&&(c=null),c):b}}function Xa(a,b,c,d){return w(d)?d(a,b,c):(f(d,function(d){a=d(a,b,c)}),a)}function Ya(){var a=this.defaults={transformResponse:[Ua],transformRequest:[function(a){return s(a)&&"[object File]"!==Dc.call(a)&&"[object Blob]"!==Dc.call(a)&&"[object FormData]"!==Dc.call(a)?L(a):a}],headers:{common:{Accept:"application/json, text/plain, */*"},post:G(qd),put:G(qd),patch:G(qd)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},b=!1;this.useApplyAsync=function(a){return r(a)?(b=!!a,this):b};var e=this.interceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(h,i,j,l,m,n){function o(b){function e(a){var b=k({},a);return b.data=a.data?Xa(a.data,a.headers,a.status,h.transformResponse):a.data,a=a.status,a>=200&&300>a?b:m.reject(b)}function g(a){var b,c={};return f(a,function(a,d){w(a)?(b=a(),null!=b&&(c[d]=b)):c[d]=a}),c}if(!Fc.isObject(b))throw d("$http")("badreq",b);var h=k({method:"get",transformRequest:a.transformRequest,transformResponse:a.transformResponse},b);h.headers=function(b){var c,d,e=a.headers,f=k({},b.headers),e=k({},e.common,e[xc(b.method)]);a:for(c in e){b=xc(c);for(d in f)if(xc(d)===b)continue a;f[c]=e[c]}return g(f)}(b),h.method=zc(h.method);var i=[function(b){var d=b.headers,g=Xa(b.data,Wa(d),c,b.transformRequest);return q(g)&&f(d,function(a,b){"content-type"===xc(b)&&delete d[b]}),q(b.withCredentials)&&!q(a.withCredentials)&&(b.withCredentials=a.withCredentials),p(b,g).then(e,e)},c],j=m.when(h);for(f(y,function(a){(a.request||a.requestError)&&i.unshift(a.request,a.requestError),(a.response||a.responseError)&&i.push(a.response,a.responseError)});i.length;){b=i.shift();var l=i.shift(),j=j.then(b,l)}return j.success=function(a){return j.then(function(b){a(b.data,b.status,b.headers,h)}),j},j.error=function(a){return j.then(null,function(b){a(b.data,b.status,b.headers,h)}),j},j}function p(d,e){function f(a,c,d,e){function f(){g(c,a,d,e)}n&&(a>=200&&300>a?n.put(z,[a,c,Va(d),e]):n.remove(z)),b?l.$applyAsync(f):(f(),l.$$phase||l.$apply())}function g(a,b,c,e){b=Math.max(b,0),(b>=200&&300>b?t.resolve:t.reject)({data:a,status:b,headers:Wa(c),config:d,statusText:e})}function j(a){g(a.data,a.status,G(a.headers()),a.statusText)}function k(){var a=o.pendingRequests.indexOf(d);-1!==a&&o.pendingRequests.splice(a,1)}var n,p,t=m.defer(),v=t.promise,y=d.headers,z=u(d.url,d.params);return o.pendingRequests.push(d),v.then(k,k),!d.cache&&!a.cache||!1===d.cache||"GET"!==d.method&&"JSONP"!==d.method||(n=s(d.cache)?d.cache:s(a.cache)?a.cache:x),n&&(p=n.get(z),r(p)?p&&w(p.then)?p.then(j,j):Ic(p)?g(p[1],p[0],G(p[2]),p[3]):g(p,200,{},"OK"):n.put(z,v)),q(p)&&((p=Qb(d.url)?i.cookies()[d.xsrfCookieName||a.xsrfCookieName]:c)&&(y[d.xsrfHeaderName||a.xsrfHeaderName]=p),h(d.method,z,e,f,y,d.timeout,d.withCredentials,d.responseType)),v}function u(a,b){if(!b)return a;var c=[];return g(b,function(a,b){null===a||q(a)||(Ic(a)||(a=[a]),f(a,function(a){s(a)&&(a=v(a)?a.toISOString():L(a)),c.push(S(b)+"="+S(a))}))}),0<c.length&&(a+=(-1==a.indexOf("?")?"?":"&")+c.join("&")),a}var x=j("$http"),y=[];return f(e,function(a){y.unshift(t(a)?n.get(a):n.invoke(a))}),o.pendingRequests=[],function(){f(arguments,function(a){o[a]=function(b,c){return o(k(c||{},{method:a,url:b}))}})}("get","delete","head","jsonp"),function(){f(arguments,function(a){o[a]=function(b,c,d){return o(k(d||{},{method:a,url:b,data:c}))}})}("post","put","patch"),o.defaults=a,o}]}function Za(){return new a.XMLHttpRequest}function $a(){this.$get=["$browser","$window","$document",function(a,b,c){return _a(a,Za,a.defer,b.angular.callbacks,c[0])}]}function _a(a,b,d,e,g){function h(a,b,c){var d=g.createElement("script"),f=null;return d.type="text/javascript",d.src=a,d.async=!0,f=function(a){d.removeEventListener("load",f,!1),d.removeEventListener("error",f,!1),g.body.removeChild(d),d=null;var h=-1,i="unknown";a&&("load"!==a.type||e[b].called||(a={type:"error"}),i=a.type,h="error"===a.type?404:200),c&&c(h,i)},d.addEventListener("load",f,!1),d.addEventListener("error",f,!1),g.body.appendChild(d),f}return function(g,i,j,k,l,m,o,p){function q(){u&&u(),v&&v.abort()}function s(b,e,f,g,h){y!==c&&d.cancel(y),u=v=null,b(e,f,g,h),a.$$completeOutstandingRequest(n)}if(a.$$incOutstandingRequestCount(),i=i||a.url(),"jsonp"==xc(g)){var t="_"+(e.counter++).toString(36);e[t]=function(a){e[t].data=a,e[t].called=!0};var u=h(i.replace("JSON_CALLBACK","angular.callbacks."+t),t,function(a,b){s(k,a,e[t].data,"",b),e[t]=n})}else{var v=b();if(v.open(g,i,!0),f(l,function(a,b){r(a)&&v.setRequestHeader(b,a)}),v.onload=function(){var a=v.statusText||"",b="response"in v?v.response:v.responseText,c=1223===v.status?204:v.status;0===c&&(c=b?200:"file"==Pb(i).protocol?404:0),s(k,c,b,v.getAllResponseHeaders(),a)},g=function(){s(k,-1,null,null,"")},v.onerror=g,v.onabort=g,o&&(v.withCredentials=!0),p)try{v.responseType=p}catch(x){if("json"!==p)throw x}v.send(j||null)}if(m>0)var y=d(q,m);else m&&w(m.then)&&m.then(q)}}function ab(){var a="{{",b="}}";this.startSymbol=function(b){return b?(a=b,this):a},this.endSymbol=function(a){return a?(b=a,this):b},this.$get=["$parse","$exceptionHandler","$sce",function(c,d,e){function f(a){return"\\\\\\"+a}function g(f,g,m,n){function o(c){return c.replace(j,a).replace(l,b)}function p(a){try{var b=a;a=m?e.getTrusted(m,b):e.valueOf(b);var c;if(n&&!r(a))c=a;else if(null==a)c="";else{switch(typeof a){case"string":break;case"number":a=""+a;break;default:a=L(a)}c=a}return c}catch(g){c=ud("interr",f,g.toString()),d(c)}}n=!!n;for(var s,t,u=0,v=[],x=[],y=f.length,z=[],A=[];y>u;){if(-1==(s=f.indexOf(a,u))||-1==(t=f.indexOf(b,s+h))){u!==y&&z.push(o(f.substring(u)));break}u!==s&&z.push(o(f.substring(u,s))),u=f.substring(s+h,t),v.push(u),x.push(c(u,p)),u=t+i,A.push(z.length),z.push("")}if(m&&1<z.length)throw ud("noconcat",f);if(!g||v.length){var B=function(a){for(var b=0,c=v.length;c>b;b++){if(n&&q(a[b]))return;z[A[b]]=a[b]}return z.join("")};return k(function(a){var b=0,c=v.length,e=Array(c);try{for(;c>b;b++)e[b]=x[b](a);return B(e)}catch(g){a=ud("interr",f,g.toString()),d(a)}},{exp:f,expressions:v,$$watchDelegate:function(a,b,c){var d;return a.$watchGroup(x,function(c,e){var f=B(c);w(b)&&b.call(this,f,c!==e?d:f,a),d=f},c)}})}}var h=a.length,i=b.length,j=new RegExp(a.replace(/./g,f),"g"),l=new RegExp(b.replace(/./g,f),"g");return g.startSymbol=function(){return a},g.endSymbol=function(){return b},g}]}function bb(){this.$get=["$rootScope","$window","$q","$$q",function(a,b,c,d){function e(e,g,h,i){var j=b.setInterval,k=b.clearInterval,l=0,m=r(i)&&!i,n=(m?d:c).defer(),o=n.promise;return h=r(h)?h:0,o.then(null,null,e),o.$$intervalId=j(function(){n.notify(l++),h>0&&l>=h&&(n.resolve(l),k(o.$$intervalId),delete f[o.$$intervalId]),m||a.$apply()},g),f[o.$$intervalId]=n,o}var f={};return e.cancel=function(a){return a&&a.$$intervalId in f?(f[a.$$intervalId].reject("canceled"),b.clearInterval(a.$$intervalId),delete f[a.$$intervalId],!0):!1},e}]}function cb(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"¤",posSuf:"",negPre:"(¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January February March April May June July August September October November December".split(" "),SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a",ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"]},pluralCat:function(a){return 1===a?"one":"other"}}}}function db(a){a=a.split("/");for(var b=a.length;b--;)a[b]=R(a[b]);return a.join("/")}function eb(a,b){var c=Pb(a);b.$$protocol=c.protocol,b.$$host=c.hostname,b.$$port=l(c.port)||wd[c.protocol]||null}function fb(a,b){var c="/"!==a.charAt(0);c&&(a="/"+a);var d=Pb(a);b.$$path=decodeURIComponent(c&&"/"===d.pathname.charAt(0)?d.pathname.substring(1):d.pathname),b.$$search=P(d.search),b.$$hash=decodeURIComponent(d.hash),b.$$path&&"/"!=b.$$path.charAt(0)&&(b.$$path="/"+b.$$path)}function gb(a,b){return 0===b.indexOf(a)?b.substr(a.length):void 0}function hb(a){var b=a.indexOf("#");return-1==b?a:a.substr(0,b)}function ib(a){return a.replace(/(#.+)|#$/,"$1")}function jb(a){return a.substr(0,hb(a).lastIndexOf("/")+1)}function kb(a,b){this.$$html5=!0,b=b||"";var d=jb(a);eb(a,this),this.$$parse=function(a){var b=gb(d,a);if(!t(b))throw xd("ipthprfx",a,d);fb(b,this),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var a=Q(this.$$search),b=this.$$hash?"#"+R(this.$$hash):"";this.$$url=db(this.$$path)+(a?"?"+a:"")+b,this.$$absUrl=d+this.$$url.substr(1)},this.$$parseLinkUrl=function(e,f){if(f&&"#"===f[0])return this.hash(f.slice(1)),!0;var g,h;return(g=gb(a,e))!==c?(h=g,h=(g=gb(b,g))!==c?d+(gb("/",g)||g):a+h):(g=gb(d,e))!==c?h=d+g:d==e+"/"&&(h=d),h&&this.$$parse(h),!!h}}function lb(a,b){var c=jb(a);eb(a,this),this.$$parse=function(d){d=gb(a,d)||gb(c,d);var e;"#"===d.charAt(0)?(e=gb(b,d),q(e)&&(e=d)):e=this.$$html5?d:"",fb(e,this),d=this.$$path;var f=/^\/[A-Z]:(\/.*)/;0===e.indexOf(a)&&(e=e.replace(a,"")),f.exec(e)||(d=(e=f.exec(d))?e[1]:d),this.$$path=d,this.$$compose()},this.$$compose=function(){var c=Q(this.$$search),d=this.$$hash?"#"+R(this.$$hash):"";this.$$url=db(this.$$path)+(c?"?"+c:"")+d,this.$$absUrl=a+(this.$$url?b+this.$$url:"")},this.$$parseLinkUrl=function(b){return hb(a)==hb(b)?(this.$$parse(b),!0):!1}}function mb(a,b){this.$$html5=!0,lb.apply(this,arguments);var c=jb(a);this.$$parseLinkUrl=function(d,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,g;return a==hb(d)?f=d:(g=gb(c,d))?f=a+b+g:c===d+"/"&&(f=c),f&&this.$$parse(f),!!f},this.$$compose=function(){var c=Q(this.$$search),d=this.$$hash?"#"+R(this.$$hash):"";this.$$url=db(this.$$path)+(c?"?"+c:"")+d,this.$$absUrl=a+b+this.$$url}}function nb(a){return function(){return this[a]}}function ob(a,b){return function(c){return q(c)?this[a]:(this[a]=b(c),this.$$compose(),this)}}function pb(){var a="",b={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(b){return r(b)?(a=b,this):a},this.html5Mode=function(a){return A(a)?(b.enabled=a,this):s(a)?(A(a.enabled)&&(b.enabled=a.enabled),A(a.requireBase)&&(b.requireBase=a.requireBase),A(a.rewriteLinks)&&(b.rewriteLinks=a.rewriteLinks),this):b},this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function(c,d,e,f,g){function h(a,b,c){var e=j.url(),f=j.$$state;try{d.url(a,b,c),j.$$state=d.state()}catch(g){throw j.url(e),j.$$state=f,g}}function i(a,b){c.$broadcast("$locationChangeSuccess",j.absUrl(),a,j.$$state,b)}var j,k;k=d.baseHref();var l,m=d.url();if(b.enabled){if(!k&&b.requireBase)throw xd("nobase");l=m.substring(0,m.indexOf("/",m.indexOf("//")+2))+(k||"/"),k=e.history?kb:mb}else l=hb(m),k=lb;j=new k(l,"#"+a),j.$$parseLinkUrl(m,m),j.$$state=d.state();var n=/^\s*(javascript|mailto):/i;f.on("click",function(a){if(b.rewriteLinks&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&2!=a.which&&2!=a.button){for(var e=tc(a.target);"a"!==D(e[0]);)if(e[0]===f[0]||!(e=e.parent())[0])return;var h=e.prop("href"),i=e.attr("href")||e.attr("xlink:href");s(h)&&"[object SVGAnimatedString]"===h.toString()&&(h=Pb(h.animVal).href),n.test(h)||!h||e.attr("target")||a.isDefaultPrevented()||!j.$$parseLinkUrl(h,i)||(a.preventDefault(),j.absUrl()!=d.url()&&(c.$apply(),g.angular["ff-684208-preventDefault"]=!0))}}),ib(j.absUrl())!=ib(m)&&d.url(j.absUrl(),!0);var o=!0;return d.onUrlChange(function(a,b){c.$evalAsync(function(){var d,e=j.absUrl(),f=j.$$state;j.$$parse(a),j.$$state=b,d=c.$broadcast("$locationChangeStart",a,e,b,f).defaultPrevented,j.absUrl()===a&&(d?(j.$$parse(e),j.$$state=f,h(e,!1,f)):(o=!1,i(e,f)))}),c.$$phase||c.$digest()}),c.$watch(function(){var a=ib(d.url()),b=ib(j.absUrl()),f=d.state(),g=j.$$replace,k=a!==b||j.$$html5&&e.history&&f!==j.$$state;(o||k)&&(o=!1,c.$evalAsync(function(){var b=j.absUrl(),d=c.$broadcast("$locationChangeStart",b,a,j.$$state,f).defaultPrevented;j.absUrl()===b&&(d?(j.$$parse(a),j.$$state=f):(k&&h(b,g,f===j.$$state?null:j.$$state),i(a,f)))})),j.$$replace=!1}),j}]}function qb(){var a=!0,b=this;this.debugEnabled=function(b){return r(b)?(a=b,this):a},this.$get=["$window",function(c){function d(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function e(a){var b=c.console||{},e=b[a]||b.log||n;a=!1;try{a=!!e.apply}catch(g){}return a?function(){var a=[];return f(arguments,function(b){a.push(d(b))}),e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){a&&c.apply(b,arguments)}}()}}]}function rb(a,b){if("__defineGetter__"===a||"__defineSetter__"===a||"__lookupGetter__"===a||"__lookupSetter__"===a||"__proto__"===a)throw zd("isecfld",b);return a}function sb(a,b){if(a){if(a.constructor===a)throw zd("isecfn",b);if(a.window===a)throw zd("isecwindow",b);if(a.children&&(a.nodeName||a.prop&&a.attr&&a.find))throw zd("isecdom",b);if(a===Object)throw zd("isecobj",b)}return a}function tb(a){return a.constant}function ub(a,b,c,d,e){sb(a,e),sb(b,e),c=c.split(".");for(var f,g=0;1<c.length;g++){f=rb(c.shift(),e);var h=0===g&&b&&b[f]||a[f];h||(h={},a[f]=h),a=sb(h,e)}return f=rb(c.shift(),e),sb(a[f],e),a[f]=d}function vb(a){return"constructor"==a}function wb(a,b,d,e,f,g,h){rb(a,g),rb(b,g),rb(d,g),rb(e,g),rb(f,g);var i=function(a){return sb(a,g)},j=h||vb(a)?i:o,k=h||vb(b)?i:o,l=h||vb(d)?i:o,m=h||vb(e)?i:o,n=h||vb(f)?i:o;return function(g,h){var i=h&&h.hasOwnProperty(a)?h:g;return null==i?i:(i=j(i[a]),b?null==i?c:(i=k(i[b]),d?null==i?c:(i=l(i[d]),e?null==i?c:(i=m(i[e]),f?null==i?c:i=n(i[f]):i):i):i):i)}}function xb(a,b){return function(c,d){return a(c,d,sb,b)}}function yb(a,b,d){var e=b.expensiveChecks,g=e?Jd:Id,h=g[a];if(h)return h;var i=a.split("."),j=i.length;if(b.csp)h=6>j?wb(i[0],i[1],i[2],i[3],i[4],d,e):function(a,b){var f,g=0;do f=wb(i[g++],i[g++],i[g++],i[g++],i[g++],d,e)(a,b),b=c,a=f;while(j>g);return f};else{var k="";e&&(k+="s = eso(s, fe);\nl = eso(l, fe);\n");var l=e;f(i,function(a,b){rb(a,d);var c=(b?"s":'((l&&l.hasOwnProperty("'+a+'"))?l:s)')+"."+a;(e||vb(a))&&(c="eso("+c+", fe)",l=!0),k+="if(s == null) return undefined;\ns="+c+";\n"}),k+="return s;",b=new Function("s","l","eso","fe",k),b.toString=p(k),l&&(b=xb(b,d)),h=b}return h.sharedGetter=!0,h.assign=function(b,c,d){return ub(b,d,a,c,a)},g[a]=h}function zb(a){return w(a.valueOf)?a.valueOf():Kd.call(a)}function Ab(){var a=da(),b=da();this.$get=["$filter","$sniffer",function(c,d){function e(a){var b=a;return a.sharedGetter&&(b=function(b,c){return a(b,c)},b.literal=a.literal,b.constant=a.constant,b.assign=a.assign),b}function g(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];e.constant||(e.inputs?g(e.inputs,b):-1===b.indexOf(e)&&b.push(e))}return b}function h(a,b){return null==a||null==b?a===b:"object"==typeof a&&(a=zb(a),"object"==typeof a)?!1:a===b||a!==a&&b!==b}function i(a,b,c,d){var e,f=d.$$inputs||(d.$$inputs=g(d.inputs,[]));if(1===f.length){var i=h,f=f[0];return a.$watch(function(a){var b=f(a);return h(b,i)||(e=d(a),i=b&&zb(b)),e},b,c)}for(var j=[],k=0,l=f.length;l>k;k++)j[k]=h;return a.$watch(function(a){for(var b=!1,c=0,g=f.length;g>c;c++){var i=f[c](a);(b||(b=!h(i,j[c])))&&(j[c]=i&&zb(i))}return b&&(e=d(a)),e},b,c)}function j(a,b,c,d){var e,f;return e=a.$watch(function(a){return d(a)},function(a,c,d){f=a,w(b)&&b.apply(this,arguments),r(a)&&d.$$postDigest(function(){r(f)&&e()})},c)}function k(a,b,c,d){function e(a){var b=!0;return f(a,function(a){r(a)||(b=!1)}),b}var g,h;return g=a.$watch(function(a){return d(a)},function(a,c,d){h=a,w(b)&&b.call(this,a,c,d),e(a)&&d.$$postDigest(function(){e(h)&&g()})},c)}function l(a,b,c,d){var e;return e=a.$watch(function(a){return d(a)},function(){w(b)&&b.apply(this,arguments),e()},c)}function m(a,b){if(!b)return a;var c=a.$$watchDelegate,c=c!==k&&c!==j?function(c,d){var e=a(c,d);return b(e,c,d)}:function(c,d){var e=a(c,d),f=b(e,c,d);return r(e)?f:e};return a.$$watchDelegate&&a.$$watchDelegate!==i?c.$$watchDelegate=a.$$watchDelegate:b.$stateful||(c.$$watchDelegate=i,c.inputs=[a]),c}var o={csp:d.csp,expensiveChecks:!1},p={csp:d.csp,expensiveChecks:!0};return function(d,f,g){var h,q,r;switch(typeof d){case"string":r=d=d.trim();var s=g?b:a;return h=s[r],h||(":"===d.charAt(0)&&":"===d.charAt(1)&&(q=!0,d=d.substring(2)),g=g?p:o,h=new Gd(g),h=new Hd(h,c,g).parse(d),h.constant?h.$$watchDelegate=l:q?(h=e(h),h.$$watchDelegate=h.literal?k:j):h.inputs&&(h.$$watchDelegate=i),s[r]=h),m(h,f);case"function":return m(d,f);default:return m(n,f)}}}]}function Bb(){this.$get=["$rootScope","$exceptionHandler",function(a,b){return Db(function(b){a.$evalAsync(b)},b)}]}function Cb(){this.$get=["$browser","$exceptionHandler",function(a,b){return Db(function(b){a.defer(b)},b)}]}function Db(a,b){function e(a,b,c){function d(b){return function(c){e||(e=!0,b.call(a,c))}}var e=!1;return[d(b),d(c)]}function g(){this.$$state={status:0}}function h(a,b){return function(c){b.call(a,c)}}function i(d){!d.processScheduled&&d.pending&&(d.processScheduled=!0,a(function(){var a,e,f;f=d.pending,d.processScheduled=!1,d.pending=c;for(var g=0,h=f.length;h>g;++g){e=f[g][0],a=f[g][d.status];try{w(a)?e.resolve(a(d.value)):1===d.status?e.resolve(d.value):e.reject(d.value)}catch(i){e.reject(i),b(i)}}}))}function j(){this.promise=new g,this.resolve=h(this,this.resolve),this.reject=h(this,this.reject),this.notify=h(this,this.notify)}var k=d("$q",TypeError);g.prototype={then:function(a,b,c){var d=new j;return this.$$state.pending=this.$$state.pending||[],this.$$state.pending.push([d,a,b,c]),0<this.$$state.status&&i(this.$$state),d.promise},"catch":function(a){return this.then(null,a)},"finally":function(a,b){return this.then(function(b){return m(b,!0,a)},function(b){return m(b,!1,a)},b)}},j.prototype={resolve:function(a){this.promise.$$state.status||(a===this.promise?this.$$reject(k("qcycle",a)):this.$$resolve(a))},$$resolve:function(a){var c,d;d=e(this,this.$$resolve,this.$$reject);try{(s(a)||w(a))&&(c=a&&a.then),w(c)?(this.promise.$$state.status=-1,c.call(a,d[0],d[1],this.notify)):(this.promise.$$state.value=a,this.promise.$$state.status=1,i(this.promise.$$state))}catch(f){d[1](f),b(f)}},reject:function(a){this.promise.$$state.status||this.$$reject(a)},$$reject:function(a){this.promise.$$state.value=a,this.promise.$$state.status=2,i(this.promise.$$state)},notify:function(c){var d=this.promise.$$state.pending;0>=this.promise.$$state.status&&d&&d.length&&a(function(){for(var a,e,f=0,g=d.length;g>f;f++){e=d[f][0],a=d[f][3];try{e.notify(w(a)?a(c):c)}catch(h){b(h)}}})}};var l=function(a,b){var c=new j;return b?c.resolve(a):c.reject(a),c.promise},m=function(a,b,c){var d=null;try{w(c)&&(d=c())}catch(e){return l(e,!1)}return d&&w(d.then)?d.then(function(){return l(a,b)},function(a){return l(a,!1)}):l(a,b)},n=function(a,b,c,d){var e=new j;return e.resolve(a),e.promise.then(b,c,d)},o=function p(a){if(!w(a))throw k("norslvr",a);if(!(this instanceof p))return new p(a);var b=new j;return a(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise};return o.defer=function(){return new j},o.reject=function(a){var b=new j;return b.reject(a),b.promise},o.when=n,o.all=function(a){var b=new j,c=0,d=Ic(a)?[]:{};return f(a,function(a,e){c++,n(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},function(a){d.hasOwnProperty(e)||b.reject(a)})}),0===c&&b.resolve(d),b.promise},o}function Eb(){this.$get=["$window","$timeout",function(a,b){var c=a.requestAnimationFrame||a.webkitRequestAnimationFrame,d=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame,e=!!c,f=e?function(a){var b=c(a);return function(){d(b)}}:function(a){var c=b(a,16.66,!1);return function(){b.cancel(c)}};return f.supported=e,f}]}function Fb(){function a(a){function b(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$id=++Gc,this.$$ChildScope=null}return b.prototype=a,b}var b=10,c=d("$rootScope"),g=null,h=null;this.digestTtl=function(a){return arguments.length&&(b=a),b},this.$get=["$injector","$exceptionHandler","$parse","$browser",function(d,i,j,k){function l(a){a.currentScope.$$destroyed=!0}function m(){this.$id=++Gc,this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this.$root=this,this.$$destroyed=!1,this.$$listeners={},this.$$listenerCount={},this.$$isolateBindings=null}function o(a){if(v.$$phase)throw c("inprog",v.$$phase);v.$$phase=a}function p(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function r(){}function t(){for(;z.length;)try{z.shift()()}catch(a){i(a)}h=null}function u(){null===h&&(h=k.defer(function(){v.$apply(t)}))}m.prototype={constructor:m,$new:function(b,c){var d;return c=c||this,b?(d=new m,d.$root=this.$root):(this.$$ChildScope||(this.$$ChildScope=a(this)),d=new this.$$ChildScope),d.$parent=c,d.$$prevSibling=c.$$childTail,c.$$childHead?(c.$$childTail.$$nextSibling=d,c.$$childTail=d):c.$$childHead=c.$$childTail=d,(b||c!=this)&&d.$on("$destroy",l),d},$watch:function(a,b,c){var d=j(a);if(d.$$watchDelegate)return d.$$watchDelegate(this,b,c,d);var e=this.$$watchers,f={fn:b,last:r,get:d,exp:a,eq:!!c};return g=null,w(b)||(f.fn=n),e||(e=this.$$watchers=[]),e.unshift(f),function(){E(e,f),g=null}},$watchGroup:function(a,b){function c(){i=!1,j?(j=!1,b(e,e,h)):b(e,d,h)}var d=Array(a.length),e=Array(a.length),g=[],h=this,i=!1,j=!0;if(!a.length){var k=!0;return h.$evalAsync(function(){k&&b(e,e,h)}),function(){k=!1}}return 1===a.length?this.$watch(a[0],function(a,c,f){e[0]=a,d[0]=c,b(e,a===c?e:d,f)}):(f(a,function(a,b){var f=h.$watch(a,function(a,f){e[b]=a,d[b]=f,i||(i=!0,h.$evalAsync(c))});g.push(f)}),function(){for(;g.length;)g.shift()()})},$watchCollection:function(a,b){function c(a){d=a;var b,c,g,h;if(!q(d)){if(s(d))if(e(d))for(f!==m&&(f=m,p=f.length=0,k++),a=d.length,p!==a&&(k++,f.length=p=a),b=0;a>b;b++)h=f[b],g=d[b],c=h!==h&&g!==g,c||h===g||(k++,f[b]=g);else{f!==n&&(f=n={},p=0,k++),a=0;for(b in d)d.hasOwnProperty(b)&&(a++,g=d[b],h=f[b],b in f?(c=h!==h&&g!==g,c||h===g||(k++,f[b]=g)):(p++,f[b]=g,k++));if(p>a)for(b in k++,f)d.hasOwnProperty(b)||(p--,delete f[b])}else f!==d&&(f=d,k++);return k}}c.$stateful=!0;var d,f,g,h=this,i=1<b.length,k=0,l=j(a,c),m=[],n={},o=!0,p=0;return this.$watch(l,function(){if(o?(o=!1,b(d,d,h)):b(d,g,h),i)if(s(d))if(e(d)){g=Array(d.length);for(var a=0;a<d.length;a++)g[a]=d[a]}else for(a in g={},d)yc.call(d,a)&&(g[a]=d[a]);else g=d})},$digest:function(){var a,d,e,f,j,l,m,n,p,q=b,s=[];o("$digest"),k.$$checkUrlChange(),this===v&&null!==h&&(k.defer.cancel(h),t()),g=null;do{for(l=!1,m=this;x.length;){try{p=x.shift(),p.scope.$eval(p.expression,p.locals)}catch(u){i(u)}g=null}a:do{if(f=m.$$watchers)for(j=f.length;j--;)try{if(a=f[j])if((d=a.get(m))===(e=a.last)||(a.eq?H(d,e):"number"==typeof d&&"number"==typeof e&&isNaN(d)&&isNaN(e))){if(a===g){l=!1;break a}}else l=!0,g=a,a.last=a.eq?F(d,null):d,a.fn(d,e===r?d:e,m),5>q&&(n=4-q,s[n]||(s[n]=[]),s[n].push({msg:w(a.exp)?"fn: "+(a.exp.name||a.exp.toString()):a.exp,newVal:d,oldVal:e}))}catch(z){i(z)}if(!(f=m.$$childHead||m!==this&&m.$$nextSibling))for(;m!==this&&!(f=m.$$nextSibling);)m=m.$parent}while(m=f);if((l||x.length)&&!q--)throw v.$$phase=null,c("infdig",b,s)}while(l||x.length);for(v.$$phase=null;y.length;)try{y.shift()()}catch(A){i(A)}},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;if(this.$broadcast("$destroy"),this.$$destroyed=!0,this!==v){for(var b in this.$$listenerCount)p(this,this.$$listenerCount[b],b);a.$$childHead==this&&(a.$$childHead=this.$$nextSibling),a.$$childTail==this&&(a.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=n,this.$on=this.$watch=this.$watchGroup=function(){return n},this.$$listeners={},this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=this.$$watchers=null}}},$eval:function(a,b){return j(a)(this,b)},$evalAsync:function(a,b){v.$$phase||x.length||k.defer(function(){x.length&&v.$digest()}),x.push({scope:this,expression:a,locals:b})},$$postDigest:function(a){y.push(a)},$apply:function(a){try{return o("$apply"),this.$eval(a)}catch(b){i(b)}finally{v.$$phase=null;try{v.$digest()}catch(c){throw i(c),c}}},$applyAsync:function(a){function b(){c.$eval(a)}var c=this;a&&z.push(b),u()},$on:function(a,b){var c=this.$$listeners[a];

c||(this.$$listeners[a]=c=[]),c.push(b);var d=this;do d.$$listenerCount[a]||(d.$$listenerCount[a]=0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){var d=c.indexOf(b);-1!==d&&(c[d]=null,p(e,1,a))}},$emit:function(a){var b,c,d,e=[],f=this,g=!1,h={name:a,targetScope:f,stopPropagation:function(){g=!0},preventDefault:function(){h.defaultPrevented=!0},defaultPrevented:!1},j=I([h],arguments,1);do{for(b=f.$$listeners[a]||e,h.currentScope=f,c=0,d=b.length;d>c;c++)if(b[c])try{b[c].apply(null,j)}catch(k){i(k)}else b.splice(c,1),c--,d--;if(g)return h.currentScope=null,h;f=f.$parent}while(f);return h.currentScope=null,h},$broadcast:function(a){var b=this,c=this,d={name:a,targetScope:this,preventDefault:function(){d.defaultPrevented=!0},defaultPrevented:!1};if(!this.$$listenerCount[a])return d;for(var e,f,g=I([d],arguments,1);b=c;){for(d.currentScope=b,c=b.$$listeners[a]||[],e=0,f=c.length;f>e;e++)if(c[e])try{c[e].apply(null,g)}catch(h){i(h)}else c.splice(e,1),e--,f--;if(!(c=b.$$listenerCount[a]&&b.$$childHead||b!==this&&b.$$nextSibling))for(;b!==this&&!(c=b.$$nextSibling);)b=b.$parent}return d.currentScope=null,d}};var v=new m,x=v.$$asyncQueue=[],y=v.$$postDigestQueue=[],z=v.$$applyAsyncQueue=[];return v}]}function Gb(){var a=/^\s*(https?|ftp|mailto|tel|file):/,b=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(b){return r(b)?(a=b,this):a},this.imgSrcSanitizationWhitelist=function(a){return r(a)?(b=a,this):b},this.$get=function(){return function(c,d){var e,f=d?b:a;return e=Pb(c).href,""===e||e.match(f)?c:"unsafe:"+e}}}function Hb(a){if("self"===a)return a;if(t(a)){if(-1<a.indexOf("***"))throw Ld("iwcard",a);return a=Kc(a).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*"),new RegExp("^"+a+"$")}if(x(a))return new RegExp("^"+a.source+"$");throw Ld("imatcher")}function Ib(a){var b=[];return r(a)&&f(a,function(a){b.push(Hb(a))}),b}function Jb(){this.SCE_CONTEXTS=Md;var a=["self"],b=[];this.resourceUrlWhitelist=function(b){return arguments.length&&(a=Ib(b)),a},this.resourceUrlBlacklist=function(a){return arguments.length&&(b=Ib(a)),b},this.$get=["$injector",function(d){function e(a,b){return"self"===a?Qb(b):!!a.exec(b.href)}function f(a){var b=function(a){this.$$unwrapTrustedValue=function(){return a}};return a&&(b.prototype=new a),b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},b}var g=function(){throw Ld("unsafe")};d.has("$sanitize")&&(g=d.get("$sanitize"));var h=f(),i={};return i[Md.HTML]=f(h),i[Md.CSS]=f(h),i[Md.URL]=f(h),i[Md.JS]=f(h),i[Md.RESOURCE_URL]=f(i[Md.URL]),{trustAs:function(a,b){var d=i.hasOwnProperty(a)?i[a]:null;if(!d)throw Ld("icontext",a,b);if(null===b||b===c||""===b)return b;if("string"!=typeof b)throw Ld("itype",a);return new d(b)},getTrusted:function(d,f){if(null===f||f===c||""===f)return f;var h=i.hasOwnProperty(d)?i[d]:null;if(h&&f instanceof h)return f.$$unwrapTrustedValue();if(d===Md.RESOURCE_URL){var j,k,h=Pb(f.toString()),l=!1;for(j=0,k=a.length;k>j;j++)if(e(a[j],h)){l=!0;break}if(l)for(j=0,k=b.length;k>j;j++)if(e(b[j],h)){l=!1;break}if(l)return f;throw Ld("insecurl",f.toString())}if(d===Md.HTML)return g(f);throw Ld("unsafe")},valueOf:function(a){return a instanceof h?a.$$unwrapTrustedValue():a}}}]}function Kb(){var a=!0;this.enabled=function(b){return arguments.length&&(a=!!b),a},this.$get=["$parse","$sceDelegate",function(b,c){if(a&&8>sc)throw Ld("iequirks");var d=G(Md);d.isEnabled=function(){return a},d.trustAs=c.trustAs,d.getTrusted=c.getTrusted,d.valueOf=c.valueOf,a||(d.trustAs=d.getTrusted=function(a,b){return b},d.valueOf=o),d.parseAs=function(a,c){var e=b(c);return e.literal&&e.constant?e:b(c,function(b){return d.getTrusted(a,b)})};var e=d.parseAs,g=d.getTrusted,h=d.trustAs;return f(Md,function(a,b){var c=xc(b);d[ga("parse_as_"+c)]=function(b){return e(a,b)},d[ga("get_trusted_"+c)]=function(b){return g(a,b)},d[ga("trust_as_"+c)]=function(b){return h(a,b)}}),d}]}function Lb(){this.$get=["$window","$document",function(a,b){var c,d={},e=l((/android (\d+)/.exec(xc((a.navigator||{}).userAgent))||[])[1]),f=/Boxee/i.test((a.navigator||{}).userAgent),g=b[0]||{},h=/^(Moz|webkit|ms)(?=[A-Z])/,i=g.body&&g.body.style,j=!1,k=!1;if(i){for(var m in i)if(j=h.exec(m)){c=j[0],c=c.substr(0,1).toUpperCase()+c.substr(1);break}c||(c="WebkitOpacity"in i&&"webkit"),j=!!("transition"in i||c+"Transition"in i),k=!!("animation"in i||c+"Animation"in i),!e||j&&k||(j=t(g.body.style.webkitTransition),k=t(g.body.style.webkitAnimation))}return{history:!(!a.history||!a.history.pushState||4>e||f),hasEvent:function(a){if("input"===a&&11>=sc)return!1;if(q(d[a])){var b=g.createElement("div");d[a]="on"+a in b}return d[a]},csp:Lc(),vendorPrefix:c,transitions:j,animations:k,android:e}}]}function Mb(){this.$get=["$templateCache","$http","$q",function(a,b,c){function d(e,f){d.totalPendingRequests++;var g=b.defaults&&b.defaults.transformResponse;return Ic(g)?g=g.filter(function(a){return a!==Ua}):g===Ua&&(g=null),b.get(e,{cache:a,transformResponse:g})["finally"](function(){d.totalPendingRequests--}).then(function(a){return a.data},function(a){if(!f)throw md("tpload",e);return c.reject(a)})}return d.totalPendingRequests=0,d}]}function Nb(){this.$get=["$rootScope","$browser","$location",function(a,b,c){return{findBindings:function(a,b,c){a=a.getElementsByClassName("ng-binding");var d=[];return f(a,function(a){var e=Fc.element(a).data("$binding");e&&f(e,function(e){c?new RegExp("(^|\\s)"+Kc(b)+"(\\s|\\||$)").test(e)&&d.push(a):-1!=e.indexOf(b)&&d.push(a)})}),d},findModels:function(a,b,c){for(var d=["ng-","data-ng-","ng\\:"],e=0;e<d.length;++e){var f=a.querySelectorAll("["+d[e]+"model"+(c?"=":"*=")+'"'+b+'"]');if(f.length)return f}},getLocation:function(){return c.url()},setLocation:function(b){b!==c.url()&&(c.url(b),a.$digest())},whenStable:function(a){b.notifyWhenNoOutstandingRequests(a)}}}]}function Ob(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",function(a,b,c,d,e){function f(f,h,i){var j=r(i)&&!i,k=(j?d:c).defer(),l=k.promise;return h=b.defer(function(){try{k.resolve(f())}catch(b){k.reject(b),e(b)}finally{delete g[l.$$timeoutId]}j||a.$apply()},h),l.$$timeoutId=h,g[h]=k,l}var g={};return f.cancel=function(a){return a&&a.$$timeoutId in g?(g[a.$$timeoutId].reject("canceled"),delete g[a.$$timeoutId],b.defer.cancel(a.$$timeoutId)):!1},f}]}function Pb(a){return sc&&(Nd.setAttribute("href",a),a=Nd.href),Nd.setAttribute("href",a),{href:Nd.href,protocol:Nd.protocol?Nd.protocol.replace(/:$/,""):"",host:Nd.host,search:Nd.search?Nd.search.replace(/^\?/,""):"",hash:Nd.hash?Nd.hash.replace(/^#/,""):"",hostname:Nd.hostname,port:Nd.port,pathname:"/"===Nd.pathname.charAt(0)?Nd.pathname:"/"+Nd.pathname}}function Qb(a){return a=t(a)?Pb(a):a,a.protocol===Od.protocol&&a.host===Od.host}function Rb(){this.$get=p(a)}function Sb(a){function b(c,d){if(s(c)){var e={};return f(c,function(a,c){e[c]=b(c,a)}),e}return a.factory(c+"Filter",d)}this.register=b,this.$get=["$injector",function(a){return function(b){return a.get(b+"Filter")}}],b("currency",Wb),b("date",dc),b("filter",Tb),b("json",ec),b("limitTo",fc),b("lowercase",Td),b("number",Xb),b("orderBy",gc),b("uppercase",Ud)}function Tb(){return function(a,b,c){if(!Ic(a))return a;var d;switch(typeof b){case"function":break;case"boolean":case"number":case"string":d=!0;case"object":b=Ub(b,c,d);break;default:return a}return a.filter(b)}}function Ub(a,b,c){var d=s(a)&&"$"in a;return!0===b?b=H:w(b)||(b=function(a,b){return s(a)||s(b)?!1:(a=xc(""+a),b=xc(""+b),-1!==a.indexOf(b))}),function(e){return d&&!s(e)?Vb(e,a.$,b,!1):Vb(e,a,b,c)}}function Vb(a,b,c,d,e){var f=null!==a?typeof a:"null",g=null!==b?typeof b:"null";if("string"===g&&"!"===b.charAt(0))return!Vb(a,b.substring(1),c,d);if(Ic(a))return a.some(function(a){return Vb(a,b,c,d)});switch(f){case"object":var h;if(d){for(h in a)if("$"!==h.charAt(0)&&Vb(a[h],b,c,!0))return!0;return e?!1:Vb(a,b,c,!1)}if("object"===g){for(h in b)if(e=b[h],!w(e)&&!q(e)&&(f="$"===h,!Vb(f?a:a[h],e,c,f,f)))return!1;return!0}return c(a,b);case"function":return!1;default:return c(a,b)}}function Wb(a){var b=a.NUMBER_FORMATS;return function(a,c,d){return q(c)&&(c=b.CURRENCY_SYM),q(d)&&(d=b.PATTERNS[1].maxFrac),null==a?a:Yb(a,b.PATTERNS[1],b.GROUP_SEP,b.DECIMAL_SEP,d).replace(/\u00A4/g,c)}}function Xb(a){var b=a.NUMBER_FORMATS;return function(a,c){return null==a?a:Yb(a,b.PATTERNS[0],b.GROUP_SEP,b.DECIMAL_SEP,c)}}function Yb(a,b,c,d,e){if(!isFinite(a)||s(a))return"";var f=0>a;a=Math.abs(a);var g=a+"",h="",i=[],j=!1;if(-1!==g.indexOf("e")){var k=g.match(/([\d\.]+)e(-?)(\d+)/);k&&"-"==k[2]&&k[3]>e+1?a=0:(h=g,j=!0)}if(j)e>0&&1>a&&(h=a.toFixed(e),a=parseFloat(h));else{g=(g.split(Pd)[1]||"").length,q(e)&&(e=Math.min(Math.max(b.minFrac,g),b.maxFrac)),a=+(Math.round(+(a.toString()+"e"+e)).toString()+"e"+-e);var g=(""+a).split(Pd),j=g[0],g=g[1]||"",l=0,m=b.lgSize,n=b.gSize;if(j.length>=m+n)for(l=j.length-m,k=0;l>k;k++)0===(l-k)%n&&0!==k&&(h+=c),h+=j.charAt(k);for(k=l;k<j.length;k++)0===(j.length-k)%m&&0!==k&&(h+=c),h+=j.charAt(k);for(;g.length<e;)g+="0";e&&"0"!==e&&(h+=d+g.substr(0,e))}return 0===a&&(f=!1),i.push(f?b.negPre:b.posPre,h,f?b.negSuf:b.posSuf),i.join("")}function Zb(a,b,c){var d="";for(0>a&&(d="-",a=-a),a=""+a;a.length<b;)a="0"+a;return c&&(a=a.substr(a.length-b)),d+a}function $b(a,b,c,d){return c=c||0,function(e){return e=e["get"+a](),(c>0||e>-c)&&(e+=c),0===e&&-12==c&&(e=12),Zb(e,b,d)}}function _b(a,b){return function(c,d){var e=c["get"+a](),f=zc(b?"SHORT"+a:a);return d[f][e]}}function ac(a){var b=new Date(a,0,1).getDay();return new Date(a,0,(4>=b?5:12)-b)}function bc(a){return function(b){var c=ac(b.getFullYear());return b=+new Date(b.getFullYear(),b.getMonth(),b.getDate()+(4-b.getDay()))-+c,b=1+Math.round(b/6048e5),Zb(b,a)}}function cc(a,b){return 0>=a.getFullYear()?b.ERAS[0]:b.ERAS[1]}function dc(a){function b(a){var b;if(b=a.match(c)){a=new Date(0);var d=0,e=0,f=b[8]?a.setUTCFullYear:a.setFullYear,g=b[8]?a.setUTCHours:a.setHours;b[9]&&(d=l(b[9]+b[10]),e=l(b[9]+b[11])),f.call(a,l(b[1]),l(b[2])-1,l(b[3])),d=l(b[4]||0)-d,e=l(b[5]||0)-e,f=l(b[6]||0),b=Math.round(1e3*parseFloat("0."+(b[7]||0))),g.call(a,d,e,f,b)}return a}var c=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,d,e){var g,h,i="",j=[];if(d=d||"mediumDate",d=a.DATETIME_FORMATS[d]||d,t(c)&&(c=Sd.test(c)?l(c):b(c)),u(c)&&(c=new Date(c)),!v(c))return c;for(;d;)(h=Rd.exec(d))?(j=I(j,h,1),d=j.pop()):(j.push(d),d=null);return e&&"UTC"===e&&(c=new Date(c.getTime()),c.setMinutes(c.getMinutes()+c.getTimezoneOffset())),f(j,function(b){g=Qd[b],i+=g?g(c,a.DATETIME_FORMATS):b.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i}}function ec(){return function(a,b){return q(b)&&(b=2),L(a,b)}}function fc(){return function(a,b){return u(a)&&(a=a.toString()),Ic(a)||t(a)?(b=1/0===Math.abs(Number(b))?Number(b):l(b))?b>0?a.slice(0,b):a.slice(b):t(a)?"":[]:a}}function gc(a){return function(b,c,d){function f(a,b){return b?function(b,c){return a(c,b)}:a}function g(a){switch(typeof a){case"number":case"boolean":case"string":return!0;default:return!1}}function h(a){return null===a?"null":"function"==typeof a.valueOf&&(a=a.valueOf(),g(a))||"function"==typeof a.toString&&(a=a.toString(),g(a))?a:""}function i(a,b){var c=typeof a,d=typeof b;return c===d&&"object"===c&&(a=h(a),b=h(b)),c===d?("string"===c&&(a=a.toLowerCase(),b=b.toLowerCase()),a===b?0:b>a?-1:1):d>c?-1:1}return e(b)?(c=Ic(c)?c:[c],0===c.length&&(c=["+"]),c=c.map(function(b){var c=!1,d=b||o;if(t(b)){if(("+"==b.charAt(0)||"-"==b.charAt(0))&&(c="-"==b.charAt(0),b=b.substring(1)),""===b)return f(i,c);if(d=a(b),d.constant){var e=d();return f(function(a,b){return i(a[e],b[e])},c)}}return f(function(a,b){return i(d(a),d(b))},c)}),Ac.call(b).sort(f(function(a,b){for(var d=0;d<c.length;d++){var e=c[d](a,b);if(0!==e)return e}return 0},d))):b}}function hc(a){return w(a)&&(a={link:a}),a.restrict=a.restrict||"AC",p(a)}function ic(a,b,d,e,g){var h=this,i=[],j=h.$$parentForm=a.parent().controller("form")||Xd;h.$error={},h.$$success={},h.$pending=c,h.$name=g(b.name||b.ngForm||"")(d),h.$dirty=!1,h.$pristine=!0,h.$valid=!0,h.$invalid=!1,h.$submitted=!1,j.$addControl(h),h.$rollbackViewValue=function(){f(i,function(a){a.$rollbackViewValue()})},h.$commitViewValue=function(){f(i,function(a){a.$commitViewValue()})},h.$addControl=function(a){aa(a.$name,"input"),i.push(a),a.$name&&(h[a.$name]=a)},h.$$renameControl=function(a,b){var c=a.$name;h[c]===a&&delete h[c],h[b]=a,a.$name=b},h.$removeControl=function(a){a.$name&&h[a.$name]===a&&delete h[a.$name],f(h.$pending,function(b,c){h.$setValidity(c,null,a)}),f(h.$error,function(b,c){h.$setValidity(c,null,a)}),f(h.$$success,function(b,c){h.$setValidity(c,null,a)}),E(i,a)},qc({ctrl:this,$element:a,set:function(a,b,c){var d=a[b];d?-1===d.indexOf(c)&&d.push(c):a[b]=[c]},unset:function(a,b,c){var d=a[b];d&&(E(d,c),0===d.length&&delete a[b])},parentForm:j,$animate:e}),h.$setDirty=function(){e.removeClass(a,Ee),e.addClass(a,Fe),h.$dirty=!0,h.$pristine=!1,j.$setDirty()},h.$setPristine=function(){e.setClass(a,Ee,Fe+" ng-submitted"),h.$dirty=!1,h.$pristine=!0,h.$submitted=!1,f(i,function(a){a.$setPristine()})},h.$setUntouched=function(){f(i,function(a){a.$setUntouched()})},h.$setSubmitted=function(){e.addClass(a,"ng-submitted"),h.$submitted=!0,j.$setSubmitted()}}function jc(a){a.$formatters.push(function(b){return a.$isEmpty(b)?b:b.toString()})}function kc(a,b,c,d,e,f){var g=xc(b[0].type);if(!e.android){var h=!1;b.on("compositionstart",function(){h=!0}),b.on("compositionend",function(){h=!1,i()})}var i=function(a){if(j&&(f.defer.cancel(j),j=null),!h){var e=b.val();a=a&&a.type,"password"===g||c.ngTrim&&"false"===c.ngTrim||(e=Jc(e)),(d.$viewValue!==e||""===e&&d.$$hasNativeValidators)&&d.$setViewValue(e,a)}};if(e.hasEvent("input"))b.on("input",i);else{var j,k=function(a,b,c){j||(j=f.defer(function(){j=null,b&&b.value===c||i(a)}))};b.on("keydown",function(a){var b=a.keyCode;91===b||b>15&&19>b||b>=37&&40>=b||k(a,this,this.value)}),e.hasEvent("paste")&&b.on("paste cut",k)}b.on("change",i),d.$render=function(){b.val(d.$isEmpty(d.$viewValue)?"":d.$viewValue)}}function lc(a,b){return function(c,d){var e,g;if(v(c))return c;if(t(c)){if('"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substring(1,c.length-1)),_d.test(c))return new Date(c);if(a.lastIndex=0,e=a.exec(c))return e.shift(),g=d?{yyyy:d.getFullYear(),MM:d.getMonth()+1,dd:d.getDate(),HH:d.getHours(),mm:d.getMinutes(),ss:d.getSeconds(),sss:d.getMilliseconds()/1e3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},f(e,function(a,c){c<b.length&&(g[b[c]]=+a)}),new Date(g.yyyy,g.MM-1,g.dd,g.HH,g.mm,g.ss||0,1e3*g.sss||0)}return 0/0}}function mc(a,b,d,e){return function(f,g,h,i,j,k,l){function m(a){return a&&!(a.getTime&&a.getTime()!==a.getTime())}function n(a){return r(a)?v(a)?a:d(a):c}nc(f,g,h,i),kc(f,g,h,i,j,k);var o,p=i&&i.$options&&i.$options.timezone;if(i.$$parserName=a,i.$parsers.push(function(a){return i.$isEmpty(a)?null:b.test(a)?(a=d(a,o),"UTC"===p&&a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),a):c}),i.$formatters.push(function(a){if(a&&!v(a))throw He("datefmt",a);if(m(a)){if((o=a)&&"UTC"===p){var b=6e4*o.getTimezoneOffset();o=new Date(o.getTime()+b)}return l("date")(a,e,p)}return o=null,""}),r(h.min)||h.ngMin){var s;i.$validators.min=function(a){return!m(a)||q(s)||d(a)>=s},h.$observe("min",function(a){s=n(a),i.$validate()})}if(r(h.max)||h.ngMax){var t;i.$validators.max=function(a){return!m(a)||q(t)||d(a)<=t},h.$observe("max",function(a){t=n(a),i.$validate()})}}}function nc(a,b,d,e){(e.$$hasNativeValidators=s(b[0].validity))&&e.$parsers.push(function(a){var d=b.prop("validity")||{};return d.badInput&&!d.typeMismatch?c:a})}function oc(a,b,c,e,f){if(r(e)){if(a=a(e),!a.constant)throw d("ngModel")("constexpr",c,e);return a(b)}return f}function pc(a,b){return a="ngClass"+a,["$animate",function(c){function d(a,b){var c=[],d=0;a:for(;d<a.length;d++){for(var e=a[d],f=0;f<b.length;f++)if(e==b[f])continue a;c.push(e)}return c}function e(a){if(!Ic(a)){if(t(a))return a.split(" ");if(s(a)){var b=[];return f(a,function(a,c){a&&(b=b.concat(c.split(" ")))}),b}}return a}return{restrict:"AC",link:function(g,h,i){function j(a,b){var c=h.data("$classCounts")||{},d=[];return f(a,function(a){(b>0||c[a])&&(c[a]=(c[a]||0)+b,c[a]===+(b>0)&&d.push(a))}),h.data("$classCounts",c),d.join(" ")}function k(a){if(!0===b||g.$index%2===b){var f=e(a||[]);if(l){if(!H(a,l)){var k=e(l),m=d(f,k),f=d(k,f),m=j(m,1),f=j(f,-1);m&&m.length&&c.addClass(h,m),f&&f.length&&c.removeClass(h,f)}}else{var m=j(f,1);i.$addClass(m)}}l=G(a)}var l;g.$watch(i[a],k,!0),i.$observe("class",function(){k(g.$eval(i[a]))}),"ngClass"!==a&&g.$watch("$index",function(c,d){var f=1&c;if(f!==(1&d)){var h=e(g.$eval(i[a]));f===b?(f=j(h,1),i.$addClass(f)):(f=j(h,-1),i.$removeClass(f))}})}}}]}function qc(a){function b(a,b){b&&!g[a]?(k.addClass(f,a),g[a]=!0):!b&&g[a]&&(k.removeClass(f,a),g[a]=!1)}function d(a,c){a=a?"-"+Y(a,"-"):"",b(Ce+a,!0===c),b(De+a,!1===c)}var e=a.ctrl,f=a.$element,g={},h=a.set,i=a.unset,j=a.parentForm,k=a.$animate;g[De]=!(g[Ce]=f.hasClass(Ce)),e.$setValidity=function(a,f,g){f===c?(e.$pending||(e.$pending={}),h(e.$pending,a,g)):(e.$pending&&i(e.$pending,a,g),rc(e.$pending)&&(e.$pending=c)),A(f)?f?(i(e.$error,a,g),h(e.$$success,a,g)):(h(e.$error,a,g),i(e.$$success,a,g)):(i(e.$error,a,g),i(e.$$success,a,g)),e.$pending?(b(Ge,!0),e.$valid=e.$invalid=c,d("",null)):(b(Ge,!1),e.$valid=rc(e.$error),e.$invalid=!e.$valid,d("",e.$valid)),f=e.$pending&&e.$pending[a]?c:e.$error[a]?!1:e.$$success[a]?!0:null,d(a,f),j.$setValidity(a,f,e)}}function rc(a){if(a)for(var b in a)return!1;return!0}var sc,tc,uc,vc,wc=/^\/(.+)\/([a-z]*)$/,xc=function(a){return t(a)?a.toLowerCase():a},yc=Object.prototype.hasOwnProperty,zc=function(a){return t(a)?a.toUpperCase():a},Ac=[].slice,Bc=[].splice,Cc=[].push,Dc=Object.prototype.toString,Ec=d("ng"),Fc=a.angular||(a.angular={}),Gc=0;sc=b.documentMode,n.$inject=[],o.$inject=[];var Hc,Ic=Array.isArray,Jc=function(a){return t(a)?a.trim():a},Kc=function(a){return a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},Lc=function(){if(r(Lc.isActive_))return Lc.isActive_;var a=!(!b.querySelector("[ng-csp]")&&!b.querySelector("[data-ng-csp]"));if(!a)try{new Function("")}catch(c){a=!0}return Lc.isActive_=a},Mc=["ng-","data-ng-","ng:","x-ng-"],Nc=/[A-Z]/g,Oc=!1,Pc=1,Qc=3,Rc={full:"1.3.15",major:1,minor:3,dot:15,codeName:"locality-filtration"};ja.expando="ng339";var Sc=ja.cache={},Tc=1;ja._data=function(a){return this.cache[a[this.expando]]||{}};var Uc=/([\:\-\_]+(.))/g,Vc=/^moz([A-Z])/,Wc={mouseleave:"mouseout",mouseenter:"mouseover"},Xc=d("jqLite"),Yc=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Zc=/<|&#?\w+;/,$c=/<([\w:]+)/,_c=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ad={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ad.optgroup=ad.option,ad.tbody=ad.tfoot=ad.colgroup=ad.caption=ad.thead,ad.th=ad.td;var bd=ja.prototype={ready:function(c){function d(){e||(e=!0,c())}var e=!1;"complete"===b.readyState?setTimeout(d):(this.on("DOMContentLoaded",d),ja(a).on("load",d))},toString:function(){var a=[];return f(this,function(b){a.push(""+b)}),"["+a.join(", ")+"]"},eq:function(a){return tc(a>=0?this[a]:this[this.length+a])},length:0,push:Cc,sort:[].sort,splice:[].splice},cd={};f("multiple selected checked disabled readOnly required open".split(" "),function(a){cd[xc(a)]=a});var dd={};f("input select option textarea button form details".split(" "),function(a){dd[a]=!0});var ed={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern"};f({data:pa,removeData:na},function(a,b){ja[b]=a}),f({data:pa,inheritedData:va,scope:function(a){return tc.data(a,"$scope")||va(a.parentNode||a,["$isolateScope","$scope"])},isolateScope:function(a){return tc.data(a,"$isolateScope")||tc.data(a,"$isolateScopeNoTemplate")},controller:ua,injector:function(a){return va(a,"$injector")},removeAttr:function(a,b){a.removeAttribute(b)},hasClass:qa,css:function(a,b,c){return b=ga(b),r(c)?void(a.style[b]=c):a.style[b]},attr:function(a,b,d){var e=xc(b);if(cd[e]){if(!r(d))return a[b]||(a.attributes.getNamedItem(b)||n).specified?e:c;d?(a[b]=!0,a.setAttribute(b,e)):(a[b]=!1,a.removeAttribute(e))}else if(r(d))a.setAttribute(b,d);else if(a.getAttribute)return a=a.getAttribute(b,2),null===a?c:a},prop:function(a,b,c){return r(c)?void(a[b]=c):a[b]},text:function(){function a(a,b){if(q(b)){var c=a.nodeType;return c===Pc||c===Qc?a.textContent:""}a.textContent=b}return a.$dv="",a}(),val:function(a,b){if(q(b)){if(a.multiple&&"select"===D(a)){var c=[];return f(a.options,function(a){a.selected&&c.push(a.value||a.text)}),0===c.length?null:c}return a.value}a.value=b},html:function(a,b){return q(b)?a.innerHTML:(la(a,!0),void(a.innerHTML=b))},empty:wa},function(a,b){ja.prototype[b]=function(b,d){var e,f,g=this.length;if(a!==wa&&(2==a.length&&a!==qa&&a!==ua?b:d)===c){if(s(b)){for(e=0;g>e;e++)if(a===pa)a(this[e],b);else for(f in b)a(this[e],f,b[f]);return this}for(e=a.$dv,g=e===c?Math.min(g,1):g,f=0;g>f;f++){var h=a(this[f],b,d);e=e?e+h:h}return e}for(e=0;g>e;e++)a(this[e],b,d);return this}}),f({removeData:na,on:function ef(a,b,c,d){if(r(d))throw Xc("onargs");if(ha(a)){var e=oa(a,!0);d=e.events;var f=e.handle;f||(f=e.handle=Ba(a,d));for(var e=0<=b.indexOf(" ")?b.split(" "):[b],g=e.length;g--;){b=e[g];var h=d[b];h||(d[b]=[],"mouseenter"===b||"mouseleave"===b?ef(a,Wc[b],function(a){var c=a.relatedTarget;c&&(c===this||this.contains(c))||f(a,b)}):"$destroy"!==b&&a.addEventListener(b,f,!1),h=d[b]),h.push(c)}}},off:ma,one:function(a,b,c){a=tc(a),a.on(b,function d(){a.off(b,c),a.off(b,d)}),a.on(b,c)},replaceWith:function(a,b){var c,d=a.parentNode;la(a),f(new ja(b),function(b){c?d.insertBefore(b,c.nextSibling):d.replaceChild(b,a),c=b})},children:function(a){var b=[];return f(a.childNodes,function(a){a.nodeType===Pc&&b.push(a)}),b},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,b){var c=a.nodeType;if(c===Pc||11===c){b=new ja(b);for(var c=0,d=b.length;d>c;c++)a.appendChild(b[c])}},prepend:function(a,b){if(a.nodeType===Pc){var c=a.firstChild;f(new ja(b),function(b){a.insertBefore(b,c)})}},wrap:function(a,b){b=tc(b).eq(0).clone()[0];var c=a.parentNode;c&&c.replaceChild(b,a),b.appendChild(a)},remove:xa,detach:function(a){xa(a,!0)},after:function(a,b){var c=a,d=a.parentNode;b=new ja(b);for(var e=0,f=b.length;f>e;e++){var g=b[e];d.insertBefore(g,c.nextSibling),c=g}},addClass:sa,removeClass:ra,toggleClass:function(a,b,c){b&&f(b.split(" "),function(b){var d=c;q(d)&&(d=!qa(a,b)),(d?sa:ra)(a,b)})},parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},next:function(a){return a.nextElementSibling},find:function(a,b){return a.getElementsByTagName?a.getElementsByTagName(b):[]},clone:ka,triggerHandler:function(a,b,c){var d,e,g=b.type||b,h=oa(a);(h=(h=h&&h.events)&&h[g])&&(d={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},stopPropagation:n,type:g,target:a},b.type&&(d=k(d,b)),b=G(h),e=c?[d].concat(c):[d],f(b,function(b){d.isImmediatePropagationStopped()||b.apply(a,e)}))}},function(a,b){ja.prototype[b]=function(b,c,d){for(var e,f=0,g=this.length;g>f;f++)q(e)?(e=a(this[f],b,c,d),r(e)&&(e=tc(e))):ta(e,a(this[f],b,c,d));return r(e)?e:this},ja.prototype.bind=ja.prototype.on,ja.prototype.unbind=ja.prototype.off}),Ea.prototype={put:function(a,b){this[Da(a,this.nextUid)]=b},get:function(a){return this[Da(a,this.nextUid)]},remove:function(a){var b=this[a=Da(a,this.nextUid)];return delete this[a],b}};var fd=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,gd=/,/,hd=/^\s*(_?)(\S+?)\1\s*$/,id=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,jd=d("$injector");Ga.$$annotate=function(a,b,c){var d;if("function"==typeof a){if(!(d=a.$inject)){if(d=[],a.length){if(b)throw t(c)&&c||(c=a.name||Fa(a)),jd("strictdi",c);b=a.toString().replace(id,""),b=b.match(fd),f(b[1].split(gd),function(a){a.replace(hd,function(a,b,c){d.push(c)})})}a.$inject=d}}else Ic(a)?(b=a.length-1,_(a[b],"fn"),d=a.slice(0,b)):_(a,"fn",!0);return d};var kd=d("$animate"),ld=["$provide",function(a){this.$$selectors={},this.register=function(b,c){var d=b+"-animation";if(b&&"."!=b.charAt(0))throw kd("notcsel",b);this.$$selectors[b.substr(1)]=d,a.factory(d,c)},this.classNameFilter=function(a){return 1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null),this.$$classNameFilter},this.$get=["$$q","$$asyncCallback","$rootScope",function(a,b,c){function d(b){var d,e=a.defer();return e.promise.$$cancelFn=function(){d&&d()},c.$$postDigest(function(){d=b(function(){e.resolve()})}),e.promise}function e(a,b){var c=[],d=[],e=da();return f((a.attr("class")||"").split(/\s+/),function(a){e[a]=!0}),f(b,function(a,b){var f=e[b];!1===a&&f?d.push(b):!0!==a||f||c.push(b)}),0<c.length+d.length&&[c.length?c:null,d.length?d:null]}function g(a,b,c){for(var d=0,e=b.length;e>d;++d)a[b[d]]=c}function h(){return j||(j=a.defer(),b(function(){j.resolve(),j=null})),j.promise}function i(a,b){if(Fc.isObject(b)){var c=k(b.from||{},b.to||{});a.css(c)}}var j;return{animate:function(a,b,c){return i(a,{from:b,to:c}),h()},enter:function(a,b,c,d){return i(a,d),c?c.after(a):b.prepend(a),h()},leave:function(a,b){return i(a,b),a.remove(),h()},move:function(a,b,c,d){return this.enter(a,b,c,d)},addClass:function(a,b,c){return this.setClass(a,b,[],c)},$$addClassImmediately:function(a,b,c){return a=tc(a),b=t(b)?b:Ic(b)?b.join(" "):"",f(a,function(a){sa(a,b)}),i(a,c),h()},removeClass:function(a,b,c){return this.setClass(a,[],b,c)},$$removeClassImmediately:function(a,b,c){return a=tc(a),b=t(b)?b:Ic(b)?b.join(" "):"",f(a,function(a){ra(a,b)}),i(a,c),h()},setClass:function(a,b,c,f){var h=this,i=!1;a=tc(a);var j=a.data("$$animateClasses");return j?f&&j.options&&(j.options=Fc.extend(j.options||{},f)):(j={classes:{},options:f},i=!0),f=j.classes,b=Ic(b)?b:b.split(" "),c=Ic(c)?c:c.split(" "),g(f,b,!0),g(f,c,!1),i&&(j.promise=d(function(b){var c=a.data("$$animateClasses");if(a.removeData("$$animateClasses"),c){var d=e(a,c.classes);d&&h.$$setClassImmediately(a,d[0],d[1],c.options)}b()}),a.data("$$animateClasses",j)),j.promise},$$setClassImmediately:function(a,b,c,d){return b&&this.$$addClassImmediately(a,b),c&&this.$$removeClassImmediately(a,c),i(a,d),h()},enabled:n,cancel:n}}]}],md=d("$compile");Na.$inject=["$provide","$$sanitizeUriProvider"];var nd=/^((?:x|data)[\:\-_])/i,od=d("$controller"),pd="application/json",qd={"Content-Type":pd+";charset=utf-8"},rd=/^\[|^\{(?!\{)/,sd={"[":/]$/,"{":/}$/},td=/^\)\]\}',?\n/,ud=d("$interpolate"),vd=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,wd={http:80,https:443,ftp:21},xd=d("$location"),yd={$$html5:!1,$$replace:!1,absUrl:nb("$$absUrl"),url:function(a){if(q(a))return this.$$url;var b=vd.exec(a);return(b[1]||""===a)&&this.path(decodeURIComponent(b[1])),(b[2]||b[1]||""===a)&&this.search(b[3]||""),this.hash(b[5]||""),this},protocol:nb("$$protocol"),host:nb("$$host"),port:nb("$$port"),path:ob("$$path",function(a){return a=null!==a?a.toString():"","/"==a.charAt(0)?a:"/"+a}),search:function(a,b){switch(arguments.length){case 0:return this.$$search;case 1:if(t(a)||u(a))a=a.toString(),this.$$search=P(a);else{if(!s(a))throw xd("isrcharg");a=F(a,{}),f(a,function(b,c){null==b&&delete a[c]}),this.$$search=a}break;default:q(b)||null===b?delete this.$$search[a]:this.$$search[a]=b}return this.$$compose(),this},hash:ob("$$hash",function(a){return null!==a?a.toString():""}),replace:function(){return this.$$replace=!0,this}};f([mb,lb,kb],function(a){a.prototype=Object.create(yd),a.prototype.state=function(b){if(!arguments.length)return this.$$state;if(a!==kb||!this.$$html5)throw xd("nostate");return this.$$state=q(b)?null:b,this}});var zd=d("$parse"),Ad=Function.prototype.call,Bd=Function.prototype.apply,Cd=Function.prototype.bind,Dd=da();f({"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:function(){}},function(a,b){a.constant=a.literal=a.sharedGetter=!0,Dd[b]=a}),Dd["this"]=function(a){return a},Dd["this"].sharedGetter=!0;var Ed=k(da(),{"+":function(a,b,d,e){return d=d(a,b),e=e(a,b),r(d)?r(e)?d+e:d:r(e)?e:c},"-":function(a,b,c,d){return c=c(a,b),d=d(a,b),(r(c)?c:0)-(r(d)?d:0)},"*":function(a,b,c,d){return c(a,b)*d(a,b)},"/":function(a,b,c,d){return c(a,b)/d(a,b)},"%":function(a,b,c,d){return c(a,b)%d(a,b)},"===":function(a,b,c,d){return c(a,b)===d(a,b)},"!==":function(a,b,c,d){return c(a,b)!==d(a,b)},"==":function(a,b,c,d){return c(a,b)==d(a,b)},"!=":function(a,b,c,d){return c(a,b)!=d(a,b)},"<":function(a,b,c,d){return c(a,b)<d(a,b)},">":function(a,b,c,d){return c(a,b)>d(a,b)},"<=":function(a,b,c,d){return c(a,b)<=d(a,b)},">=":function(a,b,c,d){return c(a,b)>=d(a,b)},"&&":function(a,b,c,d){return c(a,b)&&d(a,b)},"||":function(a,b,c,d){return c(a,b)||d(a,b)},"!":function(a,b,c){return!c(a,b)},"=":!0,"|":!0}),Fd={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'},Gd=function(a){this.options=a};Gd.prototype={constructor:Gd,lex:function(a){for(this.text=a,this.index=0,this.tokens=[];this.index<this.text.length;)if(a=this.text.charAt(this.index),'"'===a||"'"===a)this.readString(a);else if(this.isNumber(a)||"."===a&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(a))this.readIdent();else if(this.is(a,"(){}[].,;:?"))this.tokens.push({index:this.index,text:a}),this.index++;else if(this.isWhitespace(a))this.index++;else{var b=a+this.peek(),c=b+this.peek(2),d=Ed[b],e=Ed[c];Ed[a]||d||e?(a=e?c:d?b:a,this.tokens.push({index:this.index,text:a,operator:!0}),this.index+=a.length):this.throwError("Unexpected next character ",this.index,this.index+1)}return this.tokens},is:function(a,b){return-1!==b.indexOf(a)},peek:function(a){return a=a||1,this.index+a<this.text.length?this.text.charAt(this.index+a):!1},isNumber:function(a){return a>="0"&&"9">=a&&"string"==typeof a},isWhitespace:function(a){return" "===a||"\r"===a||"	"===a||"\n"===a||""===a||" "===a},isIdent:function(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a||"_"===a||"$"===a},isExpOperator:function(a){return"-"===a||"+"===a||this.isNumber(a)},throwError:function(a,b,c){throw c=c||this.index,b=r(b)?"s "+b+"-"+this.index+" ["+this.text.substring(b,c)+"]":" "+c,zd("lexerr",a,b,this.text)},readNumber:function(){for(var a="",b=this.index;this.index<this.text.length;){var c=xc(this.text.charAt(this.index));if("."==c||this.isNumber(c))a+=c;else{var d=this.peek();if("e"==c&&this.isExpOperator(d))a+=c;else if(this.isExpOperator(c)&&d&&this.isNumber(d)&&"e"==a.charAt(a.length-1))a+=c;else{if(!this.isExpOperator(c)||d&&this.isNumber(d)||"e"!=a.charAt(a.length-1))break;this.throwError("Invalid exponent")}}this.index++}this.tokens.push({index:b,text:a,constant:!0,value:Number(a)})},readIdent:function(){for(var a=this.index;this.index<this.text.length;){var b=this.text.charAt(this.index);if(!this.isIdent(b)&&!this.isNumber(b))break;this.index++}this.tokens.push({index:a,text:this.text.slice(a,this.index),identifier:!0})},readString:function(a){var b=this.index;this.index++;for(var c="",d=a,e=!1;this.index<this.text.length;){var f=this.text.charAt(this.index),d=d+f;if(e)"u"===f?(e=this.text.substring(this.index+1,this.index+5),e.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+e+"]"),this.index+=4,c+=String.fromCharCode(parseInt(e,16))):c+=Fd[f]||f,e=!1;else if("\\"===f)e=!0;else{if(f===a)return this.index++,void this.tokens.push({index:b,text:d,constant:!0,value:c});c+=f}this.index++}this.throwError("Unterminated quote",b)}};var Hd=function(a,b,c){this.lexer=a,this.$filter=b,this.options=c};Hd.ZERO=k(function(){return 0},{sharedGetter:!0,constant:!0}),Hd.prototype={
constructor:Hd,parse:function(a){return this.text=a,this.tokens=this.lexer.lex(a),a=this.statements(),0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),a.literal=!!a.literal,a.constant=!!a.constant,a},primary:function(){var a;this.expect("(")?(a=this.filterChain(),this.consume(")")):this.expect("[")?a=this.arrayDeclaration():this.expect("{")?a=this.object():this.peek().identifier&&this.peek().text in Dd?a=Dd[this.consume().text]:this.peek().identifier?a=this.identifier():this.peek().constant?a=this.constant():this.throwError("not a primary expression",this.peek());for(var b,c;b=this.expect("(","[",".");)"("===b.text?(a=this.functionCall(a,c),c=null):"["===b.text?(c=a,a=this.objectIndex(a)):"."===b.text?(c=a,a=this.fieldAccess(a)):this.throwError("IMPOSSIBLE");return a},throwError:function(a,b){throw zd("syntax",b.text,a,b.index+1,this.text,this.text.substring(b.index))},peekToken:function(){if(0===this.tokens.length)throw zd("ueoe",this.text);return this.tokens[0]},peek:function(a,b,c,d){return this.peekAhead(0,a,b,c,d)},peekAhead:function(a,b,c,d,e){if(this.tokens.length>a){a=this.tokens[a];var f=a.text;if(f===b||f===c||f===d||f===e||!(b||c||d||e))return a}return!1},expect:function(a,b,c,d){return(a=this.peek(a,b,c,d))?(this.tokens.shift(),a):!1},consume:function(a){if(0===this.tokens.length)throw zd("ueoe",this.text);var b=this.expect(a);return b||this.throwError("is unexpected, expecting ["+a+"]",this.peek()),b},unaryFn:function(a,b){var c=Ed[a];return k(function(a,d){return c(a,d,b)},{constant:b.constant,inputs:[b]})},binaryFn:function(a,b,c,d){var e=Ed[b];return k(function(b,d){return e(b,d,a,c)},{constant:a.constant&&c.constant,inputs:!d&&[a,c]})},identifier:function(){for(var a=this.consume().text;this.peek(".")&&this.peekAhead(1).identifier&&!this.peekAhead(2,"(");)a+=this.consume().text+this.consume().text;return yb(a,this.options,this.text)},constant:function(){var a=this.consume().value;return k(function(){return a},{constant:!0,literal:!0})},statements:function(){for(var a=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&a.push(this.filterChain()),!this.expect(";"))return 1===a.length?a[0]:function(b,c){for(var d,e=0,f=a.length;f>e;e++)d=a[e](b,c);return d}},filterChain:function(){for(var a=this.expression();this.expect("|");)a=this.filter(a);return a},filter:function(a){var b,d,e=this.$filter(this.consume().text);if(this.peek(":"))for(b=[],d=[];this.expect(":");)b.push(this.expression());var f=[a].concat(b||[]);return k(function(f,g){var h=a(f,g);if(d){for(d[0]=h,h=b.length;h--;)d[h+1]=b[h](f,g);return e.apply(c,d)}return e(h)},{constant:!e.$stateful&&f.every(tb),inputs:!e.$stateful&&f})},expression:function(){return this.assignment()},assignment:function(){var a,b,c=this.ternary();return(b=this.expect("="))?(c.assign||this.throwError("implies assignment but ["+this.text.substring(0,b.index)+"] can not be assigned to",b),a=this.ternary(),k(function(b,d){return c.assign(b,a(b,d),d)},{inputs:[c,a]})):c},ternary:function(){var a,b=this.logicalOR();if(this.expect("?")&&(a=this.assignment(),this.consume(":"))){var c=this.assignment();return k(function(d,e){return b(d,e)?a(d,e):c(d,e)},{constant:b.constant&&a.constant&&c.constant})}return b},logicalOR:function(){for(var a,b=this.logicalAND();a=this.expect("||");)b=this.binaryFn(b,a.text,this.logicalAND(),!0);return b},logicalAND:function(){for(var a,b=this.equality();a=this.expect("&&");)b=this.binaryFn(b,a.text,this.equality(),!0);return b},equality:function(){for(var a,b=this.relational();a=this.expect("==","!=","===","!==");)b=this.binaryFn(b,a.text,this.relational());return b},relational:function(){for(var a,b=this.additive();a=this.expect("<",">","<=",">=");)b=this.binaryFn(b,a.text,this.additive());return b},additive:function(){for(var a,b=this.multiplicative();a=this.expect("+","-");)b=this.binaryFn(b,a.text,this.multiplicative());return b},multiplicative:function(){for(var a,b=this.unary();a=this.expect("*","/","%");)b=this.binaryFn(b,a.text,this.unary());return b},unary:function(){var a;return this.expect("+")?this.primary():(a=this.expect("-"))?this.binaryFn(Hd.ZERO,a.text,this.unary()):(a=this.expect("!"))?this.unaryFn(a.text,this.unary()):this.primary()},fieldAccess:function(a){var b=this.identifier();return k(function(d,e,f){return d=f||a(d,e),null==d?c:b(d)},{assign:function(c,d,e){var f=a(c,e);return f||a.assign(c,f={},e),b.assign(f,d)}})},objectIndex:function(a){var b=this.text,d=this.expression();return this.consume("]"),k(function(e,f){var g=a(e,f),h=d(e,f);return rb(h,b),g?sb(g[h],b):c},{assign:function(c,e,f){var g=rb(d(c,f),b),h=sb(a(c,f),b);return h||a.assign(c,h={},f),h[g]=e}})},functionCall:function(a,b){var d=[];if(")"!==this.peekToken().text)do d.push(this.expression());while(this.expect(","));this.consume(")");var e=this.text,f=d.length?[]:null;return function(g,h){var i=b?b(g,h):r(b)?c:g,j=a(g,h,i)||n;if(f)for(var k=d.length;k--;)f[k]=sb(d[k](g,h),e);if(sb(i,e),j){if(j.constructor===j)throw zd("isecfn",e);if(j===Ad||j===Bd||j===Cd)throw zd("isecff",e)}return i=j.apply?j.apply(i,f):j(f[0],f[1],f[2],f[3],f[4]),f&&(f.length=0),sb(i,e)}},arrayDeclaration:function(){var a=[];if("]"!==this.peekToken().text)do{if(this.peek("]"))break;a.push(this.expression())}while(this.expect(","));return this.consume("]"),k(function(b,c){for(var d=[],e=0,f=a.length;f>e;e++)d.push(a[e](b,c));return d},{literal:!0,constant:a.every(tb),inputs:a})},object:function(){var a=[],b=[];if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var c=this.consume();c.constant?a.push(c.value):c.identifier?a.push(c.text):this.throwError("invalid key",c),this.consume(":"),b.push(this.expression())}while(this.expect(","));return this.consume("}"),k(function(c,d){for(var e={},f=0,g=b.length;g>f;f++)e[a[f]]=b[f](c,d);return e},{literal:!0,constant:b.every(tb),inputs:b})}};var Id=da(),Jd=da(),Kd=Object.prototype.valueOf,Ld=d("$sce"),Md={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},md=d("$compile"),Nd=b.createElement("a"),Od=Pb(a.location.href);Sb.$inject=["$provide"],Wb.$inject=["$locale"],Xb.$inject=["$locale"];var Pd=".",Qd={yyyy:$b("FullYear",4),yy:$b("FullYear",2,0,!0),y:$b("FullYear",1),MMMM:_b("Month"),MMM:_b("Month",!0),MM:$b("Month",2,1),M:$b("Month",1,1),dd:$b("Date",2),d:$b("Date",1),HH:$b("Hours",2),H:$b("Hours",1),hh:$b("Hours",2,-12),h:$b("Hours",1,-12),mm:$b("Minutes",2),m:$b("Minutes",1),ss:$b("Seconds",2),s:$b("Seconds",1),sss:$b("Milliseconds",3),EEEE:_b("Day"),EEE:_b("Day",!0),a:function(a,b){return 12>a.getHours()?b.AMPMS[0]:b.AMPMS[1]},Z:function(a){return a=-1*a.getTimezoneOffset(),a=(a>=0?"+":"")+(Zb(Math[a>0?"floor":"ceil"](a/60),2)+Zb(Math.abs(a%60),2))},ww:bc(2),w:bc(1),G:cc,GG:cc,GGG:cc,GGGG:function(a,b){return 0>=a.getFullYear()?b.ERANAMES[0]:b.ERANAMES[1]}},Rd=/((?:[^yMdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z|G+|w+))(.*)/,Sd=/^\-?\d+$/;dc.$inject=["$locale"];var Td=p(xc),Ud=p(zc);gc.$inject=["$parse"];var Vd=p({restrict:"E",compile:function(a,b){return b.href||b.xlinkHref||b.name?void 0:function(a,b){if("a"===b[0].nodeName.toLowerCase()){var c="[object SVGAnimatedString]"===Dc.call(b.prop("href"))?"xlink:href":"href";b.on("click",function(a){b.attr(c)||a.preventDefault()})}}}}),Wd={};f(cd,function(a,b){if("multiple"!=a){var c=Oa("ng-"+b);Wd[c]=function(){return{restrict:"A",priority:100,link:function(a,d,e){a.$watch(e[c],function(a){e.$set(b,!!a)})}}}}}),f(ed,function(a,b){Wd[b]=function(){return{priority:100,link:function(a,c,d){return"ngPattern"===b&&"/"==d.ngPattern.charAt(0)&&(c=d.ngPattern.match(wc))?void d.$set("ngPattern",new RegExp(c[1],c[2])):void a.$watch(d[b],function(a){d.$set(b,a)})}}}}),f(["src","srcset","href"],function(a){var b=Oa("ng-"+a);Wd[b]=function(){return{priority:99,link:function(c,d,e){var f=a,g=a;"href"===a&&"[object SVGAnimatedString]"===Dc.call(d.prop("href"))&&(g="xlinkHref",e.$attr[g]="xlink:href",f=null),e.$observe(b,function(b){b?(e.$set(g,b),sc&&f&&d.prop(f,e[g])):"href"===a&&e.$set(g,null)})}}}});var Xd={$addControl:n,$$renameControl:function(a,b){a.$name=b},$removeControl:n,$setValidity:n,$setDirty:n,$setPristine:n,$setSubmitted:n};ic.$inject=["$element","$attrs","$scope","$animate","$interpolate"];var Yd=function(a){return["$timeout",function(b){return{name:"form",restrict:a?"EAC":"E",controller:ic,compile:function(d,e){d.addClass(Ee).addClass(Ce);var f=e.name?"name":a&&e.ngForm?"ngForm":!1;return{pre:function(a,d,e,g){if(!("action"in e)){var h=function(b){a.$apply(function(){g.$commitViewValue(),g.$setSubmitted()}),b.preventDefault()};d[0].addEventListener("submit",h,!1),d.on("$destroy",function(){b(function(){d[0].removeEventListener("submit",h,!1)},0,!1)})}var i=g.$$parentForm;f&&(ub(a,null,g.$name,g,g.$name),e.$observe(f,function(b){g.$name!==b&&(ub(a,null,g.$name,c,g.$name),i.$$renameControl(g,b),ub(a,null,g.$name,g,g.$name))})),d.on("$destroy",function(){i.$removeControl(g),f&&ub(a,null,e[f],c,g.$name),k(g,Xd)})}}}}}]},Zd=Yd(),$d=Yd(!0),_d=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,ae=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,be=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,ce=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,de=/^(\d{4})-(\d{2})-(\d{2})$/,ee=/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,fe=/^(\d{4})-W(\d\d)$/,ge=/^(\d{4})-(\d\d)$/,he=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,ie={text:function(a,b,c,d,e,f){kc(a,b,c,d,e,f),jc(d)},date:mc("date",de,lc(de,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":mc("datetimelocal",ee,lc(ee,"yyyy MM dd HH mm ss sss".split(" ")),"yyyy-MM-ddTHH:mm:ss.sss"),time:mc("time",he,lc(he,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:mc("week",fe,function(a,b){if(v(a))return a;if(t(a)){fe.lastIndex=0;var c=fe.exec(a);if(c){var d=+c[1],e=+c[2],f=c=0,g=0,h=0,i=ac(d),e=7*(e-1);return b&&(c=b.getHours(),f=b.getMinutes(),g=b.getSeconds(),h=b.getMilliseconds()),new Date(d,0,i.getDate()+e,c,f,g,h)}}return 0/0},"yyyy-Www"),month:mc("month",ge,lc(ge,["yyyy","MM"]),"yyyy-MM"),number:function(a,b,d,e,f,g){if(nc(a,b,d,e),kc(a,b,d,e,f,g),e.$$parserName="number",e.$parsers.push(function(a){return e.$isEmpty(a)?null:ce.test(a)?parseFloat(a):c}),e.$formatters.push(function(a){if(!e.$isEmpty(a)){if(!u(a))throw He("numfmt",a);a=a.toString()}return a}),r(d.min)||d.ngMin){var h;e.$validators.min=function(a){return e.$isEmpty(a)||q(h)||a>=h},d.$observe("min",function(a){r(a)&&!u(a)&&(a=parseFloat(a,10)),h=u(a)&&!isNaN(a)?a:c,e.$validate()})}if(r(d.max)||d.ngMax){var i;e.$validators.max=function(a){return e.$isEmpty(a)||q(i)||i>=a},d.$observe("max",function(a){r(a)&&!u(a)&&(a=parseFloat(a,10)),i=u(a)&&!isNaN(a)?a:c,e.$validate()})}},url:function(a,b,c,d,e,f){kc(a,b,c,d,e,f),jc(d),d.$$parserName="url",d.$validators.url=function(a,b){var c=a||b;return d.$isEmpty(c)||ae.test(c)}},email:function(a,b,c,d,e,f){kc(a,b,c,d,e,f),jc(d),d.$$parserName="email",d.$validators.email=function(a,b){var c=a||b;return d.$isEmpty(c)||be.test(c)}},radio:function(a,b,c,d){q(c.name)&&b.attr("name",++Gc),b.on("click",function(a){b[0].checked&&d.$setViewValue(c.value,a&&a.type)}),d.$render=function(){b[0].checked=c.value==d.$viewValue},c.$observe("value",d.$render)},checkbox:function(a,b,c,d,e,f,g,h){var i=oc(h,a,"ngTrueValue",c.ngTrueValue,!0),j=oc(h,a,"ngFalseValue",c.ngFalseValue,!1);b.on("click",function(a){d.$setViewValue(b[0].checked,a&&a.type)}),d.$render=function(){b[0].checked=d.$viewValue},d.$isEmpty=function(a){return!1===a},d.$formatters.push(function(a){return H(a,i)}),d.$parsers.push(function(a){return a?i:j})},hidden:n,button:n,submit:n,reset:n,file:n},je=["$browser","$sniffer","$filter","$parse",function(a,b,c,d){return{restrict:"E",require:["?ngModel"],link:{pre:function(e,f,g,h){h[0]&&(ie[xc(g.type)]||ie.text)(e,f,g,h[0],b,a,c,d)}}}}],ke=/^(true|false|\d+)$/,le=function(){return{restrict:"A",priority:100,compile:function(a,b){return ke.test(b.ngValue)?function(a,b,c){c.$set("value",a.$eval(c.ngValue))}:function(a,b,c){a.$watch(c.ngValue,function(a){c.$set("value",a)})}}}},me=["$compile",function(a){return{restrict:"AC",compile:function(b){return a.$$addBindingClass(b),function(b,d,e){a.$$addBindingInfo(d,e.ngBind),d=d[0],b.$watch(e.ngBind,function(a){d.textContent=a===c?"":a})}}}}],ne=["$interpolate","$compile",function(a,b){return{compile:function(d){return b.$$addBindingClass(d),function(d,e,f){d=a(e.attr(f.$attr.ngBindTemplate)),b.$$addBindingInfo(e,d.expressions),e=e[0],f.$observe("ngBindTemplate",function(a){e.textContent=a===c?"":a})}}}}],oe=["$sce","$parse","$compile",function(a,b,c){return{restrict:"A",compile:function(d,e){var f=b(e.ngBindHtml),g=b(e.ngBindHtml,function(a){return(a||"").toString()});return c.$$addBindingClass(d),function(b,d,e){c.$$addBindingInfo(d,e.ngBindHtml),b.$watch(g,function(){d.html(a.getTrustedHtml(f(b))||"")})}}}}],pe=p({restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$viewChangeListeners.push(function(){a.$eval(c.ngChange)})}}),qe=pc("",!0),re=pc("Odd",0),se=pc("Even",1),te=hc({compile:function(a,b){b.$set("ngCloak",c),a.removeClass("ng-cloak")}}),ue=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],ve={},we={blur:!0,focus:!0};f("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(a){var b=Oa("ng-"+a);ve[b]=["$parse","$rootScope",function(c,d){return{restrict:"A",compile:function(e,f){var g=c(f[b],null,!0);return function(b,c){c.on(a,function(c){var e=function(){g(b,{$event:c})};we[a]&&d.$$phase?b.$evalAsync(e):b.$apply(e)})}}}}]});var xe=["$animate",function(a){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,d,e,f,g){var h,i,j;c.$watch(e.ngIf,function(c){c?i||g(function(c,f){i=f,c[c.length++]=b.createComment(" end ngIf: "+e.ngIf+" "),h={clone:c},a.enter(c,d.parent(),d)}):(j&&(j.remove(),j=null),i&&(i.$destroy(),i=null),h&&(j=ca(h.clone),a.leave(j).then(function(){j=null}),h=null))})}}}],ye=["$templateRequest","$anchorScroll","$animate","$sce",function(a,b,c,d){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:Fc.noop,compile:function(e,f){var g=f.ngInclude||f.src,h=f.onload||"",i=f.autoscroll;return function(e,f,j,k,l){var m,n,o,p=0,q=function(){n&&(n.remove(),n=null),m&&(m.$destroy(),m=null),o&&(c.leave(o).then(function(){n=null}),n=o,o=null)};e.$watch(d.parseAsResourceUrl(g),function(d){var g=function(){!r(i)||i&&!e.$eval(i)||b()},j=++p;d?(a(d,!0).then(function(a){if(j===p){var b=e.$new();k.template=a,a=l(b,function(a){q(),c.enter(a,null,f).then(g)}),m=b,o=a,m.$emit("$includeContentLoaded",d),e.$eval(h)}},function(){j===p&&(q(),e.$emit("$includeContentError",d))}),e.$emit("$includeContentRequested",d)):(q(),k.template=null)})}}}}],ze=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(c,d,e,f){/SVG/.test(d[0].toString())?(d.empty(),a(ia(f.template,b).childNodes)(c,function(a){d.append(a)},{futureParentElement:d})):(d.html(f.template),a(d.contents())(c))}}}],Ae=hc({priority:450,compile:function(){return{pre:function(a,b,c){a.$eval(c.ngInit)}}}}),Be=function(){return{restrict:"A",priority:100,require:"ngModel",link:function(a,b,d,e){var g=b.attr(d.$attr.ngList)||", ",h="false"!==d.ngTrim,i=h?Jc(g):g;e.$parsers.push(function(a){if(!q(a)){var b=[];return a&&f(a.split(i),function(a){a&&b.push(h?Jc(a):a)}),b}}),e.$formatters.push(function(a){return Ic(a)?a.join(g):c}),e.$isEmpty=function(a){return!a||!a.length}}}},Ce="ng-valid",De="ng-invalid",Ee="ng-pristine",Fe="ng-dirty",Ge="ng-pending",He=new d("ngModel"),Ie=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$rootScope","$q","$interpolate",function(a,b,d,e,g,h,i,j,k,l){this.$modelValue=this.$viewValue=Number.NaN,this.$$rawModelValue=c,this.$validators={},this.$asyncValidators={},this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$untouched=!0,this.$touched=!1,this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$error={},this.$$success={},this.$pending=c,this.$name=l(d.name||"",!1)(a);var m,o=g(d.ngModel),p=o.assign,s=o,t=p,v=null,x=this;this.$$setOptions=function(a){if((x.$options=a)&&a.getterSetter){var b=g(d.ngModel+"()"),c=g(d.ngModel+"($$$p)");s=function(a){var c=o(a);return w(c)&&(c=b(a)),c},t=function(a){w(o(a))?c(a,{$$$p:x.$modelValue}):p(a,x.$modelValue)}}else if(!o.assign)throw He("nonassign",d.ngModel,N(e))},this.$render=n,this.$isEmpty=function(a){return q(a)||""===a||null===a||a!==a};var y=e.inheritedData("$formController")||Xd,z=0;qc({ctrl:this,$element:e,set:function(a,b){a[b]=!0},unset:function(a,b){delete a[b]},parentForm:y,$animate:h}),this.$setPristine=function(){x.$dirty=!1,x.$pristine=!0,h.removeClass(e,Fe),h.addClass(e,Ee)},this.$setDirty=function(){x.$dirty=!0,x.$pristine=!1,h.removeClass(e,Ee),h.addClass(e,Fe),y.$setDirty()},this.$setUntouched=function(){x.$touched=!1,x.$untouched=!0,h.setClass(e,"ng-untouched","ng-touched")},this.$setTouched=function(){x.$touched=!0,x.$untouched=!1,h.setClass(e,"ng-touched","ng-untouched")},this.$rollbackViewValue=function(){i.cancel(v),x.$viewValue=x.$$lastCommittedViewValue,x.$render()},this.$validate=function(){if(!u(x.$modelValue)||!isNaN(x.$modelValue)){var a=x.$$rawModelValue,b=x.$valid,d=x.$modelValue,e=x.$options&&x.$options.allowInvalid;x.$$runValidators(a,x.$$lastCommittedViewValue,function(f){e||b===f||(x.$modelValue=f?a:c,x.$modelValue!==d&&x.$$writeModelToScope())})}},this.$$runValidators=function(a,b,d){function e(){var c=!0;return f(x.$validators,function(d,e){var f=d(a,b);c=c&&f,h(e,f)}),c?!0:(f(x.$asyncValidators,function(a,b){h(b,null)}),!1)}function g(){var d=[],e=!0;f(x.$asyncValidators,function(f,g){var i=f(a,b);if(!i||!w(i.then))throw He("$asyncValidators",i);h(g,c),d.push(i.then(function(){h(g,!0)},function(){e=!1,h(g,!1)}))}),d.length?k.all(d).then(function(){i(e)},n):i(!0)}function h(a,b){j===z&&x.$setValidity(a,b)}function i(a){j===z&&d(a)}z++;var j=z;(function(){var a=x.$$parserName||"parse";return m!==c?(m||(f(x.$validators,function(a,b){h(b,null)}),f(x.$asyncValidators,function(a,b){h(b,null)})),h(a,m),m):(h(a,null),!0)})()&&e()?g():i(!1)},this.$commitViewValue=function(){var a=x.$viewValue;i.cancel(v),(x.$$lastCommittedViewValue!==a||""===a&&x.$$hasNativeValidators)&&(x.$$lastCommittedViewValue=a,x.$pristine&&this.$setDirty(),this.$$parseAndValidate())},this.$$parseAndValidate=function(){var b=x.$$lastCommittedViewValue;if(m=q(b)?c:!0)for(var d=0;d<x.$parsers.length;d++)if(b=x.$parsers[d](b),q(b)){m=!1;break}u(x.$modelValue)&&isNaN(x.$modelValue)&&(x.$modelValue=s(a));var e=x.$modelValue,f=x.$options&&x.$options.allowInvalid;x.$$rawModelValue=b,f&&(x.$modelValue=b,x.$modelValue!==e&&x.$$writeModelToScope()),x.$$runValidators(b,x.$$lastCommittedViewValue,function(a){f||(x.$modelValue=a?b:c,x.$modelValue!==e&&x.$$writeModelToScope())})},this.$$writeModelToScope=function(){t(a,x.$modelValue),f(x.$viewChangeListeners,function(a){try{a()}catch(c){b(c)}})},this.$setViewValue=function(a,b){x.$viewValue=a,x.$options&&!x.$options.updateOnDefault||x.$$debounceViewValueCommit(b)},this.$$debounceViewValueCommit=function(b){var c=0,d=x.$options;d&&r(d.debounce)&&(d=d.debounce,u(d)?c=d:u(d[b])?c=d[b]:u(d["default"])&&(c=d["default"])),i.cancel(v),c?v=i(function(){x.$commitViewValue()},c):j.$$phase?x.$commitViewValue():a.$apply(function(){x.$commitViewValue()})},a.$watch(function(){var b=s(a);if(b!==x.$modelValue){x.$modelValue=x.$$rawModelValue=b,m=c;for(var d=x.$formatters,e=d.length,f=b;e--;)f=d[e](f);x.$viewValue!==f&&(x.$viewValue=x.$$lastCommittedViewValue=f,x.$render(),x.$$runValidators(b,f,n))}return b})}],Je=["$rootScope",function(a){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:Ie,priority:1,compile:function(b){return b.addClass(Ee).addClass("ng-untouched").addClass(Ce),{pre:function(a,b,c,d){var e=d[0],f=d[1]||Xd;e.$$setOptions(d[2]&&d[2].$options),f.$addControl(e),c.$observe("name",function(a){e.$name!==a&&f.$$renameControl(e,a)}),a.$on("$destroy",function(){f.$removeControl(e)})},post:function(b,c,d,e){var f=e[0];f.$options&&f.$options.updateOn&&c.on(f.$options.updateOn,function(a){f.$$debounceViewValueCommit(a&&a.type)}),c.on("blur",function(){f.$touched||(a.$$phase?b.$evalAsync(f.$setTouched):b.$apply(f.$setTouched))})}}}}}],Ke=/(\s+|^)default(\s+|$)/,Le=function(){return{restrict:"A",controller:["$scope","$attrs",function(a,b){var d=this;this.$options=a.$eval(b.ngModelOptions),this.$options.updateOn!==c?(this.$options.updateOnDefault=!1,this.$options.updateOn=Jc(this.$options.updateOn.replace(Ke,function(){return d.$options.updateOnDefault=!0," "}))):this.$options.updateOnDefault=!0}]}},Me=hc({terminal:!0,priority:1e3}),Ne=["$locale","$interpolate",function(a,b){var c=/{}/g,d=/^when(Minus)?(.+)$/;return{restrict:"EA",link:function(e,g,h){function i(a){g.text(a||"")}var j,k=h.count,l=h.$attr.when&&g.attr(h.$attr.when),m=h.offset||0,n=e.$eval(l)||{},o={},l=b.startSymbol(),p=b.endSymbol(),q=l+k+"-"+m+p,r=Fc.noop;f(h,function(a,b){var c=d.exec(b);c&&(c=(c[1]?"-":"")+xc(c[2]),n[c]=g.attr(h.$attr[b]))}),f(n,function(a,d){o[d]=b(a.replace(c,q))}),e.$watch(k,function(b){b=parseFloat(b);var c=isNaN(b);c||b in n||(b=a.pluralCat(b-m)),b===j||c&&isNaN(j)||(r(),r=e.$watch(o[b],i),j=b)})}}}],Oe=["$parse","$animate",function(a,g){var h=d("ngRepeat"),i=function(a,b,c,d,e,f,g){a[c]=d,e&&(a[e]=f),a.$index=b,a.$first=0===b,a.$last=b===g-1,a.$middle=!(a.$first||a.$last),a.$odd=!(a.$even=0===(1&b))};return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function(d,j){var k=j.ngRepeat,l=b.createComment(" end ngRepeat: "+k+" "),m=k.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!m)throw h("iexp",k);var n=m[1],o=m[2],p=m[3],q=m[4],m=n.match(/^(?:(\s*[\$\w]+)|\(\s*([\$\w]+)\s*,\s*([\$\w]+)\s*\))$/);if(!m)throw h("iidexp",n);var r=m[3]||m[1],s=m[2];if(p&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(p)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(p)))throw h("badident",p);var t,u,v,w,x={$id:Da};return q?t=a(q):(v=function(a,b){return Da(b)},w=function(a){return a}),function(a,b,d,j,m){t&&(u=function(b,c,d){return s&&(x[s]=b),x[r]=c,x.$index=d,t(a,x)});var n=da();a.$watchCollection(o,function(d){var j,o,q,t,x,y,z,A,B,C,D=b[0],E=da();if(p&&(a[p]=d),e(d))A=d,o=u||v;else{o=u||w,A=[];for(C in d)d.hasOwnProperty(C)&&"$"!=C.charAt(0)&&A.push(C);A.sort()}for(t=A.length,C=Array(t),j=0;t>j;j++)if(x=d===A?j:A[j],y=d[x],z=o(x,y,j),n[z])B=n[z],delete n[z],E[z]=B,C[j]=B;else{if(E[z])throw f(C,function(a){a&&a.scope&&(n[a.id]=a)}),h("dupes",k,z,y);C[j]={id:z,scope:c,clone:c},E[z]=!0}for(q in n){if(B=n[q],z=ca(B.clone),g.leave(z),z[0].parentNode)for(j=0,o=z.length;o>j;j++)z[j].$$NG_REMOVED=!0;B.scope.$destroy()}for(j=0;t>j;j++)if(x=d===A?j:A[j],y=d[x],B=C[j],B.scope){q=D;do q=q.nextSibling;while(q&&q.$$NG_REMOVED);B.clone[0]!=q&&g.move(ca(B.clone),null,tc(D)),D=B.clone[B.clone.length-1],i(B.scope,j,r,y,s,x,t)}else m(function(a,b){B.scope=b;var c=l.cloneNode(!1);a[a.length++]=c,g.enter(a,null,tc(D)),D=c,B.clone=a,E[B.id]=B,i(B.scope,j,r,y,s,x,t)});n=E})}}}}],Pe=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ngShow,function(b){a[b?"removeClass":"addClass"](c,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],Qe=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ngHide,function(b){a[b?"addClass":"removeClass"](c,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],Re=hc(function(a,b,c){a.$watchCollection(c.ngStyle,function(a,c){c&&a!==c&&f(c,function(a,c){b.css(c,"")}),a&&b.css(a)})}),Se=["$animate",function(a){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(c,d,e,g){var h=[],i=[],j=[],k=[],l=function(a,b){return function(){a.splice(b,1)}};c.$watch(e.ngSwitch||e.on,function(c){var d,e;for(d=0,e=j.length;e>d;++d)a.cancel(j[d]);for(d=j.length=0,e=k.length;e>d;++d){var m=ca(i[d].clone);k[d].$destroy(),(j[d]=a.leave(m)).then(l(j,d))}i.length=0,k.length=0,(h=g.cases["!"+c]||g.cases["?"])&&f(h,function(c){c.transclude(function(d,e){k.push(e);var f=c.element;d[d.length++]=b.createComment(" end ngSwitchWhen: "),i.push({clone:d}),a.enter(d,f.parent(),f)})})})}}}],Te=hc({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,c,d,e){d.cases["!"+c.ngSwitchWhen]=d.cases["!"+c.ngSwitchWhen]||[],d.cases["!"+c.ngSwitchWhen].push({transclude:e,element:b})}}),Ue=hc({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,c,d,e){d.cases["?"]=d.cases["?"]||[],d.cases["?"].push({transclude:e,element:b})}}),Ve=hc({restrict:"EAC",link:function(a,b,c,e,f){if(!f)throw d("ngTransclude")("orphan",N(b));f(function(a){b.empty(),b.append(a)})}}),We=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(b,c){"text/ng-template"==c.type&&a.put(c.id,b[0].text)}}}],Xe=d("ngOptions"),Ye=p({restrict:"A",terminal:!0}),Ze=["$compile","$parse",function(a,d){var e=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,g={$setViewValue:n};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(a,b,c){var d,e=this,f={},h=g;e.databound=c.ngModel,e.init=function(a,b,c){h=a,d=c},e.addOption=function(b,c){aa(b,'"option value"'),f[b]=!0,h.$viewValue==b&&(a.val(b),d.parent()&&d.remove()),c&&c[0].hasAttribute("selected")&&(c[0].selected=!0)},e.removeOption=function(a){this.hasOption(a)&&(delete f[a],h.$viewValue===a&&this.renderUnknownOption(a))},e.renderUnknownOption=function(b){b="? "+Da(b)+" ?",d.val(b),a.prepend(d),a.val(b),d.prop("selected",!0)},e.hasOption=function(a){return f.hasOwnProperty(a)},b.$on("$destroy",function(){e.renderUnknownOption=n})}],link:function(g,h,i,j){function k(a,b,c,d){c.$render=function(){var a=c.$viewValue;d.hasOption(a)?(x.parent()&&x.remove(),b.val(a),""===a&&o.prop("selected",!0)):q(a)&&o?b.val(""):d.renderUnknownOption(a)},b.on("change",function(){a.$apply(function(){x.parent()&&x.remove(),c.$setViewValue(b.val())})})}function l(a,b,c){var d;c.$render=function(){var a=new Ea(c.$viewValue);f(b.find("option"),function(b){b.selected=r(a.get(b.value))})},a.$watch(function(){H(d,c.$viewValue)||(d=G(c.$viewValue),c.$render())}),b.on("change",function(){a.$apply(function(){var a=[];f(b.find("option"),function(b){b.selected&&a.push(b.value)}),c.$setViewValue(a)})})}function m(b,g,h){function i(a,c,d){return H[x]=d,A&&(H[A]=c),a(b,H)}function j(a){var b;if(p)if(E&&Ic(a)){b=new Ea([]);for(var c=0;c<a.length;c++)b.put(i(E,null,a[c]),!0)}else b=new Ea(a);else E&&(a=i(E,null,a));return function(c,d){var e;return e=E?E:z?z:C,p?r(b.remove(i(e,c,d))):a===i(e,c,d)}}function k(){u||(b.$$postDigest(m),u=!0)}function l(a,b,c){a[b]=a[b]||0,a[b]+=c?1:-1}function m(){u=!1;var a,c,d,e,k,m={"":[]},o=[""];d=h.$viewValue,e=D(b)||[];var s,x,y,z,C=A?Object.keys(e).sort():e,I={};k=j(d);var J,K,L=!1;for(F={},z=0;y=C.length,y>z;z++)s=z,A&&(s=C[z],"$"===s.charAt(0))||(x=e[s],a=i(B,s,x)||"",(c=m[a])||(c=m[a]=[],o.push(a)),a=k(s,x),L=L||a,x=i(q,s,x),x=r(x)?x:"",K=E?E(b,H):A?C[z]:z,E&&(F[K]=s),c.push({id:K,label:x,selected:a}));for(p||(t||null===d?m[""].unshift({id:"",label:"",selected:!L}):L||m[""].unshift({id:"?",label:"",selected:!0})),s=0,C=o.length;C>s;s++){for(a=o[s],c=m[a],G.length<=s?(d={element:w.clone().attr("label",a),label:c.label},e=[d],G.push(e),g.append(d.element)):(e=G[s],d=e[0],d.label!=a&&d.element.attr("label",d.label=a)),L=null,z=0,y=c.length;y>z;z++)a=c[z],(k=e[z+1])?(L=k.element,k.label!==a.label&&(l(I,k.label,!1),l(I,a.label,!0),L.text(k.label=a.label),L.prop("label",k.label)),k.id!==a.id&&L.val(k.id=a.id),L[0].selected!==a.selected&&(L.prop("selected",k.selected=a.selected),sc&&L.prop("selected",k.selected))):(""===a.id&&t?J=t:(J=v.clone()).val(a.id).prop("selected",a.selected).attr("selected",a.selected).prop("label",a.label).text(a.label),e.push(k={element:J,label:a.label,id:a.id,selected:a.selected}),l(I,a.label,!0),L?L.after(J):d.element.append(J),L=J);for(z++;e.length>z;)a=e.pop(),l(I,a.label,!1),a.element.remove()}for(;G.length>s;){for(c=G.pop(),z=1;z<c.length;++z)l(I,c[z].label,!1);c[0].element.remove()}f(I,function(a,b){a>0?n.addOption(b):0>a&&n.removeOption(b)})}var o;if(!(o=s.match(e)))throw Xe("iexp",s,N(g));var q=d(o[2]||o[1]),x=o[4]||o[6],y=/ as /.test(o[0])&&o[1],z=y?d(y):null,A=o[5],B=d(o[3]||""),C=d(o[2]?o[1]:x),D=d(o[7]),E=o[8]?d(o[8]):null,F={},G=[[{element:g,label:""}]],H={};t&&(a(t)(b),t.removeClass("ng-scope"),t.remove()),g.empty(),g.on("change",function(){b.$apply(function(){var a,d=D(b)||[];if(p)a=[],f(g.val(),function(b){b=E?F[b]:b,a.push("?"===b?c:""===b?null:i(z?z:C,b,d[b]))});else{var e=E?F[g.val()]:g.val();a="?"===e?c:""===e?null:i(z?z:C,e,d[e])}h.$setViewValue(a),m()})}),h.$render=m,b.$watchCollection(D,k),b.$watchCollection(function(){var a,c=D(b);if(c&&Ic(c)){a=Array(c.length);for(var d=0,e=c.length;e>d;d++)a[d]=i(q,d,c[d])}else if(c)for(d in a={},c)c.hasOwnProperty(d)&&(a[d]=i(q,d,c[d]));return a},k),p&&b.$watchCollection(function(){return h.$modelValue},k)}if(j[1]){var n=j[0];j=j[1];var o,p=i.multiple,s=i.ngOptions,t=!1,u=!1,v=tc(b.createElement("option")),w=tc(b.createElement("optgroup")),x=v.clone();i=0;for(var y=h.children(),z=y.length;z>i;i++)if(""===y[i].value){o=t=y.eq(i);break}n.init(j,t,x),p&&(j.$isEmpty=function(a){return!a||0===a.length}),s?m(g,h,j):p?l(g,h,j):k(g,h,j,n)}}}}],$e=["$interpolate",function(a){var b={addOption:n,removeOption:n};return{restrict:"E",priority:100,compile:function(c,d){if(q(d.value)){var e=a(c.text(),!0);e||d.$set("value",c.text())}return function(a,c,d){var f=c.parent(),g=f.data("$selectController")||f.parent().data("$selectController");g&&g.databound||(g=b),e?a.$watch(e,function(a,b){d.$set("value",a),b!==a&&g.removeOption(b),g.addOption(a,c)}):g.addOption(d.value,c),c.on("$destroy",function(){g.removeOption(d.value)})}}}}],_e=p({restrict:"E",terminal:!1}),af=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.required=!0,d.$validators.required=function(a,b){return!c.required||!d.$isEmpty(b)},c.$observe("required",function(){d.$validate()}))}}},bf=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,e,f){if(f){var g,h=e.ngPattern||e.pattern;e.$observe("pattern",function(a){if(t(a)&&0<a.length&&(a=new RegExp("^"+a+"$")),a&&!a.test)throw d("ngPattern")("noregexp",h,a,N(b));g=a||c,f.$validate()}),f.$validators.pattern=function(a){return f.$isEmpty(a)||q(g)||g.test(a)}}}}},cf=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var e=-1;c.$observe("maxlength",function(a){a=l(a),e=isNaN(a)?-1:a,d.$validate()}),d.$validators.maxlength=function(a,b){return 0>e||d.$isEmpty(b)||b.length<=e}}}}},df=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var e=0;c.$observe("minlength",function(a){e=l(a)||0,d.$validate()}),d.$validators.minlength=function(a,b){return d.$isEmpty(b)||b.length>=e}}}}};a.angular.bootstrap?console.log("WARNING: Tried to load angular more than once."):(Z(),fa(Fc),tc(b).ready(function(){U(b,V)}))}(window,document),!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}</style>'),function(a,b){"use strict";function c(a,c,e){d.directive(a,["$parse","$swipe",function(d,f){return function(g,h,i){function j(a){if(!k)return!1;var b=Math.abs(a.y-k.y);

return a=(a.x-k.x)*c,l&&75>b&&a>0&&a>30&&.3>b/a}var k,l,m=d(i[a]),n=["touch"];b.isDefined(i.ngSwipeDisableMouse)||n.push("mouse"),f.bind(h,{start:function(a){k=a,l=!0},cancel:function(){l=!1},end:function(a,b){j(a)&&g.$apply(function(){h.triggerHandler(e),m(g,{$event:b})})}},n)}}])}var d=b.module("ngTouch",[]);d.factory("$swipe",[function(){function a(a){var b=a.touches&&a.touches.length?a.touches:[a];return a=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0],{x:a.clientX,y:a.clientY}}function c(a,c){var e=[];return b.forEach(a,function(a){(a=d[a][c])&&e.push(a)}),e.join(" ")}var d={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}};return{bind:function(b,d,e){var f,g,h,i,j=!1;e=e||["mouse","touch"],b.on(c(e,"start"),function(b){h=a(b),j=!0,g=f=0,i=h,d.start&&d.start(h,b)});var k=c(e,"cancel");k&&b.on(k,function(a){j=!1,d.cancel&&d.cancel(a)}),b.on(c(e,"move"),function(b){if(j&&h){var c=a(b);f+=Math.abs(c.x-i.x),g+=Math.abs(c.y-i.y),i=c,10>f&&10>g||(g>f?(j=!1,d.cancel&&d.cancel(b)):(b.preventDefault(),d.move&&d.move(c,b)))}}),b.on(c(e,"end"),function(b){j&&(j=!1,d.end&&d.end(a(b),b))})}}}]),d.config(["$provide",function(a){a.decorator("ngClickDirective",["$delegate",function(a){return a.shift(),a}])}]),d.directive("ngClick",["$parse","$timeout","$rootElement",function(a,c,d){function e(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d+1],f=c;if(25>Math.abs(a[d]-b)&&25>Math.abs(e-f))return a.splice(d,d+2),!0}return!1}function f(a){if(!(2500<Date.now()-h)){var b=a.touches&&a.touches.length?a.touches:[a],c=b[0].clientX,b=b[0].clientY;1>c&&1>b||j&&j[0]===c&&j[1]===b||(j&&(j=null),"label"===a.target.tagName.toLowerCase()&&(j=[c,b]),e(i,c,b)||(a.stopPropagation(),a.preventDefault(),a.target&&a.target.blur()))}}function g(a){a=a.touches&&a.touches.length?a.touches:[a];var b=a[0].clientX,d=a[0].clientY;i.push(b,d),c(function(){for(var a=0;a<i.length;a+=2)if(i[a]==b&&i[a+1]==d){i.splice(a,a+2);break}},2500,!1)}var h,i,j;return function(c,j,k){function l(){r=!1,j.removeClass("ng-click-active")}var m,n,o,p,q=a(k.ngClick),r=!1;j.on("touchstart",function(a){r=!0,m=a.target?a.target:a.srcElement,3==m.nodeType&&(m=m.parentNode),j.addClass("ng-click-active"),n=Date.now(),a=a.touches&&a.touches.length?a.touches:[a],a=a[0].originalEvent||a[0],o=a.clientX,p=a.clientY}),j.on("touchmove",function(){l()}),j.on("touchcancel",function(){l()}),j.on("touchend",function(a){var c=Date.now()-n,q=a.changedTouches&&a.changedTouches.length?a.changedTouches:a.touches&&a.touches.length?a.touches:[a],s=q[0].originalEvent||q[0],q=s.clientX,s=s.clientY,t=Math.sqrt(Math.pow(q-o,2)+Math.pow(s-p,2));r&&750>c&&12>t&&(i||(d[0].addEventListener("click",f,!0),d[0].addEventListener("touchstart",g,!0),i=[]),h=Date.now(),e(i,q,s),m&&m.blur(),b.isDefined(k.disabled)&&!1!==k.disabled||j.triggerHandler("click",[a])),l()}),j.onclick=function(){},j.on("click",function(a,b){c.$apply(function(){q(c,{$event:b||a})})}),j.on("mousedown",function(){j.addClass("ng-click-active")}),j.on("mousemove mouseup",function(){j.removeClass("ng-click-active")})}}]),c("ngSwipeLeft",-1,"swipeleft"),c("ngSwipeRight",1,"swiperight")}(window,window.angular),function(a){function b(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=0,g=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),g=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(g=0,f=-1*e),void 0!==c.wheelDeltaY&&(g=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120),d.unshift(b,e,f,g),(a.event.dispatch||a.event.handle).apply(this,d)}var c=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var d=c.length;d;)a.event.fixHooks[c[--d]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=c.length;a;)this.addEventListener(c[--a],b,!1);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var a=c.length;a;)this.removeEventListener(c[--a],b,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.tooltip","ui.bootstrap.position","ui.bootstrap.stackedMap"]),angular.module("ui.bootstrap.tpls",["uib/template/tooltip/tooltip-html-popup.html","uib/template/tooltip/tooltip-popup.html","uib/template/tooltip/tooltip-template-popup.html"]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.stackedMap"]).provider("$uibTooltip",function(){function a(a){var b=/[A-Z]/g,c="-";return a.replace(b,function(a,b){return(b?c:"")+a.toLowerCase()})}var b={placement:"top",placementClassPrefix:"",animation:!0,popupDelay:0,popupCloseDelay:0,useContentExp:!1},c={mouseenter:"mouseleave",click:"click",outsideClick:"outsideClick",focus:"blur",none:""},d={};this.options=function(a){angular.extend(d,a)},this.setTriggers=function(a){angular.extend(c,a)},this.$get=["$window","$compile","$timeout","$document","$uibPosition","$interpolate","$rootScope","$parse","$$stackedMap",function(e,f,g,h,i,j,k,l,m){function n(a){if(27===a.which){var b=o.top();b&&(b.value.close(),o.removeTop(),b=null)}}var o=m.createNew();return h.on("keypress",n),k.$on("$destroy",function(){h.off("keypress",n)}),function(e,k,m,n){function p(a){var b=(a||n.trigger||m).split(" "),d=b.map(function(a){return c[a]||a});return{show:b,hide:d}}n=angular.extend({},b,d,n);var q=a(e),r=j.startSymbol(),s=j.endSymbol(),t="<div "+q+'-popup uib-title="'+r+"title"+s+'" '+(n.useContentExp?'content-exp="contentExp()" ':'content="'+r+"content"+s+'" ')+'placement="'+r+"placement"+s+'" popup-class="'+r+"popupClass"+s+'" animation="animation" is-open="isOpen" origin-scope="origScope" class="uib-position-measure"></div>';return{compile:function(){var a=f(t);return function(b,c,d){function f(){M.isOpen?m():j()}function j(){(!L||b.$eval(d[k+"Enable"]))&&(t(),w(),M.popupDelay?F||(F=g(q,M.popupDelay,!1)):q())}function m(){r(),M.popupCloseDelay?G||(G=g(s,M.popupCloseDelay,!1)):s()}function q(){return r(),t(),M.content?(u(),void M.$evalAsync(function(){M.isOpen=!0,x(!0),R()})):angular.noop}function r(){F&&(g.cancel(F),F=null),H&&(g.cancel(H),H=null)}function s(){M&&M.$evalAsync(function(){M&&(M.isOpen=!1,x(!1),M.animation?E||(E=g(v,150,!1)):v())})}function t(){G&&(g.cancel(G),G=null),E&&(g.cancel(E),E=null)}function u(){C||(D=M.$new(),C=a(D,function(a){J?h.find("body").append(a):c.after(a)}),y())}function v(){r(),t(),z(),C&&(C.remove(),C=null),D&&(D.$destroy(),D=null)}function w(){M.title=d[k+"Title"],M.content=P?P(b):d[e],M.popupClass=d[k+"Class"],M.placement=angular.isDefined(d[k+"Placement"])?d[k+"Placement"]:n.placement;var a=i.parsePlacement(M.placement);I=a[1]?a[0]+"-"+a[1]:a[0];var c=parseInt(d[k+"PopupDelay"],10),f=parseInt(d[k+"PopupCloseDelay"],10);M.popupDelay=isNaN(c)?n.popupDelay:c,M.popupCloseDelay=isNaN(f)?n.popupCloseDelay:f}function x(a){O&&angular.isFunction(O.assign)&&O.assign(b,a)}function y(){Q.length=0,P?(Q.push(b.$watch(P,function(a){M.content=a,!a&&M.isOpen&&s()})),Q.push(D.$watch(function(){N||(N=!0,D.$$postDigest(function(){N=!1,M&&M.isOpen&&R()}))}))):Q.push(d.$observe(e,function(a){M.content=a,!a&&M.isOpen?s():R()})),Q.push(d.$observe(k+"Title",function(a){M.title=a,M.isOpen&&R()})),Q.push(d.$observe(k+"Placement",function(a){M.placement=a?a:n.placement,M.isOpen&&R()}))}function z(){Q.length&&(angular.forEach(Q,function(a){a()}),Q.length=0)}function A(a){M&&M.isOpen&&C&&(c[0].contains(a.target)||C[0].contains(a.target)||m())}function B(){var a=d[k+"Trigger"];S(),K=p(a),"none"!==K.show&&K.show.forEach(function(a,b){"outsideClick"===a?(c.on("click",f),h.on("click",A)):a===K.hide[b]?c.on(a,f):a&&(c.on(a,j),c.on(K.hide[b],m)),c.on("keypress",function(a){27===a.which&&m()})})}var C,D,E,F,G,H,I,J=angular.isDefined(n.appendToBody)?n.appendToBody:!1,K=p(void 0),L=angular.isDefined(d[k+"Enable"]),M=b.$new(!0),N=!1,O=angular.isDefined(d[k+"IsOpen"])?l(d[k+"IsOpen"]):!1,P=n.useContentExp?l(d[e]):!1,Q=[],R=function(){C&&C.html()&&(H||(H=g(function(){var a=i.positionElements(c,C,M.placement,J);C.css({top:a.top+"px",left:a.left+"px"}),C.hasClass(a.placement.split("-")[0])||(C.removeClass(I.split("-")[0]),C.addClass(a.placement.split("-")[0])),C.hasClass(n.placementClassPrefix+a.placement)||(C.removeClass(n.placementClassPrefix+I),C.addClass(n.placementClassPrefix+a.placement)),C.hasClass("uib-position-measure")?(i.positionArrow(C,a.placement),C.removeClass("uib-position-measure")):I!==a.placement&&i.positionArrow(C,a.placement),I=a.placement,H=null},0,!1)))};M.origScope=b,M.isOpen=!1,o.add(M,{close:s}),M.contentExp=function(){return M.content},d.$observe("disabled",function(a){a&&r(),a&&M.isOpen&&s()}),O&&b.$watch(O,function(a){M&&!a===M.isOpen&&f()});var S=function(){K.show.forEach(function(a){"outsideClick"===a?c.off("click",f):(c.off(a,j),c.off(a,f))}),K.hide.forEach(function(a){"outsideClick"===a?h.off("click",A):c.off(a,m)})};B();var T=b.$eval(d[k+"Animation"]);M.animation=angular.isDefined(T)?!!T:n.animation;var U,V=k+"AppendToBody";U=V in d&&void 0===d[V]?!0:b.$eval(d[V]),J=angular.isDefined(U)?U:J,b.$on("$destroy",function(){S(),v(),o.remove(M),M=null})}}}}}]}).directive("uibTooltipTemplateTransclude",["$animate","$sce","$compile","$templateRequest",function(a,b,c,d){return{link:function(e,f,g){var h,i,j,k=e.$eval(g.tooltipTemplateTranscludeScope),l=0,m=function(){i&&(i.remove(),i=null),h&&(h.$destroy(),h=null),j&&(a.leave(j).then(function(){i=null}),i=j,j=null)};e.$watch(b.parseAsResourceUrl(g.uibTooltipTemplateTransclude),function(b){var g=++l;b?(d(b,!0).then(function(d){if(g===l){var e=k.$new(),i=d,n=c(i)(e,function(b){m(),a.enter(b,f)});h=e,j=n,h.$emit("$includeContentLoaded",b)}},function(){g===l&&(m(),e.$emit("$includeContentError",b))}),e.$emit("$includeContentRequested",b)):m()}),e.$on("$destroy",m)}}}]).directive("uibTooltipClasses",["$uibPosition",function(a){return{restrict:"A",link:function(b,c,d){if(b.placement){var e=a.parsePlacement(b.placement);c.addClass(e[0])}b.popupClass&&c.addClass(b.popupClass),b.animation()&&c.addClass(d.tooltipAnimationClass)}}}]).directive("uibTooltipPopup",function(){return{replace:!0,scope:{content:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"uib/template/tooltip/tooltip-popup.html"}}).directive("uibTooltip",["$uibTooltip",function(a){return a("uibTooltip","tooltip","mouseenter")}]).directive("uibTooltipTemplatePopup",function(){return{replace:!0,scope:{contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&",originScope:"&"},templateUrl:"uib/template/tooltip/tooltip-template-popup.html"}}).directive("uibTooltipTemplate",["$uibTooltip",function(a){return a("uibTooltipTemplate","tooltip","mouseenter",{useContentExp:!0})}]).directive("uibTooltipHtmlPopup",function(){return{replace:!0,scope:{contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"uib/template/tooltip/tooltip-html-popup.html"}}).directive("uibTooltipHtml",["$uibTooltip",function(a){return a("uibTooltipHtml","tooltip","mouseenter",{useContentExp:!0})}]),angular.module("ui.bootstrap.position",[]).factory("$uibPosition",["$document","$window",function(a,b){var c,d,e={normal:/(auto|scroll)/,hidden:/(auto|scroll|hidden)/},f={auto:/\s?auto?\s?/i,primary:/^(top|bottom|left|right)$/,secondary:/^(top|bottom|left|right|center)$/,vertical:/^(top|bottom)$/},g=/(HTML|BODY)/;return{getRawNode:function(a){return a.nodeName?a:a[0]||a},parseStyle:function(a){return a=parseFloat(a),isFinite(a)?a:0},offsetParent:function(c){function d(a){return"static"===(b.getComputedStyle(a).position||"static")}c=this.getRawNode(c);for(var e=c.offsetParent||a[0].documentElement;e&&e!==a[0].documentElement&&d(e);)e=e.offsetParent;return e||a[0].documentElement},scrollbarWidth:function(e){if(e){if(angular.isUndefined(d)){var f=a.find("body");f.addClass("uib-position-body-scrollbar-measure"),d=b.innerWidth-f[0].clientWidth,d=isFinite(d)?d:0,f.removeClass("uib-position-body-scrollbar-measure")}return d}if(angular.isUndefined(c)){var g=angular.element('<div class="uib-position-scrollbar-measure"></div>');a.find("body").append(g),c=g[0].offsetWidth-g[0].clientWidth,c=isFinite(c)?c:0,g.remove()}return c},scrollbarPadding:function(a){a=this.getRawNode(a);var c=b.getComputedStyle(a),d=this.parseStyle(c.paddingRight),e=this.parseStyle(c.paddingBottom),f=this.scrollParent(a,!1,!0),h=this.scrollbarWidth(f,g.test(f.tagName));return{scrollbarWidth:h,widthOverflow:f.scrollWidth>f.clientWidth,right:d+h,originalRight:d,heightOverflow:f.scrollHeight>f.clientHeight,bottom:e+h,originalBottom:e}},isScrollable:function(a,c){a=this.getRawNode(a);var d=c?e.hidden:e.normal,f=b.getComputedStyle(a);return d.test(f.overflow+f.overflowY+f.overflowX)},scrollParent:function(c,d,f){c=this.getRawNode(c);var g=d?e.hidden:e.normal,h=a[0].documentElement,i=b.getComputedStyle(c);if(f&&g.test(i.overflow+i.overflowY+i.overflowX))return c;var j="absolute"===i.position,k=c.parentElement||h;if(k===h||"fixed"===i.position)return h;for(;k.parentElement&&k!==h;){var l=b.getComputedStyle(k);if(j&&"static"!==l.position&&(j=!1),!j&&g.test(l.overflow+l.overflowY+l.overflowX))break;k=k.parentElement}return k},position:function(c,d){c=this.getRawNode(c);var e=this.offset(c);if(d){var f=b.getComputedStyle(c);e.top-=this.parseStyle(f.marginTop),e.left-=this.parseStyle(f.marginLeft)}var g=this.offsetParent(c),h={top:0,left:0};return g!==a[0].documentElement&&(h=this.offset(g),h.top+=g.clientTop-g.scrollTop,h.left+=g.clientLeft-g.scrollLeft),{width:Math.round(angular.isNumber(e.width)?e.width:c.offsetWidth),height:Math.round(angular.isNumber(e.height)?e.height:c.offsetHeight),top:Math.round(e.top-h.top),left:Math.round(e.left-h.left)}},offset:function(c){c=this.getRawNode(c);var d=c.getBoundingClientRect();return{width:Math.round(angular.isNumber(d.width)?d.width:c.offsetWidth),height:Math.round(angular.isNumber(d.height)?d.height:c.offsetHeight),top:Math.round(d.top+(b.pageYOffset||a[0].documentElement.scrollTop)),left:Math.round(d.left+(b.pageXOffset||a[0].documentElement.scrollLeft))}},viewportOffset:function(c,d,e){c=this.getRawNode(c),e=e!==!1?!0:!1;var f=c.getBoundingClientRect(),g={top:0,left:0,bottom:0,right:0},h=d?a[0].documentElement:this.scrollParent(c),i=h.getBoundingClientRect();if(g.top=i.top+h.clientTop,g.left=i.left+h.clientLeft,h===a[0].documentElement&&(g.top+=b.pageYOffset,g.left+=b.pageXOffset),g.bottom=g.top+h.clientHeight,g.right=g.left+h.clientWidth,e){var j=b.getComputedStyle(h);g.top+=this.parseStyle(j.paddingTop),g.bottom-=this.parseStyle(j.paddingBottom),g.left+=this.parseStyle(j.paddingLeft),g.right-=this.parseStyle(j.paddingRight)}return{top:Math.round(f.top-g.top),bottom:Math.round(g.bottom-f.bottom),left:Math.round(f.left-g.left),right:Math.round(g.right-f.right)}},parsePlacement:function(a){var b=f.auto.test(a);return b&&(a=a.replace(f.auto,"")),a=a.split("-"),a[0]=a[0]||"top",f.primary.test(a[0])||(a[0]="top"),a[1]=a[1]||"center",f.secondary.test(a[1])||(a[1]="center"),a[2]=b?!0:!1,a},positionElements:function(a,c,d,e){a=this.getRawNode(a),c=this.getRawNode(c);var g=angular.isDefined(c.offsetWidth)?c.offsetWidth:c.prop("offsetWidth"),h=angular.isDefined(c.offsetHeight)?c.offsetHeight:c.prop("offsetHeight");d=this.parsePlacement(d);var i=e?this.offset(a):this.position(a),j={top:0,left:0,placement:""};if(d[2]){var k=this.viewportOffset(a,e),l=b.getComputedStyle(c),m={width:g+Math.round(Math.abs(this.parseStyle(l.marginLeft)+this.parseStyle(l.marginRight))),height:h+Math.round(Math.abs(this.parseStyle(l.marginTop)+this.parseStyle(l.marginBottom)))};if(d[0]="top"===d[0]&&m.height>k.top&&m.height<=k.bottom?"bottom":"bottom"===d[0]&&m.height>k.bottom&&m.height<=k.top?"top":"left"===d[0]&&m.width>k.left&&m.width<=k.right?"right":"right"===d[0]&&m.width>k.right&&m.width<=k.left?"left":d[0],d[1]="top"===d[1]&&m.height-i.height>k.bottom&&m.height-i.height<=k.top?"bottom":"bottom"===d[1]&&m.height-i.height>k.top&&m.height-i.height<=k.bottom?"top":"left"===d[1]&&m.width-i.width>k.right&&m.width-i.width<=k.left?"right":"right"===d[1]&&m.width-i.width>k.left&&m.width-i.width<=k.right?"left":d[1],"center"===d[1])if(f.vertical.test(d[0])){var n=i.width/2-g/2;k.left+n<0&&m.width-i.width<=k.right?d[1]="left":k.right+n<0&&m.width-i.width<=k.left&&(d[1]="right")}else{var o=i.height/2-m.height/2;k.top+o<0&&m.height-i.height<=k.bottom?d[1]="top":k.bottom+o<0&&m.height-i.height<=k.top&&(d[1]="bottom")}}switch(d[0]){case"top":j.top=i.top-h;break;case"bottom":j.top=i.top+i.height;break;case"left":j.left=i.left-g;break;case"right":j.left=i.left+i.width}switch(d[1]){case"top":j.top=i.top;break;case"bottom":j.top=i.top+i.height-h;break;case"left":j.left=i.left;break;case"right":j.left=i.left+i.width-g;break;case"center":f.vertical.test(d[0])?j.left=i.left+i.width/2-g/2:j.top=i.top+i.height/2-h/2}return j.top=Math.round(j.top),j.left=Math.round(j.left),j.placement="center"===d[1]?d[0]:d[0]+"-"+d[1],j},positionArrow:function(a,c){a=this.getRawNode(a);var d=a.querySelector(".tooltip-inner, .popover-inner");if(d){var e=angular.element(d).hasClass("tooltip-inner"),g=a.querySelector(e?".tooltip-arrow":".arrow");if(g){var h={top:"",bottom:"",left:"",right:""};if(c=this.parsePlacement(c),"center"===c[1])return void angular.element(g).css(h);var i="border-"+c[0]+"-width",j=b.getComputedStyle(g)[i],k="border-";k+=f.vertical.test(c[0])?c[0]+"-"+c[1]:c[1]+"-"+c[0],k+="-radius";var l=b.getComputedStyle(e?d:a)[k];switch(c[0]){case"top":h.bottom=e?"0":"-"+j;break;case"bottom":h.top=e?"0":"-"+j;break;case"left":h.right=e?"0":"-"+j;break;case"right":h.left=e?"0":"-"+j}h[c[1]]=l,angular.element(g).css(h)}}}}}]),angular.module("ui.bootstrap.stackedMap",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b===a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b===a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}),angular.module("uib/template/tooltip/tooltip-html-popup.html",[]).run(["$templateCache",function(a){a.put("uib/template/tooltip/tooltip-html-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  uib-tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind-html="contentExp()"></div>\n</div>\n')}]),angular.module("uib/template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function(a){a.put("uib/template/tooltip/tooltip-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  uib-tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("uib/template/tooltip/tooltip-template-popup.html",[]).run(["$templateCache",function(a){a.put("uib/template/tooltip/tooltip-template-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  uib-tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner"\n    uib-tooltip-template-transclude="contentExp()"\n    tooltip-template-transclude-scope="originScope()"></div>\n</div>\n')}]),angular.module("ui.bootstrap.tooltip").run(function(){!angular.$$csp().noInlineStyle&&!angular.$$uibTooltipCss&&angular.element(document).find("head").prepend('<style type="text/css">[uib-tooltip-popup].tooltip.top-left > .tooltip-arrow,[uib-tooltip-popup].tooltip.top-right > .tooltip-arrow,[uib-tooltip-popup].tooltip.bottom-left > .tooltip-arrow,[uib-tooltip-popup].tooltip.bottom-right > .tooltip-arrow,[uib-tooltip-popup].tooltip.left-top > .tooltip-arrow,[uib-tooltip-popup].tooltip.left-bottom > .tooltip-arrow,[uib-tooltip-popup].tooltip.right-top > .tooltip-arrow,[uib-tooltip-popup].tooltip.right-bottom > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.top-left > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.top-right > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.bottom-left > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.bottom-right > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.left-top > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.left-bottom > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.right-top > .tooltip-arrow,[uib-tooltip-html-popup].tooltip.right-bottom > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.top-left > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.top-right > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.bottom-left > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.bottom-right > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.left-top > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.left-bottom > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.right-top > .tooltip-arrow,[uib-tooltip-template-popup].tooltip.right-bottom > .tooltip-arrow,[uib-popover-popup].popover.top-left > .arrow,[uib-popover-popup].popover.top-right > .arrow,[uib-popover-popup].popover.bottom-left > .arrow,[uib-popover-popup].popover.bottom-right > .arrow,[uib-popover-popup].popover.left-top > .arrow,[uib-popover-popup].popover.left-bottom > .arrow,[uib-popover-popup].popover.right-top > .arrow,[uib-popover-popup].popover.right-bottom > .arrow,[uib-popover-html-popup].popover.top-left > .arrow,[uib-popover-html-popup].popover.top-right > .arrow,[uib-popover-html-popup].popover.bottom-left > .arrow,[uib-popover-html-popup].popover.bottom-right > .arrow,[uib-popover-html-popup].popover.left-top > .arrow,[uib-popover-html-popup].popover.left-bottom > .arrow,[uib-popover-html-popup].popover.right-top > .arrow,[uib-popover-html-popup].popover.right-bottom > .arrow,[uib-popover-template-popup].popover.top-left > .arrow,[uib-popover-template-popup].popover.top-right > .arrow,[uib-popover-template-popup].popover.bottom-left > .arrow,[uib-popover-template-popup].popover.bottom-right > .arrow,[uib-popover-template-popup].popover.left-top > .arrow,[uib-popover-template-popup].popover.left-bottom > .arrow,[uib-popover-template-popup].popover.right-top > .arrow,[uib-popover-template-popup].popover.right-bottom > .arrow{top:auto;bottom:auto;left:auto;right:auto;margin:0;}[uib-popover-popup].popover,[uib-popover-html-popup].popover,[uib-popover-template-popup].popover{display:block !important;}</style>'),angular.$$uibTooltipCss=!0}),angular.module("ui.bootstrap.position").run(function(){!angular.$$csp().noInlineStyle&&!angular.$$uibPositionCss&&angular.element(document).find("head").prepend('<style type="text/css">.uib-position-measure{display:block !important;visibility:hidden !important;position:absolute !important;top:-9999px !important;left:-9999px !important;}.uib-position-scrollbar-measure{position:absolute !important;top:-9999px !important;width:50px !important;height:50px !important;overflow:scroll !important;}.uib-position-body-scrollbar-measure{overflow:scroll !important;}</style>'),angular.$$uibPositionCss=!0}),window.Modernizr=function(a,b,c){function d(){n.input=function(a){for(var b=0,c=a.length;c>b;b++)B[a[b]]=a[b]in t;return B}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),n.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)t.setAttribute("type",e=a[g]),d="text"!==t.type,d&&(t.value=u,t.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&t.style.WebkitAppearance!==c?(p.appendChild(t),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(t,null).WebkitAppearance&&0!==t.offsetHeight,p.removeChild(t)):/^(search|tel)$/.test(e)||(/^(url|email)$/.test(e)?d=t.checkValidity&&t.checkValidity()===!1:/^color$/.test(e)?(p.appendChild(t),p.offsetWidth,d=t.value!=u,p.removeChild(t)):d=t.value!=u)),A[a[g]]=!!d;return A}("search tel url email datetime date month week time datetime-local number range color".split(" "))}function e(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),d=(a+" "+x.join(c+" ")+c).split(" ");return f(d,b)}function f(a,b){for(var d in a)if(s[a[d]]!==c)return"pfx"==b?a[d]:!0;return!1}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){return typeof a===b}function i(a,b){return j(w.join(a+";")+(b||""))}function j(a){s.cssText=a}var k,l,m="2.0.6",n={},o=!0,p=b.documentElement,q=(b.head||b.getElementsByTagName("head")[0],"modernizr"),r=b.createElement(q),s=r.style,t=b.createElement("input"),u=":)",v=Object.prototype.toString,w=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),x="Webkit Moz O ms Khtml".split(" "),y={svg:"http://www.w3.org/2000/svg"},z={},A={},B={},C=[],D=function(a,c,d,e){var f,g,h,i=b.createElement("div");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:q+(d+1),i.appendChild(h);return f=["&shy;","<style>",a,"</style>"].join(""),i.id=q,i.innerHTML+=f,p.appendChild(i),g=c(i,a),i.parentNode.removeChild(i),!!g},E=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var f=a in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),f=h(e[a],"function"),h(e[a],c)||(e[a]=c),e.removeAttribute(a))),e=null,f}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),F={}.hasOwnProperty;l=h(F,c)||h(F.call,c)?function(a,b){return b in a&&h(a.constructor.prototype[b],c)}:function(a,b){return F.call(a,b)};!function(c,d){var e=c.join(""),f=d.length;D(e,function(c,d){for(var e=b.styleSheets[b.styleSheets.length-1],g=e.cssRules&&e.cssRules[0]?e.cssRules[0].cssText:e.cssText||"",h=c.childNodes,i={};f--;)i[h[f].id]=h[f];n.touch="ontouchstart"in a||9===i.touch.offsetTop,n.csstransforms3d=9===i.csstransforms3d.offsetLeft,n.generatedcontent=i.generatedcontent.offsetHeight>=1,n.fontface=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])},f,d)}(['@font-face {font-family:"font";src:url("https://")}',["@media (",w.join("touch-enabled),("),q,")","{#touch{top:9px;position:absolute}}"].join(""),["@media (",w.join("transform-3d),("),q,")","{#csstransforms3d{left:9px;position:absolute}}"].join(""),['#generatedcontent:after{content:"',u,'";visibility:hidden}'].join("")],["fontface","touch","csstransforms3d","generatedcontent"]);z.flexbox=function(){function a(a,b,c,d){a.style.cssText=w.join(b+":"+c+";")+(d||"")}function c(a,b,c,d){b+=":",a.style.cssText=(b+w.join(c+";"+b)).slice(0,-b.length)+(d||"")}var d=b.createElement("div"),e=b.createElement("div");c(d,"display","box","width:42px;padding:0;"),a(e,"box-flex","1","width:10px;"),d.appendChild(e),p.appendChild(d);var f=42===e.offsetWidth;return d.removeChild(e),p.removeChild(d),f},z.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},z.canvastext=function(){return!!n.canvas&&!!h(b.createElement("canvas").getContext("2d").fillText,"function")},z.webgl=function(){return!!a.WebGLRenderingContext},z.touch=function(){return n.touch},z.geolocation=function(){return!!navigator.geolocation},z.postmessage=function(){return!!a.postMessage},z.websqldatabase=function(){var b=!!a.openDatabase;return b},z.indexedDB=function(){for(var b=-1,c=x.length;++b<c;)if(a[x[b].toLowerCase()+"IndexedDB"])return!0;return!!a.indexedDB},z.hashchange=function(){return E("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},z.history=function(){return!!a.history&&!!history.pushState},z.draganddrop=function(){return E("dragstart")&&E("drop")},z.websockets=function(){for(var b=-1,c=x.length;++b<c;)if(a[x[b]+"WebSocket"])return!0;return"WebSocket"in a},z.rgba=function(){return j("background-color:rgba(150,255,150,.5)"),g(s.backgroundColor,"rgba")},z.hsla=function(){return j("background-color:hsla(120,40%,100%,.5)"),g(s.backgroundColor,"rgba")||g(s.backgroundColor,"hsla")},z.multiplebgs=function(){return j("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(s.background)},z.backgroundsize=function(){return e("backgroundSize")},z.borderimage=function(){return e("borderImage")},z.borderradius=function(){return e("borderRadius")},z.boxshadow=function(){return e("boxShadow")},z.textshadow=function(){return""===b.createElement("div").style.textShadow},z.opacity=function(){return i("opacity:.55"),/^0.55$/.test(s.opacity)},z.cssanimations=function(){return e("animationName")},z.csscolumns=function(){return e("columnCount")},z.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return j((a+w.join(b+a)+w.join(c+a)).slice(0,-a.length)),g(s.backgroundImage,"gradient")},z.cssreflections=function(){return e("boxReflect")},z.csstransforms=function(){return!!f(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])},z.csstransforms3d=function(){var a=!!f(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);return a&&"webkitPerspective"in p.style&&(a=n.csstransforms3d),a},z.csstransitions=function(){return e("transitionProperty")},z.fontface=function(){return n.fontface},z.generatedcontent=function(){return n.generatedcontent},z.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType){c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"');var d='video/mp4; codecs="avc1.42E01E';c.h264=a.canPlayType(d+'"')||a.canPlayType(d+', mp4a.40.2"'),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"')}}catch(e){}return c},z.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"'),c.mp3=a.canPlayType("audio/mpeg;"),c.wav=a.canPlayType('audio/wav; codecs="1"'),c.m4a=a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;"))}catch(d){}return c},z.localstorage=function(){try{return!!localStorage.getItem}catch(a){return!1}},z.sessionstorage=function(){try{return!!sessionStorage.getItem}catch(a){return!1}},z.webworkers=function(){return!!a.Worker},z.applicationcache=function(){return!!a.applicationCache},z.svg=function(){return!!b.createElementNS&&!!b.createElementNS(y.svg,"svg").createSVGRect},z.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==y.svg},z.smil=function(){return!!b.createElementNS&&/SVG/.test(v.call(b.createElementNS(y.svg,"animate")))},z.svgclippaths=function(){return!!b.createElementNS&&/SVG/.test(v.call(b.createElementNS(y.svg,"clipPath")))};for(var G in z)l(z,G)&&(k=G.toLowerCase(),n[k]=z[G](),C.push((n[k]?"":"no-")+k));return n.input||d(),j(""),r=t=null,a.attachEvent&&function(){var a=b.createElement("div");return a.innerHTML="<elem></elem>",1!==a.childNodes.length}()&&function(a,b){function d(a){for(var b=-1;++b<i;)a.createElement(h[b])}a.iepp=a.iepp||{};var e,f=a.iepp,g=f.html5elements||"abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",h=g.split("|"),i=h.length,j=new RegExp("(^|\\s)("+g+")","gi"),k=new RegExp("<(/*)("+g+")","gi"),l=/^\s*[\{\}]\s*$/,m=new RegExp("(^|[^\\n]*?\\s)("+g+")([^\\n]*)({[\\n\\w\\W]*?})","gi"),n=b.createDocumentFragment(),o=b.documentElement,p=o.firstChild,q=b.createElement("body"),r=b.createElement("style"),s=/print|all/;f.getCSS=function(a,b){if(a+""===c)return"";for(var d,e=-1,g=a.length,h=[];++e<g;)d=a[e],d.disabled||(b=d.media||b,s.test(b)&&h.push(f.getCSS(d.imports,b),d.cssText),b="all");return h.join("")},f.parseCSS=function(a){for(var b,c=[];null!=(b=m.exec(a));)c.push(((l.exec(b[1])?"\n":b[1])+b[2]+b[3]).replace(j,"$1.iepp_$2")+b[4]);return c.join("\n")},f.writeHTML=function(){
var a=-1;for(e=e||b.body;++a<i;)for(var c=b.getElementsByTagName(h[a]),d=c.length,f=-1;++f<d;)c[f].className.indexOf("iepp_")<0&&(c[f].className+=" iepp_"+h[a]);n.appendChild(e),o.appendChild(q),q.className=e.className,q.id=e.id,q.innerHTML=e.innerHTML.replace(k,"<$1font")},f._beforePrint=function(){r.styleSheet.cssText=f.parseCSS(f.getCSS(b.styleSheets,"all")),f.writeHTML()},f.restoreHTML=function(){q.innerHTML="",o.removeChild(q),o.appendChild(e)},f._afterPrint=function(){f.restoreHTML(),r.styleSheet.cssText=""},d(b),d(n),f.disablePP||(p.insertBefore(r,p.firstChild),r.media="print",r.className="iepp-printshim",a.attachEvent("onbeforeprint",f._beforePrint),a.attachEvent("onafterprint",f._afterPrint))}(a,b),n._version=m,n._prefixes=w,n._domPrefixes=x,n.hasEvent=E,n.testProp=function(a){return f([a])},n.testAllProps=e,n.testStyles=D,p.className=p.className.replace(/\bno-js\b/,"")+(o?" js "+C.join(" "):""),n}(this,this.document),function(a,b,c){function d(a){return!a||"loaded"==a||"complete"==a}function e(){for(var a=1,b=-1;r.length-++b&&(!r[b].s||(a=r[b].r)););a&&h()}function f(a){var c,f=b.createElement("script");f.src=a.s,f.onreadystatechange=f.onload=function(){!c&&d(f.readyState)&&(c=1,e(),f.onload=f.onreadystatechange=null)},o(function(){c||(c=1,e())},m.errorTimeout),a.e?f.onload():p.parentNode.insertBefore(f,p)}function g(a){var c,d=b.createElement("link");if(d.href=a.s,d.rel="stylesheet",d.type="text/css",a.e||!x&&!t)d.onload=function(){c||(c=1,o(function(){e()},0))},a.e&&d.onload();else{var f=function(a){o(function(){if(!c)try{a.sheet.cssRules.length?(c=1,e()):f(a)}catch(b){1e3==b.code||"security"==b.message||"denied"==b.message?(c=1,o(function(){e()},0)):f(a)}},0)};f(d)}o(function(){c||(c=1,e())},m.errorTimeout),!a.e&&p.parentNode.insertBefore(d,p)}function h(){var a=r.shift();s=1,a?a.t?o(function(){"c"==a.t?g(a):f(a)},0):(a(),e()):s=0}function i(a,c,f,g,i,j){function k(){!n&&d(l.readyState)&&(q.r=n=1,!s&&e(),l.onload=l.onreadystatechange=null,o(function(){v.removeChild(l)},0))}var l=b.createElement(a),n=0,q={t:f,s:c,e:j};l.src=l.data=c,!u&&(l.style.display="none"),l.width=l.height="0","object"!=a&&(l.type=f),l.onload=l.onreadystatechange=k,"img"==a?l.onerror=k:"script"==a&&(l.onerror=function(){q.e=q.r=1,h()}),r.splice(g,0,q),v.insertBefore(l,u?null:p),o(function(){n||(v.removeChild(l),q.r=q.e=n=1,e())},m.errorTimeout)}function j(a,b,c){var d="c"==b?A:z;return s=0,b=b||"j",D(a)?i(d,a,b,this.i++,n,c):(r.splice(this.i++,0,a),1==r.length&&h()),this}function k(){var a=m;return a.loader={load:j,i:0},a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,w=a.opera&&"[object Opera]"==q.call(a.opera),x="webkitAppearance"in n.style,y=x&&"async"in b.createElement("script"),z=t?"object":w||y?"img":"script",A=x?"img":z,B=Array.isArray||function(a){return"[object Array]"==q.call(a)},C=function(a){return Object(a)===a},D=function(a){return"string"==typeof a},E=function(a){return"[object Function]"==q.call(a)},F=[],G={};m=function(a){function b(a){var b,c,d=a.split("!"),e=F.length,f=d.pop(),g=d.length,h={url:f,origUrl:f,prefixes:d};for(c=0;g>c;c++)b=G[d[c]],b&&(h=b(h));for(c=0;e>c;c++)h=F[c](h);return h}function d(a,d,e,f,g){var h=b(a),i=h.autoCallback;if(!h.bypass){if(d&&(d=E(d)?d:d[a]||d[f]||d[a.split("/").pop().split("?")[0]]),h.instead)return h.instead(a,d,e,f,g);e.load(h.url,h.forceCSS||!h.forceJS&&/css$/.test(h.url)?"c":c,h.noexec),(E(d)||E(i))&&e.load(function(){k(),d&&d(h.origUrl,g,f),i&&i(h.origUrl,g,f)})}}function e(a,b){function c(a){if(D(a))d(a,i,b,0,f);else if(C(a))for(e in a)a.hasOwnProperty(e)&&d(a[e],i,b,e,f)}var e,f=!!a.test,g=f?a.yep:a.nope,h=a.load||a.both,i=a.callback;c(g),c(h),a.complete&&b.load(a.complete)}var f,g,h=this.yepnope.loader;if(D(a))d(a,0,h,0);else if(B(a))for(f=0;f<a.length;f++)g=a[f],D(g)?d(g,0,h,0):B(g)?m(g):C(g)&&e(g,h);else C(a)&&e(a,h)},m.addPrefix=function(a,b){G[a]=b},m.addFilter=function(a){F.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=k()}(this,this.document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},function(a){"use strict";function b(a,b,c){return a>=b&&c>=a}function c(a,b){return Math.floor(a/b)}function d(a){var b=0;this.get=function(){return b>=a.length?N:Number(a[b])},this.offset=function(c){if(b+=c,0>b)throw new Error("Seeking past start of the buffer");if(b>a.length)throw new Error("Seeking past EOF")},this.match=function(c){if(c.length>b+a.length)return!1;var d;for(d=0;d<c.length;d+=1)if(Number(a[b+d])!==c[d])return!1;return!0}}function e(a){var b=0;this.emit=function(){var c,d=N;for(c=0;c<arguments.length;++c)d=Number(arguments[c]),a[b++]=d;return d}}function f(a){var c=0,d=function(){for(var c=[],d=0,e=a.length;d<a.length;){var f=a.charCodeAt(d);if(b(f,55296,57343))if(b(f,56320,57343))c.push(65533);else if(d===e-1)c.push(65533);else{var g=a.charCodeAt(d+1);if(b(g,56320,57343)){var h=1023&f,i=1023&g;d+=1,c.push(65536+(h<<10)+i)}else c.push(65533)}else c.push(f);d+=1}return c}();this.offset=function(a){if(c+=a,0>c)throw new Error("Seeking past start of the buffer");if(c>d.length)throw new Error("Seeking past EOF")},this.get=function(){return c>=d.length?O:d[c]}}function g(){var a="";this.string=function(){return a},this.emit=function(b){65535>=b?a+=String.fromCharCode(b):(b-=65536,a+=String.fromCharCode(55296+(b>>10&1023)),a+=String.fromCharCode(56320+(1023&b)))}}function h(a,b){if(a)throw new Error("EncodingError");return b||65533}function i(){throw new Error("EncodingError")}function j(a){if(a=String(a).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(R,a))return R[a];throw new Error("EncodingError: Unknown encoding: "+a)}function k(a,b){return(b||[])[a]||null}function l(a,b){var c=b.indexOf(a);return-1===c?null:c}function m(a){if(a>39419&&189e3>a||a>1237575)return null;var b,c=0,d=0,e=S.gb18030;for(b=0;b<e.length;++b){var f=e[b];if(!(f[0]<=a))break;c=f[0],d=f[1]}return d+a-c}function n(a){var b,c=0,d=0,e=S.gb18030;for(b=0;b<e.length;++b){var f=e[b];if(!(f[1]<=a))break;c=f[1],d=f[0]}return d+a-c}function o(a){var c=a.fatal,d=0,e=0,f=0,g=0;this.decode=function(a){var i=a.get();if(i===N)return 0!==e?h(c):O;if(a.offset(1),0===e){if(b(i,0,127))return i;if(b(i,194,223))e=1,g=128,d=i-192;else if(b(i,224,239))e=2,g=2048,d=i-224;else{if(!b(i,240,244))return h(c);e=3,g=65536,d=i-240}return d*=Math.pow(64,e),null}if(!b(i,128,191))return d=0,e=0,f=0,g=0,a.offset(-1),h(c);if(f+=1,d+=(i-128)*Math.pow(64,e-f),f!==e)return null;var j=d,k=g;return d=0,e=0,f=0,g=0,b(j,k,1114111)&&!b(j,55296,57343)?j:h(c)}}function p(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,55296,57343))return i(e);if(b(e,0,127))return a.emit(e);var f,g;b(e,128,2047)?(f=1,g=192):b(e,2048,65535)?(f=2,g=224):b(e,65536,1114111)&&(f=3,g=240);for(var h=a.emit(c(e,Math.pow(64,f))+g);f>0;){var j=c(e,Math.pow(64,f-1));h=a.emit(128+j%64),f-=1}return h}}function q(a,c){var d=c.fatal;this.decode=function(c){var e=c.get();if(e===N)return O;if(c.offset(1),b(e,0,127))return e;var f=a[e-128];return null===f?h(d):f}}function r(a,c){c.fatal;this.encode=function(c,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return c.emit(e);var f=l(e,a);return null===f&&i(e),c.emit(f+128)}}function s(a,c){var d=c.fatal,e=0,f=0,g=0;this.decode=function(c){var i=c.get();if(i===N&&0===e&&0===f&&0===g)return O;i!==N||0===e&&0===f&&0===g||(e=0,f=0,g=0,h(d)),c.offset(1);var j;if(0!==g)return j=null,b(i,48,57)&&(j=m(10*(126*(10*(e-129)+(f-48))+(g-129))+i-48)),e=0,f=0,g=0,null===j?(c.offset(-3),h(d)):j;if(0!==f)return b(i,129,254)?(g=i,null):(c.offset(-2),e=0,f=0,h(d));if(0!==e){if(b(i,48,57)&&a)return f=i,null;var l=e,n=null;e=0;var o=127>i?64:65;return(b(i,64,126)||b(i,128,254))&&(n=190*(l-129)+(i-o)),j=null===n?null:k(n,S.gbk),null===n&&c.offset(-1),null===j?h(d):j}return b(i,0,127)?i:128===i?8364:b(i,129,254)?(e=i,null):h(d)}}function t(a,d){d.fatal;this.encode=function(d,e){var f=e.get();if(f===O)return N;if(e.offset(1),b(f,0,127))return d.emit(f);var g=l(f,S.gbk);if(null!==g){var h=c(g,190)+129,j=g%190,k=63>j?64:65;return d.emit(h,j+k)}if(null===g&&!a)return i(f);g=n(f);var m=c(c(c(g,10),126),10);g-=10*m*126*10;var o=c(c(g,10),126);g-=10*o*126;var p=c(g,10),q=g-10*p;return d.emit(m+129,o+48,p+129,q+48)}}function u(a){var c=a.fatal,d=!1,e=0;this.decode=function(a){var f=a.get();if(f===N&&0===e)return O;if(f===N&&0!==e)return e=0,h(c);if(a.offset(1),126===e)return e=0,123===f?(d=!0,null):125===f?(d=!1,null):126===f?126:10===f?null:(a.offset(-1),h(c));if(0!==e){var g=e;e=0;var i=null;return b(f,33,126)&&(i=k(190*(g-1)+(f+63),S.gbk)),10===f&&(d=!1),null===i?h(c):i}return 126===f?(e=126,null):d?b(f,32,127)?(e=f,null):(10===f&&(d=!1),h(c)):b(f,0,127)?f:h(c)}}function v(a){var d=(a.fatal,!1);this.encode=function(a,e){var f=e.get();if(f===O)return N;if(e.offset(1),b(f,0,127)&&d)return e.offset(-1),d=!1,a.emit(126,125);if(126===f)return a.emit(126,126);if(b(f,0,127))return a.emit(f);if(!d)return e.offset(-1),d=!0,a.emit(126,123);var g=l(f,S.gbk);if(null===g)return i(f);var h=c(g,190)+1,j=g%190-63;return b(h,33,126)&&b(j,33,126)?a.emit(h,j):i(f)}}function w(a){var c=a.fatal,d=0,e=null;this.decode=function(a){if(null!==e){var f=e;return e=null,f}var g=a.get();if(g===N&&0===d)return O;if(g===N&&0!==d)return d=0,h(c);if(a.offset(1),0!==d){var i=d,j=null;d=0;var l=127>g?64:98;if((b(g,64,126)||b(g,161,254))&&(j=157*(i-129)+(g-l)),1133===j)return e=772,202;if(1135===j)return e=780,202;if(1164===j)return e=772,234;if(1166===j)return e=780,234;var m=null===j?null:k(j,S.big5);return null===j&&a.offset(-1),null===m?h(c):m}return b(g,0,127)?g:b(g,129,254)?(d=g,null):h(c)}}function x(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return a.emit(e);var f=l(e,S.big5);if(null===f)return i(e);var g=c(f,157)+129,h=f%157,j=63>h?64:98;return a.emit(g,h+j)}}function y(a){var c=a.fatal,d=0,e=0;this.decode=function(a){var f=a.get();if(f===N)return 0===d&&0===e?O:(d=0,e=0,h(c));a.offset(1);var g,i;return 0!==e?(g=e,e=0,i=null,b(g,161,254)&&b(f,161,254)&&(i=k(94*(g-161)+f-161,S.jis0212)),b(f,161,254)||a.offset(-1),null===i?h(c):i):142===d&&b(f,161,223)?(d=0,65377+f-161):143===d&&b(f,161,254)?(d=0,e=f,null):0!==d?(g=d,d=0,i=null,b(g,161,254)&&b(f,161,254)&&(i=k(94*(g-161)+f-161,S.jis0208)),b(f,161,254)||a.offset(-1),null===i?h(c):i):b(f,0,127)?f:142===f||143===f||b(f,161,254)?(d=f,null):h(c)}}function z(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return a.emit(e);if(165===e)return a.emit(92);if(8254===e)return a.emit(126);if(b(e,65377,65439))return a.emit(142,e-65377+161);var f=l(e,S.jis0208);if(null===f)return i(e);var g=c(f,94)+161,h=f%94+161;return a.emit(g,h)}}function A(a){var c=a.fatal,d={ASCII:0,escape_start:1,escape_middle:2,escape_final:3,lead:4,trail:5,Katakana:6},e=d.ASCII,f=!1,g=0;this.decode=function(a){var i=a.get();switch(i!==N&&a.offset(1),e){default:case d.ASCII:return 27===i?(e=d.escape_start,null):b(i,0,127)?i:i===N?O:h(c);case d.escape_start:return 36===i||40===i?(g=i,e=d.escape_middle,null):(i!==N&&a.offset(-1),e=d.ASCII,h(c));case d.escape_middle:var j=g;return g=0,36!==j||64!==i&&66!==i?36===j&&40===i?(e=d.escape_final,null):40!==j||66!==i&&74!==i?40===j&&73===i?(e=d.Katakana,null):(a.offset(i===N?-1:-2),e=d.ASCII,h(c)):(e=d.ASCII,null):(f=!1,e=d.lead,null);case d.escape_final:return 68===i?(f=!0,e=d.lead,null):(a.offset(i===N?-2:-3),e=d.ASCII,h(c));case d.lead:return 10===i?(e=d.ASCII,h(c,10)):27===i?(e=d.escape_start,null):i===N?O:(g=i,e=d.trail,null);case d.trail:if(e=d.lead,i===N)return h(c);var l=null,m=94*(g-33)+i-33;return b(g,33,126)&&b(i,33,126)&&(l=f===!1?k(m,S.jis0208):k(m,S.jis0212)),null===l?h(c):l;case d.Katakana:return 27===i?(e=d.escape_start,null):b(i,33,95)?65377+i-33:i===N?O:h(c)}}}function B(a){var d=(a.fatal,{ASCII:0,lead:1,Katakana:2}),e=d.ASCII;this.encode=function(a,f){var g=f.get();if(g===O)return N;if(f.offset(1),(b(g,0,127)||165===g||8254===g)&&e!==d.ASCII)return f.offset(-1),e=d.ASCII,a.emit(27,40,66);if(b(g,0,127))return a.emit(g);if(165===g)return a.emit(92);if(8254===g)return a.emit(126);if(b(g,65377,65439)&&e!==d.Katakana)return f.offset(-1),e=d.Katakana,a.emit(27,40,73);if(b(g,65377,65439))return a.emit(g-65377-33);if(e!==d.lead)return f.offset(-1),e=d.lead,a.emit(27,36,66);var h=l(g,S.jis0208);if(null===h)return i(g);var j=c(h,94)+33,k=h%94+33;return a.emit(j,k)}}function C(a){var c=a.fatal,d=0;this.decode=function(a){var e=a.get();if(e===N&&0===d)return O;if(e===N&&0!==d)return d=0,h(c);if(a.offset(1),0!==d){var f=d;if(d=0,b(e,64,126)||b(e,128,252)){var g=127>e?64:65,i=160>f?129:193,j=k(188*(f-i)+e-g,S.jis0208);return null===j?h(c):j}return a.offset(-1),h(c)}return b(e,0,128)?e:b(e,161,223)?65377+e-161:b(e,129,159)||b(e,224,252)?(d=e,null):h(c)}}function D(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,128))return a.emit(e);if(165===e)return a.emit(92);if(8254===e)return a.emit(126);if(b(e,65377,65439))return a.emit(e-65377+161);var f=l(e,S.jis0208);if(null===f)return i(e);var g=c(f,188),h=31>g?129:193,j=f%188,k=63>j?64:65;return a.emit(g+h,j+k)}}function E(a){var c=a.fatal,d=0;this.decode=function(a){var e=a.get();if(e===N&&0===d)return O;if(e===N&&0!==d)return d=0,h(c);if(a.offset(1),0!==d){var f=d,g=null;if(d=0,b(f,129,198)){var i=178*(f-129);b(e,65,90)?g=i+e-65:b(e,97,122)?g=i+26+e-97:b(e,129,254)&&(g=i+26+26+e-129)}b(f,199,253)&&b(e,161,254)&&(g=12460+94*(f-199)+(e-161));var j=null===g?null:k(g,S["euc-kr"]);return null===g&&a.offset(-1),null===j?h(c):j}return b(e,0,127)?e:b(e,129,253)?(d=e,null):h(c)}}function F(a){a.fatal;this.encode=function(a,d){var e=d.get();if(e===O)return N;if(d.offset(1),b(e,0,127))return a.emit(e);var f=l(e,S["euc-kr"]);if(null===f)return i(e);var g,h;if(12460>f){g=c(f,178)+129,h=f%178;var j=26>h?65:52>h?71:77;return a.emit(g,h+j)}return f-=12460,g=c(f,94)+199,h=f%94+161,a.emit(g,h)}}function G(a){var c=a.fatal,d={ASCII:0,escape_start:1,escape_middle:2,escape_end:3,lead:4,trail:5},e=d.ASCII,f=0;this.decode=function(a){var g=a.get();switch(g!==N&&a.offset(1),e){default:case d.ASCII:return 14===g?(e=d.lead,null):15===g?null:27===g?(e=d.escape_start,null):b(g,0,127)?g:g===N?O:h(c);case d.escape_start:return 36===g?(e=d.escape_middle,null):(g!==N&&a.offset(-1),e=d.ASCII,h(c));case d.escape_middle:return 41===g?(e=d.escape_end,null):(a.offset(g===N?-1:-2),e=d.ASCII,h(c));case d.escape_end:return 67===g?(e=d.ASCII,null):(a.offset(g===N?-2:-3),e=d.ASCII,h(c));case d.lead:return 10===g?(e=d.ASCII,h(c,10)):14===g?null:15===g?(e=d.ASCII,null):g===N?O:(f=g,e=d.trail,null);case d.trail:if(e=d.lead,g===N)return h(c);var i=null;return b(f,33,70)&&b(g,33,126)?i=k(178*(f-1)+26+26+g-1,S["euc-kr"]):b(f,71,126)&&b(g,33,126)&&(i=k(12460+94*(f-71)+(g-33),S["euc-kr"])),null!==i?i:h(c)}}}function H(a){var d=(a.fatal,{ASCII:0,lead:1}),e=!1,f=d.ASCII;this.encode=function(a,g){var h=g.get();if(h===O)return N;if(e||(e=!0,a.emit(27,36,41,67)),g.offset(1),b(h,0,127)&&f!==d.ASCII)return g.offset(-1),f=d.ASCII,a.emit(15);if(b(h,0,127))return a.emit(h);if(f!==d.lead)return g.offset(-1),f=d.lead,a.emit(14);var j=l(h,S["euc-kr"]);if(null===j)return i(h);var k,m;return 12460>j?(k=c(j,178)+1,m=j%178-26-26+1,b(k,33,70)&&b(m,33,126)?a.emit(k,m):i(h)):(j-=12460,k=c(j,94)+71,m=j%94+33,b(k,71,126)&&b(m,33,126)?a.emit(k,m):i(h))}}function I(a,c){var d=c.fatal,e=null,f=null;this.decode=function(c){var g=c.get();if(g===N&&null===e&&null===f)return O;if(g===N&&(null!==e||null!==f))return h(d);if(c.offset(1),null===e)return e=g,null;var i;if(i=a?(e<<8)+g:(g<<8)+e,e=null,null!==f){var j=f;return f=null,b(i,56320,57343)?65536+1024*(j-55296)+(i-56320):(c.offset(-2),h(d))}return b(i,55296,56319)?(f=i,null):b(i,56320,57343)?h(d):i}}function J(a,d){d.fatal;this.encode=function(d,e){function f(b){var c=b>>8,e=255&b;return a?d.emit(c,e):d.emit(e,c)}var g=e.get();if(g===O)return N;if(e.offset(1),b(g,55296,57343)&&i(g),65535>=g)return f(g);var h=c(g-65536,1024)+55296,j=(g-65536)%1024+56320;return f(h),f(j)}}function K(a,b){return b.match([255,254])?(b.offset(2),"utf-16"):b.match([254,255])?(b.offset(2),"utf-16be"):b.match([239,187,191])?(b.offset(3),"utf-8"):a}function L(b,c){return this&&this!==a?(b=b?String(b):T,c=Object(c),this._encoding=j(b),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(c.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new L(b,c)}function M(b,c){return this&&this!==a?(b=b?String(b):T,c=Object(c),this._encoding=j(b),this._streaming=!1,this._decoder=null,this._options={fatal:Boolean(c.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new M(b,c)}var N=-1,O=-1,P=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso_8859-2","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso_8859-3","iso-ir-109","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso_8859-4","iso-ir-110","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:["arabic","csisolatinarabic","ecma-114","iso-8859-6","iso_8859-6","iso-ir-127"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso_8859-7","iso-ir-126"],name:"iso-8859-7"},{labels:["csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-i","iso-ir-138","iso_8859-8","visual"],name:"iso-8859-8"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ascii","ansi_x3.4-1968","csisolatin1","iso-8859-1","iso8859-1","iso_8859-1","l1","latin1","us-ascii","windows-1252"],name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:["csisolatin5","iso-8859-9","iso-ir-148","l5","latin5","windows-1254"],name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gbk","gb_2312","gb_2312-80","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}],Q={},R={};P.forEach(function(a){a.encodings.forEach(function(a){Q[a.name]=a,a.labels.forEach(function(b){R[b]=a})})});var S=a["encoding-indexes"]||{};Q["utf-8"].getEncoder=function(a){return new p(a)},Q["utf-8"].getDecoder=function(a){return new o(a)},function(){["ibm864","ibm866","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-10","iso-8859-13","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","macintosh","windows-874","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","x-mac-cyrillic"].forEach(function(a){var b=Q[a],c=S[a];b.getDecoder=function(a){return new q(c,a)},b.getEncoder=function(a){return new r(c,a)}})}(),Q.gbk.getEncoder=function(a){return new t(!1,a)},Q.gbk.getDecoder=function(a){return new s(!1,a)},Q.gb18030.getEncoder=function(a){return new t(!0,a)},Q.gb18030.getDecoder=function(a){return new s(!0,a)},Q["hz-gb-2312"].getEncoder=function(a){return new v(a)},Q["hz-gb-2312"].getDecoder=function(a){return new u(a)},Q.big5.getEncoder=function(a){return new x(a)},Q.big5.getDecoder=function(a){return new w(a)},Q["euc-jp"].getEncoder=function(a){return new z(a)},Q["euc-jp"].getDecoder=function(a){return new y(a)},Q["iso-2022-jp"].getEncoder=function(a){return new B(a)},Q["iso-2022-jp"].getDecoder=function(a){return new A(a)},Q.shift_jis.getEncoder=function(a){return new D(a)},Q.shift_jis.getDecoder=function(a){return new C(a)},Q["euc-kr"].getEncoder=function(a){return new F(a)},Q["euc-kr"].getDecoder=function(a){return new E(a)},Q["iso-2022-kr"].getEncoder=function(a){return new H(a)},Q["iso-2022-kr"].getDecoder=function(a){return new G(a)},Q["utf-16"].getEncoder=function(a){return new J(!1,a)},Q["utf-16"].getDecoder=function(a){return new I(!1,a)},Q["utf-16be"].getEncoder=function(a){return new J(!0,a)},Q["utf-16be"].getDecoder=function(a){return new I(!0,a)};var T="utf-8";L.prototype={encode:function(a,b){a=a?String(a):"",b=Object(b),this._streaming||(this._encoder=this._encoding.getEncoder(this._options)),this._streaming=Boolean(b.stream);for(var c=[],d=new e(c),g=new f(a);g.get()!==O;)this._encoder.encode(d,g);if(!this._streaming){var h;do h=this._encoder.encode(d,g);while(h!==N);this._encoder=null}return new Uint8Array(c)}},M.prototype={decode:function(a,b){if(a&&!("buffer"in a&&"byteOffset"in a&&"byteLength"in a))throw new TypeError("Expected ArrayBufferView");a||(a=new Uint8Array(0)),b=Object(b),this._streaming||(this._decoder=this._encoding.getDecoder(this._options)),this._streaming=Boolean(b.stream);var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),e=new d(c),f=K(this._encoding.name,e);if(j(f)!==this._encoding)throw new Error("BOM mismatch");for(var h,i=new g;e.get()!==N;)h=this._decoder.decode(e),null!==h&&h!==O&&i.emit(h);if(!this._streaming){do h=this._decoder.decode(e),null!==h&&h!==O&&i.emit(h);while(h!==O);this._decoder=null}return i.string()}},a.TextEncoder=a.TextEncoder||L,a.TextDecoder=a.TextDecoder||M}(this),function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),"undefined"!=typeof HumanKitAndroid&&(window.mobilebundleid=HumanKitAndroid.getBundleID(),HumanKitAndroid.debugMessage("GOT BundleID"+window.mobilebundleid)),"undefined"!=typeof window.mobilebundleid?(ga("create","UA-1141985-24","auto"),ga("set","forceSSL",!0),ga("send","pageview",{dimension5:window.mobilebundleid})):(ga("create","UA-1141985-22","auto"),ga("require","displayfeatures"),ga("send","pageview")),window.ENVIRONMENT={assetDomain:"assets-human.biodigital.com",files:{min:!0,allowParams:!1,humanStyles:[],humanScripts:[]}};var glMatrix={};glMatrix.EPSILON=1e-6,glMatrix.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,glMatrix.RANDOM=Math.random,glMatrix.setMatrixArrayType=function(a){glMatrix.ARRAY_TYPE=a};var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree},glMatrix.equals=function(a,b){return Math.abs(a-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};var mat4={};mat4.create=function(){var a=new glMatrix.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.clone=function(a){var b=new glMatrix.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},mat4.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},mat4.fromValues=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=new glMatrix.ARRAY_TYPE(16);return q[0]=a,q[1]=b,q[2]=c,q[3]=d,q[4]=e,q[5]=f,q[6]=g,q[7]=h,q[8]=i,q[9]=j,q[10]=k,q[11]=l,q[12]=m,q[13]=n,q[14]=o,q[15]=p,q},mat4.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a[9]=k,a[10]=l,a[11]=m,a[12]=n,a[13]=o,a[14]=p,a[15]=q,a},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},mat4.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},mat4.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},mat4.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},mat4.mul=mat4.multiply,mat4.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},mat4.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},mat4.rotate=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=d[0],D=d[1],E=d[2],F=Math.sqrt(C*C+D*D+E*E);return Math.abs(F)<glMatrix.EPSILON?null:(F=1/F,C*=F,D*=F,E*=F,e=Math.sin(c),f=Math.cos(c),g=1-f,h=b[0],i=b[1],j=b[2],k=b[3],l=b[4],m=b[5],n=b[6],o=b[7],p=b[8],q=b[9],r=b[10],s=b[11],t=C*C*g+f,u=D*C*g+E*e,v=E*C*g-D*e,w=C*D*g-E*e,x=D*D*g+f,y=E*D*g+C*e,z=C*E*g+D*e,A=D*E*g-C*e,B=E*E*g+f,a[0]=h*t+l*u+p*v,a[1]=i*t+m*u+q*v,a[2]=j*t+n*u+r*v,a[3]=k*t+o*u+s*v,a[4]=h*w+l*x+p*y,a[5]=i*w+m*x+q*y,a[6]=j*w+n*x+r*y,a[7]=k*w+o*x+s*y,a[8]=h*z+l*A+p*B,a[9]=i*z+m*A+q*B,a[10]=j*z+n*A+r*B,a[11]=k*z+o*A+s*B,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},mat4.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},mat4.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},mat4.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},mat4.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},mat4.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromRotation=function(a,b,c){var d,e,f,g=c[0],h=c[1],i=c[2],j=Math.sqrt(g*g+h*h+i*i);return Math.abs(j)<glMatrix.EPSILON?null:(j=1/j,g*=j,h*=j,i*=j,d=Math.sin(b),e=Math.cos(b),f=1-e,a[0]=g*g*f+e,a[1]=h*g*f+i*d,a[2]=i*g*f-h*d,a[3]=0,a[4]=g*h*f-i*d,a[5]=h*h*f+e,a[6]=i*h*f+g*d,a[7]=0,a[8]=g*i*f+h*d,a[9]=h*i*f-g*d,a[10]=i*i*f+e,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},mat4.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,
a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},mat4.getTranslation=function(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a},mat4.getScaling=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[4],g=b[5],h=b[6],i=b[8],j=b[9],k=b[10];return a[0]=Math.sqrt(c*c+d*d+e*e),a[1]=Math.sqrt(f*f+g*g+h*h),a[2]=Math.sqrt(i*i+j*j+k*k),a},mat4.getRotation=function(a,b){var c=b[0]+b[5]+b[10],d=0;return c>0?(d=2*Math.sqrt(c+1),a[3]=.25*d,a[0]=(b[6]-b[9])/d,a[1]=(b[8]-b[2])/d,a[2]=(b[1]-b[4])/d):b[0]>b[5]&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/d,a[0]=.25*d,a[1]=(b[1]+b[4])/d,a[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/d,a[0]=(b[1]+b[4])/d,a[1]=.25*d,a[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/d,a[0]=(b[8]+b[2])/d,a[1]=(b[6]+b[9])/d,a[2]=.25*d),a},mat4.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},mat4.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},mat4.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},mat4.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},mat4.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},mat4.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},mat4.lookAt=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=b[0],p=b[1],q=b[2],r=d[0],s=d[1],t=d[2],u=c[0],v=c[1],w=c[2];return Math.abs(o-u)<glMatrix.EPSILON&&Math.abs(p-v)<glMatrix.EPSILON&&Math.abs(q-w)<glMatrix.EPSILON?mat4.identity(a):(k=o-u,l=p-v,m=q-w,n=1/Math.sqrt(k*k+l*l+m*m),k*=n,l*=n,m*=n,e=s*m-t*l,f=t*k-r*m,g=r*l-s*k,n=Math.sqrt(e*e+f*f+g*g),n?(n=1/n,e*=n,f*=n,g*=n):(e=0,f=0,g=0),h=l*g-m*f,i=m*e-k*g,j=k*f-l*e,n=Math.sqrt(h*h+i*i+j*j),n?(n=1/n,h*=n,i*=n,j*=n):(h=0,i=0,j=0),a[0]=e,a[1]=h,a[2]=k,a[3]=0,a[4]=f,a[5]=i,a[6]=l,a[7]=0,a[8]=g,a[9]=j,a[10]=m,a[11]=0,a[12]=-(e*o+f*p+g*q),a[13]=-(h*o+i*p+j*q),a[14]=-(k*o+l*p+m*q),a[15]=1,a)},mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},mat4.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a},mat4.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-c[14],a[15]=b[15]-c[15],a},mat4.sub=mat4.subtract,mat4.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12]*c,a[13]=b[13]*c,a[14]=b[14]*c,a[15]=b[15]*c,a},mat4.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a[9]=b[9]+c[9]*d,a[10]=b[10]+c[10]*d,a[11]=b[11]+c[11]*d,a[12]=b[12]+c[12]*d,a[13]=b[13]+c[13]*d,a[14]=b[14]+c[14]*d,a[15]=b[15]+c[15]*d,a},mat4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]},mat4.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=b[5],y=b[6],z=b[7],A=b[8],B=b[9],C=b[10],D=b[11],E=b[12],F=b[13],G=b[14],H=b[15];return Math.abs(c-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(s))&&Math.abs(d-t)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(t))&&Math.abs(e-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(f-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(g-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(h-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(i-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(j-z)<=glMatrix.EPSILON*Math.max(1,Math.abs(j),Math.abs(z))&&Math.abs(k-A)<=glMatrix.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(l-B)<=glMatrix.EPSILON*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(m-C)<=glMatrix.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(n-D)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(o-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(p-F)<=glMatrix.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(q-G)<=glMatrix.EPSILON*Math.max(1,Math.abs(q),Math.abs(G))&&Math.abs(r-H)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(H))};var mat3={};mat3.create=function(){var a=new glMatrix.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},mat3.clone=function(a){var b=new glMatrix.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},mat3.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},mat3.fromValues=function(a,b,c,d,e,f,g,h,i){var j=new glMatrix.ARRAY_TYPE(9);return j[0]=a,j[1]=b,j[2]=c,j[3]=d,j[4]=e,j[5]=f,j[6]=g,j[7]=h,j[8]=i,j},mat3.set=function(a,b,c,d,e,f,g,h,i,j){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a},mat3.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},mat3.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},mat3.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},mat3.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},mat3.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},mat3.mul=mat3.multiply,mat3.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},mat3.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},mat3.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},mat3.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},mat3.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},mat3.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},mat3.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},mat3.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a},mat3.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a},mat3.sub=mat3.subtract,mat3.multiplyScalar=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a},mat3.multiplyScalarAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a},mat3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},mat3.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8];return Math.abs(c-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(d-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))&&Math.abs(e-n)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(f-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(o))&&Math.abs(g-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(g),Math.abs(p))&&Math.abs(h-q)<=glMatrix.EPSILON*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(i-r)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(j-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(j),Math.abs(s))&&Math.abs(k-t)<=glMatrix.EPSILON*Math.max(1,Math.abs(k),Math.abs(t))};var vec2={};vec2.create=function(){var a=new glMatrix.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},vec2.clone=function(a){var b=new glMatrix.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},vec2.fromValues=function(a,b){var c=new glMatrix.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},vec2.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},vec2.set=function(a,b,c){return a[0]=b,a[1]=c,a},vec2.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},vec2.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},vec2.sub=vec2.subtract,vec2.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},vec2.mul=vec2.multiply,vec2.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},vec2.div=vec2.divide,vec2.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a},vec2.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a},vec2.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},vec2.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},vec2.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a},vec2.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},vec2.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},vec2.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},vec2.dist=vec2.distance,vec2.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},vec2.len=vec2.length,vec2.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},vec2.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},vec2.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},vec2.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},vec2.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},vec2.random=function(a,b){b=b||1;var c=2*glMatrix.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},vec2.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},vec2.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},vec2.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},vec2.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},vec2.forEach=function(){var a=vec2.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},vec2.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]},vec2.equals=function(a,b){var c=a[0],d=a[1],e=b[0],f=b[1];return Math.abs(c-e)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(d-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(f))};var vec3={};vec3.create=function(){var a=new glMatrix.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},vec3.clone=function(a){var b=new glMatrix.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},vec3.fromValues=function(a,b,c){var d=new glMatrix.ARRAY_TYPE(3);return d[0]=a,d[1]=b,d[2]=c,d},vec3.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},vec3.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},vec3.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},vec3.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},vec3.sub=vec3.subtract,vec3.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},vec3.mul=vec3.multiply,vec3.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},vec3.div=vec3.divide,vec3.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a},vec3.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a},vec3.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},vec3.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},vec3.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a},vec3.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},vec3.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},vec3.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},vec3.dist=vec3.distance,vec3.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},vec3.sqrDist=vec3.squaredDistance,vec3.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},vec3.len=vec3.length,vec3.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},vec3.sqrLen=vec3.squaredLength,vec3.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},vec3.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},vec3.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},vec3.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},vec3.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},vec3.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},vec3.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},vec3.random=function(a,b){b=b||1;var c=2*glMatrix.RANDOM()*Math.PI,d=2*glMatrix.RANDOM()-1,e=Math.sqrt(1-d*d)*b;return a[0]=Math.cos(c)*e,a[1]=Math.sin(c)*e,a[2]=d*b,a},vec3.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},vec3.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},vec3.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},vec3.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},vec3.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},vec3.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},vec3.forEach=function(){var a=vec3.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),vec3.angle=function(a,b){var c=vec3.fromValues(a[0],a[1],a[2]),d=vec3.fromValues(b[0],b[1],b[2]);vec3.normalize(c,c),vec3.normalize(d,d);var e=vec3.dot(c,d);return e>1?0:-1>e?Math.PI:Math.acos(e)},vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},vec3.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},vec3.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];return Math.abs(c-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(e-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))};var vec4={};vec4.create=function(){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},vec4.clone=function(a){var b=new glMatrix.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},vec4.fromValues=function(a,b,c,d){var e=new glMatrix.ARRAY_TYPE(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e},vec4.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},vec4.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},vec4.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},vec4.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},vec4.sub=vec4.subtract,vec4.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},vec4.mul=vec4.multiply,vec4.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},vec4.div=vec4.divide,vec4.ceil=function(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a[3]=Math.ceil(b[3]),a},vec4.floor=function(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a[3]=Math.floor(b[3]),a},vec4.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},vec4.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},vec4.round=function(a,b){return a[0]=Math.round(b[0]),a[1]=Math.round(b[1]),a[2]=Math.round(b[2]),a[3]=Math.round(b[3]),a},vec4.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},vec4.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},vec4.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},vec4.dist=vec4.distance,vec4.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},vec4.sqrDist=vec4.squaredDistance,vec4.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},vec4.len=vec4.length,vec4.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},vec4.sqrLen=vec4.squaredLength,vec4.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},vec4.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},vec4.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},vec4.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},vec4.random=function(a,b){return b=b||1,a[0]=glMatrix.RANDOM(),a[1]=glMatrix.RANDOM(),a[2]=glMatrix.RANDOM(),a[3]=glMatrix.RANDOM(),vec4.normalize(a,a),vec4.scale(a,a,b),a},vec4.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},vec4.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},vec4.forEach=function(){var a=vec4.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},vec4.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},vec4.equals=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],i=b[2],j=b[3];return Math.abs(c-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(d-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-i)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(j))};var quat={};quat.create=function(){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},quat.rotationTo=function(){var a=vec3.create(),b=vec3.fromValues(1,0,0),c=vec3.fromValues(0,1,0);return function(d,e,f){var g=vec3.dot(e,f);return-.999999>g?(vec3.cross(a,b,e),vec3.length(a)<1e-6&&vec3.cross(a,c,e),vec3.normalize(a,a),quat.setAxisAngle(d,a,Math.PI),d):g>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(vec3.cross(a,e,f),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+g,quat.normalize(d,d))}}(),quat.setAxes=function(){var a=mat3.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],quat.normalize(b,quat.fromMat3(b,a))}}(),quat.clone=vec4.clone,quat.fromValues=vec4.fromValues,quat.copy=vec4.copy,quat.set=vec4.set,quat.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},quat.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},quat.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);return 0!=d?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0),c},quat.add=vec4.add,quat.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},quat.mul=quat.multiply,quat.scale=vec4.scale,quat.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},quat.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},quat.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},quat.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},quat.dot=vec4.dot,quat.lerp=vec4.lerp,quat.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},quat.sqlerp=function(){var a=quat.create(),b=quat.create();return function(c,d,e,f,g,h){return quat.slerp(a,d,g,h),quat.slerp(b,e,f,h),quat.slerp(c,a,b,2*h*(1-h)),c}}(),quat.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},quat.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},quat.length=vec4.length,quat.len=quat.length,quat.squaredLength=vec4.squaredLength,quat.sqrLen=quat.squaredLength,quat.normalize=vec4.normalize,quat.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},quat.exactEquals=vec4.exactEquals,quat.equals=vec4.equals,function(){"use strict";window.SceneJS_Map=function(a,b){this.items=a||[];var c=b||0,d=c+1;this.addItem=function(){var a;if(2==arguments.length){var b=arguments[0];if(a=arguments[1],this.items[b])throw SceneJS_error.fatalError(SceneJS.errors.ID_CLASH,"ID clash: '"+b+"'");return this.items[b]=a,b}for(;;){a=arguments[0];var c=d++;if(!this.items[c])return this.items[c]=a,c}},this.removeItem=function(a){delete this.items[a]}}}(),function(){"use strict";var a=window.SceneJS=new function(){function b(a,c){var d,e="";for(d=0;c>d;d++)e+=" ";for(e+="-- ",console.log(e+a.type+" (id: "+a.id+", coreId: "+a.coreId+")"),d=0;d<a.nodes.length;d++)b(a.nodes[d],c+1)}this.VERSION="3.2",this.ENABLE_EXTENSIONS=["WEBGL_depth_texture","OES_texture_float","OES_texture_float_linear","OES_element_index_uint","OES_standard_derivatives","EXT_shader_texture_lod"],this._baseStateId=0,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={},this._engines={},this._engineIds=new SceneJS_Map,this.timer=window.performance||window.Date,this.WEBGL_INFO=function(){var a={WEBGL:!1,SOFTWARE_RENDERER:!1},b=document.createElement("canvas");if(!b)return a;var c=b.getContext("webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0})||b.getContext("experimental-webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0});return c||(c=b.getContext("webgl",{antialias:!0})||b.getContext("experimental-webgl",{antialias:!0}),c&&(a.SOFTWARE_RENDERER=!0)),a.WEBGL=!!c,a.WEBGL?(a.ANTIALIAS=c.getContextAttributes().antialias,a.FS_MAX_FLOAT_PRECISION=c.getShaderPrecisionFormat?c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT).precision>0?"highp":c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",a.DEPTH_BITS=c.getParameter(c.DEPTH_BITS),a.STENCIL_BITS=c.getParameter(c.STENCIL_BITS),a.MAX_TEXTURE_SIZE=c.getParameter(c.MAX_TEXTURE_SIZE),a.MAX_CUBE_MAP_SIZE=c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE),a.MAX_RENDERBUFFER_SIZE=c.getParameter(c.MAX_RENDERBUFFER_SIZE),a.MAX_TEXTURE_UNITS=c.getParameter(c.MAX_COMBINED_TEXTURE_IMAGE_UNITS),a.MAX_VERTEX_ATTRIBS=c.getParameter(c.MAX_VERTEX_ATTRIBS),a.MAX_VERTEX_UNIFORM_VECTORS=c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS),a.MAX_FRAGMENT_UNIFORM_VECTORS=c.getParameter(c.MAX_FRAGMENT_UNIFORM_VECTORS),
a.MAX_VARYING_VECTORS=c.getParameter(c.MAX_VARYING_VECTORS),a.SAMPLE_BUFFERS=!!c.getParameter(c.SAMPLE_BUFFERS),a.SAMPLES=c.getParameter(c.SAMPLES),a.MAX_POINT_SIZE=c.getParameter(c.ALIASED_POINT_SIZE_RANGE)[1],a.MAX_VIEWPORT_DIMS=c.getParameter(c.MAX_VIEWPORT_DIMS),a.SUPPORTED_EXTENSIONS={},c.getSupportedExtensions().forEach(function(b){a.SUPPORTED_EXTENSIONS[b]=!0}),a.depthTexturesSupported=a.SUPPORTED_EXTENSIONS.WEBGL_depth_texture||!1,a.floatTexturesSupported=a.SUPPORTED_EXTENSIONS.OES_texture_float||!1,a.linearFloatTexturesSupported=a.SUPPORTED_EXTENSIONS.OES_texture_float_linear||!1,a.drawBuffersSupported=a.SUPPORTED_EXTENSIONS.WEBGL_draw_buffers||!1,a.standardDerivativesSupported=a.SUPPORTED_EXTENSIONS.OES_standard_derivatives||!1,a.textureLODSupported=a.SUPPORTED_EXTENSIONS.EXT_shader_texture_lod||!1,a):a}(),this.DISPLAY_FLAGS={FOG_LINEAR:1,FOG_EXP:2,FOG_EXP2:3},this.TEXTURE_FLAGS={baseColor:1,specular:2,emit:4,alpha:8,normals:16,shine:32,metallic:64,roughness:128,occlusion:256,add:512,multiply:1024,over:2048,transparency:4096,conditionalAlpha:8192},this.CUBEMAP_FLAGS={reflect:1,light:2},this.PROPERTY_FLAGS={PICKING:1,ENABLED:2,REFLECTIVE:4,SOLID:8,SKYBOX:16,XRAY:32,CCW:64,NO_DEPTH_MASK:128,PARTIALLY_OPAQUE:256,FORCE_TRANSPARENT:512,ROUND_POINTS:1024,PERSPECTIVE_POINTS:2048,BILLBOARD:4096,CLIPPING:8192,STOCHASTIC_ALPHA:16384},this.COLOR_MOD_FLAGS={SATURATION:1,BRIGHTNESS:2,CONTRAST:4,TINT:8},this.XFORM_FLAGS={MATRIX_DIRTY:1,COMPILING:2,DIRTY:4},this.TRANSPARENCY_FLAGS={ALPHA:1,IMPROVED_ALPHA:2,ADD_ALPHA:4,ALPHA_TO_COVERAGE:8,WEIGHTED_OIT:16},this.DEPTH_TEST_FLAGS={ENABLED:1,DISABLED:2,ALWAYS_PASS:4},this.TRANSPARENCY_FLAGS.TWO_PASS=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ORDER_DEPENDENT=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_BLEND=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.KD_TREE_MAX_DEPTH=10,this.KD_TREE_MIN_TRIANGLES=20,this.setMaxPointSize=function(a){SceneJS_ProgramSourceFactory.setMaxPointSize(a)},this.publish=function(a,b,c){c||(this._topicPubs[a]=b);var d=this._topicSubs[a];if(d)for(var e in d)d.hasOwnProperty(e)&&d[e].call(this,b)},this.unpublish=function(a){var b=this._topicSubs[a];if(b)for(var c in b)b.hasOwnProperty(c)&&b[c].call(this,null);delete this._topicPubs[a]},this.on=function(a,b){var c=this._topicSubs[a];c||(c={},this._topicSubs[a]=c);var d=this._handleMap.addItem();c[d]=b,this._handleTopics[d]=a;var e=this._topicPubs[a];return e&&b.call(this,e),d},this.off=function(a){var b=this._handleTopics[a];if(b){delete this._handleTopics[a];var c=this._topicSubs[b];c&&delete c[a],this._handleMap.removeItem(a),"rendered"==b&&this._engine.branchDirty(this)}},this.once=function(a,b){var c=this,d=this.on(a,function(a){c.off(d),b(a)})},this.createScene=function(b,c){if(b=b||{},b.id){if(this._engines[b.id])throw SceneJS_error.fatalError(a.errors.ILLEGAL_NODE_CONFIG,"Scene already exists with this ID: '"+b.id+"'");this._engineIds.addItem(b.id,{})}else b.id=this._engineIds.addItem({});var d=new SceneJS_Engine(b,c);return this._engines[b.id]=d,d.scene},this.scene=function(a){var b=this._engines[a];return b?b.scene:null},this.getScene=function(a){if(!a)for(var a in this._engines)if(this._engines.hasOwnProperty(a))return this._engines[a].scene;var b=this._engines[a];return b?b.scene:null},this.getScenes=function(){var a={};for(var b in this._engines)this._engines.hasOwnProperty(b)&&(a[b]=this._engines[b].scene);return a},this._isArray=function(a){return a&&!a.propertyIsEnumerable("length")&&"object"==typeof a&&"number"==typeof a.length},this._shallowClone=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},this._applyIf=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(void 0==b[c]||null==b[c])&&(b[c]=a[c]);return b},this._apply=function(a,b,c){var d;if(c)for(d in b)b.hasOwnProperty(d)&&delete b[d];for(d in a)a.hasOwnProperty(d)&&void 0!=a[d]&&(b[d]=a[d]);return b};var c=Object.prototype.hasOwnProperty;this._isEmpty=function(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(c.call(a,b))return!1;return!0},this._isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},this._sliceArray=function(a,b,c){if(a.slice)return a.slice(b,c);b=b||0,c=c||a.length;for(var d=c-b,e=new a.constructor(d),f=0;d>f;f++)e[f]=a[b+f];return e},this._loadBinary=function(a,b){var c=new XMLHttpRequest;c.responseType="arraybuffer",c.open("GET",a),c.onload=function(){b(c.response)},c.send(null)};var d=["","MOZ_","WEBKIT_"];this.checkExtension=function(a){for(var b=0,c=d.length;c>b;b++)if(this.WEBGL_INFO.SUPPORTED_EXTENSIONS[d[b]+a])return!0;return!1},this._getExtension=function(a,b){for(var c=0,e=d.length;e>c;c++){var f=a.getExtension(d[c]+b);if(f)return f}return null},this.printGraph=function(a){b(a,0)},this.reset=function(){var a=[];for(var b in this._engines)this._engines.hasOwnProperty(b)&&(a.push(this._engines[b]),delete this._engines[b],this._engineIds.removeItem(b));for(;a.length>0;)a.pop().destroy();SceneJS_events.fireEvent(SceneJS_events.RESET)}}}(),function(){"use strict";var a=window.SceneJS_events=new function(){this.ERROR=0,this.RESET=1,this.NODE_CREATED=2,this.SCENE_CREATED=3,this.SCENE_COMPILING=4,this.SCENE_DESTROYED=5,this.OBJECT_COMPILING=6,this.WEBGL_CONTEXT_LOST=7,this.WEBGL_CONTEXT_RESTORED=8,this.RENDER=9;var a=[];this.addListener=function(b,c,d){var e=a[b];e||(e=[],a[b]=e);for(var f={command:c,priority:void 0==d?e.length:d},g=-1,h=0,i=e.length;i>h;h++)if(!e[h]){g=h;break}0>g&&(e.push(f),g=e.length-1);var j=b+"."+g;return j},this.removeListener=function(b){var c=b.lastIndexOf("."),d=parseInt(b.substr(0,c)),e=parseInt(b.substr(c+1)),f=a[d];f&&delete f[e]},this.fireEvent=function(b,c){var d=a[b];if(d){c=c||{};for(var e=0;e<d.length;e++)d[e]&&d[e].command(c)}}};SceneJS.bind=function(b,c){switch(b){case"error":return a.addListener(a.ERROR,c);case"reset":return a.addListener(a.RESET,function(){c()});case"webglcontextlost":return a.addListener(a.WEBGL_CONTEXT_LOST,function(a){c(a)});case"webglcontextrestored":return a.addListener(a.WEBGL_CONTEXT_RESTORED,function(a){c(a)});default:throw SceneJS_error.fatalError("SceneJS.bind - this event type not supported: '"+b+"'")}},SceneJS.onEvent=SceneJS.bind,SceneJS.unEvent=function(b){return a.removeListener(b)},SceneJS.subscribe=SceneJS.addListener=SceneJS.onEvent=SceneJS.bind,SceneJS.unsubscribe=SceneJS.unEvent,SceneJS.on=SceneJS.onEvent,SceneJS.off=SceneJS.unEvent}(),function(){"use strict";var a=window.SceneJS_Canvas=function(a,b,c,d){if(this.canvasId,!b){b="canvas-"+a;var e=document.getElementsByTagName("body")[0],f=document.createElement("div"),g=f.style;g.height="100%",g.width="100%",g.padding="0",g.margin="0",g.left="0",g.top="0",g.position="absolute",f.innerHTML+='<canvas id="'+b+'" style="width: 100%; height: 100%; margin: 0; padding: 0;"></canvas>',e.appendChild(f)}var h=document.getElementById(b);if(!h)throw SceneJS_error.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"SceneJS.Scene attribute 'canvasId' does not match any elements in the page");h.addEventListener("webglcontextcreationerror",function(a){console.error("Unable to initialize WebGL:",a.statusMessage||"Unknown error")},!1),this.canvasId=b,this.options=d||{},this.canvas=h,this.options.simulateWebGLContextLost&&(window.WebGLDebugUtils?this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas):console.error("To simulate context loss, please include WebGLDebugUtils")),this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.contextAttr=c||{},this.contextAttr.alpha=!0,this.gl=null,this.webgl2=!1,this.initWebGL()};a.prototype._WEBGL_CONTEXT_NAMES=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],a.prototype.initWebGL=function(){if(this.options.webgl2===!0){try{this.gl=this.canvas.getContext("webgl2",this.contextAttr)}catch(a){}this.gl?this.webgl2=!0:console.log("Failed to get a WebGL 2 context - defaulting to WebGL 1.")}if(!this.gl)for(var b=0;!this.gl&&b<this._WEBGL_CONTEXT_NAMES.length;b++)try{this.gl=this.canvas.getContext(this._WEBGL_CONTEXT_NAMES[b],this.contextAttr)}catch(a){}if(!this.gl)throw SceneJS_error.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Failed to get a WebGL context")},a.prototype.loseWebGLContext=function(){this.options.simulateWebGLContextLost&&this.canvas.loseContext()}}(),function(){"use strict";var a=window.SceneJS_Engine=function(a,b){b=b||{},a.type="scene",this.id=a.id,this._numPasses=a.numPasses||1,this._clearEachPass=!!a.clearEachPass,this.canvas=new SceneJS_Canvas(this.id,a.canvasId,a.contextAttr,b),this._coreFactory=new SceneJS_CoreFactory,this._nodeFactory=new SceneJS_NodeFactory,this.stats={build:{version:SceneJS.VERSION},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{},state:{programs:0},geometry:{meshes:0,vertices:0,triangles:0},textures:{},load:{sceneGraphCompilation:0,shaderCompilation:0,programCompilation:0},memory:{positions:0,colors:0,normals:0,uvs:0,indices:0,morphPositions:0,morphNormals:0,textures:0,tangents:0,pickPositions:0,pickColors:0},frame:{frameCount:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,drawChunks:0}},this.display=new SceneJS_Display(this.stats,{canvas:this.canvas,transparent:a.transparent,autoTangents:b.autoTangents,gammaInputPhong:b.gammaInputPhong}),this.sceneDirty=!1,this._sceneBranchesDirty=!1,this._compilationPaused=!1,this._nodesToDestroy=[],this._numNodesToDestroy=0,this.destroyed=!1;for(var c=this.canvas.gl,d=SceneJS.ENABLE_EXTENSIONS,e=0,f=d.length;f>e;++e)c.getExtension(d[e]);this.cpuTimer=SceneJS.timer,this.gpuTimer=c.getExtension("EXT_disjoint_timer_query")||null,this.gpuTimer&&(this.gpuTimerQuery=this.gpuTimer.createQueryEXT(this.gpuTimer.TIME_ELAPSED_EXT)),this.sceneStatus={nodes:{},numTasks:0};var g=this,h=a.nodes;a.nodes=[],this.scene=this.createNode(a),h&&(a.nodes=h,this.scene.addNodes(h)),this.canvas.canvas.addEventListener("webglcontextlost",function(a){a.preventDefault(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_LOST,{scene:g.scene})},!1),this.canvas.canvas.addEventListener("webglcontextrestored",function(){g.canvas.initWebGL();for(var a=g.canvas.gl,b=SceneJS.ENABLE_EXTENSIONS,c=0,d=b.length;d>c;++c)a.getExtension(b[c]);g.gpuTimer=a.getExtension("EXT_disjoint_timer_query"),g.gpuTimer&&(g.gpuTimerQuery=g.gpuTimer.createQueryEXT(g.gpuTimer.TIME_ELAPSED_EXT)),g._coreFactory.webglRestored(),g.display.webglRestored(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_RESTORED,{scene:g.scene})},!1)};a.prototype.setNumPasses=function(a){this._numPasses=a},a.prototype.setClearEachPass=function(a){this._clearEachPass=a},a.prototype.loseWebGLContext=function(){this.canvas.loseWebGLContext()},a.prototype.hasNodeType=function(a){return!!SceneJS_NodeFactory.nodeTypes[a]},a.prototype.createNode=function(a){this._doDestroyNodes(),a.type=a.type||"node";var b=this._coreFactory.getCore(a.type,a.coreId),c=this._nodeFactory.getNode(this,a,b),d=a.nodes;if(d){var e=SceneJS_NodeFactory.nodeTypes[c.type],f=!!e&&!!e.prototype._fromPlugin;if(!f)for(var g=0,h=d.length;h>g;g++){var i=this.createNode(d[g]);c.addNode(i)}}return c},a.prototype._doDestroyNodes=function(){for(var a;this._numNodesToDestroy>0;)--this._numNodesToDestroy,a=this._nodesToDestroy[this._numNodesToDestroy],this._nodesToDestroy[this._numNodesToDestroy]=null,a._doDestroy(),this._coreFactory.putCore(a._core),this._nodeFactory.putNode(a)},a.prototype.findNode=function(a){return this._nodeFactory.nodes.items[a]},a.prototype.findNodes=function(a){var b=new RegExp(a),c=[],d=this._nodeFactory.nodes.items;for(var e in d)d.hasOwnProperty(e)&&b.test(e)&&c.push(d[e]);return c},a.prototype.hasCore=function(a,b){return this._coreFactory.hasCore(a,b)},a.prototype.branchDirty=function(a){if(!this.sceneDirty&&a!=window){a.branchDirty=!0,a.dirty=!0;for(var b=a.parent;b&&!b.dirty&&!b.branchDirty;b=b.parent)b.dirty=!0;this._sceneBranchesDirty=!0}},a.prototype.render=function(a){var b=!1;if(this._willRender()||a&&a.force)for(var c=Date.now(),d=a&&a.force,e=a&&a.custom,f=0;f<this._numPasses;f++)this.scene.publish("rendering",{pass:f}),this.compile(),this.display.prepareScene(),this.display.render({pass:f,clear:this._clearEachPass||0==f,force:d,custom:e,opaqueOnly:a&&a.opaqueOnly}),this.scene.publish("rendered",{sceneId:this.id,time:c,pass:f}),b=!0;return b},a.prototype.pick=function(a){this._willRender()&&this.compile();var b=this.display.pick({pickTriangle:a?a.rayPick:!1,pickRegion:a?a.regionPick:!1,canvasPos:a.canvasPos,origin:a.origin,direction:a.direction});return b},a.prototype.readPixels=function(a,b,c){return this._willRender()&&this.compile(),this.display.readPixels(a,b,c)},a.prototype._willRender=function(){return SceneJS_events.fireEvent(SceneJS_events.RENDER),this.display.imageDirty||this.display.objectListDirty||this._sceneBranchesDirty||this.sceneDirty},a.prototype.pauseCompilation=function(){this._compilationPaused=!0},a.prototype.resumeCompilation=function(){this._compilationPaused=!1},a.prototype.compile=function(){if(!this._compilationPaused){if(this._sceneBranchesDirty||this.sceneDirty){this._sceneBranchesDirty=!1,SceneJS_events.fireEvent(SceneJS_events.SCENE_COMPILING,{engine:this});var a=SceneJS.timer.now();this.scene._compileNodes(),this.stats.load.sceneGraphCompilation+=SceneJS.timer.now()-a,this.sceneDirty=!1}this._doDestroyNodes()}},a.prototype.destroyNode=function(a){this._nodesToDestroy[this._numNodesToDestroy++]=a;var b=this.sceneStatus.nodes[a.id];b&&(this.sceneStatus.numTasks-=b.numTasks,delete this.sceneStatus.nodes[a.id])},a.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";window.SceneJS_error=new function(){var a;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){a=b.engine.id}),SceneJS_events.addListener(SceneJS_events.RESET,function(){a=null},1e5),this.fatalError=function(b,c){"string"==typeof b&&(c=b,b=SceneJS.errors.ERROR);var d={errorName:SceneJS.errors._getErrorName(b)||"ERROR",code:b,exception:c,fatal:!0};return a&&(d.sceneId=a),SceneJS_events.fireEvent(SceneJS_events.ERROR,d),c},this.error=function(b,c){var d={errorName:SceneJS.errors._getErrorName(b)||"ERROR",code:b,exception:c,fatal:!1};a&&(d.sceneId=a),SceneJS_events.fireEvent(SceneJS_events.ERROR,d)}};!function(){SceneJS.errors={};var a=0;SceneJS.errors.ERROR=a++,SceneJS.errors.INVALID_FRAMEBUFFER=a++,SceneJS.errors.WEBGL_NOT_SUPPORTED=a++,SceneJS.errors.WEBGL_CONTEXT_LOST=a++,SceneJS.errors.NODE_CONFIG_EXPECTED=a++,SceneJS.errors.ILLEGAL_NODE_CONFIG=a++,SceneJS.errors.SHADER_COMPILATION_FAILURE=a++,SceneJS.errors.SHADER_LINK_FAILURE=a++,SceneJS.errors.CANVAS_NOT_FOUND=a++,SceneJS.errors.OUT_OF_VRAM=a++,SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG=a++,SceneJS.errors.NODE_NOT_FOUND=a++,SceneJS.errors.NODE_ILLEGAL_STATE=a++,SceneJS.errors.ID_CLASH=a++}(),SceneJS.errors._getErrorName=function(a){for(var b in SceneJS.errors)if(SceneJS.errors.hasOwnProperty(b)&&SceneJS.errors[b]==a)return b;return null}}(),function(){"use strict";SceneJS.log=new function(){var a,b=null,c={},d=0,e="";SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){a=b.engine.id}),SceneJS_events.addListener(SceneJS_events.RESET,function(){c={},b=null,a=null},1e5),this._setIndent=function(a){d=a;for(var b=[],c=0;d>c;c++)b.push("----");e=b.join("")},this.error=function(a){this._log("error",a)},this.warn=function(a){this._log("warn",a)},this.info=function(a){this._log("info",a)},this.debug=function(a){this._log("debug",a)},this.setFuncs=function(a){if(a){b=a;for(var d in c)this._flush(d)}},this._flush=function(a){var d=c[a];if(d){var e=b?b[a]:null;if(e){for(var f=0;f<d.length;f++)e(d[f]);c[a]=[]}}},this._log=function(a,b){if(SceneJS._isArray(b))for(var c=0;c<b.length;c++)this.__log(a,b[c]);else this.__log(a,b)},this.__log=function(a,c){c=e+c,b&&b[a]?b[a](c):console&&console[a]&&console[a](c)},this.getFuncs=function(){return b}}}(),function(){"use strict";{var a=(mat4.create(),mat4.create(),vec2.create(),vec3.create()),b=vec3.create(),c=vec3.create(),d=vec3.create(),e=vec3.create(),f=vec3.create(),g=vec3.create();vec3.create(),vec4.create()}window.SceneJS_math_log2=Math.log2?Math.log2:function(a){return Math.round(Math.log(a)*Math.LOG2E)},window.SceneJS_math_isPOT=function(a){return 0==(a&a-1)},window.SceneJS_math_cross3Vec4=function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];return[d*h-e*g,e*f-c*h,c*g-d*f,0]},window.SceneJS_math_setCellMat4=function(a,b,c,d){a[b+4*c]=d},window.SceneJS_math_LOOKAT_OBJ={eye:{x:0,y:0,z:10},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},window.SceneJS_math_LOOKAT_ARRAYS={eye:[0,0,10],look:[0,0,0],up:[0,1,0]},window.SceneJS_math_ORTHO_OBJ={left:-1,right:1,bottom:-1,near:.1,top:1,far:5e3},window.SceneJS_math_identityQuaternion=function(){return[0,0,0,1]},window.SceneJS_math_angleAxisQuaternion=function(a,b,c,d){var e=d/180*Math.PI,f=e/2,g=Math.sin(f);return[g*a,g*b,g*c,Math.cos(f)]},window.SceneJS_math_mulQuaternions=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],i=b[2],j=b[3];return[f*g+c*j+d*i-e*h,f*h+d*j+e*g-c*i,f*i+e*j+c*h-d*g,f*j-c*g-d*h-e*i]},window.SceneJS_math_newMat4FromQuaternion=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=2*b,g=2*c,h=2*d,i=f*e,j=g*e,k=h*e,l=f*b,m=g*b,n=h*b,o=g*c,p=h*c,q=h*d,r=mat4.create();return SceneJS_math_setCellMat4(r,0,0,1-(o+q)),SceneJS_math_setCellMat4(r,0,1,m-k),SceneJS_math_setCellMat4(r,0,2,n+j),SceneJS_math_setCellMat4(r,1,0,m+k),SceneJS_math_setCellMat4(r,1,1,1-(l+q)),SceneJS_math_setCellMat4(r,1,2,p-i),SceneJS_math_setCellMat4(r,2,0,n-j),SceneJS_math_setCellMat4(r,2,1,p+i),SceneJS_math_setCellMat4(r,2,2,1-(l+o)),r},window.SceneJS_math_normalizeQuaternion=function(a){var b=vec4.length([a[0],a[1],a[2],a[3]]);return[a[0]/b,a[1]/b,a[2]/b,a[3]/b]},window.SceneJS_math_angleAxisFromQuaternion=function(a){a=SceneJS_math_normalizeQuaternion(a);var b=a[3],c=2*Math.acos(b),d=Math.sqrt(1-b*b);return.001>d?{x:a[0],y:a[1],z:a[2],angle:57.295779579*c}:{x:a[0]/d,y:a[1]/d,z:a[2]/d,angle:57.295779579*c}},window.SceneJS_math_decompressPosition=function(a,b,c){a[0]=b[0]*c[0]+c[12],a[1]=b[1]*c[5]+c[13],a[2]=b[2]*c[10]+c[14]},window.SceneJS_math_decompressUV=function(a,b,c){a[0]=b[0]*c[0]+c[6],a[1]=b[1]*c[4]+c[7]},window.SceneJS_math_getPickPrimitives=function(a,b,c){var d,e,f=!!b;f?(e=b.length,d=c?new Uint16Array(3*e):new Float32Array(3*e)):(e=a.length/3,d=a);for(var g,h,i,j,k,l,m,n,o=new Uint8Array(4*e),p=0,q=0;e>q;q+=3)h=3*q,i=4*q,n=p>>24&255,m=p>>16&255,l=p>>8&255,k=255&p,f&&(j=b[q],g=3*j,d[h]=a[g],d[h+1]=a[g+1],d[h+2]=a[g+2]),o[i]=k,o[i+1]=l,o[i+2]=m,o[i+3]=n,f&&(j=b[q+1],g=3*j,d[h+3]=a[g],d[h+4]=a[g+1],d[h+5]=a[g+2]),o[i+4]=k,o[i+5]=l,o[i+6]=m,o[i+7]=n,f&&(j=b[q+2],g=3*j,d[h+6]=a[g],d[h+7]=a[g+1],d[h+8]=a[g+2]),o[i+8]=k,o[i+9]=l,o[i+10]=m,o[i+11]=n,p++;return{positions:d,colors:o}},window.SceneJS_math_getPickPositions=function(a,b){for(var c,d,e,f=b.length,g=new Float32Array(3*f),h=0;f>h;h++)c=3*h,e=b[h],d=3*e,g[c]=a[d],g[c+1]=a[d+1],g[c+2]=a[d+2];return g},window.SceneJS_math_getPickColors=function(a){for(var b,c,d,e,f,g=a.length,h=new Uint8Array(4*g),i=0,j=0;g>j;j+=3)b=4*j,f=i>>24&255,e=i>>16&255,d=i>>8&255,c=255&i,h[b]=c,h[b+1]=d,h[b+2]=e,h[b+3]=f,h[b+4]=c,h[b+5]=d,h[b+6]=e,h[b+7]=f,h[b+8]=c,h[b+9]=d,h[b+10]=e,h[b+11]=f,i++;return h},window.SceneJS_math_rayPlaneIntersect=function(e,f,g,h,i,j){j=j||vec3.create(),f=vec3.normalize(a,f);var k=vec3.subtract(b,h,g),l=vec3.subtract(c,i,g),m=vec3.cross(d,k,l);vec3.normalize(m,m);var n=-vec3.dot(g,m),o=-(vec3.dot(e,m)+n)/vec3.dot(f,m);return j[0]=e[0]+o*f[0],j[1]=e[1]+o*f[1],j[2]=e[2]+o*f[2],j},window.SceneJS_math_cartesianToBarycentric=function(d,e,f,g,h){var i=vec3.subtract(a,g,e),j=vec3.subtract(b,f,e),k=vec3.subtract(c,d,e),l=vec3.dot(i,i),m=vec3.dot(i,j),n=vec3.dot(i,k),o=vec3.dot(j,j),p=vec3.dot(j,k),q=l*o-m*m;if(0===q)return null;var r=1/q,s=(o*n-m*p)*r,t=(l*p-m*n)*r;return h[0]=1-s-t,h[1]=t,h[2]=s,h},window.SceneJS_math_barycentricToCartesian=function(a,b,c,d,e){var f=a[0],g=a[1],h=a[2];return e[0]=b[0]*f+c[0]*g+d[0]*h,e[1]=b[1]*f+c[1]*g+d[1]*h,e[2]=b[2]*f+c[2]*g+d[2]*h,e},window.SceneJS_math_barycentricToCartesian=function(a,b,c,d,e){e=e||vec3.create();var f=a[0],g=a[1],h=a[2];return e[0]=b[0]*f+c[0]*g+d[0]*h,e[1]=b[1]*f+c[1]*g+d[1]*h,e[2]=b[2]*f+c[2]*g+d[2]*h,e},window.SceneJS_math_buildTangents=function(h,i,j,k,l){for(var m=new Float32Array(h.length),n=.001,o=vec3.create(),p=vec3.create(),q=vec3.create(),r=vec2.create(),s=vec2.create(),t=vec2.create(),u=i?i.length:h.length/3,v=0;u>v;v+=3){var w=i?i[v]:v;o.set(h.subarray(3*w,3*w+3)),r.set(j.subarray(2*w,2*w+2)),w=i?i[v+1]:v+1,p.set(h.subarray(3*w,3*w+3)),s.set(j.subarray(2*w,2*w+2)),w=i?i[v+2]:v+2,q.set(h.subarray(3*w,3*w+3)),t.set(j.subarray(2*w,2*w+2)),k&&(SceneJS_math_decompressPosition(o,o,k),SceneJS_math_decompressPosition(p,p,k),SceneJS_math_decompressPosition(q,q,k)),l&&(SceneJS_math_decompressUV(r,r,l),SceneJS_math_decompressUV(s,s,l),SceneJS_math_decompressUV(t,t,l));var x=vec3.subtract(a,p,o),y=vec3.subtract(b,q,o),z=vec2.subtract(c,s,r),A=vec2.subtract(d,t,r),B=z[0]*A[1]-z[1]*A[0];0===B&&(B=n);for(var C=1/B,D=vec3.scale(f,vec3.subtract(g,vec3.scale(e,x,A[1]),vec3.scale(f,y,z[1])),C),E=0;3>E;E++){var F=i?3*i[v+E]:3*(v+E);m[F]+=D[0],m[F+1]+=D[1],m[F+2]+=D[2]}}return m},window.SceneJS_math_octDecodeVec2=function(a,b){var c=a[0],d=a[1];c=(2*c+1)/255,d=(2*d+1)/255;var e=1-Math.abs(c)-Math.abs(d);0>e&&(c=(1-Math.abs(d))*(c>=0?1:-1),d=(1-Math.abs(c))*(d>=0?1:-1));var f=Math.sqrt(c*c+d*d+e*e);return b[0]=c/f,b[1]=d/f,b[2]=e/f,b}}(),function(){"use strict";SceneJS._webgl={enumMap:{funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipMapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipMapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipMapLinear:"NEAREST_MIPMAP_LINEAR",linearMipMapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"}}}(),function(){"use strict";SceneJS._webgl.ArrayBuffer=function(a,b,c,d,e,f,g){switch(this.allocated=!1,c.constructor){case Uint8Array:this.itemType=a.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=a.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=a.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=a.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=a.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=a.INT,this.itemByteSize=4;break;default:this.itemType=a.FLOAT,this.itemByteSize=4}this.gl=a,this.type=b,this.numItems=d,this.itemSize=e,this.usage=f,this.normalize=!!g,this._allocate(c,d)},SceneJS._webgl.ArrayBuffer.prototype._allocate=function(a,b){if(this.allocated=!1,this.handle=this.gl.createBuffer(),!this.handle)throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to allocate WebGL ArrayBuffer");this.handle&&(this.gl.bindBuffer(this.type,this.handle),this.gl.bufferData(this.type,a,this.usage),this.gl.bindBuffer(this.type,null),this.numItems=b,this.length=a.length,this.allocated=!0)},SceneJS._webgl.ArrayBuffer.prototype.setData=function(a){this.allocated&&(this.gl.bindBuffer(this.type,this.handle),a.length>this.length?(this.gl.bufferData(this.type,a,this.usage),this.length=a.length):this.gl.bufferSubData(this.type,0,a),this.gl.bindBuffer(this.type,null),this.numItems=a.length)},SceneJS._webgl.ArrayBuffer.prototype.unbind=function(){this.allocated&&this.gl.bindBuffer(this.type,null)},SceneJS._webgl.ArrayBuffer.prototype.destroy=function(){this.allocated&&(this.gl.deleteBuffer(this.handle),this.handle=null,this.allocated=!1)},SceneJS._webgl.ArrayBuffer.prototype.bind=function(){this.allocated&&this.gl.bindBuffer(this.type,this.handle)}}(),function(){"use strict";SceneJS._webgl.Attribute=function(a,b){this.gl=a,this.location=b},SceneJS._webgl.Attribute.prototype.bindArrayBuffer=function(a){a&&(a.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,a.itemSize,a.itemType,a.normalize,0,0))}}(),function(){"use strict";SceneJS._webgl.Framebuffer=function(a){this.allocated=!1,this.canvas=a.canvas,this.gl=a.canvas.gl,this.canvasWidth=0,this.canvasHeight=0,this.sizeRatio=a.sizeRatio||1,"number"==typeof a.colorAttachments&&(a.colorAttachments=new Array(a.colorAttachments));var b=a.colorAttachments||new Array(1);this.numColorAttachments=b.length,this.colorAttachments=new Array(this.numColorAttachments);for(var c=0;c<this.numColorAttachments;++c){var d=b[c]||{};this.colorAttachments[c]={format:void 0!==d.format?this.gl[d.format]:this.gl.RGBA,type:void 0!==d.type?this.gl[d.type]:this.gl.UNSIGNED_BYTE,minFilter:void 0!==d.minFilter?this.gl[d.minFilter]:this.gl.LINEAR,magFilter:void 0!==d.magFilter?this.gl[d.magFilter]:this.gl.LINEAR,wrapS:void 0!==d.wrapS?this.gl[d.wrapS]:this.gl.CLAMP_TO_EDGE,wrapT:void 0!==d.wrapT?this.gl[d.wrapT]:this.gl.CLAMP_TO_EDGE}}this.sharedDepthBuffer=a.sharedDepthBuffer||null,this.hasDepthAttachment=a.depthAttachment!==!1,this.useDepthTextures=SceneJS.WEBGL_INFO.depthTexturesSupported,this.drawBuffers=this.gl.getExtension("WEBGL_draw_buffers"),this.buf=null,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.webglRestored=function(a){this.gl=a,this.buf=null,this.allocated=!1,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.bind=function(){this._touch(),this.bound||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),this.gl.viewport(0,0,this.buf.width,this.buf.height),this.bound=!0)},SceneJS._webgl.Framebuffer.prototype._touch=function(){var a=this.gl.drawingBufferWidth,b=this.gl.drawingBufferHeight;if(this.buf){if(this.canvasWidth==a&&this.canvasHeight==b)return;for(var c=0;c<this.numColorAttachments;++c)this.gl.deleteTexture(this.buf.colorTargets[c]);this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.gl.deleteFramebuffer(this.buf.framebuf)}this.canvasWidth=a,this.canvasHeight=b;var d=Math.floor(a*this.sizeRatio),e=Math.floor(b*this.sizeRatio);this.buf={framebuf:this.gl.createFramebuffer(),colorTargets:new Array(this.numColorAttachments),width:d,height:e},this.buf.depthTarget=this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget().texture():this.useDepthTextures?this.gl.createTexture():this.gl.createRenderbuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf);for(var c=0;c<this.numColorAttachments;++c)this.buf.colorTargets[c]=this.gl.createTexture(),this._setTexture(this.buf.colorTargets[c],d,e,this.colorAttachments[c]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0+c,this.gl.TEXTURE_2D,this.buf.colorTargets[c],0);if(this.drawBuffers){for(var f=new Array(this.numColorAttachments),c=0;c<this.numColorAttachments;++c)f[c]=this.gl.COLOR_ATTACHMENT0+c;this.drawBuffers.drawBuffersWEBGL(f)}if(this.hasDepthAttachment&&(this.useDepthTextures?(this.sharedDepthBuffer||this._setTexture(this.buf.depthTarget,d,e,{format:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.buf.depthTarget,0)):(this.sharedDepthBuffer||(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,d,e)),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null))),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),!this.gl.isFramebuffer(this.buf.framebuf))throw SceneJS_error.fatalError(SceneJS.errors.INVALID_FRAMEBUFFER,"Invalid framebuffer");var g=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);switch(g){case this.gl.FRAMEBUFFER_COMPLETE:break;case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this.gl.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: "+g)}this.bound=!1},SceneJS._webgl.Framebuffer.prototype._setTexture=function(a,b,c,d){var e=void 0!==d.format?d.format:this.gl.RGBA,f=void 0!==d.type?d.type:this.gl.UNSIGNED_BYTE,g=void 0!==d.minFilter?d.minFilter:this.gl.LINEAR,h=void 0!==d.magFilter?d.magFilter:this.gl.LINEAR,i=void 0!==d.wrapS?d.wrapS:this.gl.CLAMP_TO_EDGE,j=void 0!==d.wrapT?d.wrapT:this.gl.CLAMP_TO_EDGE;this.gl.bindTexture(this.gl.TEXTURE_2D,a);try{this.gl.texImage2D(this.gl.TEXTURE_2D,0,e,b,c,0,e,f,null)}catch(k){var l=new WebGLUnsignedByteArray(b*c*3);this.gl.texImage2D(this.gl.TEXTURE_2D,0,e,b,c,0,e,f,l)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,g),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,h),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,j)},SceneJS._webgl.Framebuffer.prototype.clear=function(){if(!this.bound)throw"Render buffer not bound";this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.disable(this.gl.BLEND)},SceneJS._webgl.Framebuffer.prototype.read=function(a,b){var c=a,d=this.canvas.canvas.height-b,e=new Uint8Array(4);return this.gl.readPixels(c,d,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),e},SceneJS._webgl.Framebuffer.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.bound=!1},SceneJS._webgl.Framebuffer.prototype.getColorTarget=function(a){var b=this;return a=a||0,{bind:function(c){return b.buf&&b.buf.colorTargets[a]?(b.gl.activeTexture(b.gl.TEXTURE0+c),b.gl.bindTexture(b.gl.TEXTURE_2D,b.buf.colorTargets[a]),!0):!1},unbind:function(c){b.buf&&b.buf.colorTargets[a]&&(b.gl.activeTexture(b.gl.TEXTURE0+c),b.gl.bindTexture(b.gl.TEXTURE_2D,null))},texture:function(){return b.buf.colorTargets[a]}}},SceneJS._webgl.Framebuffer.prototype.getDepthTarget=function(){var a=this;return this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget():{bind:function(b){return a.buf&&a.buf.depthTarget?(a.gl.activeTexture(a.gl.TEXTURE0+b),a.gl.bindTexture(a.gl.TEXTURE_2D,a.buf.depthTarget),!0):!1},unbind:function(b){a.buf&&a.buf.depthTarget&&(a.gl.activeTexture(a.gl.TEXTURE0+b),a.gl.bindTexture(a.gl.TEXTURE_2D,null))},texture:function(){
return a.buf.depthTarget}}},SceneJS._webgl.Framebuffer.prototype.destroy=function(){if(this.buf){for(var a=0;a<this.numColorAttachments;++a)this.gl.deleteTexture(this.buf.colorTargets[a]);this.gl.deleteFramebuffer(this.buf.framebuf),this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.buf=null,this.bound=!1}}}(),function(){"use strict";SceneJS._webgl.Program=function(a,b,c,d,e){this.stats=a,this.hash=c,this.useCount=0,this.allocated=!1,this.gl=null,this._uniforms={},this._samplers={},this._attributes={},this.vertexSource=d,this.fragmentSource=e,this._vertexShader=null,this._fragmentShader=null,this.build(b)},SceneJS._webgl.Program.prototype.build=function(a){var b,c,d,e,f,g=SceneJS.timer.now(),h=this.stats;if(this.gl=a,this._vertexShader=new SceneJS._webgl.Shader(h,a,a.VERTEX_SHADER,this.vertexSource),this._fragmentShader=new SceneJS._webgl.Shader(h,a,a.FRAGMENT_SHADER,this.fragmentSource),this.handle=a.createProgram(),this.handle){a.attachShader(this.handle,this._vertexShader.handle),a.attachShader(this.handle,this._fragmentShader.handle),a.linkProgram(this.handle),a.getProgramParameter(this.handle,a.LINK_STATUS)||SceneJS.log.error("Shader program failed to link: "+a.getProgramInfoLog(this.handle));var i=a.getProgramParameter(this.handle,a.ACTIVE_UNIFORMS),j=0;for(c=0;i>c;++c)d=a.getActiveUniform(this.handle,c),d&&(e=d.name,"\x00"==e[e.length-1]&&(e=e.substr(0,e.length-1)),f=a.getUniformLocation(this.handle,e),d.type==a.SAMPLER_2D||d.type==a.SAMPLER_CUBE||35682==d.type?this._samplers[e]=f:(this._uniforms[e]=new SceneJS._webgl.Uniform(a,d.type,d.size,f),++j));var k=a.getProgramParameter(this.handle,a.ACTIVE_ATTRIBUTES);for(c=0;k>c;c++)b=a.getActiveAttrib(this.handle,c),b&&(f=a.getAttribLocation(this.handle,b.name),this._attributes[b.name]=new SceneJS._webgl.Attribute(a,f));h.load.programCompilation+=SceneJS.timer.now()-g,this.allocated=!0}},SceneJS._webgl.Program.prototype.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},SceneJS._webgl.Program.prototype.getUniformLocation=function(a){if(this.allocated){var b=this._uniforms[a];return b?b.getLocation():void 0}},SceneJS._webgl.Program.prototype.getUniform=function(a){if(this.allocated){var b=this._uniforms[a];return b?b:void 0}},SceneJS._webgl.Program.prototype.getAttribute=function(a){if(this.allocated){var b=this._attributes[a];return b?b:void 0}},SceneJS._webgl.Program.prototype.bindArrayBuffer=function(a,b){if(this.allocated){var c=this._attributes[a];c&&c.bindArrayBuffer(b)}},SceneJS._webgl.Program.prototype.bindTexture=function(a,b,c){if(!this.allocated)return!1;var d=this._samplers[a];return d&&b.bind(c)?(this.gl.uniform1i(d,c),!0):!1},SceneJS._webgl.Program.prototype.destroy=function(){this.allocated&&(this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this._attributes=null,this._uniforms=null,this._samplers=null,this.allocated=!1)},SceneJS._webgl.Program.prototype.setUniform=function(a,b){if(this.allocated){var c=this._uniforms[a];c&&c.setValue(b)}}}(),function(){"use strict";SceneJS._webgl.Shader=function(a,b,c,d){this.allocated=!1;var e=SceneJS.timer.now();if(this.handle=b.createShader(c),!this.handle)throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create WebGL shader");if(b.shaderSource(this.handle,d),b.compileShader(this.handle),this.valid=0!=b.getShaderParameter(this.handle,b.COMPILE_STATUS),!this.valid&&!b.isContextLost()){SceneJS.log.error("Shader program failed to compile: "+b.getShaderInfoLog(this.handle)),SceneJS.log.error("Shader source:");for(var f=d.split("\n"),g=0;g<f.length;g++)SceneJS.log.error(g+1+": "+f[g]);throw SceneJS_error.fatalError(SceneJS.errors.SHADER_COMPILATION_FAILURE,"Shader program failed to compile")}a.load.shaderCompilation+=SceneJS.timer.now()-e,this.allocated=!0}}(),function(){"use strict";SceneJS._webgl.Texture2D=function(a,b){try{this._init(a,b)}catch(c){throw SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create texture: "+c.message||c)}},SceneJS._webgl.Texture2D.prototype._init=function(a,b){this.allocated=!1,this.gl=a,this.target=b.target||a.TEXTURE_2D,this.minFilter=b.minFilter,this.magFilter=b.magFilter,this.wrapS=b.wrapS,this.wrapT=b.wrapT,this.update=b.update,this.texture=b.texture,this.compressed=!!b.compressed,this.format=a.RGBA,this.isDepth=!1,this.depthMode=0,this.depthCompareMode=0,this.depthCompareFunc=0,a.bindTexture(this.target,this.texture),b.minFilter&&a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,b.minFilter),b.magFilter&&a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,b.magFilter),b.wrapS&&a.texParameteri(this.target,a.TEXTURE_WRAP_S,b.wrapS),b.wrapT&&a.texParameteri(this.target,a.TEXTURE_WRAP_T,b.wrapT),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY!==!1),this.compressed||this.minFilter!=a.NEAREST_MIPMAP_NEAREST&&this.minFilter!=a.LINEAR_MIPMAP_NEAREST&&this.minFilter!=a.NEAREST_MIPMAP_LINEAR&&this.minFilter!=a.LINEAR_MIPMAP_LINEAR||a.generateMipmap(this.target),a.bindTexture(this.target,null),this.allocated=!0},SceneJS._webgl.Texture2D.prototype.bind=function(a){if(this.allocated){var b=this.gl;return this.texture?(b.activeTexture(b["TEXTURE"+a]),b.bindTexture(this.target,this.texture),this.update&&this.update(b),!0):!1}},SceneJS._webgl.Texture2D.prototype.unbind=function(a){if(this.allocated){var b=this.gl;this.texture&&(b.activeTexture(b["TEXTURE"+a]),b.bindTexture(this.target,null))}},SceneJS._webgl.Texture2D.prototype.destroy=function(){if(this.allocated){var a=this.gl;this.texture&&(a.deleteTexture(this.texture),this.texture=null)}}}(),function(){"use strict";function a(a,b,c){if(b===a.BOOL)return new Array(c);if(b===a.BOOL_VEC2)return new Array(2*c);if(b===a.BOOL_VEC3)return new Array(3*c);if(b===a.BOOL_VEC4)return new Array(4*c);if(b===a.INT)return new Uint32Array(c);if(b===a.INT_VEC2)return new Uint32Array(2*c);if(b===a.INT_VEC3)return new Uint32Array(3*c);if(b===a.INT_VEC4)return new Uint32Array(4*c);if(b===a.FLOAT)return new Float32Array(c);if(b===a.FLOAT_VEC2)return new Float32Array(2*c);if(b===a.FLOAT_VEC3)return new Float32Array(3*c);if(b===a.FLOAT_VEC4)return new Float32Array(4*c);if(b===a.FLOAT_MAT2)return new Float32Array(4*c);if(b===a.FLOAT_MAT3)return new Float32Array(9*c);if(b===a.FLOAT_MAT4)return new Float32Array(16*c);throw"Unsupported shader uniform type: "+b}var b=function(){var a={},b=document.createElement("canvas"),c=b.getContext("webgl")||b.getContext("experimental-webgl");return c?(a[c.BOOL]=function(a){var b,c,d=!0;if(1===this.length)this.value[0]!==a&&(d=!1);else for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){if(1===this.length)this.value[0]=a;else for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform1fv(this.location,this.value)}},a[c.BOOL_VEC2]=function(a){var b,c,d=!0;for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform2iv(this.location,a)}},a[c.BOOL_VEC3]=function(a){var b,c,d=!0;for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform3iv(this.location,a)}},a[c.BOOL_VEC4]=function(a){var b,c,d=!0;for(b=0,c=this.length;c>b;++b)if(this.value[b]!==a[b]){d=!1;break}if(!d){for(;c>b;)this.value[b]=a[b],++b;this.gl.uniform4iv(this.location,a)}},a[c.INT_VEC2]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform2iv(this.location,a))},a[c.INT_VEC3]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform3iv(this.location,a))},a[c.INT_VEC4]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform4iv(this.location,a))},a[c.FLOAT]=function(a){var b=!0;if(1===this.length)this.value[0]!==a&&(b=!1);else for(var c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(1===this.length?this.value[0]=a:this.value.set(a),this.gl.uniform1fv(this.location,this.value))},a[c.FLOAT_VEC2]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform2fv(this.location,a))},a[c.FLOAT_VEC3]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform3fv(this.location,a))},a[c.FLOAT_VEC4]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniform4fv(this.location,a))},a[c.FLOAT_MAT2]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniformMatrix2fv(this.location,!1,a))},a[c.FLOAT_MAT3]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniformMatrix3fv(this.location,!1,a))},a[c.FLOAT_MAT4]=function(a){for(var b=!0,c=0,d=this.length;d>c;++c)if(this.value[c]!==a[c]){b=!1;break}b||(this.value.set(a),this.gl.uniformMatrix4fv(this.location,!1,a))},a):a}();SceneJS._webgl.Uniform=function(c,d,e,f){this.gl=c,this.location=f,this.value=a(c,d,e),this.length=this.value.length,this.setValue=b[d]},SceneJS._webgl.Uniform.prototype.getLocation=function(){return this.location}}(),function(){"use strict";window.SceneJS_Core=function(a){this.type=a,this.coreId=null,this.stateId=null,this.useCount=0}}(),ColorFresnel.prototype.isEqual=function(a,b){var c=a.center.reduce(function(a,c,d){return a&&c===b.center[d]},!0),d=a.edge.reduce(function(a,c,d){return a&&c===b.edge[d]},!0),e=a.edgeBias===b.edgeBias,f=a.centerBias===b.centerBias,g=a.power===b.power;return c&&d&&e&&f&&g},ScalarFresnel.prototype.isEqual=function(a,b){var c=a.center===b.center,d=a.edge==b.edge,e=a.edgeBias===b.edgeBias,f=a.centerBias===b.centerBias,g=a.power===b.power;return c&&d&&e&&f&&g},function(){"use strict";function a(a){var b,c,d,e=a._engine.canvas.gl;a.arrays.positions?(b=SceneJS_math_getPickPrimitives(a.arrays.positions,a.arrays.indices,a.compressedPositions),c=b.positions,d=b.colors,a.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,c,c.length,3,e.STATIC_DRAW),a._engine.stats.memory.pickPositions+=c.length*c.constructor.BYTES_PER_ELEMENT,a._engine.stats.memory.pickColors+=d.length*d.constructor.BYTES_PER_ELEMENT):(d=SceneJS_math_getPickColors(a.arrays.indices),a._engine.stats.memory.pickColors+=d.length*d.constructor.BYTES_PER_ELEMENT),a.pickColorsBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,d,d.length,4,e.STATIC_DRAW,!0)}function b(a,e,g,h,i,j){var k=vec3.create(),l=vec3.create(),m={triangles:null,left:null,right:null,bb:{min:k,max:l}};k[0]=k[1]=k[2]=Number.POSITIVE_INFINITY,l[0]=l[1]=l[2]=Number.NEGATIVE_INFINITY;var n,o;for(n=0,o=a.length;o>n;++n)for(var p=3*a[n],q=0;3>q;++q){var r;r=e?3*e[p+q]:3*(p+q),f[0]=g[r],f[1]=g[r+1],f[2]=g[r+2],h&&SceneJS_math_decompressPosition(f,f,h),f[0]<k[0]&&(k[0]=f[0]),f[0]>l[0]&&(l[0]=f[0]),f[1]<k[1]&&(k[1]=f[1]),f[1]>l[1]&&(l[1]=f[1]),f[2]<k[2]&&(k[2]=f[2]),f[2]>l[2]&&(l[2]=f[2])}if(j>c)return m.triangles=a,m;var s=(k[i]+l[i])/2,t=new Array(a.length),u=0,v=new Array(a.length),w=0;for(n=0,o=a.length;o>n;++n){var x,y,z,p=3*a[n];e?(x=e[p],y=e[p+1],z=e[p+2]):(x=p,y=p+1,z=p+2);var A=3*x,B=3*y,C=3*z,D=g[A+i],E=g[B+i],F=g[C+i];if(h){var G=h[5*i],H=h[i+12];D=D*G+H,E=E*G+H,F=F*G+H}s>=D||s>=E||s>=F?t[u++]=a[n]:v[w++]=a[n]}return d>u||d>w?(m.triangles=a,m):(t.length=u,v.length=w,m.left=b(t,e,g,h,(i+1)%3,j+1),m.right=b(v,e,g,h,(i+1)%3,j+1),m)}var c=SceneJS.KD_TREE_MAX_DEPTH,d=SceneJS.KD_TREE_MIN_TRIANGLES,e=window.SceneJS_GeometryCore=function(){this.type="xform",this.coreId=null,this.stateId=null,this.kdTree=null,this.kdTreeDirty=!0};e.prototype.getTangents=function(a){if(this.tangentBufs||(this.tangentBufs=[]),this.tangentBufs[a])return this.tangentBufs[a];var b=this.arrays,c=this.arrays.tangents[a],d=this._engine.canvas.gl;return c||b.positions&&b.uvs&&b.uvs[a]&&(c=SceneJS_math_buildTangents(b.positions,b.indices,b.uvs[a],this.positionDecodeMat,this.compressedUVs&&this.uvDecodeMats[a]),this._engine.stats.memory.tangents+=c.length*c.constructor.BYTES_PER_ELEMENT),c?(this.tangentBufs[a]=new SceneJS._webgl.ArrayBuffer(d,d.ARRAY_BUFFER,c,c.length,3,d.STATIC_DRAW),this.arrays.tangents[a]=!0,this.tangentBufs[a]):null},e.prototype.getPickPositions=function(){return this.pickPositionsBuf?this.pickPositionsBuf:(a(this),this.pickPositionsBuf)},e.prototype.getPickColors=function(){return this.pickColorsBuf?this.pickColorsBuf:(a(this),this.pickColorsBuf)},e.prototype.getKdTree=function(){return this.kdTree||this.buildKdTree(),this.kdTree},e.prototype.buildKdTree=function(){if(this.kdTreeDirty){var a=this.arrays.positions,c=this.arrays.indices;if(a){var d;d=c?c.length/3:a.length/9;for(var e=new Array(d),f=0;d>f;++f)e[f]=f;this.kdTree=b(e,c,a,this.positionDecodeMat,0,0),this.kdTreeDirty=!1}}};var f=vec3.create()}(),function(){"use strict";var a=SceneJS.PROPERTY_FLAGS,b=SceneJS.DEPTH_TEST_FLAGS,c=window.SceneJS_PropertiesCore=function(){this.type="properties",this.coreId=null,this.stateId=null,this.useCount=0,this.xrayParams=new Float32Array([.4,.8]),this.solidColor=new Float32Array([1,1,1]),this.colorModifiers=[],this.colorModRange=!1,this.opacityModifiers=[],this.opacityModRange=!1,this.name=null,this.flags=a.PICKING|a.ENABLED|a.REFLECTIVE|a.CCW|a.CLIPPING,this.transparent=!1,this.partiallyOpaque=!1,this.stochasticAlpha=!1,this.blend=!1,this.fragmentShaderHeader=null,this.fragmentShaderFooter=null,this.depthTest=b.ENABLED,this.hash="refl;;;;;;;"};c.prototype.getFlag=function(a){return!!(this.flags&a)},c.prototype.setFlag=function(a,b){this.flags=b?this.flags|a:this.flags&~a},c.prototype.resetTransparency=function(){var b=this.opacityModifiers,c=!1,d=!1,e=0;for(e=0;e<b.length;e++)if(b[e].value<1){c=!0;break}for(e=0;e<b.length;e++)if(b[e].range){d=!0;break}this.stochasticAlpha=this.getFlag(a.STOCHASTIC_ALPHA),this.transparent=this.getFlag(a.FORCE_TRANSPARENT)||!this.stochasticAlpha&&(c||this.getFlag(a.XRAY)),this.partiallyOpaque=this.getFlag(a.PARTIALLY_OPAQUE)||c&&d&&!this.getFlag(a.XRAY)}}(),function(){"use strict";var a=window.SceneJS_CoreFactory=function(){this._stateMap=new SceneJS_Map(null,SceneJS._baseStateId),this._cores={}};a.coreConstructors={geometry:SceneJS_GeometryCore,properties:SceneJS_PropertiesCore,"default":SceneJS_Core},a.prototype.getCore=function(b,c){var d=this._cores[b];d||(d=this._cores[b]={});var e;if(c&&(e=d[c]))return e.useCount++,e;var f=a.coreConstructors[b]||a.coreConstructors["default"];return e=new f(b),e.useCount=1,e.stateId=this._stateMap.addItem(e),e.coreId=void 0!=c&&null!=c?c:e.stateId,d[e.coreId]=e,e},a.prototype.hasCore=function(a,b){var c=this._cores[a];return c&&c[b]},a.prototype.putCore=function(a){if(0!=a.useCount&&--a.useCount<=0){var b=this._cores[a.type];delete b[a.coreId],this._stateMap.removeItem(a.stateId)}},a.prototype.webglRestored=function(){var a,b;for(var c in this._cores)if(this._cores.hasOwnProperty(c)&&(a=this._cores[c]))for(var d in a)a.hasOwnProperty(d)&&(b=a[d],b&&b.webglRestored&&b.webglRestored())}}(),function(){"use strict";SceneJS.Node=function(){},SceneJS.Node.prototype.constructor=SceneJS.Node,SceneJS.Node.prototype._construct=function(a,b,c,d){this._engine=a,this._core=b,this.coreId=b.coreId,this.id=c.id||c.nodeId||d,this.type=c.type||"node",this.data=c.data,this.parent=null,this.nodes=[],this.dirty=!1,this.disabled=!1,this.branchDirty=!1,this._init&&this._init(c)},SceneJS.Node.prototype.disable=function(){this.disabled||(this.disabled=!0,this._engine.branchDirty(this))},SceneJS.Node.prototype.enable=function(){this.disabled&&(this.disabled=!1,this._engine.branchDirty(this))},SceneJS.Node.prototype.log=function(){var a,b;switch(1==arguments.length?(a="info",b=arguments[0]):2==arguments.length&&(a=arguments[0],b=arguments[1]),a){case"warn":b="WARN;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+b;break;case"error":b="ERROR; [SceneJS.Node type="+this.type+", id="+this.id+"] : "+b;break;default:b="INFO;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+b}console[a]?console[a](b):console.log(b)},SceneJS.Node.prototype.getScene=function(){return this._engine.scene},SceneJS.Node.prototype.getCoreId=function(){return this._core.coreId},SceneJS.Node.prototype.getID=function(){return this.id},SceneJS.Node.prototype.getId=function(){return this.id},SceneJS.Node.prototype.getNodeId=function(){return this.id},SceneJS.Node.prototype.getType=function(){return this.type},SceneJS.Node.prototype.getData=function(){return this.data},SceneJS.Node.prototype.setData=function(a){return this.data=a,this},SceneJS.Node.prototype.getNumNodes=function(){return this.nodes.length},SceneJS.Node.prototype.getNodes=function(){return this.nodes.slice(0)},SceneJS.Node.prototype.getNodeAt=function(a){return 0>a||a>=this.nodes.length?null:this.nodes[a]},SceneJS.Node.prototype.getFirstNode=function(){return 0==this.nodes.length?null:this.nodes[0]},SceneJS.Node.prototype.getLastNode=function(){return 0==this.nodes.length?null:this.nodes[this.nodes.length-1]},SceneJS.Node.prototype.getNode=function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].id==a)return this.nodes[b];return null},SceneJS.Node.prototype.disconnectNodeAt=function(a){var b=this.nodes.splice(a,1);return b.length>0?(b[0]._disconnectFromScene(),b[0].parent=null,this._engine.branchDirty(this),b[0]):null},SceneJS.Node.prototype.disconnect=function(){if(this.parent){for(var a=0;a<this.parent.nodes.length;a++)if(this.parent.nodes[a]===this){var b=this.parent.disconnectNodeAt(a);return this._disconnectFromScene(),this.parent=null,b}this._disconnectFromScene(),this.parent=null}return null},SceneJS.Node.prototype._connectToScene=function(){for(var a=0,b=this.nodes.length;b>a;a++)this.nodes[a]._connectToScene()},SceneJS.Node.prototype._disconnectFromScene=function(){for(var a=0,b=this.nodes.length;b>a;a++)this.nodes[a]._disconnectFromScene()},SceneJS.Node.prototype.removeNodeAt=function(a){var b=this.disconnectNodeAt(a);b&&b.destroy()},SceneJS.Node.prototype.removeNode=function(a){if(!a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#removeNode - node argument undefined");if(!a._compile&&"string"==typeof a){var b=this._engine.findNode(a);if(!b)throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - node not found anywhere: '"+a+"'");a=b}if(a._compile)for(var c=0;c<this.nodes.length;c++)if(this.nodes[c]===a){var d=this.removeNodeAt(c);return d}throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - child node not found: "+(a._compile?": "+a.id:a))},SceneJS.Node.prototype.disconnectNodes=function(){for(var a=this.nodes.length,b=0;a>b;b++)this.nodes[b]._disconnectFromScene(),this.nodes[b].parent=null;var c=this.nodes;return this.nodes=[],this._engine.branchDirty(this),c},SceneJS.Node.prototype.removeNodes=function(){for(var a=this.disconnectNodes(),b=0;b<a.length;b++)a[b].destroy()},SceneJS.Node.prototype.splice=function(){var a,b;if(null==this.parent)return null;var c=this.parent,d=this.disconnectNodes();for(a=0,b=d.length;b>a;a++)d[a].parent=this.parent,d[a]._connectToScene();for(a=0,b=c.nodes.length;b>a;a++)if(c.nodes[a]===this)return c.nodes.splice.apply(c.nodes,[a,1].concat(d)),this.nodes=[],this._disconnectFromScene(),this.parent=null,this.destroy(),this._engine.branchDirty(c),c},SceneJS.Node.prototype.addNodes=function(a){if(!a)return null;for(var b=a.length-1;b>=0;b--)this.addNode(a[b])},SceneJS.Node.prototype.addNode=function(a,b){if(a=a||{},a._compile){if(null!=a.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(a),a.parent=this,a._connectToScene(),this._engine.branchDirty(a),b&&b(a),a}if("string"==typeof a){var c=this._engine.findNode(a);if(!c)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node not found: '"+a+"'");if(a=c,null!=a.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(a),a.parent=this,a._connectToScene(),this._engine.branchDirty(a),b&&b(a),a}if(a.type=a.type||"node","node"==a.type||this._engine.hasNodeType(a.type))return a=this._engine.createNode(a),this.nodes.push(a),a.parent=this,a._connectToScene(),this._engine.branchDirty(a),b&&b(a),a;var d=this;return this._engine.createNode(a,function(a){d.nodes.push(a),a.parent=d,a._connectToScene(),d._engine.branchDirty(a),b&&b(a)}),null},SceneJS.Node.prototype.insertNode=function(a,b){if(!a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is undefined");if(a._compile||(a=this._engine.createNode(a)),!a._compile)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is not a SceneJS.Node");if(null!=a.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is still attached to another parent");if(void 0===b||null===b)a.addNodes(this.disconnectNodes()),this.addNode(a);else{if(0>b)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node index out of range: -1");b>=this.nodes.length?this.nodes.push(a):this.nodes.splice(b,0,a)}return a.parent=this,a._connectToScene(),a},SceneJS.Node.prototype.mapNodes=function(a){if(a(this))return this;for(var b,c=0;c<this.nodes.length;c++)if(b=this.nodes[c].mapNodes(a))return b;return null},SceneJS.Node.prototype.getParent=function(){return this.parent},SceneJS.Node.prototype.getParentOfType=function(a){for(var b=this.parent;b&&b.type!=a;)b=b.parent;return b},SceneJS.Node.prototype.eachParent=function(a){if(!a)throw"SceneJS.Node.eachParent param 'fn' is null or undefined";for(var b=0,c=this;c.parent;){if(a.call(c.parent,b++)===!0)return c.parent;c=c.parent}return null},SceneJS.Node.prototype.hasNode=function(a){if(null===a||void 0===a)throw"SceneJS.Node.hasNode param 'node' is null or undefined";var b,c=typeof a;if("number"==c)b=this.getNodeAt(a);else{if("string"!=c)throw"SceneJS.Node.hasNode param 'node' should be either an index number or an ID string";b=this.getNode(a)}return void 0!=b&&null!=b},SceneJS.Node.prototype.node=function(a){if(null===a||void 0===a)throw"SceneJS.Node.node param 'node' is null or undefined";var b,c=typeof a;if("number"==c)b=this.getNodeAt(a);else{if("string"!=c)throw"SceneJS.Node.node param 'node' should be either an index number or an ID string";b=this.getNode(a)}if(!b)throw"SceneJS.Node.node - node not found: '"+a+"'";return b},SceneJS.Node.prototype.eachNode=function(a,b){if(!a)throw"SceneJS.Node.eachNode param 'fn' is null or undefined";if("function"!=typeof a)throw"SceneJS.Node.eachNode param 'fn' should be a function";var c;b=b||{};var d=0;return b.andSelf&&a.call(this,d++)===!0?this:(b.depthFirst||b.breadthFirst?b.depthFirst&&(c=this._iterateEachNodeDepthFirst(a,this,d,!1)):c=this._iterateEachNode(a,this,d),c?c:void 0)},SceneJS.Node.prototype.numNodes=function(){return this.nodes.length},SceneJS.Node.prototype._iterateEachNode=function(a,b,c){for(var d,e=b.nodes.length,f=0;e>f;f++)if(d=b.nodes[f],a.call(d,c++)===!0)return d;return null},SceneJS.Node.prototype._iterateEachNodeDepthFirst=function(a,b,c,d){if(d&&a.call(b,c++)===!0)return b;d=!0;for(var e,f=b.nodes.length,g=0;f>g;g++)if(e=this._iterateEachNodeDepthFirst(a,b.nodes[g],c,d))return e;return null},SceneJS.Node.prototype.findNodesByType=function(a,b){return this._findNodesByType(a,[],b)},SceneJS.Node.prototype._findNodesByType=function(a,b,c){var d;for(d=0;d<this.nodes.length;d++){var e=this.nodes[d];e.type==a&&b.push(e)}if(c)for(d=0;d<this.nodes.length;d++)this.nodes[d]._findNodesByType(a,b,c);return b},SceneJS.Node.prototype.findParentByType=function(a){for(var b=this.parent;b&&b.type!=a;)b=b.parent;return b},SceneJS.Node.prototype.getJSON=function(){return this},SceneJS.Node.prototype._compile=function(a){this.preCompile&&this.preCompile(),this._compileNodes(a),this.postCompile&&this.postCompile()},SceneJS.Node.prototype._compileNodes=function(a){for(var b,c=(!!this.onRendered,0),d=this.nodes.length;d>c;c++)b=this.nodes[c],b.branchDirty=b.branchDirty||this.branchDirty,(b.dirty||b.branchDirty||this._engine.sceneDirty)&&(b.disabled?b._compileNodes(a):b._compile(a),b.dirty=!1,b.branchDirty=!1)},SceneJS.Node.prototype.destroy=function(){if(!this.destroyed){if(this.parent)for(var a=this.parent.nodes,b=a.length,c=0;b>c;c++)if(a[c].id===this.id){a.splice(c,1);break}this._engine.scene.unpublish("nodes/"+this.id),this._destroyTree(),this._engine.display.objectListDirty=!0}return this},SceneJS.Node.prototype._destroyTree=function(){this.destroyed=!0,this._engine.destroyNode(this);for(var a,b=0,c=this.nodes.length;c>b;b++)a=this.nodes[b],this._engine.scene.unpublish("nodes/"+a.id),a._destroyTree()},SceneJS.Node.prototype._doDestroy=function(){return this._destroy&&this._destroy(),this}}(),function(){"use strict";var a=window.SceneJS_NodeFactory=function(){this.nodes=new SceneJS_Map({})};a.nodeTypes={},a.createNodeType=function(b){if(a.nodeTypes[b])throw"Node type already defined: "+b;var c=function(){SceneJS.Node.apply(this,arguments),this.type=b};return c.prototype=new SceneJS.Node,c.prototype.constructor=c,a.nodeTypes[b]=c,c},a.prototype.getNode=function(b,c,d){c.type=c.type||"node";var e;"node"===c.type?e=SceneJS.Node:(e=a.nodeTypes[c.type],e||(console.error("Unknown node type: "+c.type+" - can't create - making a SceneJS.Node by default"),e=SceneJS.Node));var f=new e,g=c.id||c.nodeId;return g?this.nodes.addItem(g,f):g=this.nodes.addItem(f),f._construct(b,d,c,g),f},a.prototype.putNode=function(a){this.nodes.removeItem(a.id)}}(),function(){"use strict";function a(a){var b="",c=0,d=a.colorModifiers.length;for(c=0;d>c;c++){var f=a.colorModifiers[c],g=f.applyTo,h=f.range,i=f.value;g===e.BRIGHTNESS?b+="b":g===e.CONTRAST?b+="c":g===e.SATURATION?b+="s":g===e.TINT&&(b+="t"),h&&(b+="r"),b+=i.isScalarFresnel?"sf":i.isColorFresnel?"cf":"nv"}return b}function b(a){var b="",c=0,d=a.opacityModifiers.length;for(c=0;d>c;c++){var e=a.opacityModifiers[c],f=e.range,g=e.value;b+=f?"r":"o",b+=g.isScalarFresnel?"sf":"nv"}return b}function c(c){return(c.getFlag(d.REFLECTIVE)?"refl":"")+";"+(c.getFlag(d.SKYBOX)?"sky":"")+";"+(c.getFlag(d.SOLID)?"s":"")+";"+(c.getFlag(d.ROUND_POINTS)?"rpt":"")+";"+(c.getFlag(d.PERSPECTIVE_POINTS)?"ppt":"")+";"+(c.getFlag(d.BILLBOARD)?"b":"")+";"+(c.getFlag(d.STOCHASTIC_ALPHA)?"sa":"")+";"+a(c)+";"+b(c)+";"+(c.fragmentShaderHeader||"")+";"+(c.fragmentShaderFooter||"")+";"}var d=SceneJS.PROPERTY_FLAGS,e=SceneJS.COLOR_MOD_FLAGS,f=SceneJS.DEPTH_TEST_FLAGS,g={saturation:e.SATURATION,brightness:e.BRIGHTNESS,contrast:e.CONTRAST,tintColor:e.TINT},h={enabled:f.ENABLED,disabled:f.DISABLED,alwaysPass:f.ALWAYS_PASS},i={};for(var j in h){var k=h[j];i[k]=j}var l=new SceneJS_PropertiesCore;l.stateId=SceneJS._baseStateId++;var m=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.properties=l,n=0}),SceneJS.Properties=SceneJS_NodeFactory.createNodeType("properties"),SceneJS.Properties.prototype._init=function(a){1==this._core.useCount&&a.properties&&this.setProperties(a.properties)},SceneJS.Properties.prototype.setProperties=function(a){var b=this._core;if(void 0!=a.picking&&(b.setFlag(d.PICKING,a.picking),this._engine.display.imageDirty=!0),void 0!=a.solidColor){var f=l.solidColor,i=a.solidColor;b.solidColor[0]=void 0!=i.r?i.r:f[0],b.solidColor[1]=void 0!=i.g?i.g:f[1],b.solidColor[2]=void 0!=i.b?i.b:f[2],this._engine.display.imageDirty=!0}if(void 0!=a.clipping&&(b.setFlag(d.CLIPPING,a.clipping),this._engine.branchDirty(this)),void 0!=a.enabled&&(b.setFlag(d.ENABLED,a.enabled),this._engine.display.objectListDirty=!0),void 0!=a.frontface&&(b.setFlag(d.CCW,"ccw"===a.frontface),this._engine.display.imageDirty=!0),void 0!=a.reflective&&(b.setFlag(d.REFLECTIVE,a.reflective),this._engine.branchDirty(this)),void 0!=a.solid&&(b.setFlag(d.SOLID,a.solid),this._engine.branchDirty(this)),void 0!=a.skybox&&(b.setFlag(d.SKYBOX,a.skybox),this._engine.branchDirty(this)),void 0!=a.billboard&&(b.setFlag(d.BILLBOARD,a.billboard),this._engine.branchDirty(this)),a.colorModifiers){var j,k;b.colorModifiers.length=a.colorModifiers.length,b.colorModRange=!1;for(var m=0,n=a.colorModifiers.length;n>m;++m){var o=a.colorModifiers[m];j=g[o.applyTo]||o.applyTo,k=o.value,k.isScalarFresnel||k.isColorFresnel||j===e.CONTRAST&&(k=o.value+1),b.colorModifiers[m]={applyTo:j,value:k,range:null},o.range&&(b.colorModRange=!0,b.colorModifiers[m].range={center:new Float32Array(o.range.center),radius:new Float32Array([o.range.minRadius,o.range.maxRadius-o.range.minRadius])})}}if(void 0!=a.name&&(b.name=a.name),void 0!=a.xray){var p=b.transparent;b.setFlag(d.XRAY,a.xray),b.resetTransparency(),b.transparent!==p&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(void 0!=a.glassFactor&&(b.xrayParams[0]=a.glassFactor,this._engine.display.imageDirty=!0),void 0!=a.murkiness&&(b.xrayParams[1]=a.murkiness,this._engine.display.imageDirty=!0),a.opacityModifiers){var k,q,p=b.transparent,r=a.opacityModifiers.length;b.opacityModifiers.length=r,b.opacityModRange=!1;for(var s=0;r>s;++s)q=a.opacityModifiers[s],k=q.value,b.opacityModifiers[s]={value:k,range:null},q.range&&(b.opacityModRange=!0,b.opacityModifiers[s].range={center:new Float32Array(q.range.center),radius:new Float32Array([q.range.minRadius,q.range.maxRadius-q.range.minRadius])});b.resetTransparency(),b.transparent!==p&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(void 0!=a.noDepthMask&&(b.setFlag(d.NO_DEPTH_MASK,a.noDepthMask),this._engine.display.imageDirty=!0),void 0!=a.partiallyOpaque){var t=b.partiallyOpaque;b.setFlag(d.PARTIALLY_OPAQUE,a.partiallyOpaque),b.resetTransparency(),b.partiallyOpaque!==t&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0}if(void 0!=a.forceTransparent){var p=b.transparent;b.setFlag(d.FORCE_TRANSPARENT,a.forceTransparent),b.resetTransparency(),b.transparent!==p&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(void 0!=a.stochasticAlpha){var p=b.transparent;b.setFlag(d.STOCHASTIC_ALPHA,a.stochasticAlpha),b.resetTransparency(),this._engine.branchDirty(this),this._engine.display.imageDirty=!0}void 0!=a.roundPoints&&(b.setFlag(d.ROUND_POINTS,a.roundPoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.perspectivePoints&&(b.setFlag(d.PERSPECTIVE_POINTS,a.perspectivePoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.fragmentShaderHeader&&(b.fragmentShaderHeader=a.fragmentShaderHeader,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.fragmentShaderFooter&&(b.fragmentShaderFooter=a.fragmentShaderFooter,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),void 0!=a.depthTest&&(b.depthTest=h[a.depthTest]||a.depthTest,this._engine.display.imageDirty=!0);var u=b.hash;return b.hash=c(b),b.hash!==u&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this},SceneJS.Properties.prototype.getProperties=function(){var a=this._core;return{picking:a.getFlag(d.PICKING),clipping:a.getFlag(d.CLIPPING),enabled:a.getFlag(d.ENABLED),frontface:a.getFlag(d.CCW)?"ccw":"cw",reflective:a.getFlag(d.REFLECTIVE),solid:a.getFlag(d.SOLID),solidColor:a.solidColor,skybox:a.getFlag(d.SKYBOX),billboard:a.getFlag(d.BILLBOARD),fullyTransparent:a.getFlag(d.FULLY_TRANSPARENT),roundPoints:a.getFlag(d.ROUND_POINTS),perspectivePoints:a.getFlag(d.PERSPECTIVE_POINTS),xray:a.getFlag(d.XRAY),glassFactor:a.xrayParams[0],murkiness:a.xrayParams[1],colorModifiers:a.colorModifiers,opacityModifier:a.opacityModifiers,pointPerspectiveDistance:a.pointPerspectiveDistance,fragmentShaderHeader:a.fragmentShaderHeader,
fragmentShaderFooter:a.fragmentShaderFooter,depthTest:i[a.depthTest]||"enabled"}},SceneJS.Properties.prototype.setPicking=function(a){return a=!!a,this._core.getFlag(d.PICKING)!==a&&(this._core.setFlag(d.PICKING,a),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getPicking=function(){return this._core.getFlag(d.PICKING)},SceneJS.Properties.prototype.setClipping=function(a){return this.setProperties({clipping:a}),this},SceneJS.Properties.prototype.getClipping=function(){return!!this.solidColor[3]},SceneJS.Properties.prototype.setEnabled=function(a){return this.setProperties({enabled:a})},SceneJS.Properties.prototype.getEnabled=function(){return this._core.getFlag(d.ENABLED)},SceneJS.Properties.prototype.setFrontface=function(a){var b="ccw"===a;return this._core.getFlag(d.CCW)!==b&&(this._core.setFlag(d.CCW,b),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFrontface=function(){return this._core.getFlag(d.CCW)?"ccw":"cw"},SceneJS.Properties.prototype.setReflective=function(a){return a=!!a,this._core.getFlag(d.REFLECTIVE)!=a&&(this._core.setFlag(d.REFLECTIVE,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getReflective=function(){return this._core.getFlag(d.REFLECTIVE)},SceneJS.Properties.prototype.setSolid=function(a){return a=!!a,this._core.getFlag(d.SOLID)!=a&&(this._core.setFlag(d.SOLID,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSolid=function(){return this._core.getFlag(d.SOLID)},SceneJS.Properties.prototype.setSolidColor=function(a){return this.setProperties({solidColor:a}),this},SceneJS.Properties.prototype.getSolidColor=function(){return{r:this._core.solidColor[0],g:this._core.solidColor[1],b:this._core.solidColor[2]}},SceneJS.Properties.prototype.setSkybox=function(a){return a=!!a,this._core.getFlag(d.SKYBOX)!=a&&(this._core.setFlag(d.SKYBOX,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSkybox=function(){return this._core.getFlag(d.SKYBOX)},SceneJS.Properties.prototype.setName=function(a){this._core.name=a},SceneJS.Properties.prototype.getName=function(){return this._core.name},SceneJS.Properties.prototype.setFullyTransparent=function(a){return a=!!a,this._core.getFlag(d.FULLY_TRANSPARENT)!==a&&(this._core.setFlag(d.FULLY_TRANSPARENT,a),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFullyTransparent=function(){return this._core.getFlag(d.FULLY_TRANSPARENT)},SceneJS.Properties.prototype.setRoundPoints=function(a){return a=!!a,this._core.getFlag(d.ROUND_POINTS)!=a&&(this._core.setFlag(d.ROUND_POINTS,a),this._core.hash=c(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getRoundPoints=function(){return this._core.getFlag(d.ROUND_POINTS)},SceneJS.Properties.prototype._compile=function(a){this._engine.display.properties=m[n++]=this._core,this._compileNodes(a),this._engine.display.properties=--n>0?m[n-1]:l,m[n]=null}}(),function(){"use strict";function a(a){return function(){a._core.tangentBufs=null,a._core.pickPositionsBuf=null,a._core.arrays.tangents&&(a._core.arrays.tangents=[]),a._buildNodeCore(a._engine.canvas.gl,a._core)}}function b(a,b){{var c=a.STATIC_DRAW,d=b.arrays;b.compressedPositions||b.compressedNormals||b.compressedUVs}if(b.transparent=!!d.colors,d.positions&&(b.vertexBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.positions,d.positions.length,3,c)),b.compressedNormals?b.normalBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.normals,d.normals.length,2,c,!0):d.normals&&(b.normalBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.normals,d.normals.length,3,c)),d.uvs){var e,f,g,h=d.uvs;for(b.uvBufs=[],e=0,f=h.length;f>e;e++)g=d.uvs[e],g.length>0&&b.uvBufs.push(new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,g,g.length,2,c))}d.colors&&(b.colorBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.colors,d.colors.length,4,c,!0)),d.indices&&(b.indexBuf=new SceneJS._webgl.ArrayBuffer(a,a.ELEMENT_ARRAY_BUFFER,d.indices,d.indices.length,1,c)),d.pointScaleRotations&&(b.pointScaleRotationBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.pointScaleRotations,d.pointScaleRotations.length,2,c,!0)),d.pointUVTranslates&&(b.pointUVTranslateBuf=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,d.pointUVTranslates,d.pointUVTranslates.length,2,c,!0))}SceneJS.Geometry=SceneJS_NodeFactory.createNodeType("geometry"),SceneJS.Geometry.prototype._init=function(b){1==this._core.useCount&&(this._initNodeCore(b,{origin:b.origin,scale:b.scale,autoNormals:"auto"==b.normals}),this._buildNodeCore(this._engine.canvas.gl,this._core),this._boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this._boundaryDirty=!0,this.backfaces=b.backfaces!==!1,this.addBlend=b.addBlend===!0,this.layer=b.layer||0,this.onObjectCreate=b.onObjectCreate||null,this._core.webglRestored=a(this),this._engine.stats.geometry.meshes++)},SceneJS.Geometry.prototype._initNodeCore=function(a,b){b=b||{};var c=a.primitive||"triangles",d=this._core,e=SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_element_index_uint?Uint32Array:Uint16Array;d._engine=this._engine,d.primitive=this._getPrimitiveType(c),d.primitiveName=c,d.pointSize=a.pointSize||1,d.pointUVScale=a.pointUVScale||new Float32Array([1,1]),d.compressedPositions=!1,d.compressedNormals=!1,d.compressedUVs=!1,a.normals&&"triangles"==c&&("auto"===a.normals||a.normals===!0)&&a.positions&&a.indices&&this._buildNormals(a),d.arrays={},a.positions&&(a.positionDecodeMat?(d.arrays.positions=a.positions,d.positionDecodeMat=a.positionDecodeMat,d.compressedPositions=!0):(a.positions.constructor!=Float32Array&&(a.positions=new Float32Array(a.positions)),(b.scale||b.origin)&&this._applyOptions(a.positions,b),d.arrays.positions=a.positions),this._engine.stats.geometry.vertices+=a.positions.length/3,this._engine.stats.memory.positions+=a.positions.length*a.positions.constructor.BYTES_PER_ELEMENT),a.normals&&(a.normals.constructor==Int8Array?(d.arrays.normals=a.normals,d.compressedNormals=!0):(a.normals.constructor!=Float32Array&&(a.normals=new Float32Array(a.normals)),d.arrays.normals=a.normals),this._engine.stats.memory.normals+=a.normals.length*a.normals.constructor.BYTES_PER_ELEMENT);var f,g;if(a.uvDecodeMats){f=a.uvs;for(var h=0,i=f.length;i>h;h++)g=f[h],g.constructor!=Uint16Array&&(f[h]=new Uint16Array(f[h])),this._engine.stats.memory.uvs+=g.length*g.constructor.BYTES_PER_ELEMENT;d.arrays.uvs=f,d.uvDecodeMats=a.uvDecodeMats,d.compressedUVs=!0}else if(a.uvs){f=a.uvs;for(var h=0,i=f.length;i>h;h++)g=f[h],g.constructor!=Float32Array&&(f[h]=new Float32Array(f[h])),this._engine.stats.memory.uvs+=g.length*g.constructor.BYTES_PER_ELEMENT;d.arrays.uvs=f}a.uv&&(a.uv.constructor!=Float32Array&&(a.uv=new Float32Array(a.uv)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[0]=a.uv,this._engine.stats.memory.uvs+=a.uv.length*a.uv.constructor.BYTES_PER_ELEMENT),a.uv1&&(a.uv1.constructor!=Float32Array&&(a.uv1=new Float32Array(a.uv1)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[1]=a.uv1,this._engine.stats.memory.uvs+=a.uv1.length*a.uv1.constructor.BYTES_PER_ELEMENT),a.uv2&&(a.uv2.constructor!=Float32Array&&(a.uv2=new Float32Array(a.uv2)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[2]=a.uv2,this._engine.stats.memory.uvs+=a.uv2.length*a.uv2.constructor.BYTES_PER_ELEMENT),a.uv3&&(a.uv3.constructor!=Float32Array&&(a.uv3=new Float32Array(a.uv3)),d.arrays.uvs||(d.arrays.uvs=[]),d.arrays.uvs[3]=a.uv3,this._engine.stats.memory.uvs+=a.uv3.length*a.uv3.constructor.BYTES_PER_ELEMENT),d.arrays.normals&&d.arrays.uvs&&(d.arrays.tangents=[]),a.colors&&(a.colors.constructor!=Uint8Array&&(a.colors=new Uint8Array(a.colors)),d.arrays.colors=a.colors,this._engine.stats.memory.colors+=a.colors.length*a.colors.constructor.BYTES_PER_ELEMENT),a.indices&&(a.indices.constructor!=Uint8Array&&a.indices.constructor!=Uint16Array&&a.indices.constructor!=Uint32Array&&(a.indices=new e(a.indices)),d.arrays.indices=a.indices,this._engine.stats.geometry.triangles+=a.indices.length/3,this._engine.stats.memory.indices+=a.indices.length*a.indices.constructor.BYTES_PER_ELEMENT),a.pointScaleRotations&&(a.pointScaleRotations.constructor!=Float32Array&&(a.pointScaleRotations=new Float32Array(a.pointScaleRotations)),d.arrays.pointScaleRotations=a.pointScaleRotations,this._engine.stats.memory.pointScaleRotations+=a.pointScaleRotations.length*a.pointScaleRotations.constructor.BYTES_PER_ELEMENT),a.pointUVTranslates&&(a.pointUVTranslates.constructor!=Float32Array&&(a.pointUVTranslates=new Float32Array(a.pointUVTranslates)),d.arrays.pointUVTranslates=a.pointUVTranslates,this._engine.stats.memory.pointUVTranslates+=a.pointUVTranslates.length*a.pointUVTranslates.constructor.BYTES_PER_ELEMENT)},SceneJS.Geometry.prototype._getPrimitiveType=function(a){var b=this._engine.canvas.gl;switch(a){case"points":return b.POINTS;case"lines":return b.LINES;case"line-loop":return b.LINE_LOOP;case"line-strip":return b.LINE_STRIP;case"triangles":return b.TRIANGLES;case"triangle-strip":return b.TRIANGLE_STRIP;case"triangle-fan":return b.TRIANGLE_FAN;default:throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"geometry primitive unsupported: '"+a+"' - supported types are: 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'")}},SceneJS.Geometry.prototype._applyOptions=function(a,b){if(b.scale)for(var c=void 0!=b.scale.x?b.scale.x:1,d=void 0!=b.scale.y?b.scale.y:1,e=void 0!=b.scale.z?b.scale.z:1,f=0,g=a.length;g>f;f+=3)a[f]*=c,a[f+1]*=d,a[f+2]*=e;if(b.origin)for(var h=void 0!=b.origin.x?b.origin.x:0,i=void 0!=b.origin.y?b.origin.y:0,j=void 0!=b.origin.z?b.origin.z:0,f=0,g=a.length;g>f;f+=3)a[f]-=h,a[f+1]-=i,a[f+2]-=j;return a};var c=function(a){if(a.vertexBuf&&(a.vertexBuf.destroy(),a.vertexBuf=null),a.normalBuf&&(a.normalBuf.destroy(),a.normalBuf=null),a.uvBufs){for(var b,c=a.uvBufs,d=0,e=c.length;e>d;d++)b=c[d],b&&b.destroy();a.uvBufs=null}if(a.colorBuf&&(a.colorBuf.destroy(),a.colorBuf=null),a.pointScaleRotationBuf&&(a.pointScaleRotationBuf.destroy(),a.pointScaleRotationBuf=null),a.pointUVTranslateBuf&&(a.pointUVTranslateBuf.destroy(),a.pointUVTranslateBuf=null),a.tangentBufs){for(var f,g=a.tangentBufs,h=0,i=g.length;i>h;h++)f=g[h],f&&f.destroy();a.tangentBufs=null}a.indexBuf&&(a.indexBuf.destroy(),a.indexBuf=null)};SceneJS.Geometry.prototype._buildNodeCore=function(a,d){try{b(a,d)}catch(e){throw c(d),SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate geometry: "+e)}},SceneJS.Geometry.prototype._updateArray=function(a,b,c){var d=a.length,e=b.length;e+c>d&&(e-=e+c-d);for(var f=c,g=0;e>g;f++,g++)a[f]=b[g]},SceneJS.Geometry.prototype._buildNormals=function(a){for(var b,c,d,e,f,g,h=a.positions,i=a.indices,j=new Array(h.length/3),k=0,l=i.length-3;l>k;k+=3){b=i[k+0],c=i[k+1],d=i[k+2],e=[h[3*b+0],h[3*b+1],h[3*b+2]],f=[h[3*c+0],h[3*c+1],h[3*c+2]],g=[h[3*d+0],h[3*d+1],h[3*d+2]],f=vec4.subtract(vec4.create(),f,e),g=vec4.subtract(vec4.create(),g,e);var m=vec4.normalize(vec4.create(),SceneJS_math_cross3Vec4(f,g,[0,0,0,0]));j[b]||(j[b]=[]),j[c]||(j[c]=[]),j[d]||(j[d]=[]),j[b].push(m),j[c].push(m),j[d].push(m)}for(var n=new Float32Array(h.length),k=0,l=j.length;l>k;k++){var o=j[k];if(o){for(var p=o.length,q=0,r=0,s=0,t=0;p>t;t++)q+=o[t][0],r+=o[t][1],s+=o[t][2];n[3*k+0]=q/p,n[3*k+1]=r/p,n[3*k+2]=s/p}}a.normals=n,this._engine.stats.memory.normals+=n.length/3},SceneJS.Geometry.prototype.setSource=function(a){this._sourceConfigs=a;var b=this._source;b&&b.configure&&b.configure(a)},SceneJS.Geometry.prototype.getSource=function(){return this._sourceConfigs||{}},SceneJS.Geometry.prototype.getBackfaces=function(){return this.backfaces},SceneJS.Geometry.prototype.setBackfaces=function(a){this.backfaces=a;var b=this.getObject();b&&(b.backfaces=a),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getAddBlend=function(){return this.addBlend},SceneJS.Geometry.prototype.setAddBlend=function(a){this.addBlend=a;var b=this.getObject();b&&(b.addBlend=a),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getLayer=function(){return this.layer},SceneJS.Geometry.prototype.setLayer=function(a){this.layer=a;var b=this.getObject();b&&(b.layer=a),this._engine.display.objectListDirty=!0},SceneJS.Geometry.prototype.setPositions=function(a){if(a&&this._core.vertexBuf){this._boundaryDirty=!0;var b=this._core;b.vertexBuf.bind(),b.vertexBuf.setData(a),b.arrays.positions.set(a),b.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPositions=function(){return this._core.arrays?this._core.arrays.positions:null},SceneJS.Geometry.prototype.getPositionDecodeMat=function(){return this._core.positionDecodeMat||null},SceneJS.Geometry.prototype.setNormals=function(a){if(a&&this._core.normalBuf){var b=this._core;b.normalBuf.bind(),b.normalBuf.setData(a),b.arrays.normals.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getNormals=function(){return this._core.arrays?this._core.arrays.normals:null},SceneJS.Geometry.prototype.setColors=function(a){if(a&&this._core.colorBuf){var b=this._core;b.colorBuf.bind(),b.colorBuf.setData(a),b.arrays.colors.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getColors=function(){return this._core.arrays?this._core.arrays.colors:null},SceneJS.Geometry.prototype.setIndices=function(a){if(a&&this._core.indexBuf){this._boundaryDirty=!0;var b=this._core;b.indexBuf.bind(),a.constructor!=b.arrays.indices.constructor&&(a=new b.arrays.indices.constructor(a)),b.indexBuf.setData(a),b.arrays.indices.set(a),b.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getIndices=function(){return this._core.arrays?this._core.arrays.indices:null},SceneJS.Geometry.prototype.getUVs=function(){return this._core.arrays?this._core.arrays.uvs:null},SceneJS.Geometry.prototype.getUV=function(){return this._core.arrays?this._core.arrays.uvs[0]:null},SceneJS.Geometry.prototype.getUVDecodeMat=function(a){return this._core.uvDecodeMats[a||0]||null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[1]:null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[2]:null},SceneJS.Geometry.prototype.getUv3=function(){return this._core.arrays?this._core.arrays.uvs[3]:null},SceneJS.Geometry.prototype.setUV=function(a,b){if(b&&this._core.uvBufs&&this._core.uvBufs[a]){var c=this._core;c.uvBufs[a].bind(),c.uvBufs[a].setData(b),c.arrays.uvs[a].set(b),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.hasCompressedPositions=function(){return!!this._core.compressedPositions},SceneJS.Geometry.prototype.hasCompressedNormals=function(){return!!this._core.compressedNormals},SceneJS.Geometry.prototype.hasCompressedUVs=function(){return!!this._core.compressedUVs},SceneJS.Geometry.prototype.getPrimitive=function(){return this.primitive},SceneJS.Geometry.prototype.getPointSize=function(){return this._core.pointSize},SceneJS.Geometry.prototype.setPointSize=function(a){a&&this._core.pointSize!==a&&(this._core.pointSize=a,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.getPointUVScale=function(){return this._core.pointUVScale},SceneJS.Geometry.prototype.setPointUVScale=function(a){a&&this._core.pointUVScale!==a&&(this._core.pointUVScale=a,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.setPointScaleRotations=function(a){if(a&&this._core.pointScaleRotationBuf){var b=this._core;b.pointScaleRotationBuf.bind(),b.pointScaleRotationBuf.setData(a),b.arrays.pointScaleRotations.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointScaleRotations=function(){return this._core.arrays?this._core.arrays.pointScaleRotations:null},SceneJS.Geometry.prototype.setPointUVTranslates=function(a){if(a&&this._core.pointUVTranslateBuf){var b=this._core;b.pointUVTranslateBuf.bind(),b.pointUVTranslateBuf.setData(a),b.arrays.pointUVTranslates.set(a),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointUVTranslates=function(){return this._core.arrays?this._core.arrays.pointUVTranslates:null},SceneJS.Geometry.prototype.getKdTree=function(){var a=this.getObject();return a?a.getKdTree():this._core.getKdTree()},SceneJS.Geometry.prototype.getObject=function(){return this._engine.display._objects[this.id]||null},SceneJS.Geometry.prototype.getBoundary=function(){if(!this._boundaryDirty)return this._boundary;var a=this._core.arrays;if(!a)return null;var b=a.positions;if(!b)return null;this._boundary.xmin=Number.POSITIVE_INFINITY,this._boundary.ymin=Number.POSITIVE_INFINITY,this._boundary.zmin=Number.POSITIVE_INFINITY,this._boundary.xmax=Number.NEGATIVE_INFINITY,this._boundary.ymax=Number.NEGATIVE_INFINITY,this._boundary.zmax=Number.NEGATIVE_INFINITY;for(var c,d,e,f=0,g=b.length-2;g>f;f+=3)c=b[f],d=b[f+1],e=b[f+2],c<this._boundary.xmin&&(this._boundary.xmin=c),d<this._boundary.ymin&&(this._boundary.ymin=d),e<this._boundary.zmin&&(this._boundary.zmin=e),c>this._boundary.xmax&&(this._boundary.xmax=c),d>this._boundary.ymax&&(this._boundary.ymax=d),e>this._boundary.zmax&&(this._boundary.zmax=e);return this._boundaryDirty=!1,this._boundary},SceneJS.Geometry.prototype._compile=function(a){if(this._core._loading)return void this._compileNodes(a);var b=this._core,c=[b.normalBuf?"t":"f",b.arrays&&b.arrays.tangents?"t":"f",b.colorBuf?"t":"f",b.primitive,b.compressedPositions?"t":"f",b.compressedNormals?"t":"f",b.compressedUVs?"t":"f",b.pointScaleRotationBuf?"t":"f",b.pointUVTranslateBuf?"t":"f"];c.push(";uvs");var d=b.uvBufs;if(d)for(var e=0,f=d.length;f>e;e++)c.push(d[e]?"t":"f");b.hash=c.join(""),b.stateId=this._core.stateId,b.type="geometry",this._engine.display.geometry=b,SceneJS_events.fireEvent(SceneJS_events.OBJECT_COMPILING,{display:this._engine.display}),this._engine.display.buildObject(this.id,{backfaces:this.backfaces,addBlend:this.addBlend,layer:this.layer}),this.onObjectCreate&&this.onObjectCreate(this.getObject()),this._compileNodes(a)},SceneJS.Geometry.prototype._destroy=function(){this._engine.display.removeObject(this.id),1==this._core.useCount&&(this._destroyNodeCore(),this._source&&this._source.destroy&&this._source.destroy(),this._engine.stats.geometry.meshes--)},SceneJS.Geometry.prototype._disconnectFromScene=function(){this._engine.display.removeObject(this.id)},SceneJS.Geometry.prototype._destroyNodeCore=function(){document.getElementById(this._engine.canvas.canvasId)&&c(this._core);var a=this._core.arrays;a.positions&&(this._engine.stats.memory.positions-=a.positions.length/3),a.normals&&(this._engine.stats.memory.normals-=a.normals.length/3),a.colors&&(this._engine.stats.memory.colors-=a.colors.length/3),a.uvs&&a.uvs.length>0&&(this._engine.stats.memory.uvs-=a.uvs.length*(a.uvs[0].length/2)),a.indices&&(this._engine.stats.memory.indices-=a.indices.length),a.pointScaleRotations&&(this._engine.stats.memory.pointScaleRotations-=a.pointScaleRotations.length/2),a.pointUVTranslates&&(this._engine.stats.memory.pointUVTranslates-=a.pointUVTranslates.length/2)}}(),function(){"use strict";SceneJS.Library=SceneJS_NodeFactory.createNodeType("library"),SceneJS.Library.prototype._compile=function(){}}(),function(){"use strict";SceneJS.Material=SceneJS_NodeFactory.createNodeType("material"),SceneJS.Material.PHONG=0,SceneJS.Material.METALLIC=1;var a={type:"material",stateId:SceneJS._baseStateId++,workflow:SceneJS.Material.PHONG,baseColor:new Float32Array([1,1,1,1]),specularColor:new Float32Array([1,1,1,1]),emitColor:new Float32Array([1,1,1,0]),shine:70,metalRoughspecularf0:new Float32Array([1,1,.1,0])},b=[],c=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){b.engine.display.material=a,c=0}),SceneJS.Material.prototype._init=function(b){1==this._core.useCount&&(this._core.baseColor=new Float32Array(a.baseColor),this._core.specularColor=new Float32Array(a.specularColor),this._core.emitColor=new Float32Array(a.emitColor),this._core.shine=a.shine,this._core.metalRoughspecularf0=new Float32Array(a.metalRoughspecularf0),(b.color||b.baseColor)&&this.setBaseColor(b.color||b.baseColor),b.specularColor&&this.setSpecularColor(b.specularColor),b.emitColor&&this.setEmitColor(b.emitColor),void 0!=b.specular&&this.setSpecular(b.specular),void 0!=b.shine&&this.setShine(b.shine),void 0!=b.emit&&this.setEmit(b.emit),void 0!=b.alpha&&this.setAlpha(b.alpha),void 0!=b.metallic&&this.setMetallic(b.metallic),void 0!=b.roughness&&this.setRoughness(b.roughness),void 0!=b.specularf0&&this.setspecularf0(b.specularf0),this.setWorkflow(b.workflow))},SceneJS.Material.prototype.setWorkflow=function(a){return a=a||"phong","phong"===a?this._core.workflow=SceneJS.Material.PHONG:"metallic"===a?this._core.workflow=SceneJS.Material.METALLIC:(console.error("Unsupported SceneJS material workflow: "+a),this._core.workflow=SceneJS.Material.PHONG),this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getWorkflow=function(){switch(this._core.workflow){case SceneJS.Material.PHONG:return"phong";case SceneJS.Material.METALLIC:return"metallic"}},SceneJS.Material.prototype.setBaseColor=function(b){var c=a.baseColor;return this._core.baseColor[0]=void 0!=b.r?b.r:c[0],this._core.baseColor[1]=void 0!=b.g?b.g:c[1],this._core.baseColor[2]=void 0!=b.b?b.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.setColor=SceneJS.Material.prototype.setBaseColor,SceneJS.Material.prototype.getBaseColor=function(){return{r:this._core.baseColor[0],g:this._core.baseColor[1],b:this._core.baseColor[2]}},SceneJS.Material.prototype.getColor=SceneJS.Material.prototype.getBaseColor,SceneJS.Material.prototype.setSpecularColor=function(b){var c=a.specularColor;return this._core.specularColor[0]=void 0!=b.r?b.r:c[0],this._core.specularColor[1]=void 0!=b.g?b.g:c[1],this._core.specularColor[2]=void 0!=b.b?b.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecularColor=function(){return{r:this._core.specularColor[0],g:this._core.specularColor[1],b:this._core.specularColor[2]}},SceneJS.Material.prototype.setEmitColor=function(b){var c=a.emitColor;return this._core.emitColor[0]=void 0!=b.r?b.r:c[0],this._core.emitColor[1]=void 0!=b.g?b.g:c[1],this._core.emitColor[2]=void 0!=b.b?b.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmitColor=function(){return{r:this._core.emitColor[0],g:this._core.emitColor[1],b:this._core.emitColor[2]}},SceneJS.Material.prototype.setSpecular=function(b){return this._core.specularColor[3]=void 0!=b&&null!=b?b:a.specularColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecular=function(){return this._core.specularColor[3]},SceneJS.Material.prototype.setShine=function(b){return this._core.shine=void 0!=b?b:a.shine,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getShine=function(){return this._core.shine},SceneJS.Material.prototype.setEmit=function(b){return this._core.emitColor[3]=void 0!=b?b:a.emitColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmit=function(){return this._core.emitColor[3]},SceneJS.Material.prototype.setAlpha=function(b){var c=this._core.baseColor[3]<1;return this._core.baseColor[3]=void 0!=b?b:a.baseColor[3],this._core.transparent=this._core.baseColor[3]<1,this._engine.display.imageDirty=!0,c!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this},SceneJS.Material.prototype.getAlpha=function(){return this._core.baseColor[3]},SceneJS.Material.prototype.setMetallic=function(b){return this._core.metalRoughspecularf0[0]=void 0!=b?b:a.metalRoughspecularf0[0],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getMetallic=function(){return this._core.metalRoughspecularf0[0]},SceneJS.Material.prototype.setRoughness=function(b){return this._core.metalRoughspecularf0[1]=void 0!=b?b:a.metalRoughspecularf0[1],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getRoughness=function(){return this._core.metalRoughspecularf0[1]},SceneJS.Material.prototype.setspecularf0=function(b){return this._core.metalRoughspecularf0[2]=void 0!=b?b:a.metalRoughspecularf0[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getspecularf0=function(){return this._core.metalRoughspecularf0[2]},SceneJS.Material.prototype._compile=function(d){this._engine.display.material=b[c++]=this._core,this._compileNodes(d),this._engine.display.material=--c>0?b[c-1]:a,b[c]=null}}(),function(){"use strict";function a(a,c){var d=c.targets||[];if(d.length<2)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node should have at least two targets");var e=c.keys||[];if(e.length!=d.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node mismatch in number of keys and targets");var f=a._core,g=a._engine.canvas.gl,h=g.STATIC_DRAW;f.keys=e,f.targets=[],f.key1=0,f.key2=1;for(var i,j,k,l,m,n=0,o=d.length;o>n;n++)m=d[n],!i&&m.positions&&(i=m.positions),!j&&m.normals&&(j=m.normals),!k&&m.uv&&(k=m.uv),!l&&m.uv2&&(l=m.uv2);for(var p,q,n=0,o=d.length;o>n;n++)m=d[n],p={},q=m.positions||i,q&&(m.positionDecodeMat?(p.positions=q,p.positionDecodeMat=m.positionDecodeMat,f.compressedPositions=!0):p.positions=q.constructor==Float32Array?q:new Float32Array(q),p.vertexBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.positions,q.length,3,h),i=q,a._engine.stats.memory.morphPositions+=p.positions.length*p.positions.constructor.BYTES_PER_ELEMENT),q=m.normals||j,q&&(q.constructor==Int8Array?(p.normals=q,f.compressedNormals=!0,p.normalBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.normals,q.length,2,h,!0)):(p.normals=q.constructor==Float32Array?q:new Float32Array(q),p.normalBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.normals,q.length,3,h)),j=q,a._engine.stats.memory.morphNormals+=p.normals.length*p.normals.constructor.BYTES_PER_ELEMENT),q=m.uv||k,q&&(p.uv=q.constructor==Float32Array?q:new Float32Array(q),p.uvBuf=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.uv,q.length,2,h),k=q),q=m.uv2||l,q&&(p.uv2=q.constructor==Float32Array?q:new Float32Array(q),p.uvBuf2=new SceneJS._webgl.ArrayBuffer(g,g.ARRAY_BUFFER,p.uv2,q.length,2,h),l=q),f.targets.push(p);f.kdTree=null,f.kdTreeDirty=!0,f.getKdTree=function(a){if(!this.kdTreeDirty)return this.kdTree;for(var c=a.length/3,d=new Array(c),e=0;c>e;++e)d[e]=e;return this.kdTree=b(d,a,this.targets,0,0),this.kdTreeDirty=!1,this.kdTree},a._pickPositionsDirty=!0}function b(a,e,f,g,i){var j=vec3.create(),k=vec3.create(),l={triangles:null,left:null,right:null,bb:{min:j,max:k}};j[0]=j[1]=j[2]=Number.POSITIVE_INFINITY,k[0]=k[1]=k[2]=Number.NEGATIVE_INFINITY;var m,n,o=f.length;for(m=0,n=a.length;n>m;++m)for(var p=3*a[m],q=0;3>q;++q)for(var r=3*e[p+q],s=0;o>s;++s){var t=f[s].positions,u=f[s].positionDecodeMat;h[0]=t[r],h[1]=t[r+1],h[2]=t[r+2],u&&SceneJS_math_decompressPosition(h,h,u),h[0]<j[0]&&(j[0]=h[0]),h[0]>k[0]&&(k[0]=h[0]),h[1]<j[1]&&(j[1]=h[1]),h[1]>k[1]&&(k[1]=h[1]),h[2]<j[2]&&(j[2]=h[2]),h[2]>k[2]&&(k[2]=h[2])}if(i>c)return l.triangles=a,l;var v=(j[g]+k[g])/2,w=new Array(a.length),x=0,y=new Array(a.length),z=0;for(m=0,n=a.length;n>m;++m){for(var p=3*a[m],A=e[p],B=e[p+1],C=e[p+2],D=3*A,E=3*B,F=3*C,G=!0,s=0;o>s;++s){var t=f[s].positions,u=f[s].positionDecodeMat,H=t[D+g],I=t[E+g],J=t[F+g];if(u){var K=u[5*g],L=u[g+12];H=H*K+L,I=I*K+L,J=J*K+L}if(v>H||v>I||v>J){G=!1;break}}G?y[z++]=a[m]:w[x++]=a[m]}return d>x||d>z?(l.triangles=a,l):(w.length=x,y.length=z,l.left=b(w,e,f,(g+1)%3,i+1),l.right=b(y,e,f,(g+1)%3,i+1),l)}var c=SceneJS.KD_TREE_MAX_DEPTH,d=SceneJS.KD_TREE_MIN_TRIANGLES,e={type:"morphGeometry",stateId:SceneJS._baseStateId++,hash:"",morph:null},f=[],g=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.morphGeometry=e,g=0}),SceneJS.MorphGeometry=SceneJS_NodeFactory.createNodeType("morphGeometry"),SceneJS.MorphGeometry.prototype._init=function(a){if(1==this._core.useCount){this._pickPositionsDirty=!0,this._buildNodeCore(a),this._core.webglRestored=function(){};var b=this;this._core.getPickPositions=function(a,c){return b._pickPositionsDirty&&b._buildPickPositions(c),b._core.targets[a].pickPositionsBuf},this._core.getTangents=function(a,c,d,e,f){var g=b._core,h=g.targets[a];if(h.tangentBuf)return h.tangentBuf;var i=h.positions,e=h.positionDecodeMat||e;if(d=h.uv||d,i&&c&&d){var j=b._engine.canvas.gl,k=SceneJS_math_buildTangents(i,c,d,e,f);h.tangents=k;var l=j.STATIC_DRAW;return h.tangentBuf=new SceneJS._webgl.ArrayBuffer(j,j.ARRAY_BUFFER,k,k.length,3,l),h.tangentBuf}},this.setFactor(a.factor)}this._core.factor=a.factor||0,this._core.clamp=!!a.clamp},SceneJS.MorphGeometry.prototype._buildNodeCore=function(b){try{a(this,b)}catch(c){for(var d=0,e=this._core.targets.length;e>d;d++)target=core.targets[d],target.vertexBuf&&target.vertexBuf.destroy(),target.normalBuf&&target.normalBuf.destroy(),target.uvBuf&&target.uvBuf.destroy(),target.uvBuf2&&target.uvBuf2.destroy();throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate VBO(s) for morphGeometry: "+c)}},SceneJS.MorphGeometry.prototype._buildPickPositions=function(a){for(var b,c=this._core,d=null,e=this._engine.canvas.gl,f=e.STATIC_DRAW,g=0,h=c.targets.length;h>g;g++)d=c.targets[g],d.positions&&(d.pickPositionsBuf&&(d.pickPositionsBuf.destroy(),d.pickPositionsBuf=null),b=SceneJS_math_getPickPositions(d.positions,a),d.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,b,b.length,3,f));this._pickPositionsDirty=!1},SceneJS.MorphGeometry.prototype.setFactor=function(a){a=a||0;var b=this._core,c=b.keys,d=b.key1,e=b.key2,f=b.factor;if(a<c[0])d=0,e=1;else if(a>c[c.length-1])d=c.length-2,e=d+1;else{for(;c[d]>a;)d--,e--;for(;c[e]<a;)d++,e++}var g=d!=b.key1;b.factor=(a-c[d])/(c[e]-c[d]),this._factor=a;var h=g||f!=b.factor;if(b.key1=d,b.key2=e,h){var i=this.getCurrentFrame();this.onUpdate&&this.onUpdate(i),g&&this.onFrameUpdate&&this.onFrameUpdate(i)}this._engine.display.imageDirty=!0},SceneJS.MorphGeometry.prototype.getFactor=function(){return this._factor},SceneJS.MorphGeometry.prototype.getKeys=function(){return this._core.keys},SceneJS.MorphGeometry.prototype.getTargets=function(){return this._core.targets},SceneJS.MorphGeometry.prototype.getCurrentFrame=function(){var a=this._core,b=a.key1,c=a.key2;return{key1:b,key2:c,factor:a.factor,target1:a.targets[b],target2:a.targets[c]}},SceneJS.MorphGeometry.prototype._compile=function(a){this._core.hash||this._makeHash(),this._engine.display.morphGeometry=f[g++]=this._core,this._compileNodes(a),this._engine.display.morphGeometry=--g>0?f[g-1]:e,f[g]=null},SceneJS.MorphGeometry.prototype._makeHash=function(){var a=this._core;if(a.targets.length>0){var b=a.targets[0],c="t",d="f";a.hash=[b.vertexBuf?c:d,b.normalBuf?c:d,b.uvBuf?c:d,b.uvBuf2?c:d].join("")}else a.hash=""},SceneJS.MorphGeometry.prototype._destroy=function(){if(1==this._core.useCount&&document.getElementById(this._engine.canvas.canvasId))for(var a,b=this._core,c=0,d=b.targets.length;d>c;c++)a=b.targets[c],a.vertexBuf&&a.vertexBuf.destroy(),a.pickPositionsBuf&&a.pickPositionsBuf.destroy(),a.normalBuf&&a.normalBuf.destroy(),a.uvBuf&&a.uvBuf.destroy(),a.uvBuf2&&a.uvBuf2.destroy()};var h=(vec3.create(),vec3.create(),vec3.create())}(),function(){"use strict";SceneJS.Scene=SceneJS_NodeFactory.createNodeType("scene"),SceneJS.Scene.prototype._init=function(a){this.transparent=a.transparent===!0,this.stats=this._engine.stats,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},SceneJS.Scene.prototype.loseWebGLContext=function(){this._engine.loseWebGLContext()},SceneJS.Scene.prototype.getCanvas=function(){return this._engine.canvas.canvas},SceneJS.Scene.prototype.setTransparencyMode=function(a){
this._engine.display.setTransparencyMode(a),this._engine.branchDirty(this)},SceneJS.Scene.prototype.setDepthSort=function(a){this._engine.display.depthSort=a,this._engine.display.objectListDirty=!0},SceneJS.Scene.prototype.getGL=function(){return this._engine.canvas.gl},SceneJS.Scene.prototype.getGPUTimer=function(){return this._engine.gpuTimer},SceneJS.Scene.prototype.getGPUTimerQuery=function(){return this._engine.gpuTimerQuery},SceneJS.Scene.prototype.getWebGL2Supported=function(){return this._engine.canvas.webgl2},SceneJS.Scene.prototype.getZBufferDepth=function(){var a=this._engine.canvas.gl;return a.getParameter(a.DEPTH_BITS)},SceneJS.Scene.prototype.setProjection=function(a){var b=this._engine.display,c=a.type;c||b.projection&&(c=b.projection.type),c=c||"perspective","ortho"==c?b.projection=SceneJS._applyIf(SceneJS_math_ORTHO_OBJ,{type:c,left:a.left,bottom:a.bottom,near:a.near,right:a.right,top:a.top,far:a.far}):"frustum"==c?b.projection={type:c,left:a.left||-1,bottom:a.bottom||-1,near:a.near||.1,right:a.right||1,top:a.top||1,far:a.far||1e4}:"perspective"==c&&(void 0!=a.fovy&&(a.fov=a.fovy),b.projection={type:c,fov:a.fov||60,aspect:void 0==a.aspect?1:a.aspect,near:a.near||.1,far:a.far||1e4}),b.projection.pan=a.pan,b.buildProjectionMatrix(),b.imageDirty=!0},SceneJS.Scene.prototype.getProjection=function(){return this._engine.display.projection},SceneJS.Scene.prototype.setCamera=function(a){var b=this._engine.display;a.eye&&b.camera.eye.set(a.eye),a.look&&b.camera.look.set(a.look),a.up&&b.camera.up.set(a.up),a.deviceMatrix&&(b.hasDeviceMatrix=!0,b.deviceMatrix.set(a.deviceMatrix)),b.buildViewMatrix(),b.imageDirty=!0},SceneJS.Scene.prototype.setLights=function(a){a=a||[];var b=this._engine.display;b.lights.length=a.length;var c="";b._ambientColor[0]=0,b._ambientColor[1]=0,b._ambientColor[2]=0;for(var d=0,e=0,f=a.length;f>e;++e){b.lights[d]=b.lights[d]||{};var g=b.lights[d],h=a[e],i=h.mode||"dir";if("dir"!=i&&"point"!=i&&"ambient"!=i&&"spot"!=i)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light mode not supported - should be 'dir' or 'point' or 'spot' or 'ambient'");var j=h.pos,k=h.dir,l=h.color;g.color=new Float32Array([void 0!=l.r?l.r:1,void 0!=l.g?l.g:1,void 0!=l.b?l.b:1]),"ambient"!==i?(g.mode=i,g.diffuse="ambient"==i?!0:void 0!=h.diffuse?h.diffuse:!0,g.specular="ambient"==i?!1:void 0!=h.specular?h.specular:!0,g.pos=new Float32Array(h.pos?[j.x||0,j.y||0,j.z||0]:[0,0,0]),g.dir=new Float32Array(h.dir?[k.x||0,k.y||0,k.z||0]:[0,0,1]),g.innerCone=void 0!=h.innerCone?h.innerCone:.25,g.outerCone=void 0!=h.outerCone?h.outerCone:0,g.attenuation=new Float32Array([void 0!=h.constantAttenuation?h.constantAttenuation:0,h.linearAttenuation||0,h.quadraticAttenuation||0]),g.space=h.space||"world",++d,c+=g.mode,g.specular&&(c+="s"),g.diffuse&&(c+="d"),c+="world"===g.space?"w":"v",f-1>e&&(c+="/")):(b._ambientColor[0]=g.color[0],b._ambientColor[1]=g.color[1],b._ambientColor[2]=g.color[2])}b.lights.length=d,b.lightHash!==c?(b.lightHash=c,this._engine.branchDirty(this)):b.imageDirty=!0},SceneJS.Scene.prototype.setClips=function(a){var b=this._engine.display,c=b.clips,d="";c.clips.length=a.length,c.enabled=!1;for(var e=0,f=a.length;f>e;++e){var g=a[e],h=c.clips[e]||(c.clips[e]={normalAndDist:vec4.create(),fade:!1,fadeDistance:0}),i=g.n;vec3.normalize(i,i);var j=0;g.d?j=g.d:g.p&&(j=-vec3.dot(i,g.p)),h.normalAndDist.set(i),h.normalAndDist[3]=j,h.fade=!!g.fade,h.fadeDistance=0,h.fade?(c.clipFade=!0,h.fadeDistance=g.fadeDistance):c.clipDiscard=!0,d+=h.fade?"f":"c"}d===b.clipsHash?b.imageDirty=!0:(this._engine.branchDirty(this),b.clipsHash=d)},SceneJS.Scene.prototype.setDeviceMatrix=function(a){var b=this._engine.display;b.hasDeviceMatrix=!!a,a&&b.deviceMatrix.set(a),b.imageDirty=!0},SceneJS.Scene.prototype.getCamera=function(){return this._engine.display.camera},SceneJS.Scene.prototype.getViewMatrix=function(){return this._engine.display.viewMatrix},SceneJS.Scene.prototype.getProjectionMatrix=function(){return this._engine.display.projectionMatrix},SceneJS.Scene.prototype.setFogDensity=function(a){this._engine.display.fogDensity=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogStart=function(a){this._engine.display.fogParams[0]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnd=function(a){this._engine.display.fogParams[1]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMin=function(a){this._engine.display.fogParams[2]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMax=function(a){this._engine.display.fogParams[3]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogColor=function(a,b,c){this._engine.display.fogColor[0]=a,this._engine.display.fogColor[1]=b,this._engine.display.fogColor[2]=c,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogDensity=function(a){this._engine.display.fogColor[3]=a,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMode=function(a){this._engine.display.fogMode=a,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnabled=function(a){this._engine.display.fogEnabled=a,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setXrayColor=function(a,b,c){this._engine.display.xrayColor[0]=a,this._engine.display.xrayColor[1]=b,this._engine.display.xrayColor[2]=c,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.mainFramebufferParams=function(a){this._engine.display.mainFramebufferParams=a||null},SceneJS.Scene.prototype.createFramebuffer=function(a,b){this._engine.display.createFramebuffer(a,b)},SceneJS.Scene.prototype.destroyFramebuffer=function(a){this._engine.display.destroyFramebuffer(a)},SceneJS.Scene.prototype.getPostProcessStage=function(a){return this._engine.display.getPostProcessStage(a)},SceneJS.Scene.prototype.createPostProcessType=function(a,b,c){this._engine.display.createPostProcessType(a,b,c)},SceneJS.Scene.prototype.postProcessOpaque=function(a){this._engine.display.postProcessOpaque(a)},SceneJS.Scene.prototype.postProcessFinal=function(a){this._engine.display.postProcessFinal(a)},SceneJS.Scene.prototype.setNumPasses=function(a){this._engine.setNumPasses(a)},SceneJS.Scene.prototype.setClearEachPass=function(a){this._engine.setClearEachPass(a)},SceneJS.Scene.prototype.setViewport=function(a,b,c,d){this._engine.display.setViewport(a,b,c,d)},SceneJS.Scene.prototype.render=function(a){return this._engine.render(a)},SceneJS.Scene.prototype.pauseCompilation=function(){return this._engine.pauseCompilation()},SceneJS.Scene.prototype.resumeCompilation=function(){return this._engine.resumeCompilation()},SceneJS.Scene.prototype.compile=function(){return this._engine.compile()},SceneJS.Scene.prototype.needFrame=function(){this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.start=function(a){this._engine.start(a)},SceneJS.Scene.prototype.pick=function(){var a;if(SceneJS._isNumeric(arguments[0])){var b=arguments[0],c=arguments[1];a=arguments[2]||{},a.canvasPos=new Float32Array([b,c])}else a=arguments[0]||{};var d=this._engine.pick(a);return this.render({force:!0}),d?(this.publish("pick",d),d):void this.publish("nopick")},SceneJS.Scene.prototype.readPixels=function(a,b,c){return this._engine.readPixels(a,b,c)},SceneJS.Scene.prototype._destroy=function(){this.destroyed||(delete SceneJS._engines[this.id],SceneJS._engineIds.removeItem(this.id),this.destroyed=!0)},SceneJS.Scene.prototype.isActive=function(){return!this._engine.destroyed},SceneJS.Scene.prototype.stop=function(){this._engine.stop()},SceneJS.Scene.prototype.containsNode=function(a){return!!this._engine.findNode(a)},SceneJS.Scene.prototype.findNodes=function(a){return this._engine.findNodes(a)},SceneJS.Scene.prototype.findNode=function(a){return this.getNode(a)},SceneJS.Scene.prototype.getNode=function(a){return this._engine.findNode(a)},SceneJS.Scene.prototype.hasCore=function(a,b){return this._engine.hasCore(a,b)},SceneJS.Scene.prototype.publish=function(a,b,c){if(c||(this._topicPubs[a]=b),this._topicSubs[a]){var d=this._topicSubs[a];for(var e in d)d.hasOwnProperty(e)&&d[e].call(this,b)}},SceneJS.Scene.prototype.unpublish=function(a){var b=this._topicSubs[a];if(b)for(var c in b)b.hasOwnProperty(c)&&b[c].call(this,null);delete this._topicPubs[a]},SceneJS.Scene.prototype.on=function(a,b){var c=this._topicSubs[a];c||(c={},this._topicSubs[a]=c);var d=this._handleMap.addItem();c[d]=b,this._handleTopics[d]=a;var e=this._topicPubs[a];return e&&b.call(this,e),"rendered"==a&&this._engine.branchDirty(this),d},SceneJS.Scene.prototype.off=function(a){var b=this._handleTopics[a];if(b){delete this._handleTopics[a];var c=this._topicSubs[b];c&&delete c[a],this._handleMap.removeItem(a),"rendered"==b&&this._engine.branchDirty(this)}},SceneJS.Scene.prototype.once=function(a,b){var c=this,d=this.on(a,function(a){c.off(d),b(a)})}}(),function(){"use strict";function a(a,b,c,d){return function(){if(b.compressedSrc){a._initTexture(c);var e;"dds"===d?e=a._parseDDS:"pvr"===d&&(e=a._parsePVR),SceneJS._loadBinary(b.compressedSrc,e.bind(this))}else b.image?(a._initTexture(c),a._setTextureImage(b.image)):b.src&&(a._initTexture(c),a._loadTexture(b.src))}}function b(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function c(a,b){var a=Math.max(a,16),b=Math.max(b,8);return a*b/4}function d(a,b){var a=Math.max(a,8),b=Math.max(b,8);return a*b/2}function e(a,b){return Math.floor((a+3)/4)*Math.floor((b+3)/4)*8}function f(a,b){return Math.floor((a+3)/4)*Math.floor((b+3)/4)*16}var g={type:"texture",stateId:SceneJS._baseStateId++,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.texture=g,i=0});var h=[],i=0,j=null,k=null,l=null,m=null,n=SceneJS.TEXTURE_FLAGS;SceneJS.TextureMap=SceneJS_NodeFactory.createNodeType("texture"),SceneJS.TextureMap.prototype._init=function(b){if(1==this._core.useCount){var c=b.applyFrom||"uv";if("uv"!==c.substring(0,2))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var d=0;if("uv"!==c&&(d=parseInt(c.substring(2)),isNaN(d)))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'");if(b.applyTo){var e=b.applyTo;if("baseColor"!=e&&"color"!=e&&"occlusion"!=e&&"specular"!=e&&"emit"!=e&&"alpha"!=e&&"normals"!=e&&"shine"!=e&&"transparency"!=e&&"metallic"!=e&&"roughness"!=e&&"metallicRoughness"!=e)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyTo value is unsupported: "+e)}if(b.blendMode&&"add"!=b.blendMode&&"multiply"!=b.blendMode&&"over"!=b.blendMode&&"conditionalAlpha"!=b.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'");"color"==b.applyTo&&(b.applyTo="baseColor");var f=n[b.applyTo||"baseColor"]|n[b.blendMode||"multiply"];if(SceneJS._apply({waitForLoad:void 0==b.waitForLoad?!0:b.waitForLoad,texture:null,minFilter:b.minFilter,magFilter:b.magFilter,wrapS:b.wrapS,wrapT:b.wrapT,flipY:b.flipY,uvLayerIdx:d,isNormalMap:"normals"===b.applyTo,isAlphaMap:"alpha"===b.applyTo,isTransparencyMap:"transparency"===b.applyTo,flags:f,blendFactor:void 0!=b.blendFactor&&null!=b.blendFactor?b.blendFactor:1},this._core),this._initTexture(b.preloadColor),b.compressedImage)this.setCompressedImage(b.compressedImage,b.containerFormat,b.compressedSrc);else if(b.compressedSrc){this._core.compressedSrc=b.compressedSrc;var g;if("dds"===b.containerFormat)g=this._parseDDS;else if("pvr"===b.containerFormat)g=this._parsePVR;else{if("ktx"!==b.containerFormat)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"Compressed textures require containerFormat parameter to be 'dds' or 'pvr'");g=this._parseKTX}SceneJS._loadBinary(b.compressedSrc,g.bind(this))}else b.image?this._setTextureImage(b.image):b.src&&(this._core.src=b.src,this._loadTexture(b.src,b.preloadSrc));this._core.mipMapLevels=0,this._core.drawTexture=b.drawTexture||!1,this._core.webglRestored=a(this,this._core,b.preloadColor,b.containerFormat)}},SceneJS.TextureMap.prototype._initTexture=function(a){var b=this._engine.canvas.gl;a=a||{r:.57735,g:.57735,b:.57735},a.a=void 0===a.a?1:a.a,a=new Uint8Array([Math.floor(255*a.r),Math.floor(255*a.g),Math.floor(255*a.b),Math.floor(255*a.a)]),this._core.width=1,this._core.height=1;var c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,a),this._setCoreTexture(c)},SceneJS.TextureMap.prototype._loadTexture=function(a,b){var c=this,d=new Image,e=!1,f=!1;if(b){var g=new Image;g.onload=function(){e||(c._setTextureImage(g),f=!0,c._engine.display.imageDirty=!0)},g.src=b}d.onload=function(){c._setTextureImage(d),e=!0,c._engine.display.imageDirty=!0},d.src=a},SceneJS.TextureMap.prototype._setTextureImage=function(a){var b=this._engine.canvas.gl,c=this._core,d=c.texture&&c.texture.texture?c.texture.texture:b.createTexture();b.bindTexture(b.TEXTURE_2D,d),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a),c.width=a.width,c.height=a.height,this._setCoreTexture(d),this._gatherStats(a.width,a.height,a.width*a.height*4)},SceneJS.TextureMap.prototype._setCompressedTextureImage=function(a,b,c,d,e,f,g){var h=this._engine.canvas.gl,i=this._core,k=i.texture&&i.texture.texture?i.texture.texture:h.createTexture(),l=SceneJS._getExtension(h,b);if(!l)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Compressed texture format "+b+"not available.");h.bindTexture(h.TEXTURE_2D,k);var m=0;this._core.width=d,this._core.height=e,this._core.mipMapLevels=f,this._core.compressed=!0;for(var n=j.SIZE_FUNCTIONS[c],o=d,p=e,q=0;f>q;++q){var r=0;g?(r=a[m]+(a[m+1]<<8)+(a[m+2]<<16)+(a[m+3]<<24),m+=4):r=n(o,p);var s=new Uint8Array(a.buffer,a.byteOffset+m,r);h.compressedTexImage2D(h.TEXTURE_2D,q,c,o,p,0,s),o/=2,p/=2,m+=r}this._setCoreTexture(k),this._gatherStats(d,e,a.byteLength)},SceneJS.TextureMap.prototype._gatherStats=function(a,b,c){this._engine.stats.memory.textures+=c;var d=this._engine.stats.textures,e=a+"x"+b,f=this._getTextureTarget(),g=d[f]=d[f]||{};g[e]=(g[e]||0)+1,g.memory=(g.memory||0)+c},SceneJS.TextureMap.prototype._setCoreTexture=function(a){var b=this._engine.canvas.gl,c=SceneJS_math_isPOT(this._core.width)&SceneJS_math_isPOT(this._core.height),d=c?b.REPEAT:b.CLAMP_TO_EDGE,e=1!==this._core.mipMapLevels&&c?b.LINEAR_MIPMAP_NEAREST:b.LINEAR;this._core.texture=new SceneJS._webgl.Texture2D(b,{texture:a,minFilter:this._getGLOption("minFilter",e),magFilter:this._getGLOption("magFilter",b.LINEAR),wrapS:this._getGLOption("wrapS",d),wrapT:this._getGLOption("wrapT",d),compressed:this._core.compressed,flipY:this._core.flipY,update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype._getTextureTarget=function(){var a=this._core.flags;return a&n.baseColor?"baseColor":a&n.occlusion?"occlusion":a&n.normals?"normals":a&n.alpha?"alpha":a&n.specular?"specular":a&n.emit?"emit":a&n.shine?"shine":a&n.transparency?"transparency":a&n.metallic?"metallic":a&n.roughness?"roughness":a&n.metallicRoughness?"metallicRoughness":void 0},SceneJS.TextureMap.prototype._getGLOption=function(a,b){var c=this._engine.canvas.gl,d=this._core[a];if(void 0==d)return b;var e=SceneJS._webgl.enumMap[d];if(void 0==e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+a+"' value: '"+d+"'");return c[e]},SceneJS.TextureMap.prototype._getOption=function(a,b){return void 0==a?b:a},SceneJS.TextureMap.prototype.setSrc=function(a){this._core.image=null,this._core.src=a,this._core.target=null,this._loadTexture(a)},SceneJS.TextureMap.prototype.setImage=function(a){this._core.src=null,this._core.target=null,this._setTextureImage(a)},SceneJS.TextureMap.prototype.setCompressedImage=function(a,b,c){this._core.src=null,this._core.image=null,this._core.target=null,this._core.compressedSrc=c,"dds"===b?this._parseDDS(a):"pvr"===b?this._parsePVR(a):this._parseKTX(a)},SceneJS.TextureMap.prototype.setTarget=function(a){return"colorTarget"!=a.type&&"depthTarget"!=a.type?void console.log("Target node type not compatible: "+a.type):(delete this._core.src,this._core.target=a,this._core.src=null,this._core.image=null,this._core.texture=a._core.renderBuf.getTexture(),this._core.texture.bufType=a._core.bufType,void(this._engine.display.imageDirty=!0))},SceneJS.TextureMap.prototype.setBlendFactor=function(a){this._core.blendFactor=a,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getBlendFactor=function(){return this._core.blendFactor},SceneJS.TextureMap.prototype.setTranslate=function(a){this._core.translate||(this._core.translate={x:0,y:0}),this._core.translate.x=a.x,this._core.translate.y=a.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getTranslate=function(){return this._core.translate},SceneJS.TextureMap.prototype.setScale=function(a){this._core.scale||(this._core.scale={x:0,y:0}),this._core.scale.x=a.x,this._core.scale.y=a.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getScale=function(){return this._core.scale},SceneJS.TextureMap.prototype.setRotate=function(a){this._core.rotate=a,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getRotate=function(){return this._core.rotate},SceneJS.TextureMap.prototype.getMatrix=function(){return this._core._matrixDirty&&this._core.buildMatrix.call(this.core)(),this.core.matrix},SceneJS.TextureMap.prototype._compile=function(a){this.__core||(this.__core=this._engine._coreFactory.getCore("texture"),this.__core.transparent=!1,this.__core.drawLayer=-1);var b=this._engine.display.texture;this._core.empty||(this.__core.layers=b&&b.layers?b.layers.concat([this._core]):[this._core],this.__core.transparent=this._core.isAlphaMap||this._core.isTransparencyMap||b.transparent,this._core.drawTexture&&(this.__core.drawLayerIndex=this.__core.layers.length-1)),this._makeHash(this.__core),h[i++]=this.__core,this._engine.display.texture=this.__core,this._compileNodes(a),this._engine.display.texture=--i>0?h[i-1]:g,h[i]=null},SceneJS.TextureMap.prototype._makeHash=function(a){var b=[];if(a.layers&&a.layers.length>0)for(var c,d=a.layers,e=0,f=d.length;f>e;e++)c=d[e],b.push("/"),b.push(c.uvLayerIdx),b.push("/"),b.push(c.flags),c.matrix&&b.push("/anim"),c.compressed&&b.push("/comp"),"normals"===c.applyTo&&SceneJS.WEBGL_INFO.standardDerivativesSupported&&b.push("/gt");var g=b.join("");a.hash!=g&&(a.hash=g)},SceneJS.TextureMap.prototype._destroy=function(){1==this._core.useCount&&(this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null),this._engine.stats.memory.textures--),this._core&&this._engine._coreFactory.putCore(this._core)},SceneJS.TextureMap.prototype._parseDDS=function(a){if(!k)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"DXT compressed textures not supported on this platform.");var b=new Uint32Array(a,0,k.HEADER_LENGTH);if(b[k.MAGIC_NUMBER_INDEX]!=k.MAGIC_NUMBER)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: Magic number invalid.");if(b[k.PIXEL_FORMAT_FLAGS_INDEX]&0===k.PIXEL_FORMAT_FOURCC_FLAG)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: FourCC required.");var c=k.FOURCC_MAP[b[k.PIXEL_FORMAT_FOURCC_INDEX]],d=k.EXTENSION_MAP[b[k.PIXEL_FORMAT_FOURCC_INDEX]],e=1;b[k.FLAGS_INDEX]&k.MIPMAPCOUNT_FLAG&&(e=b[k.MIPMAPCOUNT_INDEX]);var f=b[k.WIDTH_INDEX],g=b[k.HEIGHT_INDEX],h=new Uint8Array(a,k.DATA_OFFSET);this._setCompressedTextureImage(h,d,c,f,g,e)},SceneJS.TextureMap.prototype._parsePVR=function(a){var b=new Uint32Array(a,0,l.HEADER_LENGTH);if(b[l.MAGIC_NUMBER_INDEX]!=l.MAGIC_NUMBER)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid PVR File: Magic number invalid.");var c=b[l.PIXEL_FORMAT_INDEX],d=l.EXTENSION_MAP[c],e=l.FORMAT_MAP[c],f=b[l.MIPMAPCOUNT_INDEX],g=b[l.WIDTH_INDEX],h=b[l.HEIGHT_INDEX],i=l.HEADER_SIZE+b[l.METADATA_SIZE_INDEX],j=new Uint8Array(a,i);this._setCompressedTextureImage(j,d,e,g,h,f)},SceneJS.TextureMap.prototype._parseKTX=function(a){for(var b=new Uint32Array(a,0,m.HEADER_LENGTH),c=0;c<m.IDENTIFIER_LENGTH;++c)if(b[c]!=m.IDENTIFIER[c])throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid KTX File: Identifier invalid.");var d=b[m.INTERNAL_FORMAT_INDEX],e=m.EXTENSION_MAP[d],f=b[m.MIPMAPCOUNT_INDEX],g=b[m.WIDTH_INDEX],h=b[m.HEIGHT_INDEX],i=m.HEADER_SIZE+b[m.KEY_VALUE_SIZE_INDEX],j=new Uint8Array(a,i);this._setCompressedTextureImage(j,e,d,g,h,f,!0)},function(){function a(a){var b=SceneJS._getExtension(a,"WEBGL_compressed_texture_pvrtc"),g=SceneJS._getExtension(a,"WEBGL_compressed_texture_etc1"),h=SceneJS._getExtension(a,"WEBGL_compressed_texture_s3tc"),i={PVRTC_SUPPORTED:!!b,ETC1_SUPPORTED:!!g,DXT_SUPPORTED:!!h,FORMAT_ENUMS:{},SIZE_FUNCTIONS:{}};return i.PVRTC_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,i.SIZE_FUNCTIONS[b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=c,i.SIZE_FUNCTIONS[b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=c,i.SIZE_FUNCTIONS[b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=d,i.SIZE_FUNCTIONS[b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=d),i.ETC1_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL=g.COMPRESSED_RGB_ETC1_WEBGL,i.SIZE_FUNCTIONS[g.COMPRESSED_RGB_ETC1_WEBGL]=e),i.DXT_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT=h.COMPRESSED_RGB_S3TC_DXT1_EXT,i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT=h.COMPRESSED_RGBA_S3TC_DXT3_EXT,i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT=h.COMPRESSED_RGBA_S3TC_DXT5_EXT,i.SIZE_FUNCTIONS[h.COMPRESSED_RGB_S3TC_DXT1_EXT]=e,i.SIZE_FUNCTIONS[h.COMPRESSED_RGBA_S3TC_DXT3_EXT]=f,i.SIZE_FUNCTIONS[h.COMPRESSED_RGBA_S3TC_DXT5_EXT]=f),i}function g(){var a={MAGIC_NUMBER:542327876,MIPMAPCOUNT_FLAG:131072,PIXEL_FORMAT_FOURCC_FLAG:4,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,SIZE_INDEX:1,FLAGS_INDEX:2,HEIGHT_INDEX:3,WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,PIXEL_FORMAT_FLAGS_INDEX:20,PIXEL_FORMAT_FOURCC_INDEX:21,DATA_OFFSET:128,FOURCC_MAP:{},EXTENSION_MAP:{}};if(j.DXT_SUPPORTED){var c=b("DXT1"),d=b("DXT3"),e=b("DXT5");a.FOURCC_MAP[c]=j.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,a.FOURCC_MAP[d]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,a.FOURCC_MAP[e]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT,a.EXTENSION_MAP[c]="WEBGL_compressed_texture_s3tc",a.EXTENSION_MAP[d]="WEBGL_compressed_texture_s3tc",a.EXTENSION_MAP[e]="WEBGL_compressed_texture_s3tc"}if(j.ETC1_SUPPORTED){var f=b("ETC1");a.FOURCC_MAP[f]=j.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL,a.EXTENSION_MAP[f]="WEBGL_compressed_texture_etc1"}return a}function h(){var a={MAGIC_NUMBER:55727696,HEADER_LENGTH:13,HEADER_SIZE:52,MAGIC_NUMBER_INDEX:0,PIXEL_FORMAT_INDEX:2,HEIGHT_INDEX:6,WIDTH_INDEX:7,MIPMAPCOUNT_INDEX:11,METADATA_SIZE_INDEX:12,EXTENSION_MAP:{0:"WEBGL_compressed_texture_pvrtc",1:"WEBGL_compressed_texture_pvrtc",2:"WEBGL_compressed_texture_pvrtc",3:"WEBGL_compressed_texture_pvrtc",6:"WEBGL_compressed_texture_etc1",7:"WEBGL_compressed_texture_s3tc",9:"WEBGL_compressed_texture_s3tc",11:"WEBGL_compressed_texture_s3tc"},FORMAT_MAP:{}};return j.PVRTC_SUPPORTED&&(a.FORMAT_MAP[0]=j.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,a.FORMAT_MAP[1]=j.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,a.FORMAT_MAP[2]=j.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,a.FORMAT_MAP[3]=j.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),j.ETC1_SUPPORTED&&(a.FORMAT_MAP[6]=j.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL),j.DXT_SUPPORTED&&(a.FORMAT_MAP[7]=j.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,a.FORMAT_MAP[9]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,a.FORMAT_MAP[11]=j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT),a}function i(){var a=new Uint8Array([171,75,84,88,32,49,49,187,13,10,26,10]),b={IDENTIFIER:new Uint32Array(a.buffer),IDENTIFIER_LENGTH:3,HEADER_LENGTH:16,HEADER_SIZE:64,INTERNAL_FORMAT_INDEX:7,WIDTH_INDEX:9,HEIGHT_INDEX:10,MIPMAPCOUNT_INDEX:14,KEY_VALUE_SIZE_INDEX:15,EXTENSION_MAP:{}};return j.DXT_SUPPORTED&&(b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc",b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT]="WEBGL_compressed_texture_s3tc",b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT]="WEBGL_compressed_texture_s3tc"),j.ETC1_SUPPORTED&&(b.EXTENSION_MAP[j.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL]="WEBGL_compressed_texture_etc1"),b}var n=document.createElement("canvas");if(n){var o=n.getContext("webgl")||n.getContext("experimental-webgl");o&&(j=a(o),k=g(),l=h(),m=i())}}()}(),function(){"use strict";var a=SceneJS.TEXTURE_FLAGS,b={type:"fresnel",stateId:SceneJS._baseStateId++,power:1,centerColor:new Float32Array([1,1,1,1]),edgeColor:new Float32Array([0,0,0,0]),blendFactor:1,blendMode:a.multiply,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.fresnel=b,d=0});var c=[],d=0;SceneJS.Fresnel=SceneJS_NodeFactory.createNodeType("fresnel"),SceneJS.Fresnel.prototype._init=function(c){if(1==this._core.useCount){if(c.applyTo&&"color"!=c.applyTo&&"specular"!=c.applyTo&&"alpha"!=c.applyTo&&"reflect"!=c.applyTo&&"emit"!=c.applyTo&&"fragment"!=c.applyTo&&"transparency"!=c.applyTo)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"fresnel applyTo value is unsupported - should be either 'color', 'specular', 'alpha', 'reflect', 'emit' or 'fragment'");if(this._core.applyTo=c.applyTo,c.blendMode&&"add"!=c.blendMode&&"multiply"!=c.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'");this._core.blendMode=a[c.blendMode||"multiply"],this._core.centerColor=new Float32Array(b.centerColor),this._core.edgeColor=new Float32Array(b.edgeColor),this._core.power=b.power,void 0!=c.centerBias&&this.setCenterBias(c.centerBias),void 0!=c.edgeBias&&this.setEdgeBias(c.edgeBias),void 0!=c.power&&this.setPower(c.power),void 0!=c.centerColor&&this.setCenterColor(c.centerColor),void 0!=c.edgeColor&&this.setEdgeColor(c.edgeColor)}},SceneJS.Fresnel.prototype.getApplyTo=function(){return this._core.applyTo},SceneJS.Fresnel.prototype.setCenterBias=function(a){this._core.centerColor[3]=void 0!==a?a:b.centerColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getCenterBias=function(){return this._core.centerColor[3]},SceneJS.Fresnel.prototype.setEdgeBias=function(a){this._core.edgeColor[3]=void 0!==a?a:b.edgeColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getEdgeBias=function(){return this._core.edgeColor[3]},SceneJS.Fresnel.prototype.setPower=function(a){this._core.power=void 0!==a?a:b.power,this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getPower=function(){return this._core.power},SceneJS.Fresnel.prototype.setCenterColor=function(a){var c=b.centerColor;return this._core.centerColor[0]=void 0!=a.r?a.r:c[0],this._core.centerColor[1]=void 0!=a.g?a.g:c[1],this._core.centerColor[2]=void 0!=a.b?a.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getCenterColor=function(){return{r:this._core.centerColor[0],g:this._core.centerColor[1],b:this._core.centerColor[2]}},SceneJS.Fresnel.prototype.setEdgeColor=function(a){var c=b.edgeColor;return this._core.edgeColor[0]=void 0!=a.r?a.r:c[0],this._core.edgeColor[1]=void 0!=a.g?a.g:c[1],this._core.edgeColor[2]=void 0!=a.b?a.b:c[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getEdgeColor=function(){return{r:this._core.edgeColor[0],g:this._core.edgeColor[1],b:this._core.edgeColor[2]}},SceneJS.Fresnel.prototype._compile=function(a){this.__core||(this.__core=this._engine._coreFactory.getCore("fresnel"),this.__core.transparent=!1,this.__core.partiallyOpaque=!1);var e=this._engine.display.fresnel;this._core.empty||(this.__core.diffuse="color"==this._core.applyTo?this._core:e.diffuse,this.__core.specular="specular"==this._core.applyTo?this._core:e.specular,this.__core.alpha="alpha"==this._core.applyTo?this._core:e.alpha,this.__core.reflect="reflect"==this._core.applyTo?this._core:e.reflect,this.__core.emit="emit"==this._core.applyTo?this._core:e.emit,this.__core.fragment="fragment"==this._core.applyTo?this._core:e.fragment,this.__core.transparency="transparency"==this._core.applyTo?this._core:e.transparency,this.__core.transparent=e.transparent,this.__core.partiallyOpaque=e.partiallyOpaque,("alpha"==this._core.applyTo||"transparency"==this._core.applyTo)&&(this.__core.transparent=!0,(this._core.centerColor[0]>=1||this._core.edgeColor[0]>=1)&&(this.__core.partiallyOpaque=!0))),this._makeHash(this.__core),c[d++]=this.__core,this._engine.display.fresnel=this.__core,this._compileNodes(a),this._engine.display.fresnel=--d>0?c[d-1]:b,c[d]=null},SceneJS.Fresnel.prototype._makeHash=function(a){var b=[];a.diffuse&&b.push("d"+a.diffuse.blendMode+";"),a.specular&&b.push("s"+a.specular.blendMode+";"),a.alpha&&b.push("a"+a.alpha.blendMode+";"),a.reflect&&b.push("r"+a.reflect.blendMode+";"),a.emit&&b.push("e"+a.emit.blendMode+";"),a.fragment&&b.push("f"+a.fragment.blendMode+";"),a.transparency&&b.push("t"+a.transparency.blendMode+";"),b.push(a.blendMode+";"),b=b.join(""),a.hash!=b&&(a.hash=b)},SceneJS.Fresnel.prototype._destroy=function(){this._core&&this._engine._coreFactory.putCore(this._core)}}(),function(){"use strict";var a={type:"cubemap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,space:"world",hash:""},b=[],c=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(b){b.engine.display.cubemap=a,c=0}),SceneJS.Cubemap=SceneJS_NodeFactory.createNodeType("cubemap"),SceneJS.Cubemap.prototype._init=function(a){if(1==this._core.useCount){if(this._core.hash="y",a.blendMode&&"add"!==a.blendMode&&"multiply"!==a.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap blendMode value is unsupported - should be either 'add' or 'multiply'");var b=a.applyTo||"reflect";if("reflect"!==b&&"light"!==b)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap applyTo value is unsupported - should be either 'reflect' or 'light'");this._core.blendMode=a.blendMode||"multiply",this._core.intensity=void 0!=a.intensity&&null!=a.intensity?a.intensity:1,this._core.applyTo=SceneJS.CUBEMAP_FLAGS[b];var c=a.space||"world";if("view"!==c&&"world"!==c)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"cubemap 'space' value is unsupported: '"+c+"' - should be 'view' or 'world'");"view"===c&&"reflect"===b&&(c="world;"),this._core.space=c;for(var d=this,e=this._engine.canvas.gl,f=e.createTexture(),g=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z],h=new Array(6),i=!1,j=6,k=0;k<g.length;k++){var l=new Image;l.onload=function(a){var b=l;return function(){if(!i&&(h[a]=b,0===--j)){e.bindTexture(e.TEXTURE_CUBE_MAP,f),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);for(var c=0,k=h.length;k>c;c++)e.texImage2D(g[c],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h[c]);d._core.texture=new SceneJS._webgl.Texture2D(e,{texture:f,target:e.TEXTURE_CUBE_MAP,minFilter:e.LINEAR_MIPMAP_LINEAR,magFilter:e.LINEAR,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE});var l=Math.min(b.width,b.height);d._core.mipLevels=SceneJS_math_log2(l),d._engine.display.imageDirty=!0}}}(k),l.onerror=function(){i=!0},l.src=a.src[k]}}},SceneJS.Cubemap.prototype._compile=function(d){this.__core||(this.__core=this._engine._coreFactory.getCore("cubemap"));var e=this._engine.display.cubemap;this._core.empty||(this.__core.layers=e&&e.layers?e.layers.concat([this._core]):[this._core]),
this._makeHash(this.__core),b[c++]=this.__core,this._engine.display.cubemap=this.__core,this._compileNodes(d),this._engine.display.cubemap=--c>0?b[c-1]:a,b[c]=null},SceneJS.Cubemap.prototype._makeHash=function(a){var b;if(a.layers&&a.layers.length>0){for(var c,d=a.layers,e=[],f=0,g=d.length;g>f;f++)c=d[f],e.push("/"),e.push(c.applyTo),e.push("/"),e.push(c.space),e.push("/"),e.push(c.blendMode);b=e.join("")}else b="";a.hash!=b&&(a.hash=b)},SceneJS.Cubemap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&(this._core.texture.destroy(),this._core.texture=null),this._core&&this._engine._coreFactory.putCore(this._core)}}(),function(){"use strict";var a={type:"regionMap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,regionColor:[-1,-1,-1],highlightFactor:[1.5,1.5,0],hideAlpha:0,regionData:[],mode:"info",hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(c){c.engine.display.regionMap=a,b=0});var b=0,c={info:!0,highlight:!0,hide:!0,isolate:!0};SceneJS.RegionMap=SceneJS_NodeFactory.createNodeType("regionMap"),SceneJS.RegionMap.prototype._init=function(a){var b=this;if(1==this._core.useCount){SceneJS._apply({regionMap:null},this._core);var c=a.applyFrom||"uv";if("uv"!==c.substring(0,2))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var d=0;if("uv"!==c&&(d=c.substring(2),isNaN(d)))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'");this._core.uvLayerIdx=d,a.src?(this._initTexture(),this._core.src=a.src,this._loadTexture(a.src)):a.image&&(this._initTexture(a.preloadColor),this._core.image=a.image,this._setTextureImage(a.image)),this._core.webglRestored=function(){b._core.image?(b._initTexture(),b._setTextureImage(b._core.image)):b._core.src?(b._initTexture(),b._loadTexture(b._core.src)):b._core.target},this.setRegionColor(a.regionColor),this.setHighlightFactor(a.highlightFactor),this.setHideAlpha(a.hideAlpha),this.setRegionData(a.regionData),this.setMode(a.mode)}},SceneJS.RegionMap.prototype._initTexture=function(){var a=this._engine.canvas.gl,b={r:.57735,g:.57735,b:.57735};b.a=void 0===b.a?1:b.a,b=new Uint8Array([Math.floor(255*b.r),Math.floor(255*b.g),Math.floor(255*b.b),Math.floor(255*b.a)]);var c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,b),this._setCoreTexture(c)},SceneJS.RegionMap.prototype._loadTexture=function(a){var b=this,c=new Image,d=!1;c.onload=function(){b._setTextureImage(c),d=!0,b._engine.display.imageDirty=!0},this._fetchImage(c,a)},SceneJS.RegionMap.prototype._fetchImage=function(a,b){0==b.indexOf("data")?a.src=b:(a.crossOrigin="Anonymous",a.src=b)},SceneJS.RegionMap.prototype._setTextureImage=function(a){var b=this._engine.canvas.gl,c=this._core.texture?this._core.texture.texture:b.createTexture();b.bindTexture(b.TEXTURE_2D,c),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a),this._core.image=a,this._setCoreTexture(c)},SceneJS.RegionMap.prototype._setCoreTexture=function(a){var b=this._engine.canvas.gl;this._core.texture=new SceneJS._webgl.Texture2D(b,{texture:a,minFilter:this._getGLOption("minFilter",b.NEAREST_MIPMAP_NEAREST),magFilter:this._getGLOption("magFilter",b.NEAREST),wrapS:this._getGLOption("wrapS",b.REPEAT),wrapT:this._getGLOption("wrapT",b.REPEAT),isDepth:this._getOption(this._core.isDepth,!1),depthMode:this._getGLOption("depthMode",b.LUMINANCE),depthCompareMode:this._getGLOption("depthCompareMode",b.COMPARE_R_TO_TEXTURE),depthCompareFunc:this._getGLOption("depthCompareFunc",b.LEQUAL),flipY:this._getOption(this._core.flipY,!0),width:this._getOption(this._core.width,1),height:this._getOption(this._core.height,1),internalFormat:this._getGLOption("internalFormat",b.ALPHA),sourceFormat:this._getGLOption("sourceFormat",b.ALPHA),sourceType:this._getGLOption("sourceType",b.UNSIGNED_BYTE),update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.RegionMap.prototype._getGLOption=function(a,b){var c=this._engine.canvas.gl,d=this._core[a];if(void 0==d)return b;var e=SceneJS._webgl.enumMap[d];if(void 0==e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+a+"' value: '"+d+"'");return c[e]},SceneJS.RegionMap.prototype._getOption=function(a,b){return void 0==a?b:a},SceneJS.RegionMap.prototype.setSrc=function(a){this._core.image=null,this._core.src=a,this._core.target=null,this._loadTexture(a)},SceneJS.RegionMap.prototype.setImage=function(a){this._core.image=a,this._core.src=null,this._core.target=null,this._setTextureImage(a)},SceneJS.RegionMap.prototype.setTarget=function(a){return"colorTarget"!=a.type&&"depthTarget"!=a.type?void console.log("Target node type not compatible: "+a.type):(delete this._core.src,this._core.target=a,this._core.src=null,this._core.image=null,this._core.texture=a._core.renderBuf.getTexture(),this._core.texture.bufType=a._core.bufType,void(this._engine.display.imageDirty=!0))},SceneJS.RegionMap.prototype.setRegionColor=function(b){var c=a.regionColor;return this._core.regionColor=b?[void 0!=b.r&&null!=b.r?b.r:c[0],void 0!=b.g&&null!=b.g?b.g:c[1],void 0!=b.b&&null!=b.b?b.b:c[2]]:a.regionColor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHighlightFactor=function(b){var c=a.highlightFactor;return this._core.highlightFactor=b?[void 0!=b.r&&null!=b.r?b.r:c[0],void 0!=b.g&&null!=b.g?b.g:c[1],void 0!=b.b&&null!=b.b?b.b:c[2]]:a.highlightFactor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHideAlpha=function(b){return this._core.hideAlpha=void 0!=b?b:a.hideAlpha,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setMode=function(b){var d=!!this._core.transparent;return this._core.mode=b&&c[b]?b:a.mode,this._core.transparent="hide"===this._core.mode||"isolate"===this._core.mode,d!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this._core.hash="reg-"+b,this},SceneJS.RegionMap.prototype.setRegionData=function(b){return this._core.regionData=b?b:a.regionData,this},SceneJS.RegionMap.prototype._compile=function(a){var b=this._engine.display.regionMap;this._engine.display.regionMap=this._core,this._compileNodes(a),this._engine.display.regionMap=b},SceneJS.RegionMap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null)}}(),function(){"use strict";var a=[],b=0,c={type:"xform",stateId:SceneJS._baseStateId++,matrix:mat4.create(),normalMatrix:mat4.create()};SceneJS.XForm=SceneJS_NodeFactory.createNodeType("xform"),SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(a){a.engine.display.modelTransform=c,b=0}),SceneJS.XForm.prototype._init=function(a){1==this._core.useCount&&(this._core.matrix=mat4.create(),this._core.normalMatrix=mat4.create(),a.elements&&this.setElements(a.elements))},SceneJS.XForm.prototype.getMatrix=function(){return this._core.matrix},SceneJS.XForm.prototype.setElements=function(a){if(16!=a.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.XForm elements should number 16");var b=this._core;return b.matrix.set(a),mat4.invert(b.normalMatrix,b.matrix),mat4.transpose(b.normalMatrix,b.normalMatrix),this._engine.display.imageDirty=!0,this},SceneJS.XForm.prototype.getElements=function(){return this._core.matrix},SceneJS.XForm.prototype._compile=function(d){this._engine.display.modelTransform=a[b++]=this._core,this._compileNodes(d),this._engine.display.modelTransform=--b>0?a[b-1]:c,a[b]=null}}(),function(){"use strict";SceneJS.Types=new function(){this.addType=function(a,b){var c,d=SceneJS_NodeFactory.createNodeType(a);for(var e in b)if(b.hasOwnProperty(e))switch(c=b[e],e){case"init":case"construct":!function(){var a=b[e];d.prototype._init=function(b){a.call(this,b)},d.prototype._fromPlugin=!0}();break;case"destroy":case"destruct":d.prototype._destroy=c;break;default:d.prototype[e]=c}},this.hasType=function(a){return!!SceneJS_NodeFactory.nodeTypes[a]}}}(),function(){"use strict";function a(a,b){return a.sortKey-b.sortKey}function b(a,b){return a.layer-b.layer||a.properties.stateId-b.properties.stateId||a.sortTieBreaker-b.sortTieBreaker}function c(a,b){return a.layer-b.layer||b.getDepth()-a.getDepth()}var d=window.SceneJS_Display=function(a,b){this.stats=a||{},this._canvas=b.canvas,this._programFactory=new SceneJS_ProgramFactory(this.stats,{canvas:b.canvas}),this._chunkFactory=new SceneJS_ChunkFactory,this.transparent=b.transparent===!0,this.depthSort=b.depthSort===!0,this.autoTangents=b.autoTangents===!0,this.gammaInputPhong=b.gammaInputPhong===!0,this.properties=null,this.material=null,this.texture=null,this.fresnel=null,this.cubemap=null,this.modelTransform=null,this.regionMap=null,this.morphGeometry=null,this.geometry=null,this._objects={},this._ambientColor=[.7,.7,.8],this.projection={type:"perspective",fov:60,aspect:1,near:.1,far:500,pan:0},this.projectionMatrix=mat4.create(),this.buildProjectionMatrix(),this.camera={eye:new Float32Array([0,0,10]),look:new Float32Array([0,0,0]),up:new Float32Array([0,1,0])},this.viewMatrix=mat4.create(),this.hasDeviceMatrix=!1,this.deviceMatrix=mat4.create(),this.buildViewMatrix(),this.lights=[{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!0,specular:!0,dir:new Float32Array([-.5,-.5,-1]),space:"view"},{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!1,specular:!0,dir:new Float32Array([1,-.9,-.7]),space:"view"}],this.lightHash="dirsdv/dirsv/",this.clips={clips:[],clipFade:!1,clipDiscard:!1,enabled:!1},this.clipsHash="",this.highlightColor=new Float32Array([1.5,1.5,.5]),this.desatParams=new Float32Array([.9,.3]),this.fogParams=new Float32Array([0,1e3,0,1]),this.fogColor=new Float32Array([1,1,1,.01]),this.fogEnabled=!1,this.xrayColor=new Float32Array([0,0,.1]),this.fogMode=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,this.viewport=new Float32Array([0,0,this._canvas.canvas.width,this._canvas.canvas.height]),this._opaqueObjects=[],this._numOpaqueObjects=0,this._transparentObjects=[],this._numTransparentObjects=0,this._pickLookup=[],this._frameCtx={regionData:[],canvas:this._canvas,VAO:null},this.objectListDirty=!0,this.imageDirty=!0,this._nextProgramId=0,this.postProcessPipelineOpaque=[],this.postProcessPipelineTransparent=[],this.postProcessPipelineFinal=[],this._postProcessTypes={},this._postProcesses={},this.framebuffers={},this.mainFramebuffer=null,this.mainFramebufferParams=null,this.oitAccumulateFramebuffer=null,this.oitPostprocessType=null,this.oitPostprocess=null,this.blitPostprocessType=null,this.blitPostprocess=null,this.transparencyMode=SceneJS.TRANSPARENCY_FLAGS.ALPHA,this.depthSort=!1,this.postProcessInitialized=!1,this.oitInitialized=!1};d.prototype.initPostProcess=function(){this.postProcessInitialized||(this.mainFramebuffer=this.createFramebuffer("__MAIN",this.mainFramebufferParams),this.blitPostprocessType=this.createPostProcessType("__BLIT",["precision highp float;","varying vec2 vUV;","uniform sampler2D uTexture;","void main() {","    gl_FragColor = texture2D(uTexture, vUV);","}"].join("\n")),this.blitPostprocess=new SceneJS_PostProcessStage(this,{type:"__BLIT",textures:{uTexture:{framebuffer:"__MAIN",target:"color"}}}),this.postProcessInitialized=!0)},d.prototype.initOIT=function(){this.oitInitialized||(this.initPostProcess(),this.oitAccumulateFramebuffer=this.createFramebuffer("__OIT_ACCUMULATE",{colorAttachments:[{type:"FLOAT"}],sharedDepthBuffer:this.mainFramebuffer}),this.oitDepthBuffer=this.createFramebuffer("__OIT_DEPTH",{colorAttachments:0}),this.oitPostprocessType=this.createPostProcessType("__OIT",["precision highp float;","varying vec2 vUV;","uniform vec2 uTexelOffset;","uniform sampler2D uAccumulate;","#define THRESH 0.1176","float edgeFilter(vec2 center, vec2 a0, vec2 a1, vec2 a2, vec2 a3){","    vec4 luminance = vec4(a0.x, a1.x , a2.x, a3.x);","    vec4 w = 1.0 - step(THRESH, abs(luminance - center.x));","    float W = w.x + w.y + w.z + w.w;","    w.x = W == 0.0 ? 1.0 : w.x;","    W = W == 0.0 ? 1.0 : W;","    return (w.x * a0.y + w.y * a1.y + w.z * a2.y + w.w * a3.y) / W;","}","void main() {","    vec4 accum = texture2D(uAccumulate, vUV);","    vec4 a0 = texture2D(uAccumulate, vUV + vec2(uTexelOffset.x, 0.0));","    vec4 a1 = texture2D(uAccumulate, vUV - vec2(uTexelOffset.x, 0.0));","    vec4 a2 = texture2D(uAccumulate, vUV + vec2(0.0, uTexelOffset.y));","    vec4 a3 = texture2D(uAccumulate, vUV - vec2(0.0, uTexelOffset.y));","    accum.rg /= max(accum.b, 0.001);","    a0.rg /= max(a0.b, 0.001);","    a1.rg /= max(a1.b, 0.001);","    a2.rg /= max(a2.b, 0.001);","    a3.rg /= max(a3.b, 0.001);","    vec3 ycocg = vec3(accum.rg, edgeFilter(accum.rg, a0.rg, a1.rg, a2.rg, a3.rg));","    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);","    ycocg.gb = checkerboard ? ycocg.gb : ycocg.bg;","    vec3 rgb = vec3(ycocg.r + ycocg.g - ycocg.b, ycocg.r + ycocg.b, ycocg.r - ycocg.g - ycocg.b);","    float a = 1.0 - accum.a;","    gl_FragColor = vec4(a * rgb, a);","}"].join("\n")),this.oitPostprocess=new SceneJS_PostProcessStage(this,{type:"__OIT",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uAccumulate:{framebuffer:"__OIT_ACCUMULATE",target:"color"}}}),this.oitInitialized=!0)},d.prototype.setTransparencyMode=function(a){this.transparencyMode=a,a===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.initOIT(),this.objectListDirty=!0},d.prototype.createFramebuffer=function(a,b){return this.framebuffers[a]&&this.framebuffers[a].destroy(),b=b||{},b.canvas=this._canvas,this.framebuffers[a]=new SceneJS._webgl.Framebuffer(b),this.framebuffers[a]},d.prototype.destroyFramebuffer=function(a){this.framebuffers[a]&&this.framebuffers[a].destroy(),delete this.framebuffers[a]},d.prototype.getPostProcessStage=function(a){return this._postProcesses[a]},d.prototype.createPostProcessType=function(a,b,c){return this._postProcessTypes[a]=new SceneJS_PostProcess(this.stats,this._canvas.gl,b,c),this._postProcessTypes[a]},d.prototype.postProcessOpaque=function(a){var b,c;for(a=a||[],a.length>0&&this.initPostProcess(),b=0,c=this.postProcessPipelineOpaque.length;c>b;++b){var d=this.postProcessPipelineOpaque[b];delete this._postProcesses[d.id],d.destroy()}for(this.postProcessPipelineOpaque.length=0,b=0,c=a.length;c>b;++b){var e=a[b],f=e.id;this._postProcesses[f]=new SceneJS_PostProcessStage(this,e),this.postProcessPipelineOpaque.push(this._postProcesses[f])}this.imageDirty=!0},d.prototype.postProcessFinal=function(a){var b,c;for(a=a||[],a.length>0&&this.initPostProcess(),b=0,c=this.postProcessPipelineFinal.length;c>b;++b){var d=this.postProcessPipelineFinal[b];delete this._postProcesses[d.id],d.destroy()}for(this.postProcessPipelineFinal.length=0,b=0,c=a.length;c>b;++b){var e=a[b],f=e.id;this._postProcesses[f]=new SceneJS_PostProcessStage(this,e),this.postProcessPipelineFinal.push(this._postProcesses[f])}this.imageDirty=!0},d.prototype.webglRestored=function(){this._programFactory.webglRestored(),this._chunkFactory.webglRestored();var a=this._canvas.gl;this.pickBuf&&this.pickBuf.webglRestored(a);for(var b in this.framebuffers)this.framebuffers[b].webglRestored(a);for(var c in this._postProcessTypes)this._postProcessTypes[c].webglRestored(a);this.imageDirty=!0},d.prototype.setViewport=function(a,b,c,d){this.viewport[0]=a,this.viewport[1]=b,this.viewport[2]=c,this.viewport[3]=d,this.imageDirty=!0},d.prototype.buildProjectionMatrix=function(){var a=this.projection,b=this.projectionMatrix;if("ortho"==a.type)mat4.ortho(b,a.left,a.right,a.bottom,a.top,a.near,a.far);else if("frustum"==a.type)mat4.frustum(b,a.left,a.right,a.bottom,a.top,a.near,a.far);else if("perspective"==a.type){var c=a.fov;c=Math.min(c,120),mat4.perspective(b,c*Math.PI/180,a.aspect,a.near,a.far)}if(a.pan){var d=a.pan,e=mat4.fromTranslation(mat4.create(),[d.x||0,d.y||0,d.z||0]);mat4.multiply(b,e,b)}},d.prototype.buildViewMatrix=function(){var a=this.camera,b=this.viewMatrix;if(mat4.lookAt(b,a.eye,a.look,a.up),this.hasDeviceMatrix){var c=mat4.create();mat4.multiply(c,this.deviceMatrix,b),b.set(c)}},d.prototype.buildObject=function(a,b){var c=this._objects[a];c||(c=this._objects[a]=new SceneJS_Object(a)),c.modelTransform=this.modelTransform,c.viewMatrix=this.viewMatrix,c.projectionMatrix=this.projectionMatrix,c.texture=this.texture,c.cubemap=this.cubemap,c.geometry=this.geometry,c.morphGeometry=this.morphGeometry,c.properties=this.properties,c.material=this.material,c.fresnel=this.fresnel,c.regionMap=this.regionMap,c.backfaces=b.backfaces,c.addBlend=b.addBlend,c.layer=b.layer;var d=[this.geometry.hash,this.morphGeometry.hash,this.texture.hash,this.fresnel.hash,this.cubemap.hash,this.lightHash,this.clipsHash,this.properties.hash,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&c.isPartiallyOpaque()?"pt":"",this.regionMap.hash,this.fogEnabled?"f"+this.fogMode:""].join(";");if(!c.program||d!=c.hash){c.program&&(this._programFactory.putProgram(c.program.draw),this._programFactory.putProgram(c.program.xray),this._programFactory.putProgram(c.program.pick),this._programFactory.putProgram(c.program.pickTriangle),this._programFactory.putProgram(c.program.depth),this._programFactory.putProgram(c.program.drawTexture),SceneJS_ProgramSourceFactory.putSource(c.hash));var e=SceneJS_ProgramSourceFactory.getSource(d,this,c);c.program={draw:this._programFactory.getProgram(d+"-draw",e.drawVertexSrc,e.drawFragmentSrc),xray:this._programFactory.getProgram(d+"-xray",e.xrayVertexSrc,e.xrayFragmentSrc),pick:this._programFactory.getProgram(d+"-pick",e.pickVertexSrc,e.pickFragmentSrc),pickTriangle:this._programFactory.getProgram(d+"-pickTriangle",e.pickTriangleVertexSrc,e.pickTriangleFragmentSrc),depth:this._programFactory.getProgram(d+"-depth",e.depthVertexSrc,e.depthFragmentSrc),drawTexture:this._programFactory.getProgram(d+"-drawTexture",e.drawTextureVertexSrc,e.drawTextureFragmentSrc),id:this._nextProgramId++,gl:this._canvas.gl},c.hash=d,c.sortKey=1e5*(c.program.id+1)+c.texture.stateId}this._setChunk(c,"draw",0,"program"),this._setChunk(c,"draw",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"draw",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(c,"draw",3,"regionMap",[this.regionMap]),this._setChunk(c,"draw",4,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"draw",5,"draw",[this.geometry]),this._setChunk(c,"xray",0,"program"),this._setChunk(c,"xray",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"xray",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"xray",3,"draw",[this.geometry]),this._setChunk(c,"pick",0,"program"),this._setChunk(c,"pick",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"pick",2,"regionMap",[this.regionMap]),this._setChunk(c,"pick",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"pick",4,"draw",[this.geometry]),this._setChunk(c,"pickTriangle",0,"program"),this._setChunk(c,"pickTriangle",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"pickTriangle",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"pickTriangle",3,"draw",[this.geometry]),this._setChunk(c,"depth",0,"program"),this._setChunk(c,"depth",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"depth",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"depth",3,"draw",[this.geometry]),this._setChunk(c,"drawTexture",0,"program"),this._setChunk(c,"drawTexture",1,"object",[this.properties,this.modelTransform]),this._setChunk(c,"drawTexture",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(c,"drawTexture",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(c,"drawTexture",4,"draw",[this.geometry]),this.objectListDirty=!0},d.prototype._setChunk=function(a,b,c,d,e){{var f;this._chunkFactory.chunkTypes[d]}void 0===a.chunkSets[b]&&(a.chunkSets[b]=[]);var g=a.chunkSets[b];if(e){for(var h=!0,i=0,j=e.length;j>i;++i)if(!e[i].empty){h=!1;break}if(h){var k=g[c];return k&&this._chunkFactory.putChunk(k),void(g[c]=null)}f="p"+a.program.id;for(var i=0,j=e.length;j>i;++i)f+="_"+e[i].stateId}else f="p"+a.program.id;f=c+"__"+f;var k=g[c];if(k){if(k.id==f)return;this._chunkFactory.putChunk(k)}g[c]=this._chunkFactory.getChunk(f,d,a.program,e)},d.prototype.removeObject=function(a){var b=this._objects[a];if(b){this._programFactory.putProgram(b.program),b.program=null,b.hash=null;for(var c in b.chunkSets)for(var d,e=b.chunkSets[c],f=0,g=e.length;g>f;f++)d=e[f],d&&this._chunkFactory.putChunk(d);delete this._objects[a],this.objectListDirty=!0}},d.prototype.prepareScene=function(){this.objectListDirty&&(this._buildObjectList(),this.objectListDirty=!1,this.imageDirty=!0)},d.prototype.render=function(a){a=a||{},0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height&&(this.imageDirty||a.force)&&(this._doDrawList({clear:a.clear!==!1,opaqueOnly:a.opaqueOnly,pass:a.pass,custom:a.custom}),this.imageDirty=!1,this.pickBufDirty=!0)},d.prototype._buildObjectList=function(){var c,d=(this._numOpaqueObjects,this._numTransparentObjects,SceneJS.PROPERTY_FLAGS.ENABLED),e=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS);this._numOpaqueObjects=0,this._numTransparentObjects=0;for(c in this._objects){var f=this._objects[c];f.properties.flags&d&&(f.isTransparent()?(this._transparentObjects[this._numTransparentObjects++]=f,e&&f.isPartiallyOpaque()&&(this._opaqueObjects[this._numOpaqueObjects++]=f)):this._opaqueObjects[this._numOpaqueObjects++]=f)}this._opaqueObjects.length=this._numOpaqueObjects,this._opaqueObjects.sort(a),this._transparentObjects.length=this._numTransparentObjects,this._transparentObjects.sort(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ORDER_DEPENDENT?b:a)},function(){var a=vec3.create(),b=vec3.create(),c=mat4.create(),e=mat4.frustum(mat4.create(),-1,1,-1,1,.1,1e4),f=vec3.create(),g=vec3.create(),h=vec3.create(),i=(vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),mat4.create(),mat4.create(),vec4.create(),vec4.create(),vec3.create()),j=(vec3.create(),vec3.create(),vec3.create(),vec2.create(),vec2.create(),vec2.create(),vec2.create(),function(){var a=mat4.create(),b=mat4.create(),c=mat4.create(),d=vec4.create(),e=vec4.create();return function(f,g,h,i,j){var k=g.modelTransform.matrix,l=g.viewMatrix,m=g.projectionMatrix;mat4.multiply(a,l,k),mat4.multiply(b,m,a),mat4.invert(c,b);var n=f.width,o=f.height,p=(h[0]-n/2)/(n/2),q=-(h[1]-o/2)/(o/2);vec4.transformMat4(d,[p,q,-1,1],c),vec3.scale(d,d,1/d[3]),vec4.transformMat4(e,[p,q,1,1],c),vec3.scale(e,e,1/e[3]),i[0]=d[0],i[1]=d[1],i[2]=d[2],vec3.subtract(j,e,d),vec3.normalize(j,j)}}()),k=function(){var a=mat4.create(),b=vec4.create(),c=vec4.create();return function(d,e,f,g,h){var i=d.modelTransform.matrix;mat4.invert(a,i),b[0]=e[0],b[1]=e[1],b[2]=e[2],b[3]=1,vec4.transformMat4(c,b,a),g[0]=c[0],g[1]=c[1],g[2]=c[2],vec3.transformMat4(h,f,a)}}();d.prototype.pick=function(d){if(!(d.canvasPos||!d.rayPick||d.origin&&d.direction))return void console.warn("Incomplete pick parameters");if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){var l,m,n,o=this._canvas.canvas,p=d.canvasPos,q=this.pickBuf,r=null;q||(q=this.pickBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas}));var s,t,u,v,w=!d.canvasPos;if(w){s=d.origin||new Float32Array([0,0,0]),t=d.direction||new Float32Array([0,0,1]);var x=vec3.add(i,s,t),y=new Float32Array([0,1,0]);mat4.lookAt(c,s,x,y),u=.5*o.clientWidth,v=.5*o.clientHeight}else u=p[0],v=p[1];this.prepareScene(),this.render(),q.bind(),q.clear(),this._doDrawList({pickObject:!0,clear:!0,pickViewMatrix:w?c:null,pickProjMatrix:w?e:null}),this._canvas.gl.finish();var z=q.read(u,v),A=z[0]+256*z[1]+256*z[2]*256+256*z[3]*256*256,B=this._pickLookup[A-1];if(B>=0){l=B<this._numOpaqueObjects?this._opaqueObjects[B]:this._transparentObjects[B-this._numOpaqueObjects],r={canvasPos:p,objectId:l.id};var C=l.properties;C&&(r.name=C.name,r.nodeId=C.nodeId)}if(d.pickRegion&&(q.clear(),this._doDrawList({pickRegion:!0,object:l,pickViewMatrix:w?c:null,pickProjMatrix:w?e:null,clear:!0}),z=q.read(u,v),0!==z[0]||0!==z[1]||0!==z[2]||0!==z[3])){r=r||{canvasPos:p};var D,E,F={r:z[0]/255,g:z[1]/255,b:z[2]/255,a:z[3]/255},G=this._frameCtx.regionData,H=.01,I={};for(m=0,n=G.length;n>m;m++)if(D=G[m].color,F&&G[m].data&&(E=Math.max(Math.abs(F.r-D.r),Math.abs(F.g-D.g),Math.abs(F.b-D.b),Math.abs(F.a-(void 0===D.a?F.a:D.a))),H>E)){I=G[m].data;break}r.color=F,r.regionData=I}if(d.pickTriangle&&l){q.clear(),this._doDrawList({pickTriangle:!0,object:l,pickViewMatrix:w?c:null,pickProjMatrix:w?e:null,clear:!0}),z=q.read(u,v);var J=z[0]+256*z[1]+256*z[2]*256+256*z[3]*256*256;J*=3,r.primitiveIndex=J,"triangles"===l.geometry.primitiveName&&(r.primitive="triangle",w?k(l,s,t,a,b):j(o,l,p,a,b),r.indices=vec3.create(),l.getTriangleIndices(J,r.indices),l.getTrianglePositionOnSurface(J,f,g,h),r.position=vec3.create(),SceneJS_math_rayPlaneIntersect(a,b,f,g,h,r.position),r.barycentric=vec3.create(),l.cartesianToBarycentric(J,r.position,r.barycentric),r.normal=vec3.create(),l.normalFromBarycentric(J,r.barycentric,r.normal),r.worldPos=vec3.create(),l.getPointInWorldSpace(r.position,r.worldPos),r.uvs=[],l.uvFromBarycentric(J,r.barycentric,r.uvs),r.uvs.length>0&&(r.uv=r.uvs[0]))}return q.unbind(),r}}}(),d.prototype._doDrawList=function(){function a(a){d[a]||(d[a]=new Int32Array(8));for(var b=d[a],c=0,e=b.length;e>c;++c)b[c]=-1}function b(a,b,c){var e,f=a.gl,g=b.chunkSets[c],h=d[c];a.backfaces!=b.backfaces&&(b.backfaces?f.disable(f.CULL_FACE):f.enable(f.CULL_FACE),a.backfaces=b.backfaces),a.addBlend!=b.addBlend&&(b.addBlend?f.blendFunc(f.ONE,f.ONE):f.blendFunc(f.ONE,f.ONE_MINUS_SRC_ALPHA),a.addBlend=b.addBlend);for(var i=0,j=g.length;j>i;i++)e=g[i],e&&(e.unique||h[i]!==e.numericId)&&(e.draw(c,a),h[i]=e.numericId)}var d={},e=new Float32Array(2);return function(d){var f=this._canvas.gl,g=this._frameCtx;g.gl=f,g.pass=d.pass||0,g.targetIndex=0,g.viewMatrix=this.viewMatrix,g.cameraEye=this.camera.eye,g.modelMat=null,g.cameraMat=null,g.projectionMatrix=this.projectionMatrix,g.lights=this.lights,g.clips=this.clips,g.highlightColor=this.highlightColor,g.desatParams=this.desatParams,g.fogParams=this.fogParams,g.fogColor=this.fogColor,g.fogMode=this.fogMode,g.fogEnabled=this.fogEnabled,g.xrayColor=this.xrayColor,g.scissorTestEnabled=!1,g.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,g.backfaces=!0,g.frontface=SceneJS.PROPERTY_FLAGS.CCW,g.picking=!!d.pickObject||!!d.pickTriangle||!!d.pickRegion,g.pickObject=!!d.pickObject,g.pickTriangle=!!d.pickTriangle,g.pickRegion=!!d.pickRegion,g.pickIndex=1,g.textureUnit=0,g.lineWidth=1,g.transparent=0,g.ambientColor=this._ambientColor,g.canvasResolution=g.canvasResolution||new Float32Array(2),g.canvasResolution[0]=this._canvas.canvas.width,g.canvasResolution[1]=this._canvas.canvas.height,g.aspect=this._canvas.canvas.width/this._canvas.canvas.height,g.texture=null,g.hasNormalMap=!1,g.regionMapUVLayerIdx=-1,g.drawElements=0,g.drawArrays=0,g.useProgram=0,g.bindTexture=0,g.bindArray=0,g.pickViewMatrix=d.pickViewMatrix,g.pickProjMatrix=d.pickProjMatrix,g.discardOpaque=!1,g.outputFormat=0,g.depthBuffer=null,g.addBlend=!1;var h=f.getExtension("OES_vertex_array_object");g.VAO=h?h:null,SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_standard_derivatives&&f.getExtension("OES_standard_derivatives"),f.viewport(this.viewport[0],this.viewport[1],this.viewport[2],this.viewport[3]),f.enable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),f.depthMask(!0),this.transparent||g.picking?f.clearColor(0,0,0,0):f.clearColor(this._ambientColor[0],this._ambientColor[1],this._ambientColor[2],1);var i,j,k;if(d.custom){var l=d.custom.renderMode,m=d.custom.objects;for(a(l),i=0;i<m.length;i++)k=m[i],b(g,k,l)}else if(d.pickObject){a("pick");var n=0;for(d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),i=0,j=this._numOpaqueObjects;j>i;i++)k=this._opaqueObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=i,b(g,k,"pick"));for(i=0,j=this._numTransparentObjects;j>i;i++)k=this._transparentObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=this._numOpaqueObjects+i,b(g,k,"pick"))}else if(d.pickTriangle&&d.object)d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),a("pickTriangle"),b(g,d.object,"pickTriangle");else if(d.pickRegion)if(a("pick"),d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),d.object)b(g,d.object,"pick");else{var n=0;if(d.pickRegion){for(i=0,j=this._numOpaqueObjects;j>i;i++)k=this._opaqueObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=i,b(g,k,"pick"));for(i=0,j=this._numTransparentObjects;j>i;i++)k=this._transparentObjects[i],k.properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[n++]=this._numOpaqueObjects+i,b(g,k,"pick"))}}else{a("draw"),a("xray");var o=(Date.now(),d.opaqueOnly,this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this._numTransparentObjects>0||this.postProcessPipelineOpaque.length>0||this.postProcessPipelineFinal.length>0);for(o&&this.mainFramebuffer.bind(),d.clear&&f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT),i=0,j=this._numOpaqueObjects;j>i;i++){var k=this._opaqueObjects[i];k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw")}o&&this.mainFramebuffer.unbind(),this.postProcessPipelineOpaque.length>0&&(f.disable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE));for(var i=0,j=this.postProcessPipelineOpaque.length;j>i;++i){var p=this.postProcessPipelineOpaque[i];p.framebuffer&&p.framebuffer.bind(),p.draw(g),p.framebuffer&&p.framebuffer.unbind()}if(this.postProcessPipelineOpaque.length>0&&(f.enable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),g.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,g.backfaces=SceneJS.PROPERTY_FLAGS.BACKFACES,g.frontface=SceneJS.PROPERTY_FLAGS.CCW,g.addBlend=!1),this._numTransparentObjects>0){if(a("draw"),a("xray"),o&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.bind(),this.depthSort&&this._transparentObjects.sort(c),g.discardOpaque=!0,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_BLEND){var q=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK);f.enable(f.BLEND),this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA?f.blendFunc(f.ONE,f.ONE):f.blendFunc(f.ONE,f.ONE_MINUS_SRC_ALPHA);var r=SceneJS.PROPERTY_FLAGS.NO_DEPTH_MASK;for(q&&f.depthMask(!1),i=0;i<this._numTransparentObjects;i++){var k=this._transparentObjects[i],s=!q&&k.properties.flags&r;s&&f.depthMask(!1),k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw"),s&&f.depthMask(!0)}f.disable(f.BLEND),f.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT){for(a("depth"),e[0]=1/g.canvasResolution[0],e[1]=1/g.canvasResolution[1],this.oitDepthBuffer.bind(),f.clear(f.DEPTH_BUFFER_BIT),f.colorMask(!1,!1,!1,!1),i=0;i<this._numTransparentObjects;i++)b(g,this._transparentObjects[i],"depth");for(f.colorMask(!0,!0,!0,!0),this.oitDepthBuffer.unbind(),f.clearColor(0,0,0,1),f.enable(f.BLEND),f.blendFuncSeparate(f.ONE,f.ONE,f.ZERO,f.ONE_MINUS_SRC_ALPHA),f.depthMask(!1),this.oitAccumulateFramebuffer.bind(),f.clear(f.COLOR_BUFFER_BIT),g.outputFormat=1,g.depthBuffer=this.oitDepthBuffer.getDepthTarget(),i=0;i<this._numTransparentObjects;i++){var k=this._transparentObjects[i];k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw")}this.oitAccumulateFramebuffer.unbind(),f.disable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),this.mainFramebuffer.bind(),f.blendFunc(f.ONE,f.ONE_MINUS_SRC_ALPHA),
this.oitPostprocess.setUniform("uTexelOffset",e),this.oitPostprocess.draw(g),this.mainFramebuffer.unbind(),f.disable(f.BLEND),f.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE){for(f.enable(f.SAMPLE_ALPHA_TO_COVERAGE),i=0;i<this._numTransparentObjects;i++){var k=this._transparentObjects[i];k.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?b(g,k,"xray"):b(g,k,"draw")}f.disable(f.SAMPLE_ALPHA_TO_COVERAGE)}o&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.unbind()}if(o)if(f.disable(f.DEPTH_TEST),f.frontFace(f.CCW),f.disable(f.CULL_FACE),this.postProcessPipelineFinal.length>0)for(var i=0,j=this.postProcessPipelineFinal.length;j>i;++i){var p=this.postProcessPipelineFinal[i];p.framebuffer&&p.framebuffer.bind(),p.draw(g),p.framebuffer&&p.framebuffer.unbind()}else this.blitPostprocess.draw(g);{Date.now()}this.stats.frame.drawElements=g.drawElements,this.stats.frame.drawArrays=g.drawArrays,this.stats.frame.useProgram=g.useProgram,this.stats.frame.bindTexture=g.bindTexture,this.stats.frame.bindArray=g.bindArray,this.stats.frame.drawChunks=this._drawListLen}if(g.VAO)for(g.VAO.bindVertexArrayOES(null),i=0;10>i;i++)f.disableVertexAttribArray(i)}}(),d.prototype.readPixels=function(a,b,c){if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){this._readPixelBuf||(this._readPixelBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas})),this._readPixelBuf.bind(),this._readPixelBuf.clear(),this.prepareScene(),this.render({force:!0,opaqueOnly:c});for(var d,e,f=0;b>f;f++)d=a[f]||(a[f]={}),e=this._readPixelBuf.read(d.x,d.y),d.r=e[0],d.g=e[1],d.b=e[2],d.a=e[3];this._readPixelBuf.unbind()}},d.prototype.destroy=function(){this._programFactory.destroy()}}(),function(){"use strict";var a=SceneJS.DISPLAY_FLAGS,b=SceneJS.TEXTURE_FLAGS,c=SceneJS.CUBEMAP_FLAGS,d=SceneJS.PROPERTY_FLAGS,e=SceneJS.COLOR_MOD_FLAGS,f="highp"===SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION,g=SceneJS.WEBGL_INFO.textureLODSupported;window.SceneJS_ProgramSourceFactory=new function(){function h(){for(var a=E.properties.colorModifiers,b=0,c=a.length;c>b;b++)if(a[b].value.isScalarFresnel)return!0;return!1}function i(){for(var a=E.properties.colorModifiers,b=0,c=a.length;c>b;b++)if(a[b].value.isColorFresnel)return!0;return!1}function j(){for(var a=E.properties.opacityModifiers,b=0,c=a.length;c>b;b++)if(a[b].value.isScalarFresnel)return!0;return!1}function k(a){return B(),C("attribute vec4 SCENEJS_aVertex;"),a&&(C("attribute vec4 SCENEJS_aTriColor;"),C("varying vec4 SCENEJS_vTriColor;")),C("uniform mat4 SCENEJS_uMMatrix;"),C("uniform mat4 SCENEJS_uVMatrix;"),C("uniform mat4 SCENEJS_uPMatrix;"),ca&&(C("uniform float SCENEJS_uPointSize;"),fa&&C("attribute vec2 SCENEJS_aPointScaleRotation;")),ha&&C("uniform mat4 SCENEJS_uDecodePositionMatrix;"),C("varying vec4 SCENEJS_vWorldVertex;"),aa&&(C("attribute vec2 SCENEJS_aRegionMapUV;"),C("varying vec2 SCENEJS_vRegionMapUV;")),_&&(C("uniform float SCENEJS_uMorphFactor;"),E.morphGeometry.targets[0].vertexBuf&&C("attribute vec4 SCENEJS_aMorphVertex;"),ha&&C("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),C("void main(void) {"),C(ha?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),_&&E.morphGeometry.targets[0].vertexBuf&&C(ha?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),C("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),C("mat4 vPosMatrix = SCENEJS_uVMatrix;"),W&&C("vPosMatrix[3].xyz = vec3(0.0);"),C("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),C("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),aa&&C("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),a&&C("SCENEJS_vTriColor = SCENEJS_aTriColor;"),ca&&(C("gl_PointSize = SCENEJS_uPointSize;"),ea&&C("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),fa&&C("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),C("gl_PointSize = min(gl_PointSize, "+Aa+");")),C("}"),D()}function l(a){if(B(),C("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),C("varying vec4 SCENEJS_vWorldVertex;"),a?C("varying vec4  SCENEJS_vTriColor;"):(C("uniform float  SCENEJS_uPickMode;"),C("uniform vec4  SCENEJS_uPickColor;")),$)for(var b=0;b<E.clips.clips.length;b++)C("uniform vec4  SCENEJS_uClipNormalAndDist"+b+";"),E.clips.clips[b].fade&&C("uniform float SCENEJS_uClipFadeDistance"+b+";");if(aa&&(C("varying vec2 SCENEJS_vRegionMapUV;"),C("uniform sampler2D SCENEJS_uRegionMapSampler;")),C("void main(void) {"),$){E.clips.clipDiscard&&C("float distOff = 0.0;"),E.clips.clipFade&&C("float distAlpha = 0.0;");for(var b=0;b<E.clips.clips.length;b++)C(E.clips.clips[b].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w) / SCENEJS_uClipFadeDistance"+b+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w);");E.clips.clipDiscard&&C("if (distOff > 0.0) { discard; }"),E.clips.clipFade&&C("if (distAlpha > 1.0) { discard; }")}return a?C("gl_FragColor = SCENEJS_vTriColor;  "):(C("    if  (SCENEJS_uPickMode == 0.0) {"),C("          gl_FragColor = SCENEJS_uPickColor;  "),C("    } else {"),C(aa?"          gl_FragColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t));":"          gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"),C("    }")),C("}"),D()}function m(){B(),C("attribute vec4 SCENEJS_aVertex;"),C("uniform mat4 SCENEJS_uMMatrix;"),C("uniform mat4 SCENEJS_uVMatrix;"),C("uniform mat4 SCENEJS_uPMatrix;"),ha&&C("uniform mat4 SCENEJS_uDecodePositionMatrix;");var a=0,b=null,c=null;return R&&(c=E.texture.layers[E.texture.drawLayerIndex],c&&(a=c.uvLayerIdx||0),E.geometry.uvBufs&&(b=E.geometry.uvBufs[a]),b&&(C("varying vec2 SCENEJS_vUVCoord"+a+";"),C("attribute vec2 SCENEJS_aUVCoord"+a+";"),ja&&C("uniform mat3 SCENEJS_uDecodeUVMatrix"+a+";"))),C("varying vec4 SCENEJS_vWorldVertex;"),_&&(C("uniform float SCENEJS_uMorphFactor;"),E.morphGeometry.targets[0].vertexBuf&&C("attribute vec4 SCENEJS_aMorphVertex;"),ha&&C("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),C("void main(void) {"),C(ha?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),_&&E.morphGeometry.targets[0].vertexBuf&&C(ha?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),C("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),C("mat4 vPosMatrix = SCENEJS_uVMatrix;"),C("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),C("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),R&&b&&C(ja?"SCENEJS_vUVCoord"+a+" = (SCENEJS_uDecodeUVMatrix"+a+" * vec3(SCENEJS_aUVCoord"+a+", 1.0)).xy;":"SCENEJS_vUVCoord"+a+" = SCENEJS_aUVCoord"+a+";"),C("}"),D()}function n(){B(),C("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;");var a=0,b=null,c=null;return R&&(c=E.texture.layers[E.texture.drawLayerIndex],c&&(a=c.uvLayerIdx||0),E.geometry.uvBufs&&(b=E.geometry.uvBufs[a]),b&&(C("uniform sampler2D SCENEJS_uDrawSampler;"),C("varying vec2 SCENEJS_vUVCoord"+a+";"))),C("void main(void) {"),C("vec4 color = vec4(0.0);"),R&&b&&c&&(C("vec2 textureCoord;"),C("textureCoord = SCENEJS_vUVCoord"+a+";"),c.compressed&&C("   textureCoord.y = 1.0 - textureCoord.y;"),C("if(textureCoord.x != -1.0) {"),C("   color = texture2D(SCENEJS_uDrawSampler, textureCoord);"),C("}")),C("gl_FragColor = color;"),C("}"),D()}function o(){return E.regionMap.empty?!1:q()}function p(){return E.texture.layers&&E.texture.layers.length>0?q():!1}function q(){return"points"===E.geometry.primitiveName?!0:E.geometry.uvBufs?!0:E.morphGeometry.targets&&(E.morphGeometry.targets[0].uvBuf||E.morphGeometry.targets[0].uvBuf2)?!0:!1}function r(a){if(!a.properties.getFlag(d.REFLECTIVE))return!1;if(!a.geometry.normalBuf)return!1;if(!a.cubemap.layers)return!1;for(var b=0,e=a.cubemap.layers.length;e>b;b++)if(a.cubemap.layers[b].applyTo===c.reflect)return!0;return!1}function s(a){if(!a.geometry.normalBuf)return!1;if(!a.cubemap.layers)return!1;for(var b=0,d=a.cubemap.layers.length;d>b;b++)if(a.cubemap.layers[b].applyTo===c.light)return!0;return!1}function t(a){return a.geometry.normalBuf?!0:a.morphGeometry.targets&&a.morphGeometry.targets[0].normalBuf?!0:!1}function u(a){if(a.texture){var c=a.texture.layers;if(!c)return!1;for(var d=0,e=c.length;e>d;d++)if(c[d].flags&b.normals)return!0}return!1}function v(){var a,b;if(B(),C("uniform mat4 SCENEJS_uMMatrix;"),C(f?"uniform mat4 SCENEJS_uVMatrix;":"uniform mediump mat4 SCENEJS_uVMatrix;"),C("uniform mat4 SCENEJS_uPMatrix;"),C("attribute vec4 SCENEJS_aVertex;"),C(f?"uniform vec3 SCENEJS_uWorldEye;":"uniform mediump vec3 SCENEJS_uWorldEye;"),C("varying vec3 SCENEJS_vViewEyeVec;"),ca&&(C("uniform float SCENEJS_uPointSize;"),fa&&(C("attribute vec2 SCENEJS_aPointScaleRotation;"),C("varying float SCENEJS_vPointRotation;")),ga&&(C("attribute vec2 SCENEJS_aPointUVTranslate;"),C("varying vec2 SCENEJS_vPointUVTranslate;"))),ha&&C("uniform mat4 SCENEJS_uDecodePositionMatrix;"),U&&(C("attribute vec3 SCENEJS_aNormal;"),C("uniform   mat4 SCENEJS_uMNMatrix;"),C("varying   vec3 SCENEJS_vViewNormal;"),(S||T)&&C("varying   vec3 SCENEJS_vWorldNormal;"),Y&&!Z&&(C("attribute vec3 SCENEJS_aTangent;"),C("varying   vec3 SCENEJS_vTangent;"))),R&&(b=E.geometry.uvBufs))for(var a=0,c=b.length;c>a;a++)b[a]&&(C("attribute vec2 SCENEJS_aUVCoord"+a+";"),ja&&C("uniform mat3 SCENEJS_uDecodeUVMatrix"+a+";"));if(E.geometry.colorBuf&&(C("attribute vec4 SCENEJS_aVertexColor;"),C("varying vec4 SCENEJS_vColor;")),($||U||ma||sa)&&C("varying vec4 SCENEJS_vWorldVertex;"),wa&&C("varying vec4 SceneJS_vModelVertex;"),C("varying vec4 SCENEJS_vViewVertex;"),R&&(b=E.geometry.uvBufs))for(a=0,c=b.length;c>a;a++)b[a]&&C("varying vec2 SCENEJS_vUVCoord"+a+";");if(ba&&(C("attribute vec2 SCENEJS_aRegionMapUV;"),C("varying vec2 SCENEJS_vRegionMapUV;")),_&&(C("uniform float SCENEJS_uMorphFactor;"),E.morphGeometry.targets[0].vertexBuf&&C("attribute vec4 SCENEJS_aMorphVertex;"),U&&E.morphGeometry.targets[0].normalBuf&&C("attribute vec3 SCENEJS_aMorphNormal;"),Y&&!Z&&C("attribute vec3 SCENEJS_aMorphTangent;"),ha&&C("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),X&&(C("void billboard(inout mat4 mat) {"),C("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),C("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),C("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),C("}")),ia&&(C("vec3 octDecode(vec2 oct) {"),C("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),C("    if (v.z < 0.0) {"),C("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),C("    }"),C("    return normalize(v);"),C("}")),C("void main(void) {"),Y&&!Z&&C("vec3 modelTangent = SCENEJS_aTangent;"),C(ha?"  vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"  vec4 modelVertex = SCENEJS_aVertex; "),ia?C("  vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):U&&C("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),_&&(E.morphGeometry.targets[0].vertexBuf&&C(ha?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),U&&E.morphGeometry.targets[0].normalBuf&&C(ia?"  modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"  modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); "),Y&&!Z&&C("  modelTangent = mix(modelTangent, SCENEJS_aMorphTangent, SCENEJS_uMorphFactor); ")),wa&&C("SceneJS_vModelVertex = modelVertex;;"),C("mat4 modelMatrix = SCENEJS_uMMatrix;"),C("mat4 viewMatrix = SCENEJS_uVMatrix;"),U&&C("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),C("vec4 worldVertex;"),C("vec4 viewVertex;"),W&&C("viewMatrix[3].xyz = vec3(0.0);"),X?(C("   mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),C("   billboard(modelMatrix);"),C("   billboard(viewMatrix);"),C("   billboard(modelViewMatrix);"),U&&C("   billboard(modelNormalMatrix);"),C("   worldVertex = modelMatrix * modelVertex;"),C("   viewVertex = modelViewMatrix * modelVertex;")):(C("  worldVertex = modelMatrix * modelVertex;"),C("  viewVertex  = viewMatrix * worldVertex; ")),U&&(C("  vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),C("  SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;"),(S||T)&&C("SCENEJS_vWorldNormal = worldNormal;")),($||U||ma||sa)&&C("  SCENEJS_vWorldVertex = worldVertex;"),C("  SCENEJS_vViewVertex = viewVertex;"),C("  gl_Position = SCENEJS_uPMatrix * viewVertex;"),Y&&!Z&&C("SCENEJS_vTangent = modelTangent;"),C("SCENEJS_vViewEyeVec = ((viewMatrix * vec4(SCENEJS_uWorldEye, 1.0)).xyz  - viewVertex.xyz);"),R&&(b=E.geometry.uvBufs))for(a=0,c=b.length;c>a;a++)b[a]&&C(ja?"SCENEJS_vUVCoord"+a+" = (SCENEJS_uDecodeUVMatrix"+a+" * vec3(SCENEJS_aUVCoord"+a+", 1.0)).xy;":"SCENEJS_vUVCoord"+a+" = SCENEJS_aUVCoord"+a+";");return E.geometry.colorBuf&&C("SCENEJS_vColor = SCENEJS_aVertexColor;"),ba&&C("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),ca&&(C("gl_PointSize = SCENEJS_uPointSize;"),ea&&C("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),fa&&(C("SCENEJS_vPointRotation = SCENEJS_aPointScaleRotation.y;"),C("gl_PointSize *= SCENEJS_aPointScaleRotation.x;")),ga&&C("SCENEJS_vPointUVTranslate = SCENEJS_aPointUVTranslate;"),C("gl_PointSize = min(gl_PointSize, "+Aa+");")),C("}"),D()}function w(){var c=E.fresnel.diffuse,d=E.fresnel.specular,f=E.fresnel.alpha,h=E.fresnel.transparency,i=E.fresnel.reflect,j=E.fresnel.emit,k=E.fresnel.fragment;if(B(),(Y&&Z||wa)&&C("#extension GL_OES_standard_derivatives : enable"),g&&C("#extension GL_EXT_shader_texture_lod : enable"),xa&&C(xa),C("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),C("uniform sampler2D SCENEJS_uDepthBuffer;"),C("uniform vec2 SCENEJS_uCanvasRes;"),(H||I)&&(C("vec4 sRGBToLinear( in vec4 value ) {"),C("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),C("}")),va&&C("uniform bool SCENEJS_uDiscardOpaque;"),wa&&(C("float hash(vec2 v) {"),C("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),C("}"),C("float hash3D(vec3 v) {"),C("    return hash(vec2(hash(v.xy), v.z));"),C("}")),H&&(C("#define PI 3.14159265359"),C("#define RECIPROCAL_PI 0.31830988618"),C("#define RECIPROCAL_PI2 0.15915494"),C("#define EPSILON 1e-6"),C("#define saturate(a) clamp( a, 0.0, 1.0 )"),C("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),C("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),C("}"),C("struct IncidentLight {"),C("   vec3 color;"),C("   vec3 direction;"),C("};"),C("struct ReflectedLight {"),C("   vec3 diffuse;"),C("   vec3 specular;"),C("};"),C("struct Geometry {"),C("   vec3 position;"),C("   vec3 viewNormal;"),C("   vec3 worldNormal;"),C("   vec3 viewEyeDir;"),C("};"),C("struct Material {"),C("   vec3    diffuseColor;"),C("   float   specularRoughness;"),C("   vec3    specularColor;"),C("   float   shine;"),C("};"),T&&(C("void computePBRLightMapping(const in samplerCube lightMap, const in float intensity, const in vec3 normal, const in Material material, inout ReflectedLight reflectedLight) {"),C("   reflectedLight.diffuse += (sRGBToLinear(textureCube(lightMap, normal)).rgb * PI) * (RECIPROCAL_PI * material.diffuseColor) * intensity;"),C("}")),S&&(C("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),C("   float r = ggxRoughness + 0.0001;"),C("   return (2.0 / (r * r) - 2.0);"),C("}"),C("float getSpecularMIPLevel(const in float blinnShininessExponent, float maxMipLevels) {"),C("   float desiredMIPLevel = maxMipLevels - 0.79248 - 0.5 * log2( (blinnShininessExponent * blinnShininessExponent) + 1.0 );"),C("   return clamp( desiredMIPLevel, 0.0, maxMipLevels );"),C("}"),C("vec3 getLightProbeIndirectRadiance(const in samplerCube reflectMap, const in vec3 reflectVec, const in float blinnShininessExponent, float maxMipLevels) {"),C("   float mipLevel = getSpecularMIPLevel(blinnShininessExponent, maxMipLevels);"),C(g?"   vec3 envMapColor = sRGBToLinear(textureCubeLodEXT(reflectMap, reflectVec, mipLevel)).rgb;":"   vec3 envMapColor = sRGBToLinear(textureCube(reflectMap, reflectVec, mipLevel)).rgb;"),C("   return envMapColor;"),C("}"),C("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),C("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),C("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),C("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),C("   vec4 r = roughness * c0 + c1;"),C("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),C("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),C("   return specularColor * AB.x + AB.y;"),C("}"),C("void computePBRReflectionMapping(const in samplerCube reflectMap, const in float intensity, const in mat4 viewMatrix, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight, float maxMipLevel) {"),C("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),C("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),C("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),C("   vec3 radiance               = getLightProbeIndirectRadiance(reflectMap, reflectVec, blinnExpFromRoughness, maxMipLevel);"),C("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),C("   reflectedLight.specular     += radiance * specularBRDFContrib * intensity;"),C("}")),C("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),C("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),C("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),C("}"),C("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),C("   float a2 = alpha * alpha;"),C("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),C("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),C("   return 1.0 / ( gl * gv );"),C("}"),C("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),C("   float a2 = ( alpha * alpha );"),C("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),C("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),C("   return 0.5 / max( gv + gl, EPSILON );"),C("}"),C("float D_GGX(const in float alpha, const in float dotNH) {"),C("   float a2 = ( alpha * alpha );"),C("   float denom = ( dotNH * dotNH ) * ( a2 - 1.0 ) + 1.0;"),C("   return RECIPROCAL_PI * a2 / ( denom * denom );"),C("}"),C("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),C("   float alpha = ( roughness * roughness );"),C("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),C("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),C("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),C("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),C("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),C("   vec3  F = F_Schlick( specularColor, dotLH );"),C("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),C("   float D = D_GGX( alpha, dotNH );"),C("   return F * (G * D);"),C("}"),C("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),C("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),C("   vec3 irradiance = dotNL * incidentLight.color * PI;"),C("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),C("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),C("}")),($||U||ma||sa)&&C("varying vec4 SCENEJS_vWorldVertex;"),wa&&C("varying vec4 SceneJS_vModelVertex;"),C("varying vec4 SCENEJS_vViewVertex;"),E.geometry.colorBuf&&C("varying vec4 SCENEJS_vColor;"),R){Y&&(Z?(C("vec3 perturbNormal2Arb( sampler2D sampler, vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),C("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),C("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),C("      vec2 st0 = dFdx( uv.st );"),C("      vec2 st1 = dFdy( uv.st );"),C("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),C("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),C("      vec3 N = normalize( surf_norm );"),C("      vec3 mapN = texture2D( sampler, uv ).xyz * 2.0 - 1.0;"),C("      mat3 tsn = mat3( S, T, N );"),C("      return normalize( tsn * mapN );"),C("}")):C("varying vec3 SCENEJS_vTangent;"));var l=E.geometry.uvBufs;if(l)for(var m=0,n=l.length;n>m;m++)l[m]&&C("varying vec2 SCENEJS_vUVCoord"+m+";")}if(C("uniform mat4 SCENEJS_uVMatrix;"),C("uniform mat4 SCENEJS_uMMatrix;"),C("uniform vec3 SCENEJS_uWorldEye;"),C("varying vec3 SCENEJS_vViewEyeVec;"),C("uniform vec4  SCENEJS_uMaterialColor;"),C("uniform vec4  SCENEJS_uMaterialEmitColor;"),R)for(var m=0,n=E.texture.layers.length;n>m;m++){var o=E.texture.layers[m];C("uniform sampler2D SCENEJS_uSampler"+m+";"),o.matrix&&C("uniform mat4 SCENEJS_uLayer"+m+"Matrix;"),C("uniform float SCENEJS_uLayer"+m+"BlendFactor;")}if((c||d||f||h||j||k||i||pa||qa||ra)&&(Ba.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),Ba.push("    float fr = abs(dot(eyeDir, normal));"),Ba.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),Ba.push("    return pow(finalFr, power);"),Ba.push("}"),c&&(C("uniform vec4 SCENEJS_uDiffuseFresnelCenterColor;"),C("uniform vec4 SCENEJS_uDiffuseFresnelEdgeColor;"),C("uniform float SCENEJS_uDiffuseFresnelPower;")),d&&(C("uniform vec4 SCENEJS_uSpecularFresnelCenterColor;"),C("uniform vec4 SCENEJS_uSpecularFresnelEdgeColor;"),C("uniform float SCENEJS_uSpecularFresnelPower;")),f&&(C("uniform vec4 SCENEJS_uAlphaFresnelCenterColor;"),C("uniform vec4 SCENEJS_uAlphaFresnelEdgeColor;"),C("uniform float SCENEJS_uAlphaFresnelPower;")),h&&(C("uniform vec4 SCENEJS_uTransparencyFresnelCenterColor;"),C("uniform vec4 SCENEJS_uTransparencyFresnelEdgeColor;"),C("uniform float SCENEJS_uTransparencyFresnelPower;")),i&&(C("uniform vec4 SCENEJS_uReflectFresnelCenterColor;"),C("uniform vec4 SCENEJS_uReflectFresnelEdgeColor;"),C("uniform float SCENEJS_uReflectFresnelPower;")),j&&(C("uniform vec4 SCENEJS_uEmitFresnelCenterColor;"),C("uniform vec4 SCENEJS_uEmitFresnelEdgeColor;"),C("uniform float SCENEJS_uEmitFresnelPower;")),k&&(C("uniform vec4 SCENEJS_uFragmentFresnelCenterColor;"),C("uniform vec4 SCENEJS_uFragmentFresnelEdgeColor;"),C("uniform float SCENEJS_uFragmentFresnelPower;"))),G&&(C("uniform vec3  SCENEJS_uAmbientColor;"),C("uniform vec4  SCENEJS_uMaterialSpecularColor;"),C("uniform float SCENEJS_uMaterialShine;")),H&&C("uniform vec4 SCENEJS_uMetalRoughSpecularf0;"),U){if(C("uniform vec2  SCENEJS_uXrayParams;"),S||T)for(var m=0,n=E.cubemap.layers.length;n>m;m++){var o=E.cubemap.layers[m];C("uniform samplerCube SCENEJS_uCubeMapSampler"+m+";"),C("uniform float SCENEJS_uCubeMapIntensity"+m+";"),C("uniform float SCENEJS_uCubeMapMipLevels"+m+";")}C("varying vec3 SCENEJS_vViewNormal;"),(S||T)&&C("varying vec3 SCENEJS_vWorldNormal;");for(var m=0;m<E.lights.length;m++){var p=E.lights[m];C("uniform vec3  SCENEJS_uLightColor"+m+";"),"dir"==p.mode&&C("uniform vec3 SCENEJS_uLightDir"+m+";"),"point"==p.mode&&(C("uniform vec3  SCENEJS_uLightAttenuation"+m+";"),C("uniform vec3 SCENEJS_uLightPos"+m+";")),"spot"==p.mode&&(C("uniform vec3  SCENEJS_uLightAttenuation"+m+";"),C("uniform vec3 SCENEJS_uLightPos"+m+";"),C("uniform vec3 SCENEJS_uLightDir"+m+";"),C("uniform float SCENEJS_uInnerCone"+m+";"),C("uniform float SCENEJS_uOuterCone"+m+";"))}}if(na){var q,r=0,s=E.properties.colorModifiers,n=s.length;for(r=0;n>r;r++)q=s[r],q.value.isColorFresnel||q.value.isScalarFresnel?(C("uniform vec4 SCENEJS_uColorModFresnelEdge"+r+";"),C("uniform vec4 SCENEJS_uColorModFresnelCenter"+r+";"),C("uniform float SCENEJS_uColorModFresnelPower"+r+";")):C(q.applyTo===e.TINT?"uniform vec3 SCENEJS_uColorModification"+r+";":"uniform float SCENEJS_uColorModification"+r+";"),q.range&&(C("uniform vec3 SCENEJS_uColorModCenter"+r+";"),C("uniform vec2 SCENEJS_uColorModRadius"+r+";"))}if(ta){var t,u=0,v=E.properties.opacityModifiers,n=v.length;for(u=0;n>u;u++)t=v[u],t.value.isScalarFresnel?(C("uniform vec4 SCENEJS_uOpacityModFresnelEdge"+u+";"),C("uniform vec4 SCENEJS_uOpacityModFresnelCenter"+u+";"),C("uniform float SCENEJS_uOpacityModFresnelPower"+u+";")):C("uniform float SCENEJS_uOpacityModification"+u+";"),t.range&&(C("uniform vec3 SCENEJS_uOpacityModCenter"+u+";"),C("uniform vec2 SCENEJS_uOpacityModRadius"+u+";"))}if(ka&&(C("uniform vec4   SCENEJS_uFogParams;"),C("uniform vec4   SCENEJS_uFogColor;")),ba&&(C("varying vec2 SCENEJS_vRegionMapUV;"),C("uniform sampler2D SCENEJS_uRegionMapSampler;"),C("uniform vec3 SCENEJS_uRegionMapRegionColor;"),C("uniform vec3 SCENEJS_uRegionMapHighlightFactor;"),C("uniform float SCENEJS_uRegionMapHideAlpha;")),$){V&&C("uniform vec3  SCENEJS_uSolidColor;");for(var m=0;m<E.clips.clips.length;m++)C("uniform vec4  SCENEJS_uClipNormalAndDist"+m+";"),E.clips.clips[m].fade&&C("uniform float SCENEJS_uClipFadeDistance"+m+";")}if(C("uniform float SCENEJS_uOutputFormat;"),C("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),ca&&(fa&&C("varying float SCENEJS_vPointRotation;"),ga&&(C("uniform vec2 SCENEJS_uPointUVScale;"),C("varying vec2 SCENEJS_vPointUVTranslate;"))),C("void main(void) {"),$){E.clips.clipDiscard&&C("float distOff = 0.0;"),E.clips.clipFade&&C("float distAlpha = 0.0;");for(var m=0;m<E.clips.clips.length;m++)C(E.clips.clips[m].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+m+".xyz) + SCENEJS_uClipNormalAndDist"+m+".w) / SCENEJS_uClipFadeDistance"+m+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+m+".xyz) + SCENEJS_uClipNormalAndDist"+m+".w);");E.clips.clipDiscard&&C("if (distOff > 0.0) { discard; }"),E.clips.clipFade&&C("if (distAlpha > 1.0) { discard; }"),V&&(C("if (gl_FrontFacing == false) {"),C("   gl_FragColor = vec4(SCENEJS_uSolidColor, 1.0);"),C("   return;"),C("}"))}if(ca&&da&&(C("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),C("float r = dot(cxy, cxy);"),C("if (r > 1.0) {"),C("   discard;"),C("}")),U&&C("vec3 worldEyeVec = normalize(SCENEJS_uWorldEye - SCENEJS_vWorldVertex.xyz);"),E.geometry.colorBuf?(C("  vec3  color   = SCENEJS_vColor.rgb;"),C("  float colorAlpha  = SCENEJS_vColor.a;")):C("  vec3  color   = SCENEJS_uMaterialColor.rgb;"),C("  float alpha = SCENEJS_uMaterialColor.a;"),C("  float emit          = SCENEJS_uMaterialEmitColor.a;"),C("  vec3  emitColor     = SCENEJS_uMaterialEmitColor.rgb;"),C("  float occlusion     = 1.0;"),E.geometry.colorBuf&&C("alpha *= colorAlpha;"),C("float transparency  = 1.0 - alpha;"),G&&(C("  vec3  ambientColor  = SCENEJS_uAmbientColor;"),C("  float specular      = SCENEJS_uMaterialSpecularColor.a;"),C("  vec3  specularColor = SCENEJS_uMaterialSpecularColor.rgb;"),C("  float shine         = SCENEJS_uMaterialShine;")),H&&(C("  vec3  ambientColor  = vec3(0.2, 0.2, 0.2);"),C("  float metallic      = SCENEJS_uMetalRoughSpecularf0.r;"),C("  float roughness     = SCENEJS_uMetalRoughSpecularf0.g;"),C("  float specularF0    = SCENEJS_uMetalRoughSpecularf0.b;")),U&&(C("float attenuation = 1.0;"),C(Y?"vec3 viewNormalVec = vec3(0.0, 0.0, 0.0);":"vec3 viewNormalVec = normalize(SCENEJS_vViewNormal);"),C("vec3 viewEyeVec = normalize(SCENEJS_vViewEyeVec);"),C("  float glassfactor = SCENEJS_uXrayParams.x;"),C("  float murkiness = SCENEJS_uXrayParams.y;"),C("if (transparency > 0.0) {"),C("  alpha = 1.0 - transparency;"),C("  float gf = (glassfactor  * (murkiness - abs(dot(SCENEJS_vViewNormal, vec3(0.0, 0.0, -1.0)))));"),C("  alpha = max(alpha, gf);"),C("  transparency = 1.0 - alpha;"),C("}")),U&&Y&&!Z&&(C("mat3 mat =  mat3(SCENEJS_uVMatrix * SCENEJS_uMMatrix);"),C("vec3 n = normalize(SCENEJS_vViewNormal);"),C("vec3 t = normalize(mat * SCENEJS_vTangent);"),C("vec3 b = normalize(cross(SCENEJS_vViewNormal, mat * SCENEJS_vTangent));"),C("mat3 TBN = mat3(t, b, n);")),R){C("vec2 textureCoord;");var w=!0,x=!0,y=!0,z=!0,A=!0,F=!0,J=!0,K=!0,L=!0;ca&&(C("vec2 pointCoord = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);"),C("vec2 centerCoord = vec2(0.5);"),ga&&(C("centerCoord = SCENEJS_vPointUVTranslate + SCENEJS_uPointUVScale * 0.5;"),C("pointCoord = pointCoord * SCENEJS_uPointUVScale + SCENEJS_vPointUVTranslate;")),fa&&(C("vec2 pivot = pointCoord - centerCoord;"),C("float c = cos(SCENEJS_vPointRotation);"),C("float s = sin(SCENEJS_vPointRotation);"),C("pointCoord.x = c * pivot.x + s * pivot.y + centerCoord.x;"),C("pointCoord.y = c * pivot.y - s * pivot.x + centerCoord.y;")));for(var m=0,n=E.texture.layers.length;n>m;m++){var o=E.texture.layers[m],M=o.uvLayerIdx||0,l=E.geometry.uvBufs;if(l&&l[M])C("textureCoord = SCENEJS_vUVCoord"+M+";");else{if(!ca){SceneJS.log.warn("Texture layer applyTo='uv' but geometry has no UV coordinates for layer "+M);continue}C("textureCoord = pointCoord;")}if(o.matrix&&C("textureCoord=(SCENEJS_uLayer"+m+"Matrix * vec4(textureCoord, 1.0, 1.0)).xy;"),o.compressed&&C("textureCoord.y = 1.0 - textureCoord.y;"),o.flags&b.alpha&&(w?(C("transparency = mix(transparency, 1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),w=!1):o.flags&b.multiply?(C("alpha = 1.0 - transparency;"),C("alpha *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"),C("transparency = 1.0 - alpha;")):o.flags&b.add?(C("alpha = 1.0 - transparency;"),C("alpha += SCENEJS_uLayer"+m+"BlendFactor * (texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"),C("transparency = 1.0 - alpha;")):o.flags&b.over&&(C("alpha = 1.0 - transparency;"),C("alpha = mix(alpha, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),C("transparency = 1.0 - alpha;"))),o.flags&b.transparency&&(w?(C("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),w=!1):o.flags&b.multiply?C("transparency *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"):o.flags&b.add?C("transparency += SCENEJS_uLayer"+m+"BlendFactor * (texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"):o.flags&b.over&&C("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);")),o.flags&b.occlusion&&(y?(C("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),y=!1):o.flags&b.multiply?C("occlusion *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"):o.flags&b.add?C("occlusion += SCENEJS_uLayer"+m+"BlendFactor * texture2D(SCENEJS_uSampler"+m+", textureCoord).r;"):o.flags&b.over&&C("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);")),G&&(I?(o.flags&b.baseColor&&(x?(C("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);"),x=!1):o.flags&b.multiply?C("color *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb);"):o.flags&b.add?C("color += SCENEJS_uLayer"+m+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb;"):o.flags&b.over&&C("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);")),
o.flags&b.emit&&(z?(C("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);"),z=!1):o.flags&b.multiply?C("emitColor *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb);"):o.flags&b.add?C("emitColor += SCENEJS_uLayer"+m+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb;"):o.flags&b.over&&C("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);"))):(o.flags&b.baseColor&&(x?(o.flags&b.conditionalAlpha?(C("if(textureCoord.x != -1.0) {"),C("   vec4 color"+m+" = texture2D(SCENEJS_uSampler"+m+", textureCoord);"),C("   color = mix(color, color"+m+".rgb, color"+m+".a * SCENEJS_uLayer"+m+"BlendFactor);"),C("}")):C("color = mix(color, texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb, SCENEJS_uLayer"+m+"BlendFactor);"),x=!1):o.flags&b.multiply?C("color *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb);"):o.flags&b.add?C("color += SCENEJS_uLayer"+m+"BlendFactor * texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb;"):o.flags&b.over?C("color = mix(color, texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb, SCENEJS_uLayer"+m+"BlendFactor);"):o.flags&b.conditionalAlpha&&(C("if(textureCoord.x != -1.0) {"),C("vec4 color"+m+" = texture2D(SCENEJS_uSampler"+m+", textureCoord);"),C("color = mix(color, color"+m+".rgb, color"+m+".a * SCENEJS_uLayer"+m+"BlendFactor);"),C("}"))),o.flags&b.emit&&(z?(C("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb, SCENEJS_uLayer"+m+"BlendFactor);"),z=!1):o.flags&b.multiply?C("emitColor *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb);"):o.flags&b.add?C("emitColor += SCENEJS_uLayer"+m+"BlendFactor * texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb;"):o.flags&b.over&&C("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+m+", textureCoord).rgb, SCENEJS_uLayer"+m+"BlendFactor);"))),o.flags&b.specular&&U&&(A?(C("specular = mix(specular, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),A=!1):o.flags&b.multiply?C("specular *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"):o.flags&b.add?C("specular += SCENEJS_uLayer"+m+"BlendFactor * texture2D(SCENEJS_uSampler"+m+", textureCoord).r;"):o.flags&b.over&&C("specular = mix(specular, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);")),o.flags&b.shine&&(F?(C("shine = mix((shine, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),F=!1):o.flags&b.multiply?C("shine *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"):o.flags&b.add?C("shine += SCENEJS_uLayer"+m+"BlendFactor * texture2D(SCENEJS_uSampler"+m+", textureCoord).r;"):o.flags&b.over&&C("shine = mix((shine, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"))),H&&(o.flags&b.baseColor&&(x?(C("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);"),x=!1):o.flags&b.multiply?C("color *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb);"):o.flags&b.add?C("color += SCENEJS_uLayer"+m+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb;"):o.flags&b.over&&C("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);")),o.flags&b.emit&&(z?(C("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);"),z=!1):o.flags&b.multiply?C("emitColor *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb);"):o.flags&b.add?C("emitColor += SCENEJS_uLayer"+m+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb;"):o.flags&b.over&&C("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+m+", textureCoord)).rgb, SCENEJS_uLayer"+m+"BlendFactor);")),o.flags&b.metallic&&(J?(C("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),J=!1):o.flags&b.multiply?C("metallic *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"):o.flags&b.add?C("metallic += SCENEJS_uLayer"+m+"BlendFactor * texture2D(SCENEJS_uSampler"+m+", textureCoord).r;"):o.flags&b.over&&C("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);")),o.flags&b.roughness&&(K?(C("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"),K=!1):o.flags&b.multiply?C("roughness *= 1.0 - SCENEJS_uLayer"+m+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+m+", textureCoord).r);"):o.flags&b.add?C("roughness += SCENEJS_uLayer"+m+"BlendFactor * texture2D(SCENEJS_uSampler"+m+", textureCoord).r;"):o.flags&b.over&&C("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+m+", textureCoord).r, SCENEJS_uLayer"+m+"BlendFactor);"))),o.flags&b.normals&&U){var N;o.flags&b.add?(N=L?"=":"+=",C(Z?"viewNormalVec "+N+" perturbNormal2Arb( SCENEJS_uSampler"+m+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord ) * SCENEJS_uLayer"+m+"BlendFactor;":"viewNormalVec "+N+" (TBN * normalize(texture2D(SCENEJS_uSampler"+m+", textureCoord).xyz * 2.0 - 1.0)) * SCENEJS_uLayer"+m+"BlendFactor;")):C(Z?"viewNormalVec = mix(viewNormalVec, (perturbNormal2Arb(SCENEJS_uSampler"+m+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord).xyz), SCENEJS_uLayer"+m+"BlendFactor);":"viewNormalVec = mix(viewNormalVec, TBN * normalize(texture2D(SCENEJS_uSampler"+m+", textureCoord).xyz * 2.0 - 1.0), SCENEJS_uLayer"+m+"BlendFactor);"),L=!1}}Y&&C("viewNormalVec = normalize(viewNormalVec);")}if(C("vec4 fragColor;"),U){if(C("vec3 viewLightDir;"),G){if(C("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),C("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),C("vec3 viewLightVec;"),C("float dotN;"),C("float spotDirRatio;"),C("float lightDist;"),S){C("float reflectFactor = 1.0;"),i&&(C("float reflectFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uReflectFresnelEdgeColor.a,  SCENEJS_uReflectFresnelCenterColor.a, SCENEJS_uReflectFresnelPower);"),i.blendMode&b.multiply?C("reflectFactor *= mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);"):i.blendMode&b.add&&C("reflectFactor += mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);")),C("vec3 envLookup = reflect(-viewEyeVec, viewNormalVec);"),C("vec4 envColor;");for(var m=0,n=E.cubemap.layers.length;n>m;m++){var o=E.cubemap.layers[m];o.applyTo===SceneJS.CUBEMAP_FLAGS.reflect&&(C("envColor = textureCube(SCENEJS_uCubeMapSampler"+m+", envLookup);"),C("color = mix(color, envColor.rgb, reflectFactor * specular * SCENEJS_uCubeMapIntensity"+m+");"))}}for(var p,m=0,n=E.lights.length;n>m;m++)p=E.lights[m],"ambient"!=p.mode&&("point"==p.mode&&("world"==p.space?(C("viewLightVec = SCENEJS_uLightPos"+m+" - SCENEJS_vWorldVertex.xyz;"),C("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):C("viewLightVec = SCENEJS_uLightPos"+m+".xyz - SCENEJS_vViewVertex.xyz;"),C("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),C("lightDist = length( SCENEJS_uLightPos"+m+" - SCENEJS_vWorldVertex.xyz);"),C("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+m+".x +   SCENEJS_uLightAttenuation"+m+".y * lightDist +   SCENEJS_uLightAttenuation"+m+".z * lightDist * lightDist);"),p.diffuse&&C("      lightValue += dotN * SCENEJS_uLightColor"+m+" * attenuation;"),p.specular&&C("    specularValue += specularColor * SCENEJS_uLightColor"+m+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"spot"==p.mode&&(C("viewLightDir = SCENEJS_uLightDir"+m+";"),"world"==p.space?(C("viewLightVec = SCENEJS_uLightPos"+m+" - SCENEJS_vWorldVertex.xyz;"),C("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),C("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):C("viewLightVec = SCENEJS_uLightPos"+m+".xyz - SCENEJS_vViewVertex.xyz;"),C("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),C("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),C("lightDist = length( SCENEJS_uLightPos"+m+" - SCENEJS_vWorldVertex.xyz);"),C("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+m+".x +   SCENEJS_uLightAttenuation"+m+".y * lightDist +   SCENEJS_uLightAttenuation"+m+".z * lightDist * lightDist);"),C("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+m+") / max(SCENEJS_uOuterCone"+m+" - SCENEJS_uInnerCone"+m+", 0.0001), 0.0, 1.0);"),p.diffuse&&C("      lightValue += dotN * SCENEJS_uLightColor"+m+" * attenuation;"),p.specular&&C("    specularValue += specularColor * SCENEJS_uLightColor"+m+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"dir"==p.mode&&("world"==p.space?(C("viewLightVec = normalize(SCENEJS_uLightDir"+m+");"),C("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):C("viewLightVec = normalize(SCENEJS_uLightDir"+m+");"),C("viewLightVec = -viewLightVec;"),C("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),p.diffuse&&C("lightValue += dotN * SCENEJS_uLightColor"+m+";"),p.specular&&C("specularValue += specularColor * SCENEJS_uLightColor"+m+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine);")));c&&(C("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),c.blendMode&b.multiply?C("color.rgb *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):c.blendMode&b.add&&C("color.rgb += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),d&&(C("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),d.blendMode&b.multiply?C("specularValue.rgb *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):d.blendMode&b.add&&C("specularValue.rgb += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),f&&(C("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),C("alpha = 1.0 - transparency;"),f.blendMode&b.multiply?C("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):f.blendMode&b.add&&C("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),C("transparency = 1.0 -alpha;")),h&&(C("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),h.blendMode&b.multiply?C("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):h.blendMode&b.add&&C("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),j&&(C("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),j.blendMode&b.multiply?C("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):j.blendMode&b.add&&C("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),C("alpha = 1.0 - transparency;"),C("fragColor = vec4((specularValue.rgb + color.rgb * (lightValue.rgb + ambientColor.rgb)) + (emit * emitColor.rgb), alpha);")}if(H){if(C("IncidentLight  light;"),C("Material       material;"),C("Geometry       geometry;"),C("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),C("float dielectricSpecular   = 0.16 * specularF0 * specularF0;"),C("material.diffuseColor      = color * (1.0 - dielectricSpecular) * (1.0 - metallic);"),C("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),C("material.specularColor     = mix(vec3(dielectricSpecular), color, metallic);"),C("geometry.position = SCENEJS_vViewVertex.xyz;"),T&&C("geometry.worldNormal = normalize(SCENEJS_vWorldNormal);"),C("geometry.viewNormal = viewNormalVec;"),C("geometry.viewEyeDir = -normalize(SCENEJS_vViewVertex.xyz);"),S)for(var O=E.cubemap.layers,m=0,n=O.length;n>m;m++){var o=O[m];o.applyTo===SceneJS.CUBEMAP_FLAGS.reflect&&C("computePBRReflectionMapping(SCENEJS_uCubeMapSampler"+m+", SCENEJS_uCubeMapIntensity"+m+", SCENEJS_uVMatrix, geometry, material, reflectedLight, SCENEJS_uCubeMapMipLevels"+m+");")}if(T)for(var O=E.cubemap.layers,m=0,n=O.length;n>m;m++){var o=O[m];o.applyTo===SceneJS.CUBEMAP_FLAGS.light&&C("world"===o.space?"computePBRLightMapping(SCENEJS_uCubeMapSampler"+m+", SCENEJS_uCubeMapIntensity"+m+", geometry.worldNormal, material, reflectedLight);":"computePBRLightMapping(SCENEJS_uCubeMapSampler"+m+", SCENEJS_uCubeMapIntensity"+m+", geometry.viewNormal, material, reflectedLight);")}C("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),C("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),C("vec3 viewLightVec;"),C("float dotN;"),C("float spotDirRatio;"),C("float lightDist;");for(var p,m=0,n=E.lights.length;n>m;m++)p=E.lights[m],"ambient"!=p.mode&&("dir"==p.mode&&("world"==p.space?(C("viewLightVec = normalize(SCENEJS_uLightDir"+m+");"),C("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):C("viewLightVec = normalize(SCENEJS_uLightDir"+m+");"),C("viewLightVec = -viewLightVec;"),C("light.direction = viewLightVec;"),C("light.color = SCENEJS_uLightColor"+m+";"),C("computePBRLighting(light, geometry, material, reflectedLight);")),"point"==p.mode&&("world"==p.space?(C("viewLightVec = SCENEJS_uLightPos"+m+" - SCENEJS_vWorldVertex.xyz;"),C("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):C("viewLightVec = SCENEJS_uLightPos"+m+".xyz - SCENEJS_vViewVertex.xyz;"),C("lightDist = length(viewLightVec);"),C("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+m+".x +   SCENEJS_uLightAttenuation"+m+".y * lightDist +   SCENEJS_uLightAttenuation"+m+".z * lightDist * lightDist);"),C("light.direction = normalize(viewLightVec);"),C("light.color = SCENEJS_uLightColor"+m+" * attenuation;"),C("computePBRLighting(light, geometry, material, reflectedLight);")),"spot"==p.mode&&(C("viewLightDir = SCENEJS_uLightDir"+m+";"),"world"==p.space?(C("viewLightVec = SCENEJS_uLightPos"+m+" - SCENEJS_vWorldVertex.xyz;"),C("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),C("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):C("viewLightVec = SCENEJS_uLightPos"+m+".xyz - SCENEJS_vViewVertex.xyz;"),C("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),C("lightDist = length(SCENEJS_uLightPos"+m+" - SCENEJS_vWorldVertex.xyz);"),C("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+m+".x +   SCENEJS_uLightAttenuation"+m+".y * lightDist +   SCENEJS_uLightAttenuation"+m+".z * lightDist * lightDist);"),C("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+m+") / max(SCENEJS_uOuterCone"+m+" - SCENEJS_uInnerCone"+m+", 0.0001), 0.0, 1.0);"),C("light.direction = normalize(viewLightVec);"),C("light.color = SCENEJS_uLightColor"+m+" * attenuation;"),C("computePBRLighting(light, geometry, material, reflectedLight);")));c&&(C("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),c.blendMode&b.multiply?C("reflectedLight.diffuse *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):c.blendMode&b.add&&C("reflectedLight.diffuse += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),d&&(C("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),d.blendMode&b.multiply?C("reflectedLight.specular *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):d.blendMode&b.add&&C("reflectedLight.specular += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),f&&(C("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),C("alpha = 1.0 - transparency;"),f.blendMode&b.multiply?C("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):f.blendMode&b.add&&C("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),C("transparency = 1.0 - alpha;")),h&&(C("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),h.blendMode&b.multiply?C("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):h.blendMode&b.add&&C("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),j&&(C("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),j.blendMode&b.multiply?C("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):j.blendMode&b.add&&C("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),C("vec3 outgoingLight = (occlusion * reflectedLight.diffuse) + (occlusion * reflectedLight.specular) + (emit * emitColor);"),C("alpha = 1.0 - transparency;"),C("fragColor = vec4(outgoingLight, alpha);")}}else C("alpha = 1.0 - transparency;"),C("fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambientColor.rgb), alpha);");if(ta){var u=0,v=E.properties.opacityModifiers,n=v.length;for(C("float opacity;"),u=0;n>u;u++)t=v[u],t.value.isScalarFresnel?(C("float opacityModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uOpacityModFresnelEdge"+u+".a, SCENEJS_uOpacityModFresnelCenter"+u+".a, SCENEJS_uOpacityModFresnelPower"+u+");"),C("opacity = mix(SCENEJS_uOpacityModFresnelEdge"+u+".r, SCENEJS_uOpacityModFresnelCenter"+u+".r, opacityModFresnel);")):C("opacity =  SCENEJS_uOpacityModification"+u+";"),t.range&&(C("float opacityModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uOpacityModCenter"+u+") - SCENEJS_uOpacityModRadius"+u+".x) / SCENEJS_uOpacityModRadius"+u+".y, 0.0, 1.0);"),C("opacity = mix(1.0, opacity, opacityModFactor);")),C("fragColor.a *= opacity;")}if($&&E.clips.clipFade&&C("fragColor.a *= 1.0 - max(distAlpha, 0.0);"),ba&&(C("vec3 regionColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t)).rgb;"),C("float tolerance = 0.01;"),C("vec3 colorDelta = abs(SCENEJS_uRegionMapRegionColor - regionColor);"),"highlight"===E.regionMap.mode||"hide"===E.regionMap.mode?(C("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) < tolerance) {"),C("highlight"===E.regionMap.mode?"  fragColor.rgb *= SCENEJS_uRegionMapHighlightFactor;":"  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),C("}")):(C("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) > tolerance) {"),C("  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),C("}"))),va&&(C("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),C("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),wa&&(C("{"),C("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),C("    float pixScale = 1.0 / maxDeriv;"),C("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),C("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),C("    float lerpFactor = fract(log2(pixScale));"),C("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),C("    float a = min(lerpFactor, 1.0 - lerpFactor);"),C("    vec3 cases = vec3("),C("        x * x / (2.0 * a * (1.0 - a)), "),C("        (x - 0.5 * a)/(1.0 - a), "),C("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),C("    );"),C("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),C("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),C("    if (fragColor.a < aThresh) {"),C("        discard;"),C("    } else {"),C("        fragColor.a = 1.0;"),C("    }"),C("}")),oa.length>0){C("float colorModFresnel;"),C("float saturation;"),C("float contrast;"),C("float brightness;"),C("float colorModFactor;"),C("vec3 tintColor;");var q,P=!1,r=0,n=oa.length;for(r=0;n>r;r++)q=oa[r],q.range&&C("colorModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uColorModCenter"+r+") - SCENEJS_uColorModRadius"+r+".x) / SCENEJS_uColorModRadius"+r+".y, 0.0, 1.0);"),q.applyTo===e.SATURATION?(P||(C("float L = dot(vec3(0.3, 0.59, 0.11), fragColor.rgb);"),P=!0),q.value.isScalarFresnel?(C("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+r+".a, SCENEJS_uColorModFresnelCenter"+r+".a, SCENEJS_uColorModFresnelPower"+r+");"),C("saturation = mix(SCENEJS_uColorModFresnelEdge"+r+".r, SCENEJS_uColorModFresnelCenter"+r+".r, colorModFresnel);")):C("saturation = SCENEJS_uColorModification"+r+";"),q.range&&C("saturation *= colorModFactor;"),C("fragColor.rgb -= saturation * (L - fragColor.rgb);")):q.applyTo===e.CONTRAST?(q.value.isScalarFresnel?(C("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+r+".a, SCENEJS_uColorModFresnelCenter"+r+".a, SCENEJS_uColorModFresnelPower"+r+");"),C("contrast = mix(SCENEJS_uColorModFresnelEdge"+r+".r, SCENEJS_uColorModFresnelCenter"+r+".r, colorModFresnel);")):C("contrast = SCENEJS_uColorModification"+r+";"),q.range&&C("contrast = mix(1.0, contrast, colorModFactor);"),C("fragColor.rgb = (fragColor.rgb - 0.5) * contrast + 0.5;")):q.applyTo===e.BRIGHTNESS?(q.value.isScalarFresnel?(C("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+r+".a, SCENEJS_uColorModFresnelCenter"+r+".a, SCENEJS_uColorModFresnelPower"+r+");"),C("brightness = mix(SCENEJS_uColorModFresnelEdge"+r+".r, SCENEJS_uColorModFresnelCenter"+r+".r, colorModFresnel);")):C("brightness = SCENEJS_uColorModification"+r+";"),q.range&&C("brightness *= colorModFactor;"),C("fragColor.rgb += brightness;")):q.applyTo===e.TINT&&(q.value.isColorFresnel?(C("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+r+".a, SCENEJS_uColorModFresnelCenter"+r+".a, SCENEJS_uColorModFresnelPower"+r+");"),C("tintColor = mix(SCENEJS_uColorModFresnelEdge"+r+".rgb, SCENEJS_uColorModFresnelCenter"+r+".rgb, colorModFresnel);"),q.range&&C("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")):(C("tintColor = SCENEJS_uColorModification"+r+";"),q.range&&C("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")),C("fragColor.rgb *= tintColor;"))}return ka&&(C("vec3 fogColor = SCENEJS_uFogColor.rgb;"),C("float fogDensity = SCENEJS_uFogColor.a;"),C("float fogStart = SCENEJS_uFogParams.x;"),C("float fogEnd = SCENEJS_uFogParams.y;"),C("float fogMin = SCENEJS_uFogParams.z;"),C("float fogMax = SCENEJS_uFogParams.w;"),la===a.FOG_LINEAR?C("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(C("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),la===a.FOG_EXP2&&C("fogAttenuation = fogAttenuation * fogAttenuation;"),C("float fog = 1.0 - exp(-fogAttenuation);")),C("fog = clamp(fog, fogMin, fogMax);"),C("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),k&&(C("float fragmentFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uFragmentFresnelEdgeColor.a, SCENEJS_uFragmentFresnelCenterColor.a, SCENEJS_uFragmentFresnelPower);"),k.blendMode&b.multiply?C("fragColor.rgb *= mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);"):k.blendMode&b.add&&C("fragColor.rgb += mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);")),wa||C("fragColor.rgb *= fragColor.a;"),C("fragColor = clamp(fragColor, 0.0, 1.0);"),C("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),ya?C(ya):(C("if (SCENEJS_uOutputFormat == 0.0) {"),C("    gl_FragColor = fragColor;"),C("} else if (SCENEJS_uOutputFormat == 1.0) {"),C("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),C("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),C("    float d = 1.0 - fragZ * 0.99;"),C("    float d4 = d * d * d * d;"),C("    float d16 = d4 * d4 * d4 * d4;"),C("    float a2 = fragColor.a * fragColor.a;"),C("    float a4 = a2 * a2;"),C("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),C("    float w = clamp(depthWeight, 0.0001, 1e4);"),C("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),C("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),C("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),C("}")),C("}"),D()}function x(){return B(),C("uniform mat4 SCENEJS_uMMatrix;"),f?(C("uniform mat4 SCENEJS_uVMatrix;"),C("uniform vec3 SCENEJS_uWorldEye;")):(C("uniform mediump mat4 SCENEJS_uVMatrix;"),C("uniform mediump vec3 SCENEJS_uWorldEye;")),C("uniform mat4 SCENEJS_uPMatrix;"),C("attribute vec4 SCENEJS_aVertex;"),ca&&(C("uniform float SCENEJS_uPointSize;"),fa&&C("attribute vec2 SCENEJS_aPointScaleRotation;")),ha&&C("uniform mat4 SCENEJS_uDecodePositionMatrix;"),C("varying vec4 SCENEJS_vViewVertex;"),U&&(C("attribute vec3 SCENEJS_aNormal;"),C("uniform   mat4 SCENEJS_uMNMatrix;"),C("varying   vec3 SCENEJS_vViewNormal;")),$&&C("varying vec4 SCENEJS_vWorldVertex;"),wa&&C("varying vec4 SceneJS_vModelVertex;"),_&&(C("uniform float SCENEJS_uMorphFactor;"),E.morphGeometry.targets[0].vertexBuf&&C("attribute vec4 SCENEJS_aMorphVertex;"),U&&E.morphGeometry.targets[0].normalBuf&&C("attribute vec3 SCENEJS_aMorphNormal;"),ha&&C("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),X&&(C("void billboard(inout mat4 mat) {"),C("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),C("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),C("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),C("}")),ia&&(C("vec3 octDecode(vec2 oct) {"),C("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),C("    if (v.z < 0.0) {"),C("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),C("    }"),C("    return normalize(v);"),C("}")),C("void main(void) {"),C(ha?"vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"vec4 modelVertex = SCENEJS_aVertex; "),ia?C("vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):U&&C("vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),_&&(E.morphGeometry.targets[0].vertexBuf&&C(ha?"modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),U&&E.morphGeometry.targets[0].normalBuf&&C(ia?"modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); ")),wa&&C("SceneJS_vModelVertex = modelVertex;"),C("mat4 modelMatrix = SCENEJS_uMMatrix;"),C("mat4 viewMatrix = SCENEJS_uVMatrix;"),U&&C("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),C("vec4 worldVertex;"),C("vec4 viewVertex;"),W&&C("viewMatrix[3].xyz = vec3(0.0);"),X?(C("mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),C("billboard(modelMatrix);"),C("billboard(viewMatrix);"),C("billboard(modelViewMatrix);"),U&&C("billboard(modelNormalMatrix);"),C("worldVertex = modelMatrix * modelVertex;"),C("viewVertex = modelViewMatrix * modelVertex;")):(C("worldVertex = modelMatrix * modelVertex;"),C("viewVertex  = viewMatrix * worldVertex; ")),C("SCENEJS_vViewVertex = viewVertex;"),U&&(C("vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),C("SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;")),$&&C("SCENEJS_vWorldVertex = worldVertex;"),C("gl_Position = SCENEJS_uPMatrix * viewVertex;"),ca&&(C("gl_PointSize = SCENEJS_uPointSize;"),ea&&C("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),fa&&C("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),C("gl_PointSize = min(gl_PointSize, "+Aa+");")),C("}"),D()}function y(){if(B(),wa&&C("#extension GL_OES_standard_derivatives : enable"),xa&&C(xa),C("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),C("#define EDGE_ALPHA 0.9"),C("#define CENTER_ALPHA 0.0"),C("#define EDGE_BIAS 0.0"),C("#define CENTER_BIAS 0.6"),C("uniform sampler2D SCENEJS_uDepthBuffer;"),C("uniform vec2 SCENEJS_uCanvasRes;"),C("varying vec4 SCENEJS_vViewVertex;"),$){C("varying vec4 SCENEJS_vWorldVertex;"),V&&C("uniform vec3 SCENEJS_uSolidColor;");for(var b=0;b<E.clips.clips.length;b++)C("uniform vec4  SCENEJS_uClipNormalAndDist"+b+";"),E.clips.clips[b].fade&&C("uniform float SCENEJS_uClipFadeDistance"+b+";")}if(wa&&C("varying vec4 SceneJS_vModelVertex;"),U&&(C("uniform vec3 SCENEJS_uXrayColor;"),C("varying vec3 SCENEJS_vViewNormal;")),ka&&(C("uniform vec4   SCENEJS_uFogParams;"),C("uniform vec4   SCENEJS_uFogColor;")),C("uniform float SCENEJS_uOutputFormat;"),C("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),va&&C("uniform bool SCENEJS_uDiscardOpaque;"),wa&&(C("float hash(vec2 v) {"),C("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),C("}"),C("float hash3D(vec3 v) {"),C("    return hash(vec2(hash(v.xy), v.z));"),C("}")),C("void main(void) {"),C("vec4 fragColor = vec4(1.0);"),$){E.clips.clipDiscard&&C("float distOff = 0.0;"),E.clips.clipFade&&C("float distAlpha = 0.0;");for(var b=0;b<E.clips.clips.length;b++)C(E.clips.clips[b].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w) / SCENEJS_uClipFadeDistance"+b+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+b+".xyz) + SCENEJS_uClipNormalAndDist"+b+".w);");E.clips.clipDiscard&&C("if (distOff > 0.0) { discard; }"),E.clips.clipFade&&C("if (distAlpha > 1.0) { discard; }")}return ca&&da&&(C("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),C("float r = dot(cxy, cxy);"),C("if (r > 1.0) {"),C("   discard;"),C("}")),U&&(C("float fr = abs(dot(normalize(-SCENEJS_vViewVertex.xyz), normalize(SCENEJS_vViewNormal)));"),C("float fresnelFactor = clamp((fr - EDGE_BIAS) / (CENTER_BIAS - EDGE_BIAS), 0.0, 1.0);"),C("fragColor.rgb = SCENEJS_uXrayColor;"),C("fragColor.a = mix(EDGE_ALPHA, CENTER_ALPHA, fresnelFactor);")),$&&E.clips.clipFade&&C("fragColor.a *= (1.0 - distAlpha);"),va&&(C("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),C("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),wa&&(C("{"),C("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),
C("    float pixScale = 1.0 / maxDeriv;"),C("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),C("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),C("    float lerpFactor = fract(log2(pixScale));"),C("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),C("    float a = min(lerpFactor, 1.0 - lerpFactor);"),C("    vec3 cases = vec3("),C("        x * x / (2.0 * a * (1.0 - a)), "),C("        (x - 0.5 * a)/(1.0 - a), "),C("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),C("    );"),C("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),C("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),C("    if (fragColor.a < aThresh) {"),C("        discard;"),C("    } else {"),C("        fragColor.a = 1.0;"),C("    }"),C("}")),ka&&(C("vec3 fogColor = SCENEJS_uFogColor.rgb;"),C("float fogDensity = SCENEJS_uFogColor.a;"),C("float fogStart = SCENEJS_uFogParams.x;"),C("float fogEnd = SCENEJS_uFogParams.y;"),C("float fogMin = SCENEJS_uFogParams.z;"),C("float fogMax = SCENEJS_uFogParams.w;"),la===a.FOG_LINEAR?C("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(C("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),la===a.FOG_EXP2&&C("fogAttenuation = fogAttenuation * fogAttenuation;"),C("float fog = 1.0 - exp(-fogAttenuation);")),C("fog = clamp(fog, fogMin, fogMax);"),C("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),C("fragColor.rgb *= fragColor.a;"),C("fragColor = clamp(fragColor, 0.0, 1.0);"),C("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),ya?C(ya):(C("if (SCENEJS_uOutputFormat == 0.0) {"),C("    gl_FragColor = fragColor;"),C("} else if (SCENEJS_uOutputFormat == 1.0) {"),C("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),C("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),C("    float d = 1.0 - fragZ * 0.99;"),C("    float d4 = d * d * d * d;"),C("    float d16 = d4 * d4 * d4 * d4;"),C("    float a2 = fragColor.a * fragColor.a;"),C("    float a4 = a2 * a2;"),C("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),C("    float w = clamp(depthWeight, 0.0001, 1e4);"),C("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),C("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),C("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),C("}")),C("}"),D()}function z(){return B(),C("attribute vec4 SCENEJS_aVertex;"),C("uniform mat4 SCENEJS_uMMatrix;"),C("uniform mat4 SCENEJS_uVMatrix;"),C("uniform mat4 SCENEJS_uPMatrix;"),ca&&(C("uniform float SCENEJS_uPointSize;"),fa&&C("attribute vec2 SCENEJS_aPointScaleRotation;")),ha&&C("uniform mat4 SCENEJS_uDecodePositionMatrix;"),C("varying vec4 SCENEJS_vWorldVertex;"),_&&(C("uniform float SCENEJS_uMorphFactor;"),E.morphGeometry.targets[0].vertexBuf&&C("attribute vec4 SCENEJS_aMorphVertex;"),ha&&C("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),C("void main(void) {"),C(ha?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),_&&E.morphGeometry.targets[0].vertexBuf&&C(ha?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),C("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),C("mat4 vPosMatrix = SCENEJS_uVMatrix;"),W&&C("vPosMatrix[3].xyz = vec3(0.0);"),C("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),C("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),ca&&(C("gl_PointSize = SCENEJS_uPointSize;"),ea&&C("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),fa&&C("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),C("gl_PointSize = min(gl_PointSize, "+Aa+");")),C("}"),D()}function A(){if(B(),C("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),C("varying vec4 SCENEJS_vWorldVertex;"),$)for(var a=0;a<E.clips.clips.length;a++)C("uniform vec4  SCENEJS_uClipNormalAndDist"+a+";"),E.clips.clips[a].fade&&C("uniform float SCENEJS_uClipFadeDistance"+a+";");if(C("void main(void) {"),$){E.clips.clipDiscard&&C("float distOff = 0.0;"),E.clips.clipFade&&C("float distAlpha = 0.0;");for(var a=0;a<E.clips.clips.length;a++)C(E.clips.clips[a].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+a+".xyz) + SCENEJS_uClipNormalAndDist"+a+".w) / SCENEJS_uClipFadeDistance"+a+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+a+".xyz) + SCENEJS_uClipNormalAndDist"+a+".w);");E.clips.clipDiscard&&C("if (distOff > 0.0) { discard; }"),E.clips.clipFade&&C("if (distAlpha > 1.0) { discard; }")}return C("   gl_FragColor = vec4(gl_FragCoord.zzz, 1.0);"),C("}"),D()}function B(){Ba=[]}function C(a){Ba.push(a||"")}function D(){return Ba.join("\n")}var E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za={},Aa=Math.floor(SceneJS.WEBGL_INFO.MAX_POINT_SIZE).toFixed(1),Ba="";this.setMaxPointSize=function(a){a=Math.min(a,SceneJS.WEBGL_INFO.MAX_POINT_SIZE),Aa=Math.floor(a).toFixed(1)},this.getSource=function(a,b,c){var e=za[a];return e?(e.useCount++,e):(E=b,F=c,G=E.material.workflow===SceneJS.Material.PHONG,H=E.material.workflow===SceneJS.Material.METALLIC,I=b.gammaInputPhong,J=E.fresnel.diffuse,K=E.fresnel.specular,L=E.fresnel.alpha,N=E.fresnel.reflect,O=E.fresnel.emit,P=E.fresnel.fragment,M=E.fresnel.transparency,Q=J||K||L||M||N||O||P,R=p(E),S=r(E),T=s(E),U=t(E),$=E.clips.clips.length>0&&!!(E.properties.flags&d.CLIPPING),V=$&&!!(E.properties.flags&d.SOLID),W=!!(E.properties.flags&d.SKYBOX),X=!!(E.properties.flags&d.BILLBOARD),Y=u(E),Z=Y&&b.autoTangents&&SceneJS.WEBGL_INFO.standardDerivativesSupported,_=!!E.morphGeometry.targets,aa=o(),ba=aa&&"info"!==E.regionMap.mode,ca="points"===E.geometry.primitiveName,ea=!!(E.properties.flags&d.PERSPECTIVE_POINTS),fa=!!E.geometry.pointScaleRotationBuf,ga=!!E.geometry.pointUVTranslateBuf,da=!!(E.properties.flags&d.ROUND_POINTS),ha=!(!E.geometry.compressedPositions&&!E.morphGeometry.compressedPositions),ia=!(!E.geometry.compressedNormals&&!E.morphGeometry.compressedNormals),ja=!(!E.geometry.compressedUVs&&!E.morphGeometry.compressedUVs),ka=E.fogEnabled,la=E.fogMode,ma=E.properties.colorModRange,na=E.properties.colorModifiers.length>0,oa=E.properties.colorModifiers,pa=h(),qa=i(),ra=j(),sa=E.properties.opacityModRange,ta=E.properties.opacityModifiers.length>0,ua=E.properties.opacityModifiers,va=E.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&F.isPartiallyOpaque(),wa=!!(E.properties.flags&d.STOCHASTIC_ALPHA),xa=E.properties.fragmentShaderHeader||null,ya=E.properties.fragmentShaderFooter||null,e={hash:a,pickVertexSrc:k(),pickFragmentSrc:l(),pickTriangleVertexSrc:k(!0),pickTriangleFragmentSrc:l(!0),drawVertexSrc:v(),drawFragmentSrc:w(),xrayVertexSrc:x(),xrayFragmentSrc:y(),depthVertexSrc:z(),depthFragmentSrc:A(),drawTextureVertexSrc:m(),drawTextureFragmentSrc:n(),useCount:0},za[a]=e,e)},this.putSource=function(a){var b=za[a];b&&0==--b.useCount&&(za[b.hash]=null)}}}(),function(){"use strict";var a=window.SceneJS_ProgramFactory=function(a,b){this.stats=a,this._canvas=b.canvas,this._programs={}};a.prototype.getProgram=function(a,b,c){var d=this._programs[a];return d||(d=new SceneJS._webgl.Program(this.stats,this._canvas.gl,a,b,c),this._programs[a]=d,this.stats.state.programs++),d.useCount++,d},a.prototype.putProgram=function(a){--a.useCount<=0&&(a.destroy(),delete this._programs[a.hash],this.stats.state.programs--)},a.prototype.webglRestored=function(){var a=this._canvas.gl;for(var b in this._programs)this._programs.hasOwnProperty(b)&&this._programs[b].build(a)},a.prototype.destroy=function(){}}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=3*b,i=3*c,j=3*d,k=a.targets[a.key1].positions,l=a.targets[a.key2].positions,m=a.targets[a.key1].positionDecodeMat,t=a.targets[a.key2].positionDecodeMat;a.compressedPositions?(SceneJS_math_decompressPosition(n,k.subarray(h,h+3),m),SceneJS_math_decompressPosition(q,l.subarray(h,h+3),t),SceneJS_math_decompressPosition(o,k.subarray(i,i+3),m),SceneJS_math_decompressPosition(r,l.subarray(i,i+3),t),SceneJS_math_decompressPosition(p,k.subarray(j,j+3),m),SceneJS_math_decompressPosition(s,l.subarray(j,j+3),t)):(n.set(k.subarray(h,h+3)),q.set(l.subarray(h,h+3)),o.set(k.subarray(i,i+3)),r.set(l.subarray(i,i+3)),p.set(k.subarray(j,j+3)),s.set(l.subarray(j,j+3))),vec3.lerp(e,n,q,a.factor),vec3.lerp(f,o,r,a.factor),vec3.lerp(g,p,s,a.factor)}function b(a,b,c,d,e,f,g){var h=a.arrays.positions,i=a.positionDecodeMat,j=3*b,k=3*c,l=3*d;e[0]=h[j],e[1]=h[j+1],e[2]=h[j+2],f[0]=h[k],f[1]=h[k+1],f[2]=h[k+2],g[0]=h[l],g[1]=h[l+1],g[2]=h[l+2],i&&(SceneJS_math_decompressPosition(e,e,i),SceneJS_math_decompressPosition(f,f,i),SceneJS_math_decompressPosition(g,g,i))}function c(a,b,c){var d=a.arrays.positions,e=a.positionDecodeMat,f=3*b;c[0]=d[f],c[1]=d[f+1],c[2]=d[f+2],e&&SceneJS_math_decompressPosition(c,c,e)}function d(a,b,c,d,e,f,g){var h,i,j,k=a.targets[a.key1].normals,l=a.targets[a.key2].normals;return a.compressedNormals?(h=2*b,i=2*c,j=2*d,SceneJS_math_octDecodeVec2(k.subarray(h,h+2),n),SceneJS_math_octDecodeVec2(l.subarray(h,h+2),q),SceneJS_math_octDecodeVec2(k.subarray(i,i+2),o),SceneJS_math_octDecodeVec2(l.subarray(i,i+2),r),SceneJS_math_octDecodeVec2(k.subarray(j,j+2),p),SceneJS_math_octDecodeVec2(l.subarray(j,j+2),s)):(h=3*b,i=3*c,j=3*d,n.set(k.subarray(h,h+3)),q.set(l.subarray(h,h+3)),o.set(k.subarray(i,i+3)),r.set(l.subarray(i,i+3)),p.set(k.subarray(j,j+3)),s.set(l.subarray(j,j+3))),vec3.lerp(e,n,q,a.factor),vec3.lerp(f,o,r,a.factor),vec3.lerp(g,p,s,a.factor),!0}function e(a,b,c,d,e,f,g){var h,i,j,k=a.arrays.normals;if(!k)return e=e.set([0,0,0]),f=f.set([0,0,0]),g=g.set([0,0,0]),!1;if(a.compressedNormals){{var h=2*b,i=2*c,j=2*d;k.subarray(h,h+2),k.subarray(i,i+2),k.subarray(j,j+2)}SceneJS_math_octDecodeVec2(k.subarray(h,h+2),e),SceneJS_math_octDecodeVec2(k.subarray(i,i+2),f),SceneJS_math_octDecodeVec2(k.subarray(j,j+2),g)}else h=3*b,i=3*c,j=3*d,e[0]=k[h],e[1]=k[h+1],e[2]=k[h+2],f[0]=k[i],f[1]=k[i+1],f[2]=k[i+2],g[0]=k[j],g[1]=k[j+1],g[2]=k[j+2];return!0}function f(a,b,c,d,e,f,g,h){var i=2*c,j=2*d,k=2*e,l=a.arrays.uvs[b];if(f[0]=l[i],f[1]=l[i+1],g[0]=l[j],g[1]=l[j+1],h[0]=l[k],h[1]=l[k+1],a.compressedUVs){var m=a.uvDecodeMats[b];SceneJS_math_decompressUV(f,f,m),SceneJS_math_decompressUV(g,g,m),SceneJS_math_decompressUV(h,h,m)}}{var g=window.SceneJS_Object=function(a){this.id=a,this.hash=null,this.sortKey=0,this.sortTieBreaker=0,this.chunkSets={},this.chunksLen=0,this.program=null,this.layer=null,this.texture=null,this.properties=null,this.centroid=null},h=new vec3.create,i=vec2.create(),j=vec2.create(),k=(vec2.create(),vec3.create()),l=vec3.create(),m=vec3.create(),n=vec3.create(),o=vec3.create(),p=vec3.create(),q=vec3.create(),r=vec3.create(),s=vec3.create(),t=vec4.create();vec4.create(),vec4.create()}g.prototype.getDepth=function(){this.centroid||(this.centroid=this._calculateCentroid(this));var a=this.modelTransform.matrix,b=this.viewMatrix,c=vec3.transformMat4(h,this.centroid,a);return-(b[2]*c[0]+b[6]*c[1]+b[10]*c[2]+b[14])},g.prototype.isTransparent=function(){return!this.properties.stochasticAlpha&&!!(this.properties.transparent||this.properties.opacityModifiers.length>0||this.texture.transparent||this.geometry.transparent||this.fresnel.transparent||this.material.transparent||this.regionMap.transparent)},g.prototype.isPartiallyOpaque=function(){return this.properties.partiallyOpaque||!this.properties.transparent&&(this.fresnel.partiallyOpaque||this.texture.transparent)},g.prototype.getKdTree=function(){var a=this.geometry.arrays.indices,b=this.morphGeometry.targets;return b&&b.length>0?this.morphGeometry.getKdTree(a):this.geometry.getKdTree()},g.prototype.getPositions=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key1].positions:this.geometry.arrays.positions},g.prototype.getPositionDecodeMat=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key1].positionDecodeMat:this.geometry.positionDecodeMat},g.prototype.getFrameEndPositions=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key2].positions:null},g.prototype.getFrameEndPositionDecodeMat=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key2].positionDecodeMat:null},g.prototype.getNormals=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key1].normals:this.geometry.arrays.normals},g.prototype.getFrameEndNormals=function(){var a=this.morphGeometry.targets;return a&&a.length>0?a[this.morphGeometry.key2].normals:null},g.prototype.getIndices=function(){return this.geometry.arrays.indices||null},g.prototype.getMorphFactor=function(){var a=this.morphGeometry.targets;return a&&a.length>0?this.morphGeometry.factor:null},g.prototype.cartesianToBarycentric=function(a,b,c){this.getTrianglePositionOnSurface(a,k,l,m),SceneJS_math_cartesianToBarycentric(b,k,l,m,c)},g.prototype.getPointInWorldSpace=function(a,b){t.set(a),t[3]=1,vec4.transformMat4(t,t,this.modelTransform.matrix),b.set(t.subarray(0,3))},g.prototype.getTriangleIndices=function(a,b){var c=this.geometry.arrays.indices;c?(b[0]=c[a],b[1]=c[a+1],b[2]=c[a+2]):(b[0]=a,b[1]=a+1,b[2]=a+2)},g.prototype.barycentricToCartesian=function(a,b,c){b=b||[1/3,1/3,1/3],this.getTrianglePositionOnSurface(a,k,l,m),SceneJS_math_barycentricToCartesian(b,k,l,m,c)},g.prototype.getTrianglePositionOnSurface=function(c,d,e,f){var g=this.geometry.arrays.indices;if(this.geometry||this.morphGeometry){var h,i,j;g?(h=g[c],i=g[c+1],j=g[c+2]):(h=c,i=c+1,j=c+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?a(this.morphGeometry,h,i,j,d,e,f):b(this.geometry,h,i,j,d,e,f)}},g.prototype.normalFromBarycentric=function(a,b,c){b=b||[1/3,1/3,1/3];var d=this.normalFromCartesian(a,k,l,m);return d?(vec3.scale(c,k,b[0]),vec3.add(c,c,vec3.scale(o,l,b[1])),vec3.add(c,c,vec3.scale(o,m,b[2])),!0):!1},g.prototype.normalFromCartesian=function(a,b,c,f){if(this.geometry||this.morphGeometry){var g,h,i,j=this.geometry.arrays.indices;return j?(g=j[a],h=j[a+1],i=j[a+2]):(g=a,h=a+1,i=a+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?d(this.morphGeometry,g,h,i,b,c,f):e(this.geometry,g,h,i,b,c,f)}},g.prototype.uvFromBarycentric=function(a,b,c){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var d,e,g,h=this.geometry.arrays.indices;h?(d=h[a],e=h[a+1],g=h[a+2]):(d=a,e=a+1,g=a+2);var n;for(n=0;n<this.geometry.arrays.uvs.length;n++){f(this.geometry,n,d,e,g,k,l,m);var o=vec2.create();vec2.scale(o,k,b[0]),vec2.add(o,o,vec2.scale(i,l,b[1])),vec2.add(o,o,vec2.scale(j,m,b[2])),c.push(o)}}},g.prototype.uvFromCartesian=function(a){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var b,c,d,e=this.geometry.arrays.indices;e?(b=e[a],c=e[a+1],d=e[a+2]):(b=a,c=a+1,d=a+2);var g,h=[],i=[],j=[];for(g=0;g<this.geometry.arrays.uvs.length;g++){f(a,g,b,c,d,k,l,m);var n=vec2.create(),o=vec2.create(),p=vec3.create();n[0]=k[0],n[1]=k[1],o[0]=l[0],o[1]=l[1],p[0]=m[0],p[1]=m[1],h.push(n),i.push(o),j.push(p)}}},g.prototype._calculateCentroid=function(){for(var a=vec3.create(),b=this.geometry.arrays.positions,d=1/0,e=1/0,f=1/0,g=-(1/0),i=-(1/0),j=-(1/0),k=Math.min,l=Math.max,m=0,n=b.length/3;n>m;++m){c(this.geometry,m,h);var o=h[0],p=h[1],q=h[2];d=k(o,d),e=k(p,e),f=k(q,f),g=l(o,g),i=l(p,i),j=l(q,j)}return a[0]=.5*(d+g),a[1]=.5*(e+i),a[2]=.5*(f+j),a}}(),function(){"use strict";var a=["attribute vec2 aPosition;","varying vec2 vUV;","void main() {","    vUV = aPosition * 0.5 + 0.5;","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),b=new Float32Array([-1,-1,1,-1,-1,1,1,1]);window.SceneJS_PostProcess=function(c,d,e,f){f=f||{},this.gl=d,this.uniformIndices={},this.uniformHandles=[],this.uniformValues=[],this.textureIndices={},this.samplerNames=[],this.textures=[],this.positionBuffer=new SceneJS._webgl.ArrayBuffer(d,d.ARRAY_BUFFER,b,b.length,2,d.STATIC_DRAW),this.program=new SceneJS._webgl.Program(c,d,"post-process",a,e),this.positionsAttribute=this.program.getAttribute("aPosition"),this.uniformCount=0,this.textureCount=0,this.clear=!!f.clear},SceneJS_PostProcess.prototype.setUniform=function(a,b){var c=this.uniformIndices[a];void 0===c&&(c=this.uniformIndices[a]=this.uniformCount++,this.uniformHandles.push(this.program.getUniform(a))),this.uniformValues[c]=b},SceneJS_PostProcess.prototype.setTexture=function(a,b){var c=this.textureIndices[a];void 0===c&&(c=this.textureIndices[a]=this.textureCount++,this.samplerNames.push(a)),this.textures[c]=b},SceneJS_PostProcess.prototype.draw=function(a){a.VAO&&a.VAO.bindVertexArrayOES(null),this.program.bind(),this.positionsAttribute.bindArrayBuffer(this.positionBuffer);for(var b=0;b<this.uniformCount;++b)this.uniformHandles[b].setValue(this.uniformValues[b]);for(var b=0;b<this.textureCount;++b)this.program.bindTexture(this.samplerNames[b],this.textures[b],b);this.clear&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)},SceneJS_PostProcess.prototype.destroy=function(){this.positionBuffer.destroy(),this.positionBuffer=null,this.program.destroy(),this.program=null},SceneJS_PostProcess.prototype.webglRestored=function(a){this.gl=a,this.positionBuffer=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,b,b.length,2,a.STATIC_DRAW),this.program.build(a),this.positionsAttribute=this.program.getAttribute("aPosition");for(var c in this.uniformIndices){var d=this.uniformIndices[c];this.uniformHandles[d]=this.program.getUniform(c)}}}(),function(){"use strict";window.SceneJS_PostProcessStage=function(a,b){this.id=b.id,this.display=a,this.postProcess=a._postProcessTypes[b.type],this.uniforms=b.uniforms,this.framebuffer=null,b.framebuffer&&(this.framebuffer=a.framebuffers[b.framebuffer]),this.textures={};for(var c in b.textures){var d,e=b.textures[c],f=e.framebuffer,g=e.target,h=e.data,i=a._canvas.gl;if(f){if(d=a.framebuffers[f],!d){console.error("Framebuffer not found: "+f);continue}if("color"===g)this.textures[c]=d.getColorTarget(e.attachment||0);else{if("depth"!==g){console.error("Invalid target: "+g);continue}this.textures[c]=d.getDepthTarget()}}else if(h){var j=i.createTexture(),k=void 0!==e.format?i[e.format]:i.RGBA,l=void 0!==e.type?i[e.type]:i.UNSIGNED_BYTE,m=void 0!==e.minFilter?i[e.minFilter]:i.NEAREST,n=void 0!==e.magFilter?i[e.magFilter]:i.NEAREST,o=void 0!==e.wrapS?i[e.wrapS]:i.CLAMP_TO_EDGE,p=void 0!==e.wrapT?i[e.wrapT]:i.CLAMP_TO_EDGE;i.bindTexture(i.TEXTURE_2D,j),i.texImage2D(i.TEXTURE_2D,0,k,e.width,e.height,0,k,l,h),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,p),this.textures[c]={texture:j,gl:i,bind:function(a){return this.texture?(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0):!1},unbind:function(a){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},i.bindTexture(i.TEXTURE_2D,null)}}},SceneJS_PostProcessStage.prototype.setUniform=function(a,b){this.uniforms[a]=b,this.display.imageDirty=!0},SceneJS_PostProcessStage.prototype.draw=function(a){for(var b in this.uniforms)this.postProcess.setUniform(b,this.uniforms[b]);for(var c in this.textures)this.postProcess.setTexture(c,this.textures[c]);this.postProcess.draw(a)},SceneJS_PostProcessStage.prototype.destroy=function(){for(var a in this.textures)"function"==typeof this.textures[a].destroy&&this.textures[a].destroy(),this.textures[a]=null}}(),function(){"use strict";var a=window.SceneJS_ChunkFactory=function(){this._chunks={},this._numericIds=1,this.chunkTypes=a.chunkTypes};a.chunkTypes={},a.addChunkType=function(b,c){a.chunkTypes[b]=c},a.prototype.getChunk=function(b,c,d,e){var f=a.chunkTypes[c];if(!f)throw"chunk type not supported: '"+c+"'";var g=this._chunks[b];return g?(g.useCount++,g):(g=new f(b,this._numericIds++,d,e),g.useCount=1,this._chunks[b]=g,g)},a.prototype.putChunk=function(a){0!==a.useCount&&--a.useCount<=0&&(a.recycle&&a.recycle(),delete this._chunks[a.id])},a.prototype.webglRestored=function(){var a;for(var b in this._chunks)this._chunks.hasOwnProperty(b)&&(a=this._chunks[b],a&&a.build&&a.build())}}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.unique=!0,this.build()};a.prototype.build=function(){this.core=this.cores[0],this.handles.draw={},this.handles.xray={},this.handles.pick={uPickColor:this.program.pick.getUniform("SCENEJS_uPickColor")},this.handles.depth={},this.handles.drawTexture={}},a.prototype.draw=function(a,b){var c=this.core,d=this.handles[a],e=this.program.gl;if(b.pickTriangle){var f=c.getPickColors();f&&e.drawArrays(c.primitive,0,f.numItems/4)}else{if(b.pickObject&&d.uPickColor){var g=b.pickIndex>>24&255,h=b.pickIndex>>16&255,i=b.pickIndex>>8&255,j=255&b.pickIndex;b.pickIndex++,d.uPickColor.setValue([j/255,i/255,h/255,g/255])}c.indexBuf?e.drawElements(c.primitive,c.indexBuf.numItems,c.indexBuf.itemType,0):e.drawArrays(c.primitive,0,c.vertexBuf.numItems/3)}b.transparent=!1},SceneJS_ChunkFactory.addChunkType("draw",a)}(),function(){"use strict";var a=SceneJS.PROPERTY_FLAGS,b=SceneJS.DEPTH_TEST_FLAGS,c=vec4.create(),d=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.unique=!0,this.build()};d.prototype.build=function(){this.propertiesCore=this.cores[0],this.xformCore=this.cores[1];var a=this.program.draw,b=this.program.xray,c=this.program.pick,d=this.program.pickTriangle,e=this.program.depth,f=this.program.drawTexture,g=this.handles.draw={},h=this.handles.xray={},i=this.handles.pick={},j=this.handles.pickTriangle={},k=this.handles.depth={},l=this.handles.drawTexture={};if(g.uDiscardOpaque=a.getUniform("SCENEJS_uDiscardOpaque"),g.uOutputFormat=a.getUniform("SCENEJS_uOutputFormat"),h.uDiscardOpaque=b.getUniform("SCENEJS_uDiscardOpaque"),h.uOutputFormat=b.getUniform("SCENEJS_uOutputFormat"),this.propertiesCore){g.uSolidColor=a.getUniform("SCENEJS_uSolidColor"),g.uXrayParams=a.getUniform("SCENEJS_uXrayParams"),h.uSolidColor=b.getUniform("SCENEJS_uSolidColor"),k.uClipping=e.getUniform("SCENEJS_uClipping"),g.uColorModifications=new Array(this.propertiesCore.colorModifiers.length),g.uColorModCenters=new Array(this.propertiesCore.colorModifiers.length),g.uColorModRadii=new Array(this.propertiesCore.colorModifiers.length),g.uColorModFresnels=new Array(this.propertiesCore.colorModifiers.length);for(var m=0,n=this.propertiesCore.colorModifiers.length;n>m;m++){var o=this.propertiesCore.colorModifiers[m],p=o.value;g.uColorModifications[m]=a.getUniform("SCENEJS_uColorModification"+m),(p.isColorFresnel||p.isScalarFresnel)&&(g.uColorModFresnels[m]={edge:a.getUniform("SCENEJS_uColorModFresnelEdge"+m),center:a.getUniform("SCENEJS_uColorModFresnelCenter"+m),power:a.getUniform("SCENEJS_uColorModFresnelPower"+m)}),g.uColorModCenters[m]=a.getUniform("SCENEJS_uColorModCenter"+m),g.uColorModRadii[m]=a.getUniform("SCENEJS_uColorModRadius"+m)}g.uOpacityModifications=new Array(this.propertiesCore.opacityModifiers.length),g.uOpacityModCenters=new Array(this.propertiesCore.opacityModifiers.length),g.uOpacityModRadii=new Array(this.propertiesCore.opacityModifiers.length),g.uOpacityModFresnels=new Array(this.propertiesCore.opacityModifiers.length);for(var q=0,n=this.propertiesCore.opacityModifiers.length;n>q;++q){var r=this.propertiesCore.opacityModifiers[q];g.uOpacityModifications[q]=a.getUniform("SCENEJS_uOpacityModification"+q),r.value.isScalarFresnel&&(g.uOpacityModFresnels[q]={edge:a.getUniform("SCENEJS_uOpacityModFresnelEdge"+q),center:a.getUniform("SCENEJS_uOpacityModFresnelCenter"+q),power:a.getUniform("SCENEJS_uOpacityModFresnelPower"+q)}),g.uOpacityModCenters[q]=a.getUniform("SCENEJS_uOpacityModCenter"+q),g.uOpacityModRadii[q]=a.getUniform("SCENEJS_uOpacityModRadius"+q)}}this.xformCore&&(g.uMatLocation=a.getUniform("SCENEJS_uMMatrix"),g.uNormalMatLocation=a.getUniform("SCENEJS_uMNMatrix"),h.uMatLocation=b.getUniform("SCENEJS_uMMatrix"),h.uNormalMatLocation=b.getUniform("SCENEJS_uMNMatrix"),i.uMatLocation=c.getUniform("SCENEJS_uMMatrix"),j.uMatLocation=d.getUniform("SCENEJS_uMMatrix"),k.uMatLocation=e.getUniform("SCENEJS_uMMatrix"),l.uMatLocation=f.getUniform("SCENEJS_uMMatrix"))},d.prototype.draw=function(d,e){var f=this.program.gl,g=(e.picking,this.handles[d]);if(g.uDiscardOpaque&&g.uDiscardOpaque.setValue(e.discardOpaque),g.uOutputFormat&&g.uOutputFormat.setValue(e.outputFormat),this.propertiesCore){var h=this.propertiesCore.depthTest;e.depthTest!=h&&(h==b.ALWAYS_PASS?(f.enable(f.DEPTH_TEST),f.depthFunc(f.ALWAYS)):h==b.DISABLED?f.disable(f.DEPTH_TEST):(f.enable(f.DEPTH_TEST),f.depthFunc(f.LESS)),e.depthTest=h);var i=this.propertiesCore.flags&a.CCW;if(e.frontface!=i&&(f.frontFace(i?f.CCW:f.CW),e.frontface=i),g.uColorModifications)for(var j=0,k=this.propertiesCore.colorModifiers.length;k>j;++j){var l=this.propertiesCore.colorModifiers[j],m=l.value;g.uColorModifications[j]&&g.uColorModifications[j].setValue(m);var n=g.uColorModFresnels[j];n&&(m.isColorFresnel?(n.edge&&(c[0]=m.edge[0],c[1]=m.edge[1],c[2]=m.edge[2],c[3]=m.edgeBias,n.edge.setValue(c)),n.center&&(c[0]=m.center[0],c[1]=m.center[1],c[2]=m.center[2],c[3]=m.centerBias,n.center.setValue(c)),n.power&&n.power.setValue(m.power)):m.isScalarFresnel&&(n.edge&&(c[0]=m.edge,c[3]=m.edgeBias,n.edge.setValue(c)),n.center&&(c[0]=m.center,c[3]=m.centerBias,n.center.setValue(c)),n.power&&n.power.setValue(m.power))),g.uColorModCenters[j]&&g.uColorModCenters[j].setValue(l.range.center),g.uColorModRadii[j]&&g.uColorModRadii[j].setValue(l.range.radius)}if(g.uOpacityModifications)for(var o=0,k=this.propertiesCore.opacityModifiers.length;k>o;++o){var p=this.propertiesCore.opacityModifiers[o],m=p.value;g.uOpacityModifications[o]&&g.uOpacityModifications[o].setValue(m);var q=g.uOpacityModFresnels[o];q&&(q.edge&&(c[0]=m.edge,c[3]=m.edgeBias,q.edge.setValue(c)),q.center&&(c[0]=m.center,c[3]=m.centerBias,q.center.setValue(c)),q.power&&q.power.setValue(m.power)),g.uOpacityModCenters[o]&&g.uOpacityModCenters[o].setValue(p.range.center),g.uOpacityModRadii[o]&&g.uOpacityModRadii[o].setValue(p.range.radius)}g.uSolidColor&&g.uSolidColor.setValue(this.propertiesCore.solidColor),g.uXrayParams&&g.uXrayParams.setValue(this.propertiesCore.xrayParams)}this.xformCore&&(g.uMatLocation&&g.uMatLocation.setValue(this.xformCore.matrix),g.uNormalMatLocation&&g.uNormalMatLocation.setValue(this.xformCore.normalMatrix))},SceneJS_ChunkFactory.addChunkType("object",d)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.VAOs={draw:null,pick:null,pickTriangle:null,xray:null,depth:null,drawTexture:null},this.build()};a.prototype.build=function(){this.core=this.cores[0],this.core2=this.cores[1];var a=this.program.draw,b=0;this.core2.uvBufs&&(b=this.core2.uvBufs.length),this.handles.draw={aRegionMapUV:a.getAttribute("SCENEJS_aRegionMapUV"),aVertex:a.getAttribute("SCENEJS_aVertex"),aNormal:a.getAttribute("SCENEJS_aNormal"),aUV:new Array(b),uDecodeUV:new Array(b),aTangent:a.getAttribute("SCENEJS_aTangent"),aColor:a.getAttribute("SCENEJS_aVertexColor"),aMorphVertex:a.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:a.getAttribute("SCENEJS_aMorphNormal"),aMorphTangent:a.getAttribute("SCENEJS_aMorphTangent"),aPointScaleRotation:a.getAttribute("SCENEJS_aPointScaleRotation"),aPointUVTranslate:a.getAttribute("SCENEJS_aPointUVTranslate"),uPointUVScale:a.getUniform("SCENEJS_uPointUVScale"),uMorphFactor:a.getUniform("SCENEJS_uMorphFactor"),uPointSize:a.getUniform("SCENEJS_uPointSize"),uDecodePositions:a.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:a.getUniform("SCENEJS_uDecodeMorphPosMatrix")};for(var c=0;b>c;c++)this.handles.draw.aUV[c]=a.getAttribute("SCENEJS_aUVCoord"+c),this.handles.draw.uDecodeUV[c]=a.getUniform("SCENEJS_uDecodeUVMatrix"+c);var d=this.program.xray;this.handles.xray={aVertex:d.getAttribute("SCENEJS_aVertex"),aNormal:d.getAttribute("SCENEJS_aNormal"),aMorphVertex:d.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:d.getAttribute("SCENEJS_aMorphNormal"),aPointScaleRotation:d.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:d.getUniform("SCENEJS_uMorphFactor"),uPointSize:d.getUniform("SCENEJS_uPointSize"),uDecodePositions:d.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:d.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var e=this.program.pick;this.handles.pick={aRegionMapUV:e.getAttribute("SCENEJS_aRegionMapUV"),aVertex:e.getAttribute("SCENEJS_aVertex"),aMorphVertex:e.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:e.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:e.getUniform("SCENEJS_uMorphFactor"),uPointSize:e.getUniform("SCENEJS_uPointSize"),uDecodePositions:e.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:e.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var f=this.program.pickTriangle;this.handles.pickTriangle={aVertex:f.getAttribute("SCENEJS_aVertex"),aTriColor:f.getAttribute("SCENEJS_aTriColor"),aMorphVertex:f.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:f.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:f.getUniform("SCENEJS_uMorphFactor"),uPointSize:f.getUniform("SCENEJS_uPointSize"),uDecodePositions:f.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:f.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var g=this.program.depth;this.handles.depth={aVertex:g.getAttribute("SCENEJS_aVertex"),aMorphVertex:g.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:g.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:g.getUniform("SCENEJS_uMorphFactor"),uPointSize:g.getUniform("SCENEJS_uPointSize"),uDecodePositions:g.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:g.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var h=this.program.drawTexture;this.handles.drawTexture={aVertex:h.getAttribute("SCENEJS_aVertex"),aUV:new Array(b),uDecodeUV:new Array(b),aMorphVertex:h.getAttribute("SCENEJS_aMorphVertex"),uMorphFactor:h.getUniform("SCENEJS_uMorphFactor"),uDecodePositions:h.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:h.getUniform("SCENEJS_uDecodeMorphPosMatrix")};for(var c=0;b>c;c++)this.handles.drawTexture.aUV[c]=h.getAttribute("SCENEJS_aUVCoord"+c),this.handles.drawTexture.uDecodeUV[c]=h.getUniform("SCENEJS_uDecodeUVMatrix"+c);for(var i in this.VAOs)this.VAOs[i]={VAO:null,morphKey1:-1,morphKey2:-1}},a.prototype.recycle=function(){var a=this.program.gl.getExtension("OES_vertex_array_object");if(a)for(var b in this.VAOs)this.VAOs[b].VAO&&(a.deleteVertexArrayOES(this.VAOs[b].VAO),this.VAOs[b].VAO=null),this.VAOs[b].morphKey1=-1,this.VAOs[b].morphKey2=-1},a.prototype.morphDraw=function(a,b,c){b.morphKey1=this.core.key1,b.morphKey2=this.core.key2;var d=this.core.key1,e=this.core.key2,f=this.core.targets[d],g=this.core.targets[e];if(a.aMorphVertex?(a.aVertex.bindArrayBuffer(f.vertexBuf),a.aMorphVertex.bindArrayBuffer(g.vertexBuf),c.bindArray+=2):a.aVertex&&(a.aVertex.bindArrayBuffer(this.core2.vertexBuf),c.bindArray++),a.aMorphNormal?(a.aNormal.bindArrayBuffer(f.normalBuf),a.aMorphNormal.bindArrayBuffer(g.normalBuf),c.bindArray+=2):a.aNormal&&(a.aNormal.bindArrayBuffer(this.core2.normalBuf),
c.bindArray++),(a.aMorphTangent||a.aTangent)&&c.hasNormalMap&&a.aMorphTangent&&(a.aTangent.bindArrayBuffer(this.core.getTangents(d,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),a.aMorphTangent.bindArrayBuffer(this.core.getTangents(e,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),c.bindArray+=2),a.aUV)for(var h,i=0,j=a.aUV.length;j>i;i++)h=this.core2.uvBufs[i],h&&a.aUV[i]&&(a.aUV[i].bindArrayBuffer(h),c.bindArray++);a.aColor&&(a.aColor.bindArrayBuffer(this.core2.colorBuf),c.bindArray++)},a.prototype.updateGeoUniforms=function(a){a.uDecodePositions&&a.uDecodePositions.setValue(this.core2.positionDecodeMat)},a.prototype.updateMorphUniforms=function(a){var b=this.core.key1,c=this.core.key2,d=this.core.targets[b],e=this.core.targets[c];a.uDecodePositions&&a.uDecodePositions.setValue(d.positionDecodeMat),a.uDecodeMorphPos&&a.uDecodeMorphPos.setValue(e.positionDecodeMat),a.uMorphFactor&&a.uMorphFactor.setValue(this.core.factor)},a.prototype.draw=function(a,b){var c=this.handles[a],d=this.VAOs[a],e=this.core.targets&&this.core.targets.length;if(c.uPointSize&&c.uPointSize.setValue(this.core2.pointSize),c.uPointUVScale&&c.uPointUVScale.setValue(this.core2.pointUVScale),c.uDecodeUV)for(var f=0,g=c.uDecodeUV.length;g>f;f++)c.uDecodeUV[f]&&c.uDecodeUV[f].setValue(this.core2.uvDecodeMats[f]);if(e?this.updateMorphUniforms(c):this.updateGeoUniforms(c),b.pickTriangle)if(e)if(c.aMorphVertex){var h=this.core.getPickPositions(this.core.key1,this.core2.arrays.indices);h&&c.aVertex.bindArrayBuffer(h),h=this.core.getPickPositions(this.core.key2,this.core2.arrays.indices),h&&c.aMorphVertex.bindArrayBuffer(h),c.aTriColor&&c.aTriColor.bindArrayBuffer(this.core2.getPickColors())}else c.aVertex&&(c.aVertex.bindArrayBuffer(this.core2.vertexBuf),this.core2.indexBuf.bind());else c.aVertex&&c.aVertex.bindArrayBuffer(this.core2.getPickPositions()),c.aTriColor&&c.aTriColor.bindArrayBuffer(this.core2.getPickColors());else{if(d.VAO&&b.VAO){if(b.VAO.bindVertexArrayOES(d.VAO),!e)return;if(d.morphKey1==this.core.key1&&d.morphKey2==this.core.key2)return}else b.VAO&&(b.VAO.bindVertexArrayOES(null),d.VAO=b.VAO.createVertexArrayOES(),b.VAO.bindVertexArrayOES(d.VAO));if(e)this.morphDraw(c,d,b);else{if(c.aVertex&&(c.aVertex.bindArrayBuffer(this.core2.vertexBuf),b.bindArray++),c.aNormal&&(c.aNormal.bindArrayBuffer(this.core2.normalBuf),b.bindArray++),c.aUV)for(var i,f=0,g=c.aUV.length;g>f;f++)i=this.core2.uvBufs[f],i&&c.aUV[f]&&(c.aUV[f].bindArrayBuffer(i),b.bindArray++);c.aColor&&(c.aColor.bindArrayBuffer(this.core2.colorBuf),b.bindArray++),c.aPointScaleRotation&&(c.aPointScaleRotation.bindArrayBuffer(this.core2.pointScaleRotationBuf),b.bindArray++),c.aPointUVTranslate&&(c.aPointUVTranslate.bindArrayBuffer(this.core2.pointUVTranslateBuf),b.bindArray++),c.aTangent&&b.hasNormalMap&&(c.aTangent.bindArrayBuffer(this.core2.getTangents(0)),b.bindArray++)}if(c.aRegionMapUV){var j=b.regionMapUVLayerIdx;if(j>=0){var k=this.core2.uvBufs;j<k.length&&(c.aRegionMapUV.bindArrayBuffer(k[j]),b.bindArray++)}}this.core2.indexBuf&&this.core2.indexBuf.bind()}},SceneJS_ChunkFactory.addChunkType("geometry",a)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.build()};a.prototype.build=function(){this.materialCore=this.cores[0],this.textureCore=this.cores[1],this.fresnelCore=this.cores[2],this.cubemapCore=this.cores[3];var a=this.program.draw,b=this.handles.draw={},c=(this.program.drawTexture,this.handles.drawTexture={});if(this.materialCore&&(b.uMaterialBaseColor=a.getUniform("SCENEJS_uMaterialColor"),b.uMaterialSpecularColor=a.getUniform("SCENEJS_uMaterialSpecularColor"),b.uMaterialEmitColor=a.getUniform("SCENEJS_uMaterialEmitColor"),b.uMaterialShine=a.getUniform("SCENEJS_uMaterialShine"),b.uMetalRoughSpecularf0=a.getUniform("SCENEJS_uMetalRoughSpecularf0")),this.textureCore){b.uTexSampler=[],b.uTexMatrix=[],b.uTexBlendFactor=[];var d=this.textureCore.layers;if(d){for(var e,a=this.program.draw,f=0,g=d.length;g>f;f++)e=d[f],b.uTexSampler[f]="SCENEJS_uSampler"+f,b.uTexMatrix[f]=a.getUniform("SCENEJS_uLayer"+f+"Matrix"),b.uTexBlendFactor[f]=a.getUniform("SCENEJS_uLayer"+f+"BlendFactor");c.uDrawSampler="SCENEJS_uDrawSampler"}}if(this.fresnelCore){var h=this.fresnelCore;h.diffuse&&(b.uDiffuseFresnelCenterColor=a.getUniform("SCENEJS_uDiffuseFresnelCenterColor"),b.uDiffuseFresnelEdgeColor=a.getUniform("SCENEJS_uDiffuseFresnelEdgeColor"),b.uDiffuseFresnelPower=a.getUniform("SCENEJS_uDiffuseFresnelPower")),h.specular&&(b.uSpecularFresnelCenterColor=a.getUniform("SCENEJS_uSpecularFresnelCenterColor"),b.uSpecularFresnelEdgeColor=a.getUniform("SCENEJS_uSpecularFresnelEdgeColor"),b.uSpecularFresnelPower=a.getUniform("SCENEJS_uSpecularFresnelPower")),h.alpha&&(b.uAlphaFresnelCenterColor=a.getUniform("SCENEJS_uAlphaFresnelCenterColor"),b.uAlphaFresnelEdgeColor=a.getUniform("SCENEJS_uAlphaFresnelEdgeColor"),b.uAlphaFresnelPower=a.getUniform("SCENEJS_uAlphaFresnelPower")),h.transparency&&(b.uTransparencyFresnelCenterColor=a.getUniform("SCENEJS_uTransparencyFresnelCenterColor"),b.uTransparencyFresnelEdgeColor=a.getUniform("SCENEJS_uTransparencyFresnelEdgeColor"),b.uTransparencyFresnelPower=a.getUniform("SCENEJS_uTransparencyFresnelPower")),h.reflect&&(b.uReflectFresnelCenterColor=a.getUniform("SCENEJS_uReflectFresnelCenterColor"),b.uReflectFresnelEdgeColor=a.getUniform("SCENEJS_uReflectFresnelEdgeColor"),b.uReflectFresnelPower=a.getUniform("SCENEJS_uReflectFresnelPower")),h.emit&&(b.uEmitFresnelCenterColor=a.getUniform("SCENEJS_uEmitFresnelCenterColor"),b.uEmitFresnelEdgeColor=a.getUniform("SCENEJS_uEmitFresnelEdgeColor"),b.uEmitFresnelPower=a.getUniform("SCENEJS_uEmitFresnelPower")),h.fragment&&(b.uFragmentFresnelCenterColor=a.getUniform("SCENEJS_uFragmentFresnelCenterColor"),b.uFragmentFresnelEdgeColor=a.getUniform("SCENEJS_uFragmentFresnelEdgeColor"),b.uFragmentFresnelPower=a.getUniform("SCENEJS_uFragmentFresnelPower"))}if(this.cubemapCore){var d=this.cubemapCore.layers;if(b.uCubeMapSampler=new Array(d.length),b.uCubeMapIntensity=new Array(d.length),b.uCubeMapMipLevels=new Array(d.length),d)for(var e,a=this.program.draw,f=0,g=d.length;g>f;f++)e=d[f],b.uCubeMapSampler[f]="SCENEJS_uCubeMapSampler"+f,b.uCubeMapIntensity[f]=a.getUniform("SCENEJS_uCubeMapIntensity"+f),b.uCubeMapMipLevels[f]=a.getUniform("SCENEJS_uCubeMapMipLevels"+f)}},a.prototype.draw=function(a,b){var c=(this.program.gl,this.handles[a]);if(this.materialCore&&(c.uMaterialBaseColor&&c.uMaterialBaseColor.setValue(this.materialCore.baseColor),c.uMaterialSpecularColor&&c.uMaterialSpecularColor.setValue(this.materialCore.specularColor),c.uMaterialEmitColor&&c.uMaterialEmitColor.setValue(this.materialCore.emitColor),c.uMaterialSpecular&&c.uMaterialSpecular.setValue(this.materialCore.specular),c.uMaterialShine&&c.uMaterialShine.setValue(this.materialCore.shine),c.uMaterialEmit&&c.uMaterialEmit.setValue(this.materialCore.emit),c.uMaterialAlpha&&c.uMaterialAlpha.setValue(this.materialCore.alpha),c.uMetalRoughSpecularf0&&c.uMetalRoughSpecularf0.setValue(this.materialCore.metalRoughspecularf0)),this.textureCore){b.hasNormalMap=!1;var d=this.textureCore.layers;if(d){var e,f=this.program[a];if(c.uTexSampler)for(var g=0,h=d.length;h>g;g++)e=d[g],c.uTexSampler[g]&&e.texture&&(f.bindTexture(c.uTexSampler[g],e.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,b.bindTexture++,e._matrixDirty&&e.buildMatrix&&e.buildMatrix.call(e),c.uTexMatrix&&c.uTexMatrix[g]&&c.uTexMatrix[g].setValue(e.matrixAsArray),c.uTexBlendFactor&&c.uTexBlendFactor[g]&&c.uTexBlendFactor[g].setValue(e.blendFactor),b.hasNormalMap=b.hasNormalMap||e.isNormalMap);if(c.uDrawSampler){var i=this.textureCore.drawLayerIndex,j=d[i];f.bindTexture(c.uDrawSampler,j.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS}}b.texture=this.textureCore}if(this.fresnelCore){var k=this.fresnelCore;k.diffuse&&(c.uDiffuseFresnelCenterColor&&c.uDiffuseFresnelCenterColor.setValue(k.diffuse.centerColor),c.uDiffuseFresnelEdgeColor&&c.uDiffuseFresnelEdgeColor.setValue(k.diffuse.edgeColor),c.uDiffuseFresnelPower&&c.uDiffuseFresnelPower.setValue(k.diffuse.power)),k.specular&&(c.uSpecularFresnelCenterColor&&c.uSpecularFresnelCenterColor.setValue(k.specular.centerColor),c.uSpecularFresnelEdgeColor&&c.uSpecularFresnelEdgeColor.setValue(k.specular.edgeColor),c.uSpecularFresnelPower&&c.uSpecularFresnelPower.setValue(k.specular.power)),k.alpha&&(c.uAlphaFresnelCenterColor&&c.uAlphaFresnelCenterColor.setValue(k.alpha.centerColor),c.uAlphaFresnelEdgeColor&&c.uAlphaFresnelEdgeColor.setValue(k.alpha.edgeColor),c.uAlphaFresnelPower&&c.uAlphaFresnelPower.setValue(k.alpha.power)),k.transparency&&(c.uTransparencyFresnelCenterColor&&c.uTransparencyFresnelCenterColor.setValue(k.transparency.centerColor),c.uTransparencyFresnelEdgeColor&&c.uTransparencyFresnelEdgeColor.setValue(k.transparency.edgeColor),c.uTransparencyFresnelPower&&c.uTransparencyFresnelPower.setValue(k.transparency.power)),k.reflect&&(c.uReflectFresnelCenterColor&&c.uReflectFresnelCenterColor.setValue(k.reflect.centerColor),c.uReflectFresnelEdgeColor&&c.uReflectFresnelEdgeColor.setValue(k.reflect.edgeColor),c.uReflectFresnelPower&&c.uReflectFresnelPower.setValue(k.reflect.power)),k.emit&&(c.uEmitFresnelCenterColor&&c.uEmitFresnelCenterColor.setValue(k.emit.centerColor),c.uEmitFresnelEdgeColor&&c.uEmitFresnelEdgeColor.setValue(k.emit.edgeColor),c.uEmitFresnelPower&&c.uEmitFresnelPower.setValue(k.emit.power)),k.fragment&&(c.uFragmentFresnelCenterColor&&c.uFragmentFresnelCenterColor.setValue(k.fragment.centerColor),c.uFragmentFresnelEdgeColor&&c.uFragmentFresnelEdgeColor.setValue(k.fragment.edgeColor),c.uFragmentFresnelPower&&c.uFragmentFresnelPower.setValue(k.fragment.power))}if(this.cubemapCore){var d=this.cubemapCore.layers;if(d){var e,f=this.program[a];if(c.uCubeMapSampler)for(var g=0,h=d.length;h>g;g++)e=d[g],c.uCubeMapSampler[g]&&e.texture&&(f.bindTexture(c.uCubeMapSampler[g],e.texture,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,c.uCubeMapIntensity[g]&&c.uCubeMapIntensity[g].setValue(e.intensity),c.uCubeMapMipLevels[g]&&c.uCubeMapMipLevels[g].setValue(e.mipLevels))}}},SceneJS_ChunkFactory.addChunkType("material",a)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.numLights=0,this.numClips=0,this.build()};a.prototype.build=function(){var a=this.program.draw,b=this.program.xray,c=this.program.pick,d=this.program.pickTriangle,e=this.program.depth,f=this.program.drawTexture;this.handles.draw={uPMatrix:a.getUniform("SCENEJS_uPMatrix"),uvMatrix:a.getUniform("SCENEJS_uVMatrix"),uWorldEye:a.getUniform("SCENEJS_uWorldEye"),uFogParams:a.getUniform("SCENEJS_uFogParams"),uFogColor:a.getUniform("SCENEJS_uFogColor"),uCanvasRes:a.getUniform("SCENEJS_uCanvasRes"),uAmbientColor:a.getUniform("SCENEJS_uAmbientColor"),uLightColor:[],uLightDir:[],uLightPos:[],uLightCutOff:[],uLightSpotExp:[],uLightAttenuation:[],uInnerCone:[],uOuterCone:[],uClipNormalAndDist:[],uClipFadeDistance:[]};var g=this.program;for(this.numLights=0;;){var h=a.getUniform("SCENEJS_uLightColor"+this.numLights);if(!h)break;this.handles.draw.uLightColor[this.numLights]=h,this.handles.draw.uLightPos[this.numLights]=g.draw.getUniform("SCENEJS_uLightPos"+this.numLights),this.handles.draw.uLightDir[this.numLights]=g.draw.getUniform("SCENEJS_uLightDir"+this.numLights),this.handles.draw.uLightAttenuation[this.numLights]=g.draw.getUniform("SCENEJS_uLightAttenuation"+this.numLights),this.handles.draw.uInnerCone[this.numLights]=g.draw.getUniform("SCENEJS_uInnerCone"+this.numLights),this.handles.draw.uOuterCone[this.numLights]=g.draw.getUniform("SCENEJS_uOuterCone"+this.numLights),++this.numLights}for(this.handles.xray={uPMatrix:b.getUniform("SCENEJS_uPMatrix"),uvMatrix:b.getUniform("SCENEJS_uVMatrix"),uWorldEye:b.getUniform("SCENEJS_uWorldEye"),uFogParams:b.getUniform("SCENEJS_uFogParams"),uFogColor:b.getUniform("SCENEJS_uFogColor"),uXrayColor:b.getUniform("SCENEJS_uXrayColor"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pick={pickMode:c.getUniform("SCENEJS_uPickMode"),uPMatrix:c.getUniform("SCENEJS_uPMatrix"),uvMatrix:c.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pickTriangle={uPMatrix:d.getUniform("SCENEJS_uPMatrix"),uvMatrix:d.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.depth={uPMatrix:e.getUniform("SCENEJS_uPMatrix"),uvMatrix:e.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.drawTexture={uPMatrix:f.getUniform("SCENEJS_uPMatrix"),uvMatrix:f.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.numClips=0;;){var i=a.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips);if(!i)break;this.handles.draw.uClipNormalAndDist[this.numClips]=i,this.handles.draw.uClipFadeDistance[this.numClips]=a.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.xray.uClipNormalAndDist[this.numClips]=b.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.xray.uClipFadeDistance[this.numClips]=b.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pick.uClipNormalAndDist[this.numClips]=c.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pick.uClipFadeDistance[this.numClips]=c.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pickTriangle.uClipNormalAndDist[this.numClips]=d.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pickTriangle.uClipFadeDistance[this.numClips]=d.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.depth.uClipNormalAndDist[this.numClips]=e.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.depth.uClipFadeDistance[this.numClips]=e.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.drawTexture.uClipNormalAndDist[this.numClips]=f.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.drawTexture.uClipFadeDistance[this.numClips]=f.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),++this.numClips}var j=a.gl,k=j.createTexture();j.bindTexture(j.TEXTURE_2D,k),j.texImage2D(j.TEXTURE_2D,0,j.RGBA,1,1,0,j.RGBA,j.UNSIGNED_BYTE,new Uint8Array(4)),this.dummyDepthTexture={texture:k,gl:j,bind:function(a){return this.texture?(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0):!1},unbind:function(a){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},j.bindTexture(j.TEXTURE_2D,null)},a.prototype.draw=function(a,b){this.program[a].bind();var c=this.handles[a];b.textureUnit=0;var d=this.program.gl;if(c.depthMode&&c.depthMode.setValue(b.depthMode),!b.VAO)for(var e=0;10>e;e++)d.disableVertexAttribArray(e);if(c.uPMatrix&&c.uPMatrix.setValue(b.projectionMatrix),c.uvMatrix&&c.uvMatrix.setValue(b.viewMatrix),c.uWorldEye&&c.uWorldEye.setValue(b.cameraEye),c.uAmbientColor&&c.uAmbientColor.setValue(b.ambientColor),c.uLightColor)for(var e=0;e<this.numLights;++e){var f=b.lights[e];c.uLightColor[e]&&c.uLightColor[e].setValue(f.color),c.uLightPos[e]&&(c.uLightPos[e].setValue(f.pos),c.uLightAttenuation[e]&&c.uLightAttenuation[e].setValue(f.attenuation)),c.uLightDir[e]&&c.uLightDir[e].setValue(f.dir),c.uInnerCone[e]&&c.uInnerCone[e].setValue(f.innerCone),c.uOuterCone[e]&&c.uOuterCone[e].setValue(f.outerCone)}if(this.numClips>0)for(var e=0;e<this.numClips;++e){var g=b.clips.clips[e];c.uClipNormalAndDist[e]&&c.uClipNormalAndDist[e].setValue(g.normalAndDist),c.uClipFadeDistance[e]&&c.uClipFadeDistance[e].setValue(g.fadeDistance)}c.uFogParams&&c.uFogParams.setValue(b.fogParams),c.uFogColor&&c.uFogColor.setValue(b.fogColor),c.uXrayColor&&c.uXrayColor.setValue(b.xrayColor);var h=b.depthBuffer||this.dummyDepthTexture;this.program[a].bindTexture("SCENEJS_uDepthBuffer",h,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,b.bindTexture++,c.uCanvasRes&&c.uCanvasRes.setValue(b.canvasResolution),c.pickMode&&c.pickMode.setValue(b.pickObject?0:2),b.useProgram++},SceneJS_ChunkFactory.addChunkType("program",a)}(),function(){"use strict";var a=function(a,b,c,d){this.id=a,this.numericId=b,this.program=c,d=d||[];for(var e=0,f=d.length;f>e;++e)d[e]&&d[e].empty&&(d[e]=null);this.cores=d,this.handles={},this.build()};a.prototype.build=function(){this.core=this.cores[0],this.handles.draw={uRegionMapRegionColor:this.program.draw.getUniform("SCENEJS_uRegionMapRegionColor"),uRegionMapHighlightFactor:this.program.draw.getUniform("SCENEJS_uRegionMapHighlightFactor"),uRegionMapHideAlpha:this.program.draw.getUniform("SCENEJS_uRegionMapHideAlpha")},this.sampleName="SCENEJS_uRegionMapSampler"},a.prototype.draw=function(a,b){var c=this.core.texture,d=this.handles[a]||{};c?(b.regionData=this.core.regionData,this.program.draw.bindTexture(this.sampleName,c,b.textureUnit),b.textureUnit=(b.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,d.uRegionMapRegionColor&&d.uRegionMapRegionColor.setValue(this.core.regionColor),d.uRegionMapHighlightFactor&&d.uRegionMapHighlightFactor.setValue(this.core.highlightFactor),d.uRegionMapHideAlpha&&d.uRegionMapHideAlpha.setValue(this.core.hideAlpha),b.regionMapUVLayerIdx=this.core.uvLayerIdx):b.regionMapUVLayerIdx=-1},SceneJS_ChunkFactory.addChunkType("regionMap",a)}(),function(){function a(a){var b,c,d;a.size?(b=a.size[0],c=a.size[1],d=a.size[2]):(b=a.xSize||1,c=a.ySize||1,d=a.zSize||1);var e="geometry/box_"+b+"_"+c+"_"+d+(a.wire?"wire":"_solid");return this.getScene().hasCore("geometry",e)?{type:"geometry",coreId:e}:{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:e,positions:new Float32Array([b,c,d,-b,c,d,-b,-c,d,b,-c,d,b,c,d,b,-c,d,b,-c,-d,b,c,-d,b,c,d,b,c,-d,-b,c,-d,-b,c,d,-b,c,d,-b,c,-d,-b,-c,-d,-b,-c,d,-b,-c,-d,b,-c,-d,b,-c,d,-b,-c,d,b,-c,-d,-b,-c,-d,-b,c,-d,b,c,-d]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),uv:new Float32Array([b,c,0,c,0,0,b,0,0,c,0,0,b,0,b,c,b,0,b,c,0,c,0,0,b,c,0,c,0,0,b,0,0,0,b,0,b,c,0,c,0,0,b,0,b,c,0,c]),indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}SceneJS.Types.addType("geometry/box",{construct:function(b){this.addNode(a.call(this,b))}})}(),function(){function a(a){var b="geometry/quad"+(a.wire?"wire":"_solid");return this.getScene().hasCore("geometry",b)?{type:"geometry",coreId:b}:{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:b,positions:[1,1,0,-1,1,0,-1,-1,0,1,-1,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3]}}SceneJS.Types.addType("geometry/quad",{construct:function(b){this.addNode(a.call(this,b))}})}(),function(){function a(a){var b=a.latitudeBands||30,c=a.longitudeBands||30,d=a.radius||1,e="geometry/sphere_"+(a.wire?"wire":"_solid")+d+"_"+c+"_"+b;if(this.getScene().hasCore("geometry",e))return{type:"geometry",coreId:e};for(var f=[],g=[],h=[],i=0;b>=i;i++)for(var j=i*Math.PI/b,k=Math.sin(j),l=Math.cos(j),m=0;c>=m;m++){var n=2*m*Math.PI/c,o=Math.sin(n),p=Math.cos(n),q=p*k,r=l,s=o*k,t=m/c,u=i/b;g.push(q),g.push(r),g.push(s),h.push(t),h.push(u),f.push(d*q),f.push(d*r),f.push(d*s)}for(var v=[],i=0;b>i;i++)for(var m=0;c>m;m++){var w=i*(c+1)+m,x=w+c+1;v.push(w+1),v.push(x+1),v.push(x),v.push(w+1),v.push(x),v.push(w)}return{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:e,positions:new Float32Array(f),normals:new Float32Array(g),uv:new Float32Array(h),indices:v}}SceneJS.Types.addType("geometry/sphere",{construct:function(b){this.addNode(a.call(this,b))}})}(),function(){function a(a){var b=a.width||1,c=a.height||1,d=a.widthSegments||1,e=a.heightSegments||1,f="geometry/plane_"+(1==a.wire?"wire_":"")+c+"_"+d+"_"+e;if(this.getScene().hasCore("geometry",f))return{type:"geometry",coreId:f};var g,h,i,j,k=[],l=[],m=[],n=[],o=b/2,p=c/2,q=d,r=e,s=q+1,t=r+1,u=b/q,v=c/r;for(h=0;t>h;h++)for(g=0;s>g;g++)i=g*u-o,j=h*v-p,k.push(i),k.push(-j),k.push(0),l.push(0),l.push(0),l.push(1),m.push(g/q),m.push(1-h/r);var w,x,y,z;for(h=0;r>h;h++)for(g=0;q>g;g++)w=g+s*h,x=g+s*(h+1),y=g+1+s*(h+1),z=g+1+s*h,n.push(w),n.push(x),n.push(y),n.push(y),n.push(z),n.push(w);return{type:"geometry",primitive:a.wire?"lines":"triangles",coreId:f,positions:new Float32Array(k),normals:new Float32Array(l),uv:new Float32Array(m),indices:n}}SceneJS.Types.addType("geometry/plane",{construct:function(b){this.addNode(a.call(this,b))}})}(),-function(a){var b=a.GrowingPacker=function(){};b.prototype={fit:function(a){var b,c,d,e=a.length,f=e>0?a[0].w:0,g=e>0?a[0].h:0;for(this.root={x:0,y:0,w:f,h:g},b=0;e>b;b++)d=a[b],d.fit=(c=this.findNode(this.root,d.w,d.h))?this.splitNode(c,d.w,d.h):this.growNode(d.w,d.h)},findNode:function(a,b,c){return a.used?this.findNode(a.right,b,c)||this.findNode(a.down,b,c):b<=a.w&&c<=a.h?a:null},splitNode:function(a,b,c){return a.used=!0,a.down={x:a.x,y:a.y+c,w:a.w,h:a.h-c},a.right={x:a.x+b,y:a.y,w:a.w-b,h:c},a},growNode:function(a,b){var c=a<=this.root.w,d=b<=this.root.h,e=d&&this.root.h>=this.root.w+a,f=c&&this.root.w>=this.root.h+b;return e?this.growRight(a,b):f?this.growDown(a,b):d?this.growRight(a,b):c?this.growDown(a,b):null},growRight:function(a,b){return this.root={used:!0,x:0,y:0,w:this.root.w+a,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:a,h:this.root.h}},(node=this.findNode(this.root,a,b))?this.splitNode(node,a,b):null},growDown:function(a,b){return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+b,down:{x:0,y:this.root.h,w:this.root.w,h:b},right:this.root},(node=this.findNode(this.root,a,b))?this.splitNode(node,a,b):null}}}("undefined"!=typeof window?window:module.exports),function(){"use strict";var a=window.Human={},b="15.0.0";b=b.indexOf("ENGINE_VERSION")>0?"qa":b;var c="2.0.1";c=c.indexOf("API_VERSION")>0?"qa":c,a.VERSION=b,a.API_VERSION=c,a.deployed=!(window.location.hostname.match(/(localhost|192\.168\.11\.\d{1,3})/)||"file:"===window.location.protocol),a.locale="en-US",a.timer=window.performance||window.Date,a.stats={trackingDownloadSize:!1,jsonDownloadTotal:0,geometryDownloadTotal:0,textureDownloadTotal:0,jsonDownloadSizes:{},geometryDownloadSizes:{},textureDownloadSizes:{},loadSequence:{startTime:a.timer.now(),moduleRequest:0,moduleLoaded:0,assetsRequested:0,assetsLoaded:0,texturesRequested:0,texturesLoaded:0},loadTimes:{preModule:0,moduleDownload:0,preAsset:0,assetDownload:0,preTexture:0,textureDownload:0},trackDownloadSize:function(){window.pako&&(this.trackingDownloadSize=!0)}},a.canvasId="theCanvas",a.annotationCanvasId="annotationCanvas",a.containerId="container",a.XML_HTTP_JSON_SUPPORTED=function(){var a=new XMLHttpRequest;return a.open("GET","/"),a.responseType="json","json"===a.responseType}(),a.ELEMENT_REMOVE_SUPPORTED="function"==typeof Element.prototype.remove,SceneJS.bind("error",function(b){a._error("WEBGL",b.errorName,b.exception,!0)}),a.error=function(b,c){return void 0===c&&(c=b,b="ERROR"),a._error("HUMAN",b,c,!1)},a.fatalError=function(b,c){return void 0===c&&(c=b,b="ERROR"),a._error("HUMAN",b,c,!0)},a._error=function(b,c,d,e){return a.events.fire("error",{type:b,name:c,message:d,fatal:e,log:a.log.messages.join("\n"),stack:a.utils.getStackTrace(),webglInfo:SceneJS.WEBGL_INFO}),d}}(),function(){"use strict";Human.Component=function(){},Human.Component.prototype={_init:function(a){this._ctx=a,this._handleMap=new Human.utils.Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},publish:function(a,b,c){c||(this._topicPubs[a]=b);var d=this._topicSubs[a];if(d)for(var e in d)d.hasOwnProperty(e)&&d[e].call(this,b)},on:function(a,b){var c=this._topicSubs[a];c||(c={},this._topicSubs[a]=c);var d=this._handleMap.addItem();c[d]=b,this._handleTopics[d]=a;var e=this._topicPubs[a];return e&&b.call(this,e),d},off:function(a,b){var c,d;if(b){c=a,d=this._topicSubs[c];for(var e in d)if(d[e]===b){a=e;break}}else c=this._handleTopics[a];c&&(delete this._handleTopics[a],d=this._topicSubs[c],d&&delete d[a],this._handleMap.removeItem(a))},once:function(a,b){var c=this,d=this.on(a,function(a){c.off(d),b(a)})}}}(),function(){"use strict";var a=Human.math={X_AXIS:vec3.fromValues(1,0,0),Y_AXIS:vec3.fromValues(0,1,0),Z_AXIS:vec3.fromValues(0,0,1),VEC3_ZEROS:vec3.fromValues(0,0,0),VEC3_ONES:vec3.fromValues(1,1,1),TO_RADIANS:Math.PI/180},b=vec3.create(),c=vec3.create();a.clamp=function(a,b,c){return b>a?b:a>c?c:a},a.nextPowerOf2=function(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))},a.sign=function(a){return a>0?1:0>a?-1:0},a.lerpScalar=function(a,b,c,d,e){var f=(a-b)/(c-b);return d+f*(e-d)},a.lerpVec3=function(a,b,c,d,e,f){f=f||vec3.create();var g=(a-b)/(c-b);return f[0]=d[0]+g*(e[0]-d[0]),f[1]=d[1]+g*(e[1]-d[1]),f[2]=d[2]+g*(e[2]-d[2]),f},a.triangleNormal=function(a,d,e,f){var g=b,h=c;return vec3.subtract(g,d,a),vec3.subtract(h,e,a),vec3.cross(f,g,h),vec3.normalize(f,f),f},a.getShortRotation=function(a,b){var c=b>a?1:-1,d=(b-a)*c;return d=(d+Math.PI)%(2*Math.PI)-Math.PI,d*c},a.lerpRadian=function(b,c,d){var e=a.getShortRotation(c,d),f=c+b*e;return f},a.lerpVec3Cylindrical=function(b,c,d,e,f,g){g=g||vec3.create();var h=(b-c)/(d-c);return g[0]=e[0]+h*(f[0]-e[0]),g[1]=a.lerpRadian(h,e[1],f[1]),g[2]=e[2]+h*(f[2]-e[2]),g},Human.math.decompressPosition=function(a,b,c){a[0]=b[0]*c[0]+c[12],a[1]=b[1]*c[5]+c[13],a[2]=b[2]*c[10]+c[14]},Human.math.decompressUV=function(a,b,c){a[0]=b[0]*c[0]+c[6],a[1]=b[1]*c[4]+c[7]},Human.math.vec3ObjToArray=function(a,b){var c=b||vec3.create();return c[0]=a.x||0,c[1]=a.y||0,c[2]=a.z||0,c},Human.math.vec3ArrayToObj=function(a){return{x:a[0],y:a[1],z:a[2]}},a.cartesianToCylindrical=function(a,b){var c=b||vec3.create();return c[0]=Math.sqrt(a[0]*a[0]+a[2]*a[2]),c[1]=Math.atan2(a[0],a[2]),c[2]=a[1],c},a.cylindricalToCartesian=function(a,b){var c=b||vec3.create();return c[0]=a[0]*Math.sin(a[1]),c[1]=a[2],c[2]=a[0]*Math.cos(a[1]),c},a.AxisBox3=function(a,b){this.verts=[[a[0],a[1],a[2]],[b[0],a[1],a[2]],[b[0],b[1],a[2]],[a[0],b[1],a[2]],[a[0],a[1],b[2]],[b[0],a[1],b[2]],[b[0],b[1],b[2]],[a[0],b[1],b[2]]]},a.easeOut=function(a,b,c){var d=a*a,e=d*a;return b+c*(-1*d*d+4*e+-6*d+4*a)},a.easeIn=function(b,c,d){return 1-a.easeOut(1-b,c,d)},a.easeInOut=function(b,c,d){return.5>b?a.easeIn(2*b,c,d)/2:.5*a.easeOut(2*b-1,c,d)+.5},a.getBoundaryCenter=function(a,b){var c=b||vec3.create();return c[0]=.5*(a.xmax+a.xmin),c[1]=.5*(a.ymax+a.ymin),c[2]=.5*(a.zmax+a.zmin),c};var d=vec3.create();a.getBoundaryDiag=function(a){return d[0]=a.xmax-a.xmin,d[1]=a.ymax-a.ymin,d[2]=a.zmax-a.zmin,vec3.length(d)};var e=mat4.create(),f=mat4.create(),g=mat4.create(),h=mat4.create(),i=mat4.create();a.buildRotationScaleMat3=function(a,b,c){return b=b||this.VEC3_ZEROS,c=c||this.VEC3_ONES,mat4.fromScaling(e,c),mat4.fromZRotation(f,b[2]*this.TO_RADIANS),mat4.fromYRotation(g,b[1]*this.TO_RADIANS),mat4.fromXRotation(h,b[0]*this.TO_RADIANS),mat4.multiply(i,h,e),mat4.multiply(i,g,i),mat4.multiply(i,f,i),mat3.fromMat4(a,i)}}(),function(){"use strict";function a(a,b,c,d,e){"undefined"==typeof e&&(e=.5);var f=i.projectionratio(e,a),g=1-f,h={x:f*b.x+g*d.x,y:f*b.y+g*d.y},j=i.abcratio(e,a),k={x:c.x+(c.x-h.x)/j,y:c.y+(c.y-h.y)/j};return{A:k,B:c,C:h}}var b=Math.abs,c=Math.cos,d=Math.sin,e=Math.atan2,f=Math.sqrt,g=Math.pow,h={x:0,y:0,z:0},i={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(a,b){var c=b(a),d=c.x*c.x+c.y*c.y;return"undefined"!=typeof c.z&&(d+=c.z*c.z),f(d)},length:function(a){var b,c,d=.5,e=0,f=i.Tvalues.length;for(b=0;f>b;b++)c=d*i.Tvalues[b]+d,e+=i.Cvalues[b]*i.arcfn(c,a);return d*e},map:function(a,b,c,d,e){var f=c-b,g=e-d,h=a-b,i=h/f;return d+g*i},lerp:function(a,b,c){var d={x:b.x+a*(c.x-b.x),y:b.y+a*(c.y-b.y)};return b.z&&c.z&&(d.z=b.z+a*(c.z-b.z)),d},pointToString:function(a){var b=a.x+"/"+a.y;return"undefined"!=typeof a.z&&(b+="/"+a.z),b},pointsToString:function(a){return"["+a.map(i.pointToString).join(", ")+"]"},angle:function(a,b,c){var d,g=b.x-a.x,h=b.y-a.y,i=c.x-a.x,j=c.y-a.y,k=g*j-h*i,l=f(g*g+h*h),m=f(i*i+j*j);return g/=l,h/=l,i/=m,j/=m,d=g*i+h*j,e(k,d)},dist:function(a,b){var c=a.x-b.x,d=a.y-b.y;return f(c*c+d*d)},abcratio:function(a,c){if(2!==c&&3!==c)return!1;if("undefined"==typeof a)a=.5;else if(0===a||1===a)return a;var d=g(a,c)+g(1-a,c),e=d-1;return b(e/d)},projectionratio:function(a,b){if(2!==b&&3!==b)return!1;if("undefined"==typeof a)a=.5;else if(0===a||1===a)return a;var c=g(1-a,b),d=g(a,b)+c;return c/d},align:function(a,b){var f=b.p1.x,g=b.p1.y,h=-e(b.p2.y-g,b.p2.x-f),i=function(a){return{x:(a.x-f)*c(h)-(a.y-g)*d(h),y:(a.x-f)*d(h)+(a.y-g)*c(h)}};return a.map(i)}},j=Human.math.bezier=function(a){var c=a&&a.forEach?a:[].slice.call(arguments),d=!1;if("object"==typeof c[0]){d=c.length;var e=[];c.forEach(function(a){["x","y","z"].forEach(function(b){"undefined"!=typeof a[b]&&e.push(a[b])})}),c=e}var f=!1,g=c.length;if(d){if(d>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");f=!0}}else if(6!==g&&8!==g&&9!==g&&12!==g&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var h=!f&&(9===g||12===g)||a&&a[0]&&"undefined"!=typeof a[0].z;this._3d=h;for(var j=[],k=0,l=h?3:2;g>k;k+=l){var m={x:c[k],y:c[k+1]};h&&(m.z=c[k+2]),j.push(m)}this.order=j.length-1,this.points=j;var n=["x","y"];h&&n.push("z"),this.dims=n,this.dimlen=n.length,function(a){for(var c=i.align(j,{p1:j[0],p2:j[a.order]}),d=0;d<c.length;d++)if(b(c[d].y)>1e-4)return void(a._linear=!1);a._linear=!0}(this),this._t1=0,this._t2=1,this.update()};j.quadraticFromPoints=function(b,c,d,e){if("undefined"==typeof e&&(e=.5),0===e)return new j(c,c,d);if(1===e)return new j(b,c,c);var f=a(2,b,c,d,e);return new j(b,f.A,d)},j.cubicFromPoints=function(b,c,d,e,f){"undefined"==typeof e&&(e=.5);var g=a(3,b,c,d,e);"undefined"==typeof f&&(f=i.dist(c,g.C));var h=f*(1-e)/e,k=i.dist(b,d),l=(d.x-b.x)/k,m=(d.y-b.y)/k,n=f*l,o=f*m,p=h*l,q=h*m,r={x:c.x-n,y:c.y-o},s={x:c.x+p,y:c.y+q},t=g.A,u={x:t.x+(r.x-t.x)/(1-e),y:t.y+(r.y-t.y)/(1-e)},v={x:t.x+(s.x-t.x)/e,y:t.y+(s.y-t.y)/e},w={x:b.x+(u.x-b.x)/e,y:b.y+(u.y-b.y)/e},x={x:d.x+(v.x-d.x)/(1-e),y:d.y+(v.y-d.y)/(1-e)};return new j(b,w,x,d)},j.prototype={valueOf:function(){return this.toString()},toString:function(){return i.pointsToString(this.points)},update:function(){this.dpoints=[];for(var a=this.points,b=a.length,c=b-1;b>1;b--,c--){for(var d,e=[],f=0;c>f;f++)d={x:c*(a[f+1].x-a[f].x),y:c*(a[f+1].y-a[f].y)},this._3d&&(d.z=c*(a[f+1].z-a[f].z)),e.push(d);this.dpoints.push(e),a=e}this.computedirection()},computedirection:function(){var a=this.points,b=i.angle(a[0],a[this.order],a[1]);this.clockwise=b>0},length:function(){return i.length(this.derivative.bind(this));

},_lut:[],getLUT:function(a){if(a=a||100,this._lut.length===a)return this._lut;this._lut=[];for(var b=0;a>=b;b++)this._lut.push(this.compute(b/a));return this._lut},on:function(a,b){b=b||5;for(var c,d=this.getLUT(),e=[],f=0,g=0;g<d.length;g++)c=d[g],i.dist(c,a)<b&&(e.push(c),f+=g/d.length);return e.length?f/=e.length:!1},get:function(a){return this.compute(a)},point:function(a){return this.points[a]},compute:function(a){if(0===a)return this.points[0];if(1===a)return this.points[this.order];var b,c=this.points,d=1-a;if(1===this.order)return b={x:d*c[0].x+a*c[1].x,y:d*c[0].y+a*c[1].y},this._3d&&(b.z=d*c[0].z+a*c[1].z),b;if(this.order<4){var e,f,g,i=d*d,j=a*a,k=0;return 2===this.order?(c=[c[0],c[1],c[2],h],e=i,f=d*a*2,g=j):3===this.order&&(e=i*d,f=i*a*3,g=d*j*3,k=a*j),b={x:e*c[0].x+f*c[1].x+g*c[2].x+k*c[3].x,y:e*c[0].y+f*c[1].y+g*c[2].y+k*c[3].y},this._3d&&(b.z=e*c[0].z+f*c[1].z+g*c[2].z+k*c[3].z),b}for(var l=JSON.parse(JSON.stringify(this.points));l.length>1;){for(var m=0;m<l.length-1;m++)l[m]={x:l[m].x+(l[m+1].x-l[m].x)*a,y:l[m].y+(l[m+1].y-l[m].y)*a},"undefined"!=typeof l[m].z&&(l[m]=l[m].z+(l[m+1].z-l[m].z)*a);l.splice(l.length-1,1)}return l[0]},derivative:function(a){var b,c,d=1-a,e=0,f=this.dpoints[0];2===this.order&&(f=[f[0],f[1],h],b=d,c=a),3===this.order&&(b=d*d,c=d*a*2,e=a*a);var g={x:b*f[0].x+c*f[1].x+e*f[2].x,y:b*f[0].y+c*f[1].y+e*f[2].y};return this._3d&&(g.z=b*f[0].z+c*f[1].z+e*f[2].z),g}}}(),function(){"use strict";function a(b,c,d,e,f){if(!h.rayAabb(b,c,d.bb.min,d.bb.max))return 0;if(d.triangles){for(var g=d.triangles,i=0,j=0,k=g.length;k>j;++j)e.getTrianglePositionOnSurface(3*g[j],z,A,B),h.rayTriangle(b,c,z,A,B,f)&&(f&&(f.triangleIndex=g[j]),++i);return i}return a(b,c,d.left,e,f)+a(b,c,d.right,e,f)}function b(a,c,d,e,f){if(!d.left){for(var g=d.objects,i=0,j=g.length;j>i;++i){var k=g[i],l=k.objectId;(!e||e(k))&&h.rayObjectAabb(a,c,l,y)&&f.push({object:k,tmin:y[0],tmax:y[1]})}return f}return h.rayAabb(a,c,d.bb.min,d.bb.max)?(b(a,c,d.left,e,f),b(a,c,d.right,e,f),f):f}function c(a,b){return a.t-b.t}function d(a,b){return a.tmin-b.tmin}function e(a,b,c){var d=[],e=a.getObject();if(!e)return d;for(C.length=0,C.push(e.getKdTree());C.length>0;){var f=C.pop();if(b(f)&&(f.left&&C.push(f.left),f.right&&C.push(f.right),f.triangles))for(var g=0,h=f.triangles.length;h>g;++g)e.getTrianglePositionOnSurface(3*f.triangles[g],z,A,B),c(z,A,B)&&d.push(f.triangles[g])}return d}function f(a,b,c,d,e){vec3.subtract(D,c,a),vec3.subtract(E,b,a),vec3.cross(F,E,D),vec3.cross(H,F,E);var f=vec3.length(D);f*=f,vec3.scale(H,H,f),vec3.cross(I,D,F);var g=vec3.length(E);g*=g,vec3.scale(I,I,g),vec3.add(H,H,I);var h=vec3.length(F);h*=h,vec3.scale(G,H,1/(2*h));var i=vec3.length(G);vec3.add(J,a,G),vec3.subtract(K,d,J);var j=vec3.length(K);return i+e>=j?!0:!1}function g(a,b,c,d,e){var f=e*e,g=a[0]-d[0],h=a[1]-d[1],i=a[2]-d[2],j=g*g+h*h+i*i;return j>f?!1:(g=b[0]-d[0],h=b[1]-d[1],i=b[2]-d[2],j=g*g+h*h+i*i,j>f?!1:(g=c[0]-d[0],h=c[1]-d[1],i=c[2]-d[2],j=g*g+h*h+i*i,j>f?!1:!0))}var h=Human.math.intersections={},i=1e-8,j=vec3.create(),k=vec3.create(),l=[new Float32Array([1,0,0]),new Float32Array([0,1,0]),new Float32Array([0,0,1]),new Float32Array([-1,0,0]),new Float32Array([0,-1,0])];h.pointAabb=function(a,b,c){return a[0]<b[0]?!1:a[0]>c[0]?!1:a[1]<b[1]?!1:a[1]>c[1]?!1:a[2]<b[2]?!1:a[2]>c[2]?!1:!0},h.aabbAabb=function(a,b,c,d){return b[0]<c[0]?!1:d[0]<a[0]?!1:b[1]<c[1]?!1:d[1]<a[1]?!1:b[2]<c[2]?!1:d[2]<a[2]?!1:!0},h.rayAabb=function(a,b,c,d,e){for(var f=0,g=Number.POSITIVE_INFINITY,h=Math.abs,j=Math.min,k=Math.max,l=0;3>l;++l)if(h(b[l])<i){if(a[l]<c[l]||a[l]>d[l])return!1}else{var m=(c[l]-a[l])/b[l],n=(d[l]-a[l])/b[l];if(m>n){var o=m;m=n,n=o}if(f=k(f,m),g=j(g,n),f>g)return!1}return e&&(e[0]=f,e[1]=g),!0};var m=new Float32Array(3),n=new Float32Array(3),o=new Float32Array(3),p=new Float32Array(3),q=new Float32Array(3);h.rayTriangle=function(a,b,c,d,e,f){vec3.sub(m,d,c),vec3.sub(n,e,c),vec3.cross(p,b,n);var g=vec3.dot(p,m);if(g>-i&&i>g)return!1;var h=1/g;vec3.sub(o,a,c);var j=h*vec3.dot(p,o);if(0>j||j>1)return!1;vec3.cross(q,o,m);var k=h*vec3.dot(q,b);if(0>k||j+k>1)return!1;var l=h*vec3.dot(q,n);return i>l?!1:(f&&l<f.t&&(f.u=j,f.v=k,f.w=1-j-k,f.t=l),!0)},h.pointPolyhedron=function(b,c){var d=0,e=0,f=c.getObject();if(!f)return!1;for(var g=0,h=l.length;h>g;++g)a(b,l[g],f.getKdTree(),f)%2===1?++d:++e;return d>e},h.rayPolyhedron=function(b,c,d,e){var f=d.getObject();return f?(e=e||{t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1},a(b,c,f.getKdTree(),f,e)>0?e:null):null},h.planeAabb=function(a,b,c,d){var e=d[0],f=d[1],g=d[2];if(a[0]>=0&&(e=c[0]),a[1]>=0&&(f=c[1]),a[2]>=0&&(g=c[2]),e*a[0]+f*a[1]+g*a[2]+b>0)return-1;var h=c[0],i=c[1],j=c[2];return a[0]>=0&&(h=d[0]),a[1]>=0&&(i=d[1]),a[2]>=0&&(j=d[2]),h*a[0]+i*a[1]+j*a[2]+b>0?0:1},h.planesAabb=function(a,b,c,d){for(var e=1,f=a.length,g=0;f>g;++g){var h=a[g],i=this.planeAabb(h.n,h.d,b,c);if(d&&(d[g]=i),1>i&&(e=i),-1===e)break}if(d&&f>g)for(var j=5;j>g;--j)d[j]=void 0;return e};var r=mat4.create(),s=mat3.create(),t=vec3.create(),u=vec3.create(),v=vec3.create(),w=vec3.create(),x=vec3.create();h.pointObject=function(a,b){var c=Human.scene.objects[b],d=c.getBoundary();if(w[0]=d.xmin,w[1]=d.ymin,w[2]=d.zmin,x[0]=d.xmax,x[1]=d.ymax,x[2]=d.zmax,!this.pointAabb(a,w,x))return!1;mat4.invert(r,c.getWorldMatrix()),vec3.transformMat4(t,a,r);for(var e=0,f=c.renderables.length;f>e;++e){var g=c.renderables[e];if(d=g.boundary,w[0]=d.xmin,w[1]=d.ymin,w[2]=d.zmin,x[0]=d.xmax,x[1]=d.ymax,x[2]=d.zmax,this.pointAabb(t,w,x)){var h=g.geometryNode;if(h&&this.pointPolyhedron(t,h))return!0}}return!1},h.rayObjectAabb=function(a,b,c,d){var e=Human.scene.objects[c],f=e.getBoundary();return w[0]=f.xmin,w[1]=f.ymin,w[2]=f.zmin,x[0]=f.xmax,x[1]=f.ymax,x[2]=f.zmax,this.rayAabb(a,b,w,x,d)},h.rayObject=function(a,b,c,d,e){var f=Human.scene.objects[c];if(!this.rayObjectAabb(a,b,c))return null;mat4.invert(r,f.getWorldMatrix()),vec3.transformMat4(u,a,r),mat3.fromMat4(s,r),vec3.transformMat3(v,b,s);for(var g=0,h=f.renderables.length;h>g;++g){var i=f.renderables[g];if(!e||e(i)){var j=i.boundary;if(w[0]=j.xmin,w[1]=j.ymin,w[2]=j.zmin,x[0]=j.xmax,x[1]=j.ymax,x[2]=j.zmax,this.rayAabb(u,v,w,x)){var k=i.geometryNode;if(k){var l=this.rayPolyhedron(u,v,k,d);if(l)return l}}}}return null},h.raySceneAabb=function(a,c,e){var f=[];return b(a,c,Human.scene.getKdTree(),e,f),f.length>0?(f.sort(d),f):null},h.rayScene=function(a,b,d,e){var f=[],g=this.raySceneAabb(a,b,d);if(g)for(var h=0,i=g.length;i>h;++h){var j=g[h].object.objectId,k={t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1,objectId:j};this.rayObject(a,b,j,k,e)&&f.push(k)}return f.length>0?(f.sort(c),f):null},h.spherePolyhedron=function(a,b,c){var d=j,g=k;return d[0]=b[0]-c,d[1]=b[1]-c,d[2]=b[2]-c,g[0]=b[0]+c,g[1]=b[1]+c,g[2]=b[2]+c,e(a,function(a){return h.aabbAabb(a.bb.min,a.bb.max,d,g)},function(a,d,e){return f(a,d,e,b,c)})},h.sphereInPolyhedron=function(a,b,c){var d=j,f=k;return d[0]=b[0]-c,d[1]=b[1]-c,d[2]=b[2]-c,f[0]=b[0]+c,f[1]=b[1]+c,f[2]=b[2]+c,e(a,function(a){return h.aabbAabb(a.bb.min,a.bb.max,d,f)},function(a,d,e){return g(a,d,e,b,c)})};var y=new Float32Array(2),z=new Float32Array(3),A=new Float32Array(3),B=new Float32Array(3),C=[],D=new Float32Array(3),E=new Float32Array(3),F=new Float32Array(3),G=new Float32Array(3),H=new Float32Array(3),I=new Float32Array(3),J=new Float32Array(3),K=new Float32Array(3)}(),function(){"use strict";function a(a,b){return b>a?-1:a>b?1:0}function b(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",a),e.responseType=b,e.onload=function(){if(200===e.status||window.localContentOnly){var b=!1;if(a.endsWith("-etc1.pvr")){var f=new DataView(e.response);1347834371!==f.getInt32(0)&&(console.log("BAD PVR FILE!"),d(new Error("Failed request: "+e.status+" - "+e.statusText)),b=!0)}b||(a.endsWith("-etc1.pvr")&&console.log("GOOD PVR FILE!"),c(e.response))}else d&&d(new Error("Failed request: "+e.status+" - "+e.statusText))},e.send(null)}function c(a,b){if(a){var d=a.bb.min,e=a.bb.max,f=d[0],g=d[1],h=d[2],i=e[0],j=e[1],k=e[2];b.addNode({type:"geometry",primitive:"lines",positions:[f,j,h,i,j,h,i,j,h,i,g,h,i,g,h,f,g,h,f,g,h,f,j,h,f,j,h,f,j,k,i,j,h,i,j,k,f,g,h,f,g,k,i,g,h,i,g,k,f,j,k,i,j,k,i,j,k,i,g,k,i,g,k,f,g,k,f,g,k,f,j,k]}),c(a.left,b),c(a.right,b)}}function d(a,b,c){b++,c.numNodes++;var e=a.triangles||a.objects;e?(c.numLeaves++,c.numObjects+=e.length,c.depthSum+=b):(d(a.left,b,c),d(a.right,b,c))}Human.utils=Human.utils||{};var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];Human.utils.leftPad=function(a,b,c){for(;a.length<c;)a=b+a;return a},Human.utils.toHexString=function(a){for(var b="";a>0;)b=e[15&a]+b,a>>=4;return b},Human.utils.floatRGBToHexString=function(a,b,c){var d=this.leftPad(this.toHexString(Math.floor(255*a)),"0",2),e=this.leftPad(this.toHexString(Math.floor(255*b)),"0",2),f=this.leftPad(this.toHexString(Math.floor(255*c)),"0",2);return"#"+d+e+f},Human.utils.isArray=function(a){return a&&!a.propertyIsEnumerable("length")&&"object"==typeof a&&"number"==typeof a.length},Human.utils.isObject=function(a){return!!a&&"[object Object]"===Object.prototype.toString.call(a)},Human.utils.isPrimitive=function(a){return null===a||!!(typeof a).match(/^(string|number|boolean|undefined)$/)},Human.utils.isString=function(a){return"string"==typeof a||a instanceof String},Human.utils.filterInPlace=function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)b(a[d])?a[d-c]=a[d]:c++;return a.length=a.length-c,a},Human.utils.getStackTrace=function(){var a,b=new Error;if(b.stack)a=b.stack;else try{throw b}catch(c){a=c.stack}return a||null},Human.utils.extend=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},Human.utils.apply=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},Human.utils.applyIf=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(void 0===b[c]||null===b[c])&&(b[c]=a[c]);return b},Human.utils.applyIf2=function(a,b){a=a||{};var c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=void 0!==a[d]?a[d]:b[d]);return c},Human.utils.shallowClone=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},Human.utils.deepClone=function(a){if(null===a||void 0===a||"string"==typeof a||"number"==typeof a||"boolean"==typeof a)return a;var b;if(Array.isArray(a)){b=new Array(a.length);for(var c=0,d=a.length;d>c;++c)b[c]=Human.utils.deepClone(a[c]);return b}b={};for(var e in a)b[e]=Human.utils.deepClone(a[e]);return b},Human.utils.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},Human.utils.getDir=function(a){var b=a.lastIndexOf("/");return b>-1?a.substring(0,b>0?b+1:0):""},Human.utils.async=function(a){setTimeout(a,0)},Human.utils.noop=function(){},Human.utils.getKeys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},Human.utils.createUUID=function(){for(var a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],b=["8","9","A","B"],c=[],d=0;38>d;d++)switch(d){case 8:c.push("-");break;case 13:c.push("-");break;case 18:c.push("-");break;case 14:c.push("4");break;case 19:c.push(b[Math.round(3*Math.random())]);break;default:c.push(a[Math.round(15*Math.random())])}return c.join("")},Human.utils.binarySearch=function(b,c,d,e){d=d||a,e=e||{index1:null,index2:null,value1:null,value2:null};var f,g,h,i=0,j=b.length-1;if(d(b[0],c)>0)return e.index1=null,e.value1=null,e.index2=0,e.value2=b[0],e;if(d(b[j],c)<0)return e.index1=j,e.value1=b[j],e.index2=null,e.value2=null,e;for(;j>=i;){if(f=Math.floor((i+j)/2),g=b[f],h=b[f+1],d(g,c)<=0&&d(h,c)>=0)return e.index1=f,e.index2=f+1,e.value1=g,e.value2=h,e;d(g,c)>0?j=f-1:i=f+1}},Human.utils.atos=function(a,b,c){b=b||0,c=c||a.byteLength;var d=new Uint8Array(a,b,c),e=new TextDecoder("utf-8").decode(d);return e},Human.utils.atoj=function(a,b,c){return JSON.parse(Human.utils.atos(a,b,c))},Human.utils.benchmark=function(a,b){b=b||1e7;for(var c=performance.now(),d=0;b>d;d++)a();c=performance.now()-c,console.log("Total time: "+c.toFixed(3)+"ms"),console.log("Time / operation: "+(c/b).toExponential(3)+"ms")},Human.utils.setRandomVisibleObjects=function(a){for(var b=Object.keys(Human.scene.objects).filter(function(a){return Human.scene.objects[a].isLeaf()}),c={},d=0;a>d;d++){var e=Math.floor(Math.random()*b.length);c[b.splice(e,1)]=!0}Human.scene.setEnabledObjects({objectIds:c,replace:!0})},Human.utils.getText=function(a,c,d){b(a,"text",c,d)},Human.utils.getJSON=Human.XML_HTTP_JSON_SUPPORTED?function(a,c,d){b(a,"json",c,d)}:function(a,b,c){this.getText(a,function(a){b(JSON.parse(a))},c)},Human.utils.getBinary=function(a,c,d){b(a,"arraybuffer",c,d)},Human.utils.elementVisible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},Human.utils.removeElement=Human.ELEMENT_REMOVE_SUPPORTED?function(a){a.remove()}:function(a){null!==a.parentNode&&a.parentNode.removeChild(a)},Human.utils.boundaryToScreen=function(a){var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=[a.xmin,a.ymin,a.zmin,1],g=[a.xmin,a.ymin,a.zmax,1],h=[a.xmin,a.ymax,a.zmin,1],i=[a.xmin,a.ymax,a.zmax,1],j=[a.xmax,a.ymin,a.zmin,1],k=[a.xmax,a.ymin,a.zmax,1],l=[a.xmax,a.ymax,a.zmin,1],m=[a.xmax,a.ymax,a.zmax,1],n=Human.renderer.getViewMat(),o=Human.renderer.getProjMat(),p=mat4.create();mat4.multiply(p,o,n),vec4.transformMat4(f,f,p),b=Math.min(b,f[0]/f[3]),c=Math.max(c,f[0]/f[3]),d=Math.min(d,f[1]/f[3]),e=Math.max(e,f[1]/f[3]),vec4.transformMat4(g,g,p),b=Math.min(b,g[0]/g[3]),c=Math.max(c,g[0]/g[3]),d=Math.min(d,g[1]/g[3]),e=Math.max(e,g[1]/g[3]),vec4.transformMat4(h,h,p),b=Math.min(b,h[0]/h[3]),c=Math.max(c,h[0]/h[3]),d=Math.min(d,h[1]/h[3]),e=Math.max(e,h[1]/h[3]),vec4.transformMat4(i,i,p),b=Math.min(b,i[0]/i[3]),c=Math.max(c,i[0]/i[3]),d=Math.min(d,i[1]/i[3]),e=Math.max(e,i[1]/i[3]),vec4.transformMat4(j,j,p),b=Math.min(b,j[0]/j[3]),c=Math.max(c,j[0]/j[3]),d=Math.min(d,j[1]/j[3]),e=Math.max(e,j[1]/j[3]),vec4.transformMat4(k,k,p),b=Math.min(b,k[0]/k[3]),c=Math.max(c,k[0]/k[3]),d=Math.min(d,k[1]/k[3]),e=Math.max(e,k[1]/k[3]),vec4.transformMat4(l,l,p),b=Math.min(b,l[0]/l[3]),c=Math.max(c,l[0]/l[3]),d=Math.min(d,l[1]/l[3]),e=Math.max(e,l[1]/l[3]),vec4.transformMat4(m,m,p),b=Math.min(b,m[0]/m[3]),c=Math.max(c,m[0]/m[3]),d=Math.min(d,m[1]/m[3]),e=Math.max(e,m[1]/m[3]);var q=Human.renderer.canvas.canvas[0],r=(.5*b+.5)*q.width,s=(.5*c+.5)*q.width,t=q.height-(.5*e+.5)*q.height,u=q.height-(.5*d+.5)*q.height,v=(s-r)*(u-t);return{min:[r,t],max:[s,u],pixelCoverage:v}},Human.utils.visibleAssetReport=function(){var a={totalVertices:0,totalTriangles:0,objectStats:{},geometryStats:{},textureStats:{},objectsByTrianglesPerPixel:null,objectsByTexelsPerPixel:null,geometriesByTriangleCount:null,texturesBySize:null},b=Human.scene.objects,c=Object.keys(Human.scene.enabledObjects).filter(function(a){return!!Human.scene.objects[a].geometry&&!!Human.scene.objects[a].material});a.objectsByTrianglesPerPixel=new Array(c.length),a.objectsByTexelsPerPixel=new Array(c.length);for(var d=a.geometryStats,e=a.textureStats,f=0,g=c.length;g>f;++f){for(var h=c[f],i=b[h],j=i.geometry._core.arrays,k=j.positions.length/3,l=j.indices.length/3,m=i.material.textures||[],n=new Array(m.length),o=0;o<m.length;++o){var p=m[o]._core,q=p.compressedSrc||p.src||p.uri;n[o]=e[q]=e[q]||{src:q,width:p.width,height:p.height,objectIds:[],count:0,atlasSharing:0,atlas:!1,adjustedTexels:p.width*p.height},e[q].count++;for(var r=!0,s=0,t=e[q].objectIds.length;t>s;++s){var u=b[e[q].objectIds[s]].geometryId;u!==i.geometryId&&(e[q].atlas=!0),u===i.geometryId&&(r=!1)}r&&e[q].atlasSharing++,e[q].objectIds.push(h)}i._setBoundaryDirty();var v=Human.utils.boundaryToScreen(i.getBoundary());a.totalVertices+=k,a.totalTriangles+=l,a.objectsByTexelsPerPixel[f]=a.objectsByTrianglesPerPixel[f]=a.objectStats[h]={objectId:h,vertices:k,triangles:l,textures:n,canvasBounds:{min:v.min,max:v.max},pixelCoverage:v.pixelCoverage,trianglesPerPixel:l/v.pixelCoverage,texelsPerPixel:0},d[i.geometryId]=d[i.geometryId]||{geometryId:i.geometryId,vertices:k,triangles:l,totalVertices:0,totalTriangles:0,objectIds:[],count:0},d[i.geometryId].count++,d[i.geometryId].totalVertices+=k,d[i.geometryId].totalTriangles+=l,d[i.geometryId].objectIds.push(h)}return Object.keys(e).forEach(function(a){var b=e[a];b.atlas&&(b.adjustedTexels/=b.atlasSharing)}),a.objectsByTrianglesPerPixel.sort(function(a,b){return b.trianglesPerPixel-a.trianglesPerPixel}),a.objectsByTexelsPerPixel.filter(function(a){return a.textures.length>0}).forEach(function(a){var b=a.textures;b.sort(function(a,b){return b.adjustedTexels-a.adjustedTexels}),a.texelsPerPixel=a.textures[0].adjustedTexels/a.pixelCoverage}),a.objectsByTexelsPerPixel.sort(function(a,b){return b.texelsPerPixel-a.texelsPerPixel}),a.geometriesByTriangleCount=Object.keys(d).map(function(a){return d[a]}).sort(function(a,b){return b.triangles*b.count-a.triangles*a.count}),a.texturesBySize=Object.keys(e).map(function(a){return e[a]}).sort(function(a,b){return b.adjustedTexels-a.adjustedTexels}),a},Human.utils.textGzipSize=function(a){if(window.pako){var b=(new TextEncoder).encode(a);return pako.deflate(b).byteLength}return 0},Human.utils.binaryGzipSize=function(a){if(window.pako){var b=new Uint8Array(a);return pako.deflate(b).byteLength}return 0},Human.utils.drawKdTree=function(a,b){c(a,b)},Human.utils.kdTreeStats=function(a){var b={numNodes:0,numLeaves:0,numObjects:0,averageLeafObjects:0,depthSum:0,averageDepth:0};return d(a,0,b),b.averageDepth=b.depthSum/b.numLeaves,b.averageLeafObjects=b.numObjects/b.numLeaves,b},Human.utils.loadScript=function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src=a,null!==b&&(d.onload=b),c.appendChild(d)}}(),Human.utils.Map=function(a,b){"use strict";this.items=a||[];var c=b||0,d=c;"number"!=typeof c&&(d=c+"0"),this.addItem=function(){var a;if(2===arguments.length){var b=arguments[0];if(a=arguments[1],this.items[b])throw"ID clash: '"+b+"'";return this.items[b]=a,b}for(;;){a=arguments[0];var e;if("number"==typeof c?e=d++:(e=c+parseInt(d.substr(c.length)),d=c+(parseInt(d.substr(c.length))+1)),!this.items[e])return this.items[e]=a,e}},this.removeItem=function(a){var b=this.items[a];return void 0!==b&&(delete this.items[a],d=a),b}},Human.utils.IDPool=function(a){"use strict";a=a||{};var b=a.prefix||"id",c=b.length,d=[],e={},f={};this.getId=function(a){if(a){if(e[a]||f[a])throw"ID already in use: "+a;return e[a]=!0,a}for(var c,g=0,h=d.length;h>g;g++)if(!d[g]&&(c=b+g,!e[c]))return d[g]=!0,f[c]=!0,c;return d.push(!0),c=b+(d.length-1),f[c]=!0,c},this.containsId=function(a){return void 0!==e[a]||void 0!==f[a]},this.putId=function(a){e[a]?delete e[a]:f[a]&&(d[parseInt(a.substr(c))]=!1,delete f[a])}},function(){"use strict";function a(a,b,c){var d,f,g=Object.create(null),h=[];if(a.forEach(function(a){d=e.call(a),g[d]||(g[d]={value:a,freq:1})}),b.forEach(function(a){d=e.call(a),g[d]?1===g[d].freq&&(g[d].freq=3):g[d]={value:a,freq:2}}),c){for(f in g)c(g[f].freq)&&h.push(g[f].value);return h}return g}var b=Human.utils.selection={},c=function(a){this.defunct="function"!=typeof a?c.defunct:function(){return!1},this.tokens=[],this.rules=[],this.remove=0,this.state=0,this.index=0,this.input=""};c.prototype.addRule=function(a,b,c){var d=a.global;if(!d){var e="g";a.multiline&&(e+="m"),a.ignoreCase&&(e+="i"),a=new RegExp(a.source,e)}return"[object Array]"!==Object.prototype.toString.call(c)&&(c=[0]),this.rules.push({pattern:a,global:d,action:b,start:c}),this},c.prototype.setInput=function(a){return this.remove=0,this.state=0,this.index=0,this.tokens.length=0,this.input=a,this},c.prototype.lex=function(){if(this.tokens.length)return this.tokens.shift();this.reject=!0;for(var a;this.index<=this.input.length;){for(var b=this.scan().splice(this.remove),c=this.index;b.length&&this.reject;){var d=b.shift(),e=d.result,f=d.length;if(this.index+=f,this.reject=!1,this.remove++,a=d.action.apply(this,e),this.reject)this.index=e.index;else if("undefined"!=typeof a)switch(Object.prototype.toString.call(a)){case"[object Array]":this.tokens=a.slice(1),a=a[0];default:return f&&(this.remove=0),a}}var g=this.input;if(c<g.length)if(this.reject){if(this.remove=0,a=this.defunct.call(this,g.charAt(this.index++)),"undefined"!=typeof a)return"[object Array]"===Object.prototype.toString.call(a)?(this.tokens=a.slice(1),a[0]):a}else this.index!==c&&(this.remove=0),this.reject=!0;else{if(!b.length)break;this.reject=!0}}},c.prototype.scan=function(){for(var a=[],b=0,c=this.state,d=this.index,e=this.input,f=0,g=this.rules.length;g>f;f++){var h=this.rules[f],i=h.start,j=i.length;if(!j||i.indexOf(c)>=0||c%2&&1===j&&!i[0]){var k=h.pattern;k.lastIndex=d;var l=k.exec(e);if(l&&l.index===d){var m=a.push({result:l,action:h.action,length:l[0].length});for(h.global&&(b=m);--m>b;){var n=m-1;if(a[m].length>a[n].length){var o=a[m];a[m]=a[n],a[n]=o}}}}}return a};var d=function(a){this.table=a};d.prototype.parse=function(a){for(var b,c=a.length,d=this.table,e=[],f=[],g=0;c>g;)switch(b=a[g++]){case"(":f.unshift(b);break;case")":for(;f.length&&(b=f.shift(),"("!==b);)e.push(b);if("("!==b)throw new Error("Mismatched parentheses.");break;default:if(d.hasOwnProperty(b)){for(;f.length;){var h=f[0];if("("===h)break;var i=d[b],j=i.precedence,k=d[h].precedence;if(j>k||j===k&&"right"===i.associativity)break;e.push(f.shift())}f.unshift(b)}else e.push(b)}for(;f.length;)b=f.shift(),"("!==b&&e.push(b);return e};var e,f=[];f.push(e=function(){return this});var g={};g.union=function(b,c){return a(b,c,function(){return!0})},g.intersection=function(b,c){return a(b,c,function(a){return 3===a})},g.difference=function(b,c){return a(b,c,function(a){return 3>a})},g.complement=function(b,c){return a(b,c,function(a){return 1===a})},g.equals=function(b,c){var d,e=0,f=Math.pow(2,53),g=a(b,c);for(d in g)e=Math.max(e,g[d].freq),f=Math.min(f,g[d].freq);return 3===f&&3===e};var h={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},i={"<AND>":function(a,b){return a&&b},"<OR>":function(a,b){return a||b},"<NOT>":function(a){return!a}};b.StringMatcher=function(){this.lexer=new c(function(){return!1}),this.parser=new d(h),this.operators=i,this.lexer.addRule(/[A-z0-9]+/i,function(a){return a}),this.lexer.addRule(/(<[A-Z]+>)/,function(a){return a}),this.lexer.addRule(/[\(\+\-\*\/\)]/,function(a){return a})},b.StringMatcher.prototype.parse=function(a){this.lexer.setInput(a);for(var b=[],c=this.lexer.lex();c;)b.push(c),c=this.lexer.lex();return this.parser.parse(b)},b.StringMatcher.prototype.match=function(a,b){var c,d,e=this.parse(b),f=[];return e.forEach(function(b){this.operators.hasOwnProperty(b)?"<NOT>"!==b?(c=f.pop(),f.push(this.operators[b](c))):(d=f.pop(),c=f.pop(),f.push(this.operators[b](c,d))):(b="("+b+")",f.push(!!a.match(new RegExp(b,"i"))))}),f[0]};var j={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},k={"<AND>":function(a,b){return g.intersection(a,b)},"<OR>":function(a,b){return g.union(a,b)},"<XOR>":function(a,b){return g.difference(a,b)},"<NOT>":function(a,b){return g.complement(a,b)}};b.GraphMatcher=function(){this.lexer=new c(function(){return!1}),this.parser=new d(j),this.operators=k,this.lexer.addRule(/[A-z0-9\-]+/i,function(a){return a}),this.lexer.addRule(/(<[A-Z]+>)/,function(a){return a}),this.lexer.addRule(/[\(\)]/,function(a){return a})},b.GraphMatcher.prototype.parse=function(a){this.lexer.setInput(a);for(var b=[],c=this.lexer.lex();c;)b.push(c),c=this.lexer.lex();return this.parser.parse(b)},b.GraphMatcher.prototype.match=function(a,b){var c,d,e=this.parse(b),f=[],g=this;return e.forEach(function(b){g.operators.hasOwnProperty(b)?(d=f.pop(),c=f.pop(),Array.isArray(c)||(c=a.access(c)),Array.isArray(d)||(d=a.access(d)),f.push(g.operators[b](c,d))):f.push(Array.isArray(b)?b:a.access(b))}),f[0]}}(),function(){"use strict";var a=Human.events={},b={},c=0,d=[{}],e={},f={},g=!1;a.addBinder=function(a,c){(b[a]||(b[a]=[])).push(c)},a.createChannel=function(b){var c=d.length;return d.push({}),b&&b.enabled&&a.enableChannel(c,b.enabled),c},a.enableChannel=function(a,b){e[a]=b},a.onEvent=a.on=function(){var a,g,h,i;if("number"==typeof arguments[0]){if(a=arguments[0],a>d.length-1)return void Human.log.error("Human_event.onEvent","Channel not created: "+a+" - should be created first with Human.events.createChannel");g=arguments[1],h=arguments[2],i=arguments[3]}else if("object"==typeof arguments[0]){var j=arguments[0];g=j.type,h=j.fn;var k=b[g];if(k)for(var l=j.mask||{},m=0,n=k.length;n>m;m++)k[m](l,h);a=void 0!==j.channel&&null!==j.channel?j.channel:c,i=j.options}else a=c,g=arguments[0],h=arguments[1],i=arguments[2];e[a]=i&&void 0!==i.enable&&null!==i.enable?i.enable:!0,i=i||{};var o=d[a];o||(o=d[a]={});var p=o[g];p||(p=[],o[g]=p);var q={fn:h,priority:void 0===i.priority?p.length:i.priority,once:i.once};for(m=0;m<p.length;m++)if(p[m].priority>q.priority)return void p.splice(m,0,q);p.push(q),f[g]&&q.fn(f[g])},a.once=function(b,c){a.on(b,c,{once:!0})},a.fireEvent=a.fire=function(a,b,c){if(!g){for(var h,i,j=0,k=d.length;k>j;j++)if(e[j]&&(h=d[j],i=h[a])){b||(b={});for(var l,m,n=0,o=i.length;o>n;n++)if(m=i[n])try{m.fn(b),m.once&&(l||(l=[]),l.push(n))}catch(p){Human.log.error(p)}if(l)for(n=l.length-1;n>=0;n--)i.splice(l[n],1)}c&&(f[a]=b)}},a.blockEvents=function(a){g=!0;try{a()}catch(b){Human.log.error(b.message)}g=!1},a.unEvent=a.off=function(a,b,e){if(void 0===e||null===e)e=c;else if(e>=d.length||0>e)throw"Channel does not exist: "+e;var f=d[e];f||(f=d[e]={});var g=f[a];g||(g=[],f[a]=g);for(var h=g.length;h--;)g[h].fn===b&&g.splice(h,1)}}(),function(){"use strict";var a=Human.properties={},b=new Human.utils.IDPool;a.properties={};var c={},d={},e={};a.subscribe=function(f){f=f||{};var g=f.propId;if(!g)return Human.log.error("Human.properties.subscribe","Param expected: propId"),null;var h=f.callback;if(!h)return Human.log.error("Human.properties.subscribe","Param expected: callback"),null;if(f.subId&&b.containsId(f.subId))return Human.log.error("Human.properties.subscribe","Subscription already exists with this ID: "+f.subId),null;var i,j=f.value,k=b.getId(f.subId),l=a.properties[g];return l?(i=d[g]||(d[g]={}),i[k]=h,j&&(a.properties[g]=j),c[k]=h,e[k]=g,h(j),k):(i=d[g]||(d[g]={}),i[k]=h,(void 0===j||null===j)&&(j={}),a.properties[g]=j,c[k]=h,e[k]=g,h(j),k)},a.resubscribe=function(b,f){var g=c[b];if(!g)return void Human.log.warn("Human.properties.resubscribe","Subscription not found: '"+b+"'");var h=e[b],i=a.properties[f];h&&i&&(d[h]&&delete d[h][b],(d[f]||(d[f]={}))[b]=g,e[b]=f,g(i))},a.set=function(b){var c,e;for(var f in b)if(b.hasOwnProperty(f)&&(c=b[f],a.properties[f]=c,e=d[f]))for(var g in e)e.hasOwnProperty(g)&&e[g](c)},a.unsubscribe=function(a){var b=e[a];b&&(delete e[a],delete d[b][a])},a.query=function(b){if(!b)return a.properties;var c;if(b){var d=new RegExp(b);c={};for(var e in a.properties)a.properties.hasOwnProperty(e)&&d.test(e)&&(c[e]=a.properties[e])}return c};var f={"annotations.margins":{top:80,left:50,right:50,bottom:50},"annotations.labelWidth":120,"annotations.horizontalLines":!1,"annotations.fadeoutAngle":100,"annotation.layout.labelWidth":100,"annotations.layout.type":"draggable","camera.optics.far":5e3,"camera.optics.fov":55,"camera.optics.near":.1,"camera.zoomLimits":{max:300,min:.01},"fog.color":[1,1,1],"fog.density":.01,"fog.enabled":!1,"fog.end":1e3,"fog.max":1,"fog.min":0,"fog.mode":1,"fog.start":0,"timeline.autoPlay.enabled":!1,"timeline.autoPlay.type":"play","timeline.chapterCamerasEnabled":!0,"timeline.prevNextMode":"scrub","ui.mouseWheel.capture":!0,"ui.zoom.mouseWheel.enabled":!0};a.getDefaults=function(a){return a?f[a]:Human.utils.shallowClone(f)},a.setDefaults=function(a){Human.utils.apply(a,f)},a.applyDefaults=function(){this.set(f)}}(),function(){"use strict";function a(a){return a.length<45?a+"                                                           ".substr(0,45-a.length):a}function b(a,b){var e=d[b].toUpperCase();c.messages.length>c.maxMessages&&c.messages.shift(),a="["+e+"]	"+a,c.messages.push(a)}var c=Human.log={};c.LOG_NONE=0,c.LOG_DEBUG=1,c.LOG_INFO=2,c.LOG_WARN=3,c.LOG_ERROR=4,c.messages=[],c.maxMessages=100;var d=["none","debug","info","warn","error"],e=c.messageBuf=[],f=200,g=c.LOG_WARN,h=c.reporters={};c.setLevel=function(a){g=a},c.getLevel=function(){return g},c.log=function(a,i){switch(i=void 0===i||null===i?c.INFO:i){case c.LOG_DEBUG:g<=c.LOG_DEBUG&&window.console&&window.console.debug&&(window.console.debug(a),b(a,i));break;case c.LOG_ERROR:g<=c.LOG_ERROR&&window.console&&window.console.error&&(window.console.error(a),b(a,i));break;case c.LOG_INFO:g<=c.LOG_INFO&&window.console&&window.console.info&&(window.console.info(a),b(a,i));break;case c.LOG_WARN:g<=c.LOG_WARN&&window.console&&window.console.warn&&(window.console.warn(a),b(a,i))}var j={message:a,level:d[i]};for(var k in h)h.hasOwnProperty(k)&&Human.events.fire(k,j);e.length>f&&(e.length=0,e.push({message:"Logging buffer exceeded max length of "+f+" - messages to this point were flushed",level:d[c.LOG_WARN]})),e.push(j)},c.debug=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_DEBUG)},c.error=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_ERROR)},c.info=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_INFO)},c.warn=function(){c.log(1===arguments.length?arguments[0]:"["+a(arguments[0])+"] "+arguments[1],c.LOG_WARN)},Human.events.on("error",function(a){c.error(a.message)})}(),function(){"use strict";var a,b,c,d=Human.request={};d.getHashStr=function(){return window.location.hash},d.getHashParams=function(){if(!b||a!==window.location.hash){b={};for(var c,d=window.location.hash.slice(1),e=d.split(","),f=0,g=e.length;g>f;f++)c=e[f].split("="),b[c[0]]=c[1];a=window.location.hash}return b},d.getHashParam=function(c){return b&&a===window.location.hash||d.getHashParams(),b[c]},d.getSearchStr=function(){return window.location.search},d.getSearchParams=function(){if(!c){c={};for(var a,b=window.location.search.slice(1),d=b.split("&"),e=0,f=d.length;f>e;e++)a=d[e].split("="),c[a[0]]=a[1]}return c},d.getSearchParam=function(a){return c||d.getSearchParams(),c[a]}}(),function(){"use strict";function a(a,b){this.procName=a,this.callId=b}function b(a,b,c){function d(b){if(!c||!e){e=!0;var d=h?h(b):b;null!==d&&a.setResult(d||{})}}var e=!1,f=c?"once":"on",g=b.events,h=b.map;b.init&&b.init();for(var i=0,j=g.length;j>i;i++)Human.events[f](g[i],d)}function c(a){return a&&"object"==typeof a?a===window?!1:"string"==typeof a.nodeName&&"function"==typeof a.querySelectorAll&&"function"==typeof a.getElementsByTagName?!1:"function"==typeof a.preventDefault&&"function"==typeof a.stopPropagation?!1:!0:!0}var d=Human.rpc={windowClientEnabled:!0},e=1e4;d._procedures={},d._eventMap={};var f=[],g=!1,h={},i=[];a.prototype.setResult=function(a){for(var b=0,c=f.length;c>b;b++)f[b](this.callId,a)},a.prototype.info=function(a){Human.log.info(this.procName,a)},a.prototype.warn=function(a){Human.log.warn(this.procName,a)},a.prototype.error=function(a){Human.log.error(this.procName,a)},d.define=function(b,c,e){d._procedures[b]&&Human.log.warn("Human.rpc.define","Redefining procedure: "+b),e=e||{},(e.hidden||g)&&(h[b]=!0),d._procedures[b]=function(d,e){c.call(new a(b,d),e||{})}},d.defineEvent=function(a,b){d._eventMap[a]&&Human.log.warn("Human.rpc.defineEvent","Redefining event: "+a),d._eventMap[a]=b||a},d.enableEvent=function(a,c,e){if(!d._eventMap[c])return void Human.log.warn("Human.rpc.enableEvent","Event: "+c+" not defined.");var f=d._eventMap[c];if("string"==typeof f){var g=e?"once":"on";Human.events[g](f,function(b){a.setResult(b)})}else b(a,f,e)},d.getProcedures=function(){var a=Object.keys(d._procedures);return Human.utils.filterInPlace(a,function(a){
return!h[a]}),a},d.getEvents=function(){return["human.ready"].concat(Object.keys(d._eventMap))},d.hideDefinitions=function(a){g=!0;try{a()}finally{g=!1}},d.onResult=function(a){f.push(a)},d.call=function(a,b,c){var e=d._procedures[b];return e?void e(a,c):void Human.log.warn("Human.rpc.call","Target procedure not found: "+b)},d.log=function(a){i.length>e&&i.shift(),i.push({engine_version:Human.VERSION,api_version:Human.API_VERSION,identifier:a,category:a.split(".")[0]})},d.getLog=function(){return i},d.logPending=function(){return i.length>0},d.resetLog=function(){i.length=0},d.filterUnsafeProperties=function(a){if(!Human.utils.isObject(a))return a;var b={};for(var d in a)a.hasOwnProperty(d)&&c(a[d])&&(b[d]=a[d]);return b}}(),function(){"use strict";Human.rpc.define("human.info",function(){this.setResult({version:Human.VERSION,webglInfo:SceneJS.WEBGL_INFO,apiFunctions:Human.rpc.getProcedures().sort(),apiEvents:Human.rpc.getEvents().sort()})}),Human.rpc.defineEvent("human.error","error")}(),function(){"use strict";function a(a){a=Human.view.annotations.annotations[a.annotationId];var b=a.pin.marker;return{annotationId:a.annotationId,title:a.label.title,description:a.label.description,objectId:a.object?a.object.objectId:null,position:{x:b.pos[0],y:b.pos[1],z:b.pos[2]},canvasPosition:{x:b.canvasPos[0],y:b.canvasPos[1]},occludable:a.occludable,shown:a.pin.shown}}Human.rpc.define("annotations.info",function(){var b,c=Human.view.annotations.annotations,d={};for(var e in c)c.hasOwnProperty(e)&&(b=c[e],d[e]=a(b));this.setResult(d)}),Human.rpc.define("annotations.create",function(b){b.saved=b.saved!==!1,b.position&&(b.pos=b.position);var c=Human.view.annotations.createAnnotation(b);this.setResult(a(c))}),Human.rpc.define("annotations.update",function(a){Human.view.annotations.updateAnnotation(a.annotationId,a),this.setResult(!0)}),Human.rpc.define("annotations.show",function(a){var b=Human.view.annotations.annotations[a];b?b.setShown(!0):Human.view.annotations.setShown(!0),this.setResult(!0)}),Human.rpc.define("annotations.hide",function(a){var b=Human.view.annotations.annotations[a];b?b.setShown(!1):Human.view.annotations.setShown(!1),this.setResult(!0)}),Human.rpc.define("annotations.destroy",function(a){"string"==typeof a&&(a={annotationId:a});var b=Human.view.annotations.annotations[a.annotationId];b&&b.destroy(),this.setResult(!0)}),Human.rpc.defineEvent("annotations.created",{events:["annotations.created"],map:a}),Human.rpc.defineEvent("annotations.destroyed"),Human.rpc.defineEvent("annotations.shown",{events:["annotations.shown"],map:function(a){return a.shown?void 0:null}}),Human.rpc.defineEvent("annotations.hidden",{events:["annotations.shown"],map:function(a){return a.shown?null:void 0}})}(),function(){"use strict";function a(){var a=Human.renderer.camera.getLookAt();return{position:a.eye,target:a.look,up:a.up,zoom:Human.renderer.camera.getZoom()}}Human.rpc.define("camera.set",function(a){var b=this;a.position&&(a.eye=a.position),a.target&&(a.look=a.target),"direct"===a.animationStyle&&(a.cylindricalView=!1),a.animate?Human.renderer.camera.fly.flyTo(a,function(){b.setResult(!0)}):Human.renderer.camera.fly.jumpTo(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.orbit",function(a){a.yaw&&Human.renderer.camera.rotateY(a.yaw),a.pitch&&Human.renderer.camera.rotateX(a.pitch),this.setResult(!0)}),Human.rpc.define("camera.pan",function(a){Human.renderer.camera.pan({x:a.x||0,y:a.y||0,z:a.z||0}),this.setResult(!0)}),Human.rpc.define("camera.zoom",function(a){var b="number"==typeof a?a:a.factor;b=Math.max(0,Math.min(b||0,1)),Human.renderer.camera.setZoom(b),this.setResult(!0)}),Human.rpc.define("camera.path",function(a){var b=this;Human.renderer.camera.fly.flyAlongCurvePath(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.info",function(){this.setResult(a())}),Human.rpc.define("camera.reset",function(){var a=this;Human.init.resetCamera(function(){a.setResult(!0)})}),Human.rpc.defineEvent("camera.updated",{events:["camera.rested"],map:a})}(),Human.rpc.hideDefinitions(function(){"use strict";Human.rpc.define("apiEvents.on",function(a){Human.rpc.enableEvent(this,a,!1)}),Human.rpc.define("apiEvents.once",function(a){Human.rpc.enableEvent(this,a,!0)})}),function(){"use strict";Human.rpc.define("input.disable",function(){Human.input.setEnabled(!1)}),Human.rpc.define("input.enable",function(){Human.input.setEnabled(!0)})}(),function(){"use strict";function a(a){var b,c={},d=Human.rpc.fmaIds,e=Human.modules.MALE_STATE_ID,f=Human.modules.FEMALE_STATE_ID;for(var g in a)if(a.hasOwnProperty(g)){b=d[g];for(var h=0;h<b.length;h++){var i=Human.scene.objects[e+"-"+b[h]]||Human.scene.objects[f+"-"+b[h]];i&&(c[i.objectId]=a[g])}}return c}function b(a){if(!a)return null;var b={};return b.objectId=a.objectId,b.canvasPosition={x:a.canvasPos[0],y:a.canvasPos[1]},a.worldPos&&(b.position={x:a.worldPos[0],y:a.worldPos[1],z:a.worldPos[2]}),b.mode=a.mode,b}Human.rpc.define("scene.load",function(a){function b(a){var b=Human.modules.modules[a],c=[];for(var d in b.showObjects)b.showObjects.hasOwnProperty(d)&&b.showObjects[d]&&Human.scene.objects[d]&&c.push(Human.scene.objects[d]);return c}function c(a){Human.modules.deactivate(a,function(){var b=Human.modules.modules[a].rootObjects;Human.modules.unload(a,b,["tweens","reflections","lights","geometry","material","transform","morph"],function(){Human.modules.destroy(a)})})}var d=this,e=null,f=null;"string"==typeof a?".json"===a.slice(-5)?f=a:e=a:(f=a.moduleId,e=a.bookmarkId);for(var g in Human.modules.activeModules)Human.modules.activeModules.hasOwnProperty(g)&&c(g);if(e)Human.utils.getJSON("/search/bookmarks/data?be="+e,function(a){Human.bookmarks.restore(a.bookmark,function(){d.setResult(!0)})},function(){d.setResult(!1)});else if(f){var h=["material","tweens","reflections","lights","geometry","transform"],i=["morph"],j={camera:!0,cameraCallback:function(){var a=Human.timeline.activeRoot._nowBranch.id;Human.events.fire("chapter.camera.finished",{chapterId:a})},graph:!0,annotations:!1,properties:!0,time:!1,hotspots:!1};Human.modules.fetch(f,function(){var a=Human.modules.moduleData[f];Human.modules.create(f,a,function(){var c=b(f);Human.modules.activate(f,0,j,function(){Human.modules.load(f,c,h,function(){var b=0;a.animation&&(b=Human.timeline.parsePlayInstruction(a.animation).t),j.annotations=!0,j.graph=!1,Human.modules.activate(f,b,j,function(){Human.modules.load(f,c,i,function(){a.animation&&Human.timeline.play(a.animation),Human.events.fire("module.ready",{moduleId:f}),d.setResult(Human.modules.activeModules.hasOwnProperty(f)?!0:!1)})})})})})})}}),Human.rpc.define("scene.pick",function(a){var c;void 0!==a.x&&(a.canvasX=a.x),void 0!==a.y&&(a.canvasY=a.y),a.rayPick=a.rayPick!==!1,c=a.triggerActions?Human.renderer.pick.pick(a):Human.renderer.pick.queryPick(a),this.setResult(b(c))}),Human.rpc.define("scene.pickingMode",function(a){"dissect"===a?(Human.events.blockEvents(function(){Human.view.annotations.setEnabled(!1)}),Human.view.dissect.setEnabled(!0)):"annotate"===a?(Human.events.blockEvents(function(){Human.view.dissect.setEnabled(!1)}),Human.view.annotations.setEnabled(!0)):"highlight"===a?(Human.events.blockEvents(function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1)}),Human.view.highlight.setEnabled(!0)):"none"===a&&Human.events.blockEvents(function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1),Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1)}),this.setResult(!0)}),Human.rpc.define("scene.selectionMode",function(a){"isolate"===a?(Human.events.blockEvents(function(){Human.view.highlight.setEnabled(!1)}),Human.view.isolate.setEnabled(!0)):"highlight"===a?(Human.events.blockEvents(function(){Human.view.isolate.setEnabled(!1)}),Human.view.highlight.setEnabled(!0)):"none"===a&&(Human.events.blockEvents(function(){Human.view.isolate.setEnabled(!1)}),Human.view.highlight.setEnabled(!1)),this.setResult(!0)}),Human.rpc.define("scene.enableXray",function(){Human.view.xray.setEnabled(!0),this.setResult(!0)}),Human.rpc.define("scene.disableXray",function(){Human.view.xray.setEnabled(!1),this.setResult(!0)}),Human.rpc.define("scene.showObjects",function(b){var c=!!b.replace;delete b.replace,b.fmaIds&&(b=a(b.fmaIds)),Human.scene.setEnabledObjects({objects:b,replace:c,fetchAssets:!0}),this.setResult(!0)}),Human.rpc.define("scene.selectObjects",function(b){var c=!!b.replace;delete b.replace,b.fmaIds&&(b=a(b.fmaIds)),Human.scene.setSelectedObjects({objects:b,replace:c}),this.setResult(!0)}),function(){function a(a,c){function d(a){c[a.objectId]||(c[a.objectId]=b(a))}for(var e=0,f=a.length;f>e;e++)a[e].traverseUp(d)}function b(a){var b={objectId:a.objectId,name:a.displayName||"",description:a.description||"",shown:a.shown,selected:a.selected};b.children=[];for(var c=0,d=a.objects.length;d>c;c++)b.children.push(a.objects[c].objectId);return b.parent=a.parent?a.parent.objectId:null,b}Human.rpc.define("scene.info",function(c){var d={},e=Human.modules.activeModules[Object.keys(Human.modules.activeModules)[0]];d.name=e?e.displayName:null;var f,g=d.objects={};if(c.objectId){var h=c.objectId;f=Human.scene.objects[h],f&&(g[f.objectId]=b(f))}else for(var i=0,j=Human.scene.rootObjects.length;j>i;i++)a(Human.scene.rootObjects[i].getRenderableObjects(),g);this.setResult(d)})}(),Human.rpc.define("scene.transformObject",function(a){var b=a.objectId,c=Human.scene.objects[b];c?(c.setTransform(a),this.setResult(!0)):(this.error("Scene object not found: '"+b+"'"),this.setResult(!1))}),Human.rpc.define("scene.colorObject",function(a){var b=a.objectId,c=Human.scene.objects[b];c?(void 0!==a.tintColor&&c.setTintColor(a.tintColor[0],a.tintColor[1],a.tintColor[2]),void 0!==a.saturation&&c.setSaturation(a.saturation),void 0!==a.brightness&&c.setBrightness(a.brightness),void 0!==a.contrast&&c.setContrast(a.contrast),void 0!==a.highlight&&c.setHighlight(a.highlight),void 0!==a.xray&&c.setXRay(a.xray),this.setResult(!0)):(this.error("Scene object not found: '"+b+"'"),this.setResult(!1))}),Human.rpc.define("scene.capture",function(){this.setResult(Human.bookmarks.capture())}),Human.rpc.define("scene.restore",function(a){var b=this;Human.bookmarks.restore(a,function(){b.setResult(!0)})}),Human.rpc.define("scene.reset",function(){var a=this;Human.init.reset(function(){a.setResult(!0)})}),Human.rpc.defineEvent("scene.objectsShown",{events:["scene.objectsShown"],map:function(a){return a.enabledObjectsUpdate}}),Human.rpc.defineEvent("scene.objectsSelected",{events:["scene.objectsSelected"],map:function(a){return a.selectedObjectsUpdate}}),Human.rpc.defineEvent("scene.restored","bookmarks.restored"),Human.rpc.defineEvent("scene.picked",{events:["pick.picked"],init:function(){Human.properties.set({"pick.alwaysRayPick":!0})},map:b});var c;Human.rpc.defineEvent("scene.pickingModeUpdated",{events:["highlight.toggled","dissect.toggled","annotations.toggled"],map:function(){var a;return Human.view.dissect.enabled?a="dissect":Human.view.annotations.enabled?a="annotate":Human.view.highlight.enabled&&(a="highlight"),a===c?null:(c=a,{pickingMode:c})}});var d;Human.rpc.defineEvent("scene.selectionModeUpdated",{events:["highlight.toggled","isolate.toggled"],map:function(){var a;return a=Human.view.isolate.enabled?"isolate":Human.view.highlight.enabled?"highlight":"none",a===d?null:(d=a,{selectionMode:d})}}),Human.rpc.defineEvent("scene.xrayEnabled",{events:["xray.toggled"],map:function(a){return a.enabled?void 0:null}}),Human.rpc.defineEvent("scene.xrayDisabled",{events:["xray.toggled"],map:function(a){return a.enabled?null:void 0}})}(),function(){"use strict";function a(){var a=Human.timeline.getTimeFrame();return{time:Human.timeline.time,startTime:a.firstTime,endTime:a.lastTime,chapters:Object.keys(Human.timeline.chapters),playing:Human.timeline.playing}}function b(a){var b=a.split(".json");return 2!==b.length||b[1].startsWith("_")?a:b[0]+".json_"+b[1]}Human.rpc.define("timeline.info",function(){this.setResult(a())}),Human.rpc.define("timeline.set",function(a){a.hasOwnProperty("chapterId")&&(a.chapterId=b(a.chapterId)),Human.timeline.scrub(a),this.setResult(!0)}),Human.rpc.define("timeline.play",function(a){a.hasOwnProperty("chapterId")&&(a.chapterId=b(a.chapterId)),a.time&&(a.startTime=a.time),a.chapterId&&(a.startChapterId=a.chapterId),Human.timeline.play(a),this.setResult(!0)}),Human.rpc.define("timeline.pause",function(){Human.timeline.pause(),this.setResult(!0)}),Human.rpc.define("timeline.previousChapter",function(){Human.timeline.prev(),this.setResult(!0)}),Human.rpc.define("timeline.nextChapter",function(){Human.timeline.next(),this.setResult(!0)}),Human.rpc.defineEvent("timeline.chapterTransition",{events:["timeline.chapters.activated"],map:function(a){return{previousChapter:a.oldChapterIndex,currentChapter:a.newChapterIndex,time:a.time}}})}(),Human.rpc.hideDefinitions(function(){"use strict";function a(a){var b,c={},d=Human.rpc.fmaIds,e=Human.modules.MALE_STATE_ID,f=Human.modules.FEMALE_STATE_ID;for(var g in a)if(a.hasOwnProperty(g)){b=d[g];for(var h=0;h<b.length;h++){var i=Human.scene.objects[e+"-"+b[h]]||Human.scene.objects[f+"-"+b[h]];i&&(c[i.objectId]=a[g])}}return c}function b(a){var b,c={};for(var d in a)a.hasOwnProperty(d)&&(b=a[d],Human.utils.isPrimitive(b)&&"_"!==d[0]&&(c[d]=b));return c.objectId=a.object?a.object.objectId:"",c.title=a.label.title,c.description=a.label.description,c.pos=a.pin.pos,c.pinVec=a.pin.dir,c.visible=a.pin.visible,c}function c(a){var b=g[a];if(b){var c=b[0],d=b[1];Human.unEvent(c,d),delete g[a]}}function d(a,b){a&&Human.view.annotations.unsavedAnnotation?alert("Please save or cancel annotation first"):b()}Human.rpc.define("bookmarks.capture",function(){this.setResult(Human.bookmarks.capture())}),Human.rpc.define("bookmarks.restore",function(a){var b=this;Human.bookmarks.restore(a,function(){b.setResult(!0)})}),Human.rpc.define("events.off",function(a){if(a.id)c(a.id);else if(a.ids)for(var b=a.ids,d=0,e=b.length;e>d;d++)c(b[d]);else for(var f in g)g.hasOwnProperty(f)&&c(f)}),Human.rpc.define("timeline.query",function(){this.setResult(Human.timeline.query())}),Human.rpc.define("camera.query",function(){var a=Human.renderer.camera.getLookAt();a.zoom=Human.renderer.camera.getZoom(),this.setResult(a)}),Human.rpc.define("properties.query",function(a){this.setResult(Human.properties.query(a.regex))}),Human.rpc.define("actions.doAction",function(a){Human.actions._doAction([a.action,a.arguments])}),Human.rpc.define("alert",function(a){window.alert(a.message||"")}),Human.rpc.define("videos.getClips",function(){this.setResult(Human.media.videos.clipsList)}),Human.rpc.define("videos.open",function(a){var b=this;Human.media.videos.open(a.clipId,function(){b.setResult(!0)})}),Human.rpc.define("videos.play",function(a){Human.media.videos.play(a.clipId)}),Human.rpc.define("videos.scrub",function(a){Human.media.videos.scrub(a.clipId,a.time)}),Human.rpc.define("videos.pause",function(a){Human.media.videos.pause(a.clipId)}),Human.rpc.define("videos.stop",function(a){Human.media.videos.stop(a.clipId)}),Human.rpc.define("videos.close",function(a){Human.media.videos.close(a.clipId)}),Human.rpc.define("audio.getClips",function(){this.setResult(Human.media.audio.clipsList)}),Human.rpc.define("audio.open",function(a){var b=this;Human.media.audio.open(a.clipId,function(){b.setResult(!0)})}),Human.rpc.define("audio.play",function(a){Human.media.audio.play(a.clipId)}),Human.rpc.define("audio.scrub",function(a){Human.media.audio.scrub(a.clipId,a.time)}),Human.rpc.define("audio.pause",function(a){Human.media.audio.pause(a.clipId)}),Human.rpc.define("audio.stop",function(a){Human.media.audio.stop(a.clipId)}),Human.rpc.define("audio.close",function(a){Human.media.videos.close(a.clipId)}),Human.rpc.define("modules.getModules",function(a){this.setResult(Human.modules.query(a))}),Human.rpc.define("modules.activate",function(a){var b=this;Human.modules.activateModules(a,function(){b.setResult(!0)})}),Human.rpc.define("modules.deactivate",function(a){Human.modules.deactivateModules(a)}),Human.rpc.define("properties.subscribe",function(a){var b=this;Human.properties.subscribe({subId:a.subId,propId:"myProperty",callback:function(a){b.setResult(a)}})}),Human.rpc.define("properties.resubscribe",function(a){Human.properties.resubscribe(a.subId,a.propId)}),Human.rpc.define("properties.unsubscribe",function(a){Human.properties.unsubscribe(a.subId)}),Human.rpc.define("renderer.getBGColor",function(){this.setResult(Human.renderer.bg.getBGColor())}),Human.rpc.define("renderer.setBGColor",function(a){Human.renderer.bg.setBGColor(a.color)}),Human.rpc.define("request.getParams",function(){this.setResult({hashParams:Human.request.getHashParams(),hashStr:Human.request.getHashStr(),searchParams:Human.request.getSearchParams(),searchStr:Human.request.getSearchStr()})}),Human.rpc.define("scene.queryBoundary",function(a){var b,c,d;if(a.objectId&&Human.scene.objects[a.objectId])b=Human.scene.objects[a.objectId].getBoundary();else if(a.fmaId){if(d=a.fmaId,c=Human.scene.objectsByFMAID[d],!c)return void this.error("No scene object found for the given FMA ID: '"+d+"'");b=c.getBoundary()}else if(a.objectIds)b=Human.scene.getBoundary({objectIds:a.objectIds});else if(a.fmaIds){for(var e=a.fmaIds,f=[],g=0,h=e.length;h>g;g++){if(d=e[g],c=Human.scene.objectsByFMAID[d],!c)return void this.error("No scene object found for the given FMA ID: '"+d+"'");f.push(c.objectId)}b=Human.scene.getBoundary({objectIds:f})}else b=a.selectedObjects?Human.scene.getBoundary({objects:Human.scene.selectedObjects}):a.enabledObjects?Human.scene.getBoundary({objects:Human.scene.enabledObjects}):Human.scene.getBoundary();this.setResult(b)}),function(){var a=document.getElementById("theCanvas"),b=function(b,c){c&&vec3.add(b,c,b);var d=Human.renderer.getViewMat(),e=Human.renderer.getProjMat(),f=vec4.create();vec3.transformMat4(f,b,d),f[3]=1,vec4.transformMat4(f,f,e);var g=f[0],h=f[1],i=f[3];return[Math.round((1+g/i)*a.width/2),Math.round((1-h/i)*a.height/2)]};Human.rpc.define("scene.getCanvasPos",function(a){this.setResult(b(a.worldPos,a.offset))}),Human.rpc.define("scene.getObjectCanvasPos",function(a){var c=Human.scene.objects[a.objectId];if(c){var d=c.getCenter();this.setResult(b(d,a.offset))}})}(),Human.rpc.define("annotations.setTitle",function(a){var b=Human.view.annotations.annotations[a.annotationId];b&&b.label.setTitle(a.title),this.setResult(!0)}),Human.rpc.define("annotations.setDescription",function(a){var b=Human.view.annotations.annotations[a.annotationId];b&&b.label.setDescription(a.description),this.setResult(!0)}),Human.rpc.define("annotations.setLabelsShown",function(a){Human.view.annotations.setLabelsShown(a),this.setResult(!0)}),Human.rpc.define("timeline.getBookmark",function(){this.setResult(Human.timeline.getBookmark())}),Human.rpc.define("timeline.setBookmark",function(a){Human.timeline.setBookmark(a)}),Human.rpc.define("clip.set",function(a){if(a.clips){var b,c=a.clips;for(var d in c)c.hasOwnProperty(d)&&(b=c[d],b.clipId=d,Human.renderer.clip.setClip(b))}else a.clip&&Human.renderer.clip.setClip(a.clip)}),Human.rpc.define("clip.reset",function(){Human.renderer.clip.reset()}),Human.rpc.define("effects.getEffects",function(){var a,b=[],c=Human.view.effects.effects;for(var d in c)c.hasOwnProperty(d)&&(a=c[d],b.push({effectId:d,displayName:a.displayName,description:a.description,enabled:a.enabled,params:a.params}));this.setResult(b)}),Human.rpc.define("effects.setEnabled",function(a){Human.view.effects.setEnabled(a)}),Human.rpc.define("effects.setParams",function(a){Human.view.effects.setParams(a)}),Human.rpc.define("focus.focusObject",function(a){var b=this,c=function(){b.setResult(!0)},d=a.fmaId,e=a.objectId,f=a.objectIds;if(!e&&!d&&!f)return Human.log.error("Human.view.focusObject","Parameter expected: either 'objectId', 'objectIds' or 'fmaId'"),void c();var g,h=Human.scene;if(e){if(g=h.objects[e],!g)return Human.log.error("Human.view.focusObject","Scene object not found: '"+e+"'"),void c()}else if(d){if(g=h.objectsByFMAID[d],!g)return Human.log.error("Human.view.focusObject","Scene object not found for this FMAID: '"+d+"'"),void c();e=g.objectId}a.xray===!0?Human.rpc.call(null,"xray.setEnabled",{enable:!0}):a.xray===!1&&Human.rpc.call(null,"xray.setEnabled",{enable:!1});var i=a.select;i=void 0===i||null===i?a.replace||!h.selectedObjects[e]:a.select;var j,k=a.flyTo;if(a.replace)h.setSelectedObjects({objectId:e,select:i,replace:a.replace});else if(i){var l={};l[e]=i,h.setSelectedObjects({objects:l,replace:a.replace})}a.showLabel===!1&&i||Human.view.labels._clearLabels(),a.showLabel!==!1&&(Human.view.labels.createLabel({objectId:a.objectId,afterDelay:!0}),Human.renderer.forceRenderFrame()),i&&"newSelected"===k?(j=g.getBoundary(),j&&Human.renderer.camera.fly.flyTo({boundary:j,backOff:a.backOff,arc:0},function(){c()})):k&&"allSelected"!==k?"selectedLeafObjects"===k?Human.renderer.camera.fly.flyTo({selectedLeafObjects:!0,backOff:a.backOff,arc:0},function(){c()}):"object"===k?(j=g.getBoundary(),Human.renderer.camera.fly.flyTo({boundary:j,backOff:a.backOff,arc:0},function(){c()})):c():(j=h.getBoundary({objects:h.selectedObjects}),j?Human.renderer.camera.fly.flyTo({boundary:j,backOff:a.backOff,arc:0},function(){c()}):c())}),Human.rpc.define("labels.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.labels.getEnabled()),Human.view.labels.setEnabled(b)}),Human.rpc.define("labels.create",function(a){return a.objectId?(a.replace&&Human.view.labels.clearLabels(),void Human.view.labels.createLabel(a)):void this.error("parameter expected: 'objectId'")}),Human.rpc.define("labels.clear",function(){Human.view.labels.clearLabels()}),Human.rpc.define("lights.getLights",function(){var a,b=[],c=Human.renderer.lights.lights;for(var d in c)c.hasOwnProperty(d)&&(a=c[d],b.push({lightId:d,displayName:a.displayName,description:a.description,enabled:a.enabled,params:a.params}));this.setResult(b)}),Human.rpc.define("lights.setEnabled",function(a){Human.renderer.lights.setEnabled(a)}),Human.rpc.define("lights.setParams",function(a){Human.renderer.lights.setParams(a)}),Human.rpc.define("dissect.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.dissect.enabled),d(b,function(){Human.view.dissect.setEnabled(b),b?(Human.renderer.pick.setMultiPickEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!1),Human.view.annotations.setEnabled(!1)):(Human.renderer.pick.setSinglePickEnabled(!0),Human.view.xray.setEnabled(Human.view.xray.enabled),Human.view.highlight.setEnabled(Human.view.highlight.enabled))})}),Human.rpc.define("highlight.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.highlight.enabled),Human.view.highlight.setEnabled(b),b&&(Human.view.isolate.setEnabled(!1),Human.view.xray.setEnabled(!1))}),Human.rpc.define("isolate.setEnabled",function(a){var b=a.enable;if((void 0===b||null===b)&&(b=!Human.view.isolate.enabled),Human.view.isolate.setEnabled(b),b){var c=Human.scene.anySelected();if(!c)return}b&&(Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1))}),Human.rpc.define("pick.single.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.renderer.pick.getSinglePickEnabled()),d(b,function(){Human.renderer.pick.setSinglePickEnabled(b),b&&(Human.renderer.pick.setMultiPickEnabled(!1),Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1))})}),Human.rpc.define("pick.multi.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.renderer.pick.getMultiPickEnabled()),d(b,function(){Human.renderer.pick.setMultiPickEnabled(b),b?(Human.renderer.pick.setSinglePickEnabled(!1),Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1)):Human.renderer.pick.setSinglePickEnabled(!0)})}),Human.rpc.define("pick.doublePick",function(a){Human.renderer.pick.doublePick({canvasX:a.canvasX,canvasY:a.canvasY})}),Human.rpc.define("pick.hoverPick",function(a){Human.renderer.pick.hoverPick({canvasX:a.canvasX,canvasY:a.canvasY})}),Human.rpc.define("annotations.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.annotations.enabled),d(!b,function(){Human.view.annotations.setEnabled(b),b?(Human.renderer.pick.setSinglePickEnabled(!1),Human.renderer.pick.setMultiPickEnabled(!1),Human.view.dissect.setEnabled(!1)):(Human.renderer.pick.setSinglePickEnabled(!0),Human.view.xray.setEnabled(Human.view.xray.enabled),Human.view.highlight.setEnabled(Human.view.highlight.enabled))})}),Human.rpc.define("xray.setEnabled",function(a){var b=a.enable;(void 0===b||null===b)&&(b=!Human.view.xray.enabled),Human.view.xray.setEnabled(b),b&&(Human.view.highlight.setEnabled(!1),Human.view.isolate.setEnabled(!1))}),Human.rpc.define("queryModes",function(){var a={xray:Human.view.xray.enabled,highlight:Human.view.highlight.enabled,annotation:Human.view.annotations.enabled,singlePick:Human.renderer.pick.singleEnabled,multipick:Human.renderer.pick.multiEnabled,dissect:Human.view.dissect.enabled};this.setResult(a)}),Human.rpc.define("navigation.setEnabled",function(a){h("navigator_container",a.enable)}),Human.rpc.define("fullscreen.setEnabled",function(a){h("embed-full-screen",a.enable)});var e=Human.log.reporters,f=Human.log.messageBuf;Human.rpc.define("log.createReporter",function(a){if(!a.id)return void Human.log.error("param expected: id");var b="log.reporters."+a.id;if(!e[b]){e[b]={};for(var c=0,d=f.length;d>c;c++)Human.events.fire(b,f[c])}}),Human.rpc.define("log.destroyReporter",function(a){if(!a.id)return void Human.log.error("param expected: id");var b="log.reporters."+a.id;delete e[b]}),Human.rpc.define("annotations.getAnnotations",function(){var a,c=Human.view.annotations.annotations,d={};for(var e in c)c.hasOwnProperty(e)&&(a=c[e],d[e]=b(a));this.setResult(d)}),Human.rpc.define("annotations.setShown",function(a){Human.view.annotations.setShown(a.shown),this.setResult(!0)}),Human.rpc.define("camera.flyTo",function(a){var b=this;Human.renderer.camera.fly.flyTo(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.jumpTo",function(a){var b=this;Human.renderer.camera.fly.jumpTo(a,function(){b.setResult(!0)})}),Human.rpc.define("camera.getZoom",function(){this.setResult(Human.renderer.camera.getZoom())});var g={};Human.rpc.define("events.on",function(a){var b=this,c=this.id;if(c&&g[c])return void this.error("an event is already bound to this ID: '"+c+"'");var d=a.type;if(!d)return void this.error("parameter expected: 'type'");var e=function(a){b.setResult(a)};a.mask?(a.fn=e,Human.events.on(a)):Human.events.on(a.type,e),c&&(g[c]=[d,e])}),Human.rpc.define("events.once",function(a){var b=this,c=a.type;return c?void Human.events.once(c,function(a){b.setResult(a)}):void this.error("parameter expected: 'type'")}),Human.rpc.define("events.fire",function(a){Human.events.fire(a.eventName,a.params)}),Human.rpc.define("reset",function(){var a=this;Human.init.reset(function(){a.setResult(!0)})}),Human.rpc.define("reload",function(){Human.init.reload()}),Human.rpc.define("pick.pick",function(a){Human.renderer.pick.pick({canvasX:a.canvasX,canvasY:a.canvasY})}),Human.rpc.define("pick.queryPick",function(a){this.setResult(Human.renderer.pick.queryPick({canvasX:a.canvasX,canvasY:a.canvasY,rayPick:a.rayPick})||{})}),Human.rpc.define("scene.setEnabledObjects",function(b){var c;if(b.fmaIds)c=a(b.fmaIds);else if(Human.utils.isArray(b.objectIds)){c={};for(var d=0,e=b.objectIds.length;e>d;d++)c[b.objectIds[d]]=!0}else c=b.objectIds;Human.scene.setEnabledObjects({objects:c,replace:b.replace})}),Human.rpc.define("scene.setSelectedObjects",function(b){var c;if(b.fmaIds)c=a(b.fmaIds);else if(Human.utils.isArray(b.objectIds)){c={};for(var d=0,e=b.objectIds.length;e>d;d++)c[b.objectIds[d]]=!0}else c=b.objectIds;b.objectIds=c,Human.scene.setSelectedObjects(b)}),function(){function a(c,d){if(c){d.push(b(c));for(var e=0,f=c.objects.length;f>e;e++)a(c.objects[e],d)}}function b(a){var b={};for(var c in a)if(a.hasOwnProperty(c)&&"_"!==c[0]){var d=a[c];Human.utils.isPrimitive(d)&&(b[c]=d)}return b.parentObjectId=a.parent?a.parent.objectId:null,b}Human.rpc.define("scene.getObjects",function(c){var d,e=[];if(c.objectId){var f=c.objectId;d=Human.scene.objects[f],d&&e.push(b(d))}else for(var g=0,h=Human.scene.rootObjects.length;h>g;g++)a(Human.scene.rootObjects[g],e);this.setResult(e)})}(),Human.rpc.define("scene.setObjectTransform",function(a){var b,c=a.objectId,d=a.fmaId;if(c){if(b=Human.scene.objects[c],!b)return void this.error("Scene object not found: '"+c+"'")}else if(d&&(b=Human.scene.objectsByFMAID[d],!b))return void this.error("scene object not found for the given FMA ID: '"+d+"'");b.setTransform(a)}),Human.rpc.define("timeline.scrub",function(a){Human.timeline.scrub(a)}),Human.rpc.define("timeline.stop",function(){Human.timeline.stop()}),Human.rpc.define("timeline.prev",function(){Human.timeline.prev()}),Human.rpc.define("timeline.next",function(){Human.timeline.next()}),Human.rpc.define("timeline.unpause",function(){Human.timeline.unpause()}),Human.rpc.define("properties.set",function(a){var b=a.props||a;Human.properties.set(b||{})});var h=function(a,b){var c="undefined"==typeof b?!0:b,d=document.getElementById(a);d.style.display=c?"block":"none"}}),Human.rpc.fmaIds={3734:["Base_of_aorta_3734_ID"],3768:["Aortic_arch_3768_ID"],3784:["Descending_Aorta_3784_ID"],3818:["Marginal_branch_of_right_coronary_artery_3818_ID"],3829:["Anterior_atrial_branch_of_right_coronary_artery_3829_ID"],3837:["Posterior_left_ventricular_branch_of_left_coronary_artery_3837_ID"],3932:["left_lower_subclavian_artery_3932_ID","Right_Brachiocephalic_trunk_3932_ID"],3941:["Right_common_carotid_artery_3941_ID"],3945:["Right_external_carotid_artery_3945_ID"],3949:["Right_Internal_Carotid_Artery_3949_ID"],3950:["Right_Internal_Carotid_Artery_3950_ID"],3958:["Right_Vertebral_Artery_3958_ID"],3969:["Right_internal_thoracic_artery_3969_ID"],3988:["Superior_right_epigastric_artery_3988_ID","Right_Superior_epigastric_artery_3988_ID"],4058:["Left_common_carotid_artery_4058_ID","Base_of_left_common_carotid_artery_4058_ID","Base_of_Left_common_carotid_artery_4058_ID"],4060:["Left_external_carotid_artery_4060_ID"],4062:["Left_Internal_Carotid_Artery_4062_ID"],4066:["Left_Vertebral_Artery_4066_ID"],4068:["Left_internal_thoracic_artery_4068_ID"],4083:["Left_Superior_epigastric_artery_4083_ID"],4085:["Right_costocervical_trunk_4085_ID"],4086:["Right_costocervical_trunk_4086_ID","Left_costocervical_trunk_4086_ID"],4134:["Left_deep_cervical_artery_4134_ID","left_deep_cervical_artery_4134_ID"],4634:["Right_Subcostal_artery_4634_ID","Right_subcostal_artery_4634_ID"],4654:["Left_Subcostal_artery_4654_ID","Left_subcostal_artery_4654_ID"],4693:["Right_subclavian_artery_4693_ID"],4694:["left_subclavian_artery_4694_ID","Left_Lower_Subclavian_artery_4694_ID","right_subclavian_artery_4694_ID"],4706:["Coronary_sinus_4706_ID"],4707:["Great_cardiac_vein_4707_ID"],4712:["Posterior_vein_of_left_ventricle_4712_ID"],4713:["Middle_cardiac_vein_4713_ID"],4714:["Small_cardiac_vein_4714_ID"],4715:["Oblique_vein_of_left_atrium_4715_ID"],4720:["Superior_Vena_Cava_4720_ID"],4728:["Inferior_Thyroid_vein_4728_ID"],4751:["Right_Brachiocephalic_vein_4751_ID","Right_brachiocephalic_vein_4751_ID"],4755:["Right_internal_jugular_vein_4755_ID"],4756:["Right_Vertebral_vein_4756_ID"],4758:["Right_internal_thoracic_vein_4758_ID"],4761:["Left_Brachiocephalic_vein_4761_ID","Left_brachiocephalic_vein_4761_ID"],4763:["Left_internal_jugular_vein_4763_ID"],4764:["Left_Vertebral_vein_4764_ID"],4766:["Left_internal_thoracic_vein_4766_ID"],4771:["Right_Superior_epigastric_vein_4771_ID","Right_superior_epigastric_vein_4771_ID"],4785:["Left_superior_epigastric_vein_4785_ID"],4838:["Azygos_Vein_4838_ID","Azygos_vein_4838_ID"],4843:["Right_ascending_lumbar_vein_4843_ID"],4944:["Hemiazgos_vein_4944_ID","Hemiazygos_vein_4944_ID"],4950:["Left_ascending_lumbar_vein_4950_ID"],5011:["Left_Accessory_Hemiazgos_vein_5011_ID","Left_Accessory_Hemiazygos_vein_5011_ID"],
5883:["Right_Splanchnic_Nerve_5883_ID","Left_Splanchnic_Nerve_5883_ID"],6192:["Right_Phrenic_Nerve_6192_ID"],6193:["Left_Phrenic_Nerve_6193_ID"],6246:["Left_Recurrent_Laryngeal_Nerve_6246_ID","Right_Recurrent_Laryngeal_Nerve_6246_ID"],6258:["Left_Sympathetic_Chain_6258_ID","Right_Sympathetic_Chain_6258_ID"],6259:["Right_Sympathetic_Chain_6259_ID"],6442:["Left_C1_Spinal_Nerve_6442_ID","Right_C1_Spinal_Nerve_6442_ID"],6451:["Left_C2_Spinal_Nerve_6451_ID","Right_C2_Spinal_Nerve_6451_ID"],6453:["Left_C3_Spinal_Nerve_6453_ID","Right_C3_Spinal_Nerve_6453_ID"],6456:["Left_C4_Spinal_Nerve_6456_ID","Right_C4_Spinal_Nerve_6456_ID"],6457:["Right_C5_Spinal_Nerve_6457_ID","Left_C5_Spinal_Nerve_6457_ID"],6459:["Left_C6_Spinal_Nerve_6459_ID","Right_C6_Spinal_Nerve_6459_ID"],6461:["Right_C7_Spinal_Nerve_Group_6461_ID","Left_C7_Spinal_Nerve_6461_ID","Right_C7_Spinal_Nerve_6461_ID","Left_C7_Spinal_Nerve_Group_6461_ID"],6465:["Left_C8_Spinal_Nerve_6465_ID","Right_C8_Spinal_Nerve_6465_ID"],6582:["Ansa_Subclavia_6582_ID"],6642:["Superior_hypogastric_nerve_plexus_6642_ID"],6643:["Inferior_hypogastric_nerve_plexus_6643_ID"],6647:["Prostatic_nerve_plexus_6647_ID"],7088:["Heart_7088_ID"],7096:["Right_atrium_7096_ID"],7097:["Left_atrium_7097_ID"],7098:["Right_Ventricle_7098_ID"],7101:["Left_Ventricle_7101_ID"],7131:["Esophagus_7131_ID"],7133:["Interventricular_Septum_7133_ID"],7148:["Stomach_7148_ID"],7196:["Spleen_7196_ID"],7197:["Liver_7197_ID"],7198:["Pancreas_7198_ID"],7200:["Small_intestine_7200_ID"],7202:["Gallbladder_7202_ID"],7204:["Left_Kidney_7204_ID","Right_Kidney_7204_ID"],7205:["Right_Kidney_7205_ID","Left_Kidney_7205_ID"],7206:["Duodenum_7206_ID"],7207:["Jejunum_7207_ID"],7208:["Ileum_7208_ID"],7209:["Ovaries_7209_ID"],7211:["Right_testis_7211_ID"],7212:["Left_testis_7212_ID"],7213:["Right_Ovary_7213_ID"],7214:["Left_Ovary_7214_ID"],7218:["Right_auricle_7218_ID"],7219:["Left_auricle_7219_ID"],7234:["Tricuspid_Valve_7234_ID"],7235:["Mitral_valve_7235_ID"],7236:["Aortic_Valve_7236_ID"],7246:["Pulmonary_Valve_7246_ID"],7309:["Right_Lung_7309_ID"],7310:["Left_Lung_7310_ID"],7333:["Right_Superior_Lobe_7333_ID"],7337:["Right_Inferior_Lobe_7337_ID"],7370:["Left_Superior_Lobe_7370_ID"],7371:["Left_Inferior_Lobe_7371_ID"],7383:["Right_Middle_Lobe_7383_ID"],7394:["Trachea_7394_ID"],7486:["manubrium_of_sternum_7486_ID","body_of_sternum_7486_ID"],7591:["Right_Costal_Cartilage_7591_ID","Left_Costal_Cartilage_7591_ID"],7592:["Left_Costal_Cartilage_7592_ID","Right_Costal_Cartilage_7592_ID"],7647:["spinal_cord_7647_ID"],7857:["Left_first_rib_7857_ID","Right_first_rib_7857_ID"],7882:["Right_second_rib_7882_ID"],7883:["Left_second_rib_7883_ID"],7909:["Right_third_rib_7909_ID"],7910:["Left_third_rib_7910_ID"],7957:["Right_fourth_rib_7957_ID"],7958:["Left_fourth_rib_7958_ID"],8066:["Right_fifth_rib_8066_ID","Left_fifth_rib_8066_ID"],8175:["Left_sixth_rib_8175_ID","Right_sixth_rib_8175_ID"],8229:["Left_seventh_rib_8229_ID","Right_seventh_rib_8229_ID"],8283:["Left_eighth_rib_8283_ID","Right_eighth_rib_8283_ID"],8364:["Left_ninth_rib_8364_ID","Right_ninth_rib_8364_ID"],8445:["Right_tenth_rib_8445_ID","Left_tenth_rib_8445_ID"],8531:["Left_eleventh_rib_8531_ID","Right_eleventh_rib_8531_ID"],8533:["Right_twelfth_rib_8533_ID","Left_twelfth_rib_8533_ID"],8612:["Pulmonary_trunk_8612_ID"],9165:["First_thoracic_vertebra_9165_ID"],9187:["Second_thoracic_vertebra_9187_ID"],9209:["Third_thoracic_vertebra_9209_ID"],9248:["Fourth_thoracic_vertebra_9248_ID"],9600:["Prostate_9600_ID"],9603:["Thyroid_Gland_9603_ID"],9615:["Cricoid_cartilage_9615_ID"],9706:["Bile_Ducts_9706_ID"],9707:["Penis_9707_ID"],9710:["Vomer_9710_ID"],9711:["Maxilla_9711_ID"],9761:["Right_Transversus_thoracis_9761_ID"],9762:["Right_Transversus_thoracis_9762_ID","Left_Transversus_thoracis_9762_ID"],9922:["Fifth_thoracic_vertebra_9922_ID"],9945:["Sixth_thoracic_vertebra_9945_ID"],9968:["Seventh_thoracic_vertebra_9968_ID"],9991:["Eighth_thoracic_vertebra_9991_ID"],10014:["Ninth_thoracic_vertebra_10014_ID"],10037:["Tenth_thoracic_vertebra_10037_ID"],10059:["Eleventh_thoracic_vertebra_10059_ID"],10081:["Twelfth_thoracic_vertebra_10081_ID"],10551:["Right_dorsal_scapular_artery_10551_ID"],10552:["right_dorsal_scapular_artery_10552_ID","left_dorsal_scapular_artery_10552_ID"],10660:["Right_deep_cervical_artery_10660_ID"],10679:["Right_inferior_thyroid_artery_10679_ID"],10680:["left_inferior_thyroid_artery_10680_ID","Right_suprascapular_artery_10680_ID"],10681:["left_suprascapular_artery_10681_ID","Right_transverse_cervical_artery_10681_ID","right_suprascapular_artery_10681_ID"],10682:["left_transverse_cervical_artery_10682_ID","Right_superficial_cervical_artery_10682_ID"],10683:["left_superficial_cervical_artery_10683_ID"],10951:["Inferior_vena_cava_10951_ID","base_of_inferior_vena_cava_10951_ID"],12519:["Atlas_C1_12519_ID"],12520:["Axis_C2_12520_ID"],12521:["Third_cervical_vertebra_12521_ID"],12522:["Fourth_cervical_vertebra_12522_ID"],12523:["Fifth_cervical_vertebra_12523_ID"],12524:["Sixth_cervical_vertebra_12524_ID"],12525:["Seventh_cervical_vertebra_12525_ID"],12770:["Deep_lateral_cervical_lymph_nodes_12770_ID"],12858:["Union_between_ascending_lumbar_veins_12858_ID"],13072:["First_lumbar_vertebra_13072_ID"],13073:["Second_lumbar_vertebra_13073_ID"],13074:["Third_lumbar_vertebra_13074_ID"],13075:["Fourth_lumbar_vertebra_13075_ID"],13076:["Fifth_lumbar_vertebra_13076_ID"],13111:["Right_external_jugular_vein_13111_ID"],13112:["Left_external_jugular_vein_13112_ID","Right_external_jugular_vein_13112_ID"],13113:["Left_external_jugular_vein_13113_ID"],13295:["Diaphragm_13295_ID"],13322:["Right_Clavicle_13322_ID"],13323:["Left_Clavicle_13323_ID"],13325:["Right_cephalic_vein_13325_ID"],13326:["right_cephalic_vein_13326_ID","left_cephalic_vein_13326_ID"],13328:["Left_Clavicle_13328_ID"],13336:["Right_external_oblique_13336_ID"],13337:["Left_external_oblique_13337_ID"],13346:["Right_Sternohyoid_13346_ID"],13347:["Left_Sternohyoid_13347_ID"],13350:["Right_Sternothyroid_13350_ID"],13351:["Left_Sternothyroid_13351_ID"],13352:["Right_Thyrohyoid_13352_ID"],13353:["Left_Thyrohyoid_13353_ID"],13354:["Intercostal_Muscles_of_Left_Thorax_13354_ID","Intercostal_Muscles_of_Right_Thorax_13354_ID"],13358:["Right_latissimus_dorsi_13358_ID"],13359:["Left_latissimus_dorsi_13359_ID"],13373:["Right_pectoralis_major_13373_ID"],13374:["Left_pectoralis_major_13374_ID","Right_pectoralis_major_13374_ID"],13375:["Right_Pectoralis_minor_13375_ID"],13376:["Left_Pectoralis_minor_13376_ID","Right_Pectoralis_minor_13376_ID"],13377:["Right_Rectus_Abdominis_13377_ID"],13378:["Left_Rectus_Abdominis_13378_ID"],13379:["Right_Rectus_Abdominis_13379_ID"],13381:["Right_Rhomboid_Major_13381_ID"],13382:["Left_Rhomboid_Major_13382_ID"],13383:["Right_Rhomboid_Minor_13383_ID"],13384:["Left_Rhomboid_Minor_13384_ID"],13395:["Right_Scapula_13395_ID"],13396:["Left_Scapula_13396_ID","Right_Scapula_13396_ID"],13398:["Right_serratus_anterior_13398_ID"],13399:["Left_serratus_anterior_13399_ID"],13403:["Right_Serratus_Posterior_Superior_13403_ID"],13404:["Left_Serratus_Posterior_Superior_13404_ID"],13405:["Right_Serratus_Posterior_Inferior_13405_ID"],13406:["Left_Serratus_Posterior_Inferior_13406_ID"],13408:["Right_Sternocleidomastoid_13408_ID"],13409:["Left_Sternocleidomastoid_13409_ID"],13410:["Right_Subclavius_13410_ID"],13411:["Left_Subclavius_13411_ID","Right_Subclavius_13411_ID"],13414:["Right_subscapularis_13414_ID"],13415:["Left_subscapularis_13415_ID","Right_subscapularis_13415_ID"],13417:["Right_Thoracoepigastric_vein_13417_ID"],13418:["Left_Thoracoepigastric_vein_13418_ID"],13419:["Right_Trapezius_13419_ID"],13420:["Left_Trapezius_13420_ID"],13421:["Ligamentum_arteriosum_13421_ID"],13478:["Vertebral_Column_13478_ID"],13889:["Pituitary_Gland_13889_ID"],13890:["Parathyroid_Glands_13890_ID"],13892:["Right_Internal_oblique_13892_ID"],13893:["Left_Internal_oblique_13893_ID"],13912:["Anterior_interventricular_artery_13912_ID"],14331:["splenic_vein_14331_ID"],14332:["superior_mesenteric_vein_14332_ID"],14335:["Right_renal_vein_14335_ID"],14336:["Left_renal_vein_14336_ID"],14338:["Right_Hepatic_Vein_14338_ID"],14339:["Left_Hepatic_Vein_14339_ID"],14341:["Right_testicular_vein_14341_ID"],14345:["Left_testicular_vein_14345_ID"],14384:["Right_median_nerve_14384_ID"],14385:["Left_median_nerve_14385_ID"],14468:["Right_Recurrent_Laryngeal_Nerve_14468_ID"],14469:["Left_Recurrent_Laryngeal_Nerve_14469_ID"],14542:["Appendix_14542_ID"],14543:["Colon_14543_ID"],14544:["Rectum_14544_ID"],14545:["Ascending_colon_14545_ID"],14546:["Transverse_colon_14546_ID"],14547:["Descending_Colon_14547_ID"],14548:["Sigmoid_Colon_14548_ID"],14735:["Right_Lumbar_artery_14735_ID","Left_Lumbar_Artery_14735_ID","Right_Lumbar_Artery_14735_ID"],14746:["Right_Inferior_Phrenic_Artery_14746_ID"],14747:["Left_Inferior_Phrenic_Artery_14747_ID"],14749:["superior_mesenteric_artery_14749_ID"],14750:["Inferior_Mesenteric_artery_14750_ID"],14752:["Right_renal_artery_14752_ID"],14753:["Left_Renal_artery_14753_ID"],14759:["Right_testicular_artery_14759_ID"],14760:["Left_testicular_artery_14760_ID"],14768:["Left_Gastric_Artery_14768_ID"],14771:["Common_hepatic_artery_14771_ID"],14772:["Hepatic_artery_proper_14772_ID"],14773:["Splenic_artery_14773_ID"],14775:["Gastroduodenal_artery_14775_ID"],14776:["Right_Gastric_artery_14776_ID"],14778:["Right_hepatic_artery_14778_ID"],14779:["Left_hepatic_artery_14779_ID"],14781:["Right_Gastroepiploic_artery_14781_ID"],14787:["Dorsal_pancreatic_artery_14787_ID"],14790:["Inferior_pancreatic_artery_14790_ID"],14791:["Prepancreatic_Artery_14791_ID"],14792:["Great_pancreatic_artery_14792_ID"],14793:["Caudal_pancreatic_artery_14793_ID"],14796:["Left_Gastroepiploic_artery_14796_ID"],14810:["middle_colic_artery_14810_ID"],14811:["Right_colic_artery_14811_ID"],14812:["Celiac_Trunk_14812_ID"],14815:["Ileocolic_artery_14815_ID"],14819:["ileal_branch_of_ileocolic_artery_14819_ID"],14820:["Ileal_branch_of_ileocolic_vein_14820_ID","Colic_branch_of_ileocolic_vein_14820_ID"],14822:["Superior_branch_of_ileocolic_artery_14822_ID"],14826:["Left_colic_artery_14826_ID"],14830:["Sigmoid_artery_14830_ID"],14831:["Marginal_artery_of_colon_14831_ID"],14832:["Superior_Rectal_artery_14832_ID"],14835:["Cystic_artery_14835_ID"],15388:["Pancreatic_tributary_of_splenic_vein_15388_ID"],15390:["left_gastroepiploic_vein_15390_ID"],15391:["Inferior_Mesenteric_vein_15391_ID"],15394:["Left_colic_vein_15394_ID"],15395:["Sigmoid_vein_15395_ID"],15397:["Right_gastroepiploic_vein_15397_ID"],15398:["Anterior_Superior_pancreaticoduodenal_vein_15398_ID","Anterior_Inferior_pancreaticoduodenal_vein_15398_ID","Pancreaticoduodenal_vein_15398_ID","Posterior_Superior_pancreaticoduodenal_vein_15398_ID","Posterior_Inferior_pancreaticoduodenal_vein_15398_ID"],15399:["Left_Gastric_vein_15399_ID"],15400:["Right_Gastric_vein_15400_ID"],15407:["right_colic_vein_15407_ID"],15408:["Ileocolic_vein_15408_ID"],15414:["Right_Hepatic_Portal_Vein_15414_ID"],15415:["Left_Hepatic_Portal_Vein_15415_ID"],15571:["Right_Ureter_15571_ID"],15572:["Left_Ureter_15572_ID"],15629:["Right_Adrenal_Gland_15629_ID"],15630:["Left_Adrenal_Gland_15630_ID"],15710:["Internal_anal_sphincter_15710_ID"],15900:["Bladder_15900_ID"],16202:["Sacrum_16202_ID"],16491:["Right_iliohypogastric_nerve_16491_ID"],16492:["Left_iliohypogastric_nerve_16492_ID"],16493:["Right_ilioinguinal_nerve_16493_ID"],16494:["Left_ilioinguinal_nerve_16494_ID"],16497:["Right_lateral_femoral_cutaneous_nerve_16497_ID"],16498:["Left_lateral_femoral_cutaneous_nerve_16498_ID"],16499:["Right_femoral_nerve_16499_ID"],16500:["Left_femoral_nerve_16500_ID"],16501:["Right_obturator_nerve_16501_ID"],16502:["Left_obturator_nerve_16502_ID"],17559:["Uterus_17559_ID"],17740:["Cervix_of_uterus_17740_ID"],18245:["Right_Fallopian_Tube_18245_ID","Left_Fallopian_Tube_18245_ID"],18256:["Right_epididymis_18256_ID"],18257:["Left_epididymis_18257_ID"],18806:["Right_external_iliac_artery_18806_ID"],18807:["Left_external_iliac_artery_18807_ID"],18809:["Right_internal_iliac_artery_18809_ID"],18810:["Left_internal_iliac_artery_18810_ID"],18824:["Right_inferior_vesical_artery_18824_ID"],18825:["Left_inferior_vesical_artery_18825_ID"],18829:["Left_Uterine_Artery_18829_ID","Right_Uterine_Artery_18829_ID"],18836:["Right_internal_pudendal_artery_18836_ID"],18837:["Left_internal_pudendal_artery_18837_ID"],18846:["Right_iliolumbar_artery_18846_ID"],18847:["Left_iliolumbar_artery_18847_ID"],18856:["Right_lateral_sacral_artery_18856_ID"],18857:["Left_lateral_sacral_artery_18857_ID"],18866:["Right_obturator_artery_18866_ID"],18867:["Left_obturator_artery_18867_ID"],18869:["Right_superior_gluteal_artery_18869_ID"],18870:["Right_superior_gluteal_artery_18870_ID","Left_superior_gluteal_artery_18870_ID"],18872:["Right_inferior_gluteal_artery_18872_ID"],18873:["Left_inferior_gluteal_artery_18873_ID"],18885:["Right_external_iliac_vein_18885_ID"],18886:["Left_external_iliac_vein_18886_ID"],18887:["Right_internal_iliac_vein_18887_ID"],18888:["Left_internal_iliac_vein_18888_ID"],18891:["Right_inferior_vesical_vein_18891_ID"],18892:["Left_inferior_vesical_vein_18892_ID"],18897:["Right_Uterine_Vein_18897_ID"],18898:["Left_Uterine_Vein_18898_ID"],18903:["Right_iliolumbar_vein_18903_ID"],18904:["Left_iliolumbar_vein_18904_ID"],18906:["Right_lateral_sacral_vein_18906_ID"],18907:["Left_lateral_sacral_vein_18907_ID"],18909:["Right_superior_gluteal_vein_18909_ID"],18910:["Left_superior_gluteal_vein_18910_ID"],18912:["Right_inferior_gluteal_vein_18912_ID"],18913:["Left_inferior_gluteal_vein_18913_ID"],18915:["Right_obturator_vein_18915_ID"],18916:["Left_obturator_vein_18916_ID"],18918:["Right_internal_pudendal_vein_18918_ID"],18919:["Left_internal_pudendal_vein_18919_ID"],19086:["Muscles_of_the_Pelvis_19086_ID"],19087:["Levator_Ani_19087_ID"],19090:["Pubococcygeus_19090_ID"],19091:["Puborectalis_19091_ID"],19119:["Right_Uterosacral_Ligament_19119_ID"],19120:["Left_Uterosacral_Ligament_19120_ID"],19235:["Right_vas_deferens_19235_ID"],19236:["Left_vas_deferens_19236_ID"],19387:["Right_Seminal_Vesicle_19387_ID"],19388:["Left_Seminal_Vesicle_19388_ID"],19617:["Corpus_spongiosum_of_penis_19617_ID"],19618:["Right_corporus_cavernosum_of_penis_19618_ID","Left_corporus_cavernosum_of_penis_19618_ID"],19667:["Urethra_19667_ID"],19668:["Male_urethra_19668_ID"],19730:["Left_Ischiocavernosus_19730_ID","Right_Ischiocavernosus_19730_ID"],19731:["Right_Superficial_Transverse_Perineal_Muscle_19731_ID","Left_Superficial_Transverse_Perineal_Muscle_19731_ID"],19732:["Deep_transverse_perineal_muscle_19732_ID"],19949:["Vagina_19949_ID"],20224:["Right_Ribs_20224_ID"],20225:["Right_Ribs_20225_ID","Left_Ribs_20225_ID"],20226:["Right_Bony_Pelvis_20226_ID","Left_Ribs_20226_ID","Right_side_of_bony_pelvis_20226_ID"],20227:["Left_Bony_Pelvis_20227_ID","Left_side_of_bony_pelvis_20227_ID"],20274:["Perineal_Body_20274_ID"],20630:["Right_genitofemoral_nerve_20630_ID"],20631:["Left_genitofemoral_nerve_20631_ID"],20632:["Genital_branch_of_right_genitofemoral_nerve_20632_ID"],20633:["Genital_branch_of_left_genitofemoral_nerve_20633_ID"],20634:["Femoral_branch_of_right_genitofemoral_nerve_20634_ID"],20635:["Femoral_branch_of_left_genitofemoral_nerve_20635_ID"],20688:["Right_Inferior_Epigastric_Artery_20688_ID"],20689:["Left_Inferior_Epigastric_Artery_20689_ID"],20735:["Right_Superficial_Epigastric_Artery_20735_ID"],20736:["Left_Superficial_Epigastric_Artery_20736_ID"],20796:["Right_deep_femoral_artery_20796_ID"],20797:["Left_deep_femoral_artery_20797_ID"],20801:["Right_lateral_circumflex_femoral_artery_20801_ID"],20802:["Left_lateral_circumflex_femoral_artery_20802_ID"],20807:["Right_Medial_circumflex_femoral_artery_20807_ID"],20808:["Left_Medial_circumflex_femoral_artery_20808_ID"],20818:["Right_dorsal_artery_of_penis_20818_ID"],20819:["Left_dorsal_artery_of_penis_20819_ID"],20967:["Prostatic_part_of_right_inferior_vesical_artery_20967_ID"],20968:["Prostatic_part_of_left_inferior_vesical_artery_20968_ID"],21163:["Right_Inferior_Epigastric_Vein_21163_ID"],21164:["Left_Inferior_Epigastric_Vein_21164_ID"],21188:["Right_Femoral_Vein_21188_ID"],21189:["Left_Femoral_Vein_21189_ID"],21378:["Superficial_Veins_of_the_Left_Leg_21378_ID","Superficial_Veins_of_the_Right_Leg_21378_ID"],21379:["Right_Great_Saphenous_Vein_21379_ID"],21380:["Left_Great_Saphenous_Vein_21380_ID"],21422:["Descending_branch_of_right_lateral_circumflex_femoral_artery_21422_ID"],21423:["Descending_branch_of_left_lateral_circumflex_femoral_artery_21423_ID"],21863:["Right_Pudendal_nerve_21863_ID"],21864:["Left_Pudendal_nerve_21864_ID"],21919:["Right_superficial_transverse_perineal_muscle_21919_ID"],21920:["Left_superficial_transverse_perineal_muscle_21920_ID"],21921:["Right_bulbospongiosus_21921_ID"],21922:["Left_bulbospongiosus_21922_ID"],21923:["Right_ischiocavernosus_21923_ID"],21924:["Left_ischiocavernosus_21924_ID"],21930:["External_Anal_Sphincter_21930_ID"],22109:["Right_Tibial_nerve_22109_ID"],22110:["Left_Tibial_nerve_22110_ID"],22111:["Right_sciatic_nerve_22111_ID"],22112:["Left_sciatic_nerve_22112_ID"],22171:["Right_inferior_ulnar_collateral_artery_22171_ID"],22172:["right_inferior_ulnar_collateral_artery_22172_ID","left_inferior_ulnar_collateral_artery_22172_ID"],22322:["Right_Iliacus_22322_ID"],22323:["Left_Iliacus_22323_ID"],22324:["Right_Obturator_Internus_22324_ID"],22325:["Left_Obturator_Internus_22325_ID"],22326:["Right_Obturator_externus_22326_ID"],22327:["Left_Obturator_externus_22327_ID"],22328:["Right_gluteus_maximus_22328_ID"],22329:["Left_gluteus_maximus_22329_ID"],22330:["Right_gluteus_medius_22330_ID"],22331:["Left_gluteus_medius_22331_ID"],22332:["Right_Gluteus_minimus_22332_ID"],22333:["Left_Gluteus_minimus_22333_ID"],22334:["Right_superior_gemellus_22334_ID"],22335:["Left_superior_gemellus_22335_ID"],22336:["Right_inferior_gemellus_22336_ID"],22337:["Left_inferior_gemellus_22337_ID"],22338:["Right_Quadratus_femoris_22338_ID"],22339:["Left_Quadratus_femoris_22339_ID"],22340:["Right_Piriformis_22340_ID"],22341:["Left_Piriformis_22341_ID"],22342:["Right_Psoas_Major_22342_ID"],22343:["Left_Psoas_Major_22343_ID"],22344:["Right_Transversus_abdominis_22344_ID"],22345:["Left_Transversus_abdominis_22345_ID"],22348:["Right_Quadratus_lumborum_22348_ID"],22349:["Left_Quadratus_lumborum_22349_ID"],22351:["Right_Psoas_Minor_22351_ID"],22352:["Left_Psoas_Minor_22352_ID"],22354:["Right_Sartorius_22354_ID"],22355:["Left_Sartorius_22355_ID"],22358:["Right_Semitendinosus_22358_ID"],22359:["Left_Semitendinosus_22359_ID"],22360:["Right_Biceps_Femoris_22360_ID"],22361:["Left_Biceps_Femoris_22361_ID"],22425:["Right_Tensor_Fasciae_Latae_22425_ID"],22426:["Left_Tensor_Fasciae_Latae_22426_ID"],22444:["Right_quadriceps_femoris_22444_ID"],22445:["Left_quadriceps_femoris_22445_ID"],22446:["Right_Articularis_Genus_22446_ID"],22447:["Left_Articularis_Genus_22447_ID"],22448:["Right_Semimembranosus_22448_ID"],22449:["Left_Semimembranosus_22449_ID"],22450:["Right_Pectineus_22450_ID"],22451:["Left_Pectineus_22451_ID"],22456:["Right_Adductor_Longus_22456_ID"],22457:["Right_Adductor_Longus_22457_ID","Left_Adductor_Longus_22457_ID"],22458:["Left_Adductor_Longus_22458_ID"],22459:["Right_Adductor_Magnus_22459_ID"],22460:["Left_Adductor_Magnus_22460_ID"],22507:["Right_descending_genicular_artery_22507_ID"],22508:["Left_descending_genicular_artery_22508_ID"],22539:["Right_Fibularis_tertius_22539_ID","Left_Fibularis_tertius_22539_ID"],22545:["Right_Tibialis_anterior_22545_ID","Left_Tibialis_anterior_22545_ID"],22547:["Left_Extensor_hallucis_longus_22547_ID","Right_Extensor_hallucis_longus_22547_ID"],22548:["Right_Extensor_hallucis_longus_22548_ID","Left_Extensor_hallucis_longus_22548_ID"],22549:["Right_extensor_digitorum_longus_22549_ID","Left_extensor_digitorum_longus_22549_ID"],22551:["Right_Fibularis_tertius_22551_ID","Left_Fibularis_tertius_22551_ID"],22553:["Right_Fibularis_longus_22553_ID","Left_Fibularis_longus_22553_ID"],22555:["Left_Fibularis_brevis_22555_ID","Right_Fibularis_brevis_22555_ID"],22556:["Right_Gastrocnemius_22556_ID"],22557:["Left_Gastrocnemius_22557_ID"],22559:["Right_Soleus_22559_ID","Left_Soleus_22559_ID"],22561:["Left_Plantaris_22561_ID","Right_Plantaris_22561_ID"],22586:["Right_superior_medial_genicular_artery_22586_ID"],22587:["Left_superior_medial_genicular_artery_22587_ID"],22588:["Right_superior_lateral_genicular_artery_22588_ID"],22589:["Left_superior_lateral_genicular_artery_22589_ID"],22592:["Right_Popliteus_22592_ID","Left_Popliteus_22592_ID"],22655:["Right_Axillary_artery_22655_ID"],22656:["Left_Axillary_artery_22656_ID","Right_Axillary_artery_22656_ID"],22669:["right_superior_thoracic_artery_22669_ID"],22670:["left_superior_thoracic_artery_22670_ID"],22675:["Right_lateral_thoracic_artery_22675_ID"],22676:["right_lateral_thoracic_artery_22676_ID","left_lateral_thoracic_artery_22676_ID"],22679:["Right_subscapular_artery_22679_ID"],22680:["left_subscapular_artery_22680_ID","right_subscapular_artery_22680_ID"],22682:["Right_anterior_humeral_circumflex_artery_22682_ID"],22683:["right_anterior_humeral_circumflex_artery_22683_ID","left_anterior_humeral_circumflex_artery_22683_ID"],22686:["Right_posterior_humeral_circumflex_artery_22686_ID"],22687:["left_posterior_humeral_circumflex_artery_22687_ID","right_posterior_humeral_circumflex_artery_22687_ID"],22691:["Right_brachial_artery_22691_ID"],22692:["right_brachial_artery_22692_ID","left_brachial_artery_22692_ID"],22696:["Right_deep_brachial_artery_22696_ID"],22697:["right_deep_brachial_artery_22697_ID","left_deep_brachial_artery_22697_ID"],22707:["Right_superior_ulnar_collateral_artery_22707_ID"],22708:["right_superior_ulnar_collateral_artery_22708_ID","left_superior_ulnar_collateral_artery_22708_ID"],22726:["Right_Splenius_cervicis_22726_ID"],22727:["Left_Splenius_cervicis_22727_ID"],22728:["Right_Splenius_capitis_22728_ID"],22729:["Left_Splenius_capitis_22729_ID"],22733:["Right_radial_artery_22733_ID"],22734:["Right_radial_artery_22734_ID","Left_radial_artery_22734_ID"],22740:["Right_Iliocostalis_Lumborum_22740_ID"],22741:["Left_Iliocostalis_Lumborum_22741_ID"],22742:["Right_Iliocostalis_Thoracis_22742_ID"],22743:["Left_Iliocostalis_Thoracis_22743_ID"],22744:["Right_Iliocostalis_Cervicis_22744_ID"],22745:["Left_Iliocostalis_Cervicis_22745_ID"],22751:["Right_Longissimus_Thoracis_22751_ID"],22753:["Left_Longissimus_Thoracis_22753_ID"],22754:["Right_Longissimus_Capitis_22754_ID"],22756:["Left_Longissimus_Capitis_22756_ID"],22757:["Right_Longissimus_Cervicis_22757_ID"],22758:["Left_Longissimus_Cervicis_22758_ID"],22765:["Right_radial_recurrent_artery_22765_ID"],22766:["left_radial_recurrent_artery_22766_ID","right_radial_recurrent_artery_22766_ID"],22772:["dorsal_carpal_branch_of_Right_radial_artery_22772_ID"],22773:["dorsal_carpal_branch_of_left_radial_artery_22773_ID","dorsal_carpal_branch_of_right_radial_artery_22773_ID"],22779:["Right_Spinalis_Thoracis_22779_ID"],22780:["Left_Spinalis_Thoracis_22780_ID"],22781:["Right_Spinalis_Cervicis_22781_ID"],22782:["Left_Spinalis_Cervicis_22782_ID"],22783:["Right_Spinalis_Capitis_22783_ID"],22784:["Left_Spinalis_Capitis_22784_ID"],22798:["Right_ulnar_artery_22798_ID","Left_ulnar_artery_22798_ID"],22801:["Right_anterior_ulnar_recurrent_artery_22801_ID"],22802:["right_anterior_ulnar_recurrent_artery_22802_ID","left_anterior_ulnar_recurrent_artery_22802_ID"],22804:["Right_posterior_ulnar_recurrent_artery_22804_ID"],22805:["right_posterior_ulnar_recurrent_artery_22805_ID","left_posterior_ulnar_recurrent_artery_22805_ID"],22807:["Right_common_interosseous_artery_22807_ID"],22808:["left_common_interosseous_artery_22808_ID","right_common_interosseous_artery_22808_ID"],22812:["Right_anterior_interosseous_artery_22812_ID"],22813:["left_anterior_interosseous_artery_22813_ID","right_anterior_interosseous_artery_22813_ID"],22821:["dorsal_carpal_branch_of_Right_ulnar_artery_22821_ID"],22822:["dorsal_carpal_branch_of_left_ulnar_artery_22822_ID","dorsal_carpal_branch_of_right_ulnar_artery_22822_ID"],22836:["Right_superficial_palmar_arch_22836_ID"],22837:["left_superficial_palmar_arch_22837_ID","right_superficial_palmar_arch_22837_ID"],22839:["Right_deep_palmar_arterial_arch_22839_ID"],22840:["left_deep_palmar_venous_arch_22840_ID","right_deep_palmar_venous_arch_22840_ID","right_deep_palmar_arterial_arch_22840_ID","left_deep_palmar_arterial_arch_22840_ID","right_deep_palmar_arch_22840_ID","left_deep_palmar_arch_22840_ID"],22872:["Right_Semispinalis_thoracis_22872_ID"],22873:["Left_Semispinalis_thoracis_22873_ID"],22874:["Right_Semispinalis_cervicis_22874_ID"],22875:["Left_Semispinalis_cervicis_22875_ID"],22876:["Right_Semispinalis_capitis_22876_ID"],22877:["Left_Semispinalis_capitis_22877_ID"],22878:["Right_Multifidus_22878_ID"],22879:["Left_Multifidus_22879_ID"],22909:["Right_basilic_vein_22909_ID"],22910:["right_basilic_vein_22910_ID","left_basilic_vein_22910_ID","Left_basilic_vein_22910_ID"],22920:["Right_palmar_metacarpal_veins_22920_ID"],22921:["right_palmar_metacarpal_veins_22921_ID","left_palmar_metacarpal_veins_22921_ID"],22935:["Right_medial_brachial_vein_22935_ID"],22936:["right_medial_brachial_vein_22936_ID","left_medial_brachial_vein_22936_ID"],22948:["Right_radial_vein_22948_ID"],22949:["left_radial_vein_22949_ID","right_radial_vein_22949_ID"],22951:["right_ulnar_vein_22951_ID"],22952:["right_ulnar_vein_22952_ID","left_ulnar_vein_22952_ID"],22964:["Right_median_cubital_vein_22964_ID"],22965:["right_median_cubital_vein_22965_ID","left_median_cubital_vein_22965_ID"],22968:["Right_median_antebrachial_vein_22968_ID"],22969:["left_median_antebrachial_vein_22969_ID","right_median_antebrachial_vein_22969_ID"],23111:["Right_deep_dorsal_vein_23111_ID"],23112:["right_deep_dorsal_vein_23112_ID","left_deep_dorsal_vein_23112_ID"],23123:["Right_medial_collateral_artery_23123_ID"],23124:["right_medial_collateral_artery_23124_ID","left_medial_collateral_artery_23124_ID"],23126:["Right_radial_collateral_artery_23126_ID"],23127:["right_radial_collateral_artery_23127_ID","left_radial_collateral_artery_23127_ID"],23130:["Right_Humerus_23130_ID","Left_Humerus_23130_ID"],23180:["Right_circumflex_scapular_artery_23180_ID"],23181:["right_circumflex_scapular_artery_23181_ID","left_circumflex_scapular_artery_23181_ID"],23464:["Left_radius_23464_ID","Right_radius_23464_ID"],23467:["Left_Ulna_23467_ID","Right_Ulna_23467_ID"],23707:["Right_Interosseous_membrane_23707_ID"],23708:["Left_Interosseous_membrane_23708_ID"],24160:["Bones_of_the_Right_Arm_24160_ID"],24162:["Bones_of_the_Left_Arm_24162_ID"],24435:["Right_scaphoid_bone_24435_ID","Left_scaphoid_bone_24435_ID"],24437:["Left_lunate_bone_24437_ID","Right_lunate_bone_24437_ID"],24439:["Left_triquetral_bone_24439_ID","Right_triquetral_bone_24439_ID"],24441:["Right_pisiform_24441_ID","Left_pisiform_24441_ID"],24443:["Right_trapezium_24443_ID","Left_trapezium_24443_ID"],24444:["Right_trapezoid_bone_24444_ID","Left_trapezoid_bone_24444_ID"],24446:["Right_capitate_bone_24446_ID","Left_capitate_bone_24446_ID"],24448:["Left_hamate_bone_24448_ID","Right_hamate_bone_24448_ID"],24474:["Right_femur_24474_ID"],24475:["Left_femur_24475_ID"],24477:["Right_tibia_24477_ID"],24478:["Right_tibia_24478_ID","Left_tibia_24478_ID"],24480:["Right_fibula_24480_ID"],24481:["Right_fibula_24481_ID","Left_fibula_24481_ID"],24482:["Right_talus_24482_ID"],24483:["Right_talus_24483_ID","Left_talus_24483_ID"],24486:["Right_patella_24486_ID"],24487:["Right_patella_24487_ID","Left_patella_24487_ID"],24497:["Right_calcaneus_24497_ID"],24498:["Right_calcaneus_24498_ID","Left_calcaneus_24498_ID"],24500:["Navicular_bone_of_right_foot_24500_ID"],24501:["Navicular_of_right_foot_24501_ID","Navicular_of_left_foot_24501_ID","Navicular_bone_of_left_foot_24501_ID"],24521:["Right_medial_Cuneiform_bone_24521_ID"],24522:["Left_medial_Cuneiform_bone_24522_ID","Right_medial_Cuneiform_bone_24522_ID"],24523:["Right_intermediate_Cuneiform_bone_24523_ID"],24524:["Right_intermediate_Cuneiform_bone_24524_ID","Left_intermediate_Cuneiform_bone_24524_ID"],24525:["Right_lateral_Cuneiform_bone_24525_ID"],24526:["Right_lateral_Cuneiform_bone_24526_ID","Left_lateral_Cuneiform_bone_24526_ID"],24528:["Right_cuboid_bone_24528_ID"],24529:["Left_cuboid_bone_24529_ID","Right_cuboid_bone_24529_ID"],25005:["Anterior_atlanto_occipital_membrane_25005_ID","Anterior_atlantooccipital_membrane_25005_ID"],29711:["Prostatic_venous_plexus_29711_ID"],31893:["Anterior_longitudinal_ligament_31893_ID"],32530:["Right_Rectus_capitis_posterior_major_32530_ID"],32531:["Left_Rectus_Capitis_posterior_major_32531_ID"],32532:["Right_Rectus_capitis_posterior_minor_32532_ID"],32533:["Left_Rectus_capitis_posterior_minor_32533_ID","Right_Rectus_Capitis_posterior_major_32533_ID"],32535:["Right_Rectus_capitis_posterior_minor_32535_ID"],32540:["Right_Levator_Scapulae_32540_ID","Right_Levator_scapulae_32540_ID"],32541:["Left_Levator_scapulae_32541_ID"],32542:["Right_Deltoid_32542_ID"],32543:["Left_Deltoid_32543_ID","Right_Deltoid_32543_ID"],32544:["Right_supraspinatus_32544_ID","Right_Supraspinatus_32544_ID"],32545:["Left_Supraspinatus_32545_ID"],32547:["Right_infraspinatus_32547_ID"],32548:["Left_infraspinatus_32548_ID"],32551:["Right_Teres_Major_32551_ID"],32552:["Left_Teres_Major_32552_ID"],32553:["Right_teres_minor_32553_ID"],32554:["Left_teres_minor_32554_ID"],33098:["Right_Rotatores_short_fibers_33098_ID","Right_Rotatores_long_fibers_33098_ID"],33099:["Left_Rotatores_long_fibers_33099_ID","Left_Rotatores_short_fibers_33099_ID"],33520:["Right_pectoral_girdle_muscles_33520_ID"],33521:["Left_pectoral_girdle_muscles_33521_ID","Right_pectoral_girdle_muscles_33521_ID"],37318:["Right_ulnar_nerve_37318_ID"],37319:["Left_ulnar_nerve_37319_ID"],37386:["Right_Abductor_pollicis_brevis_37386_ID"],37387:["Left_Abductor_pollicis_brevis_37387_ID"],37388:["Right_Flexor_pollicis_brevis_37388_ID"],37389:["Left_Flexor_pollicis_brevis_37389_ID"],37390:["Right_Opponens_pollicis_37390_ID"],37391:["Left_Opponens_pollicis_37391_ID"],37392:["Right_Adductor_pollicis_37392_ID"],37393:["Left_Adductor_pollicis_37393_ID","Right_Palmaris_brevis_37393_ID"],37395:["Left_Palmaris_brevis_37395_ID"],37396:["Right_Abductor_digiti_minimi_37396_ID"],37397:["Left_Abductor_digiti_minimi_37397_ID"],37398:["Right_Flexor_digiti_minimi_brevis_37398_ID"],37399:["Left_Flexor_digiti_minimi_brevis_37399_ID"],37400:["Right_Opponens_digiti_minimi_37400_ID"],37401:["Left_Opponens_digiti_minimi_37401_ID"],37460:["Right_Abductor_hallucis_37460_ID","Left_Abductor_hallucis_37460_ID"],37462:["Right_Flexor_digiti_minimi_brevis_37462_ID","Left_Flexor_digiti_minimi_brevis_37462_ID"],37464:["Abductor_digiti_minimi_of_right_foot_37464_ID","Abductor_digiti_minimi_of_left_foot_37464_ID"],37468:["Left_Flexor_hallucis_brevis_37468_ID","Right_Flexor_hallucis_brevis_37468_ID"],37470:["Left_Adductor_hallucis_37470_ID","Left_Adductor_hallucis_oblique_head_37470_ID","Left_Adductor_hallucis_transverse_head_37470_ID","Right_Adductor_hallucis_37470_ID","Right_Adductor_hallucis_oblique_head_37470_ID","Right_Adductor_hallucis_transverse_head_37470_ID"],37665:["Right_Coracobrachialis_37665_ID"],37666:["Left_Coracobrachialis_37666_ID","Right_Coracobrachialis_37666_ID"],37668:["Right_Brachialis_37668_ID"],37669:["Left_Brachialis_37669_ID"],37671:["Right_Biceps_Brachii_37671_ID"],37672:["Right_Biceps_Brachii_37672_ID","Left_Biceps_Brachii_37672_ID"],37689:["Right_Triceps_Brachii_37689_ID"],37690:["Right_Triceps_Brachii_37690_ID","Left_Triceps_Brachii_37690_ID"],37705:["Right_anconeus_37705_ID"],37706:["Left_anconeus_37706_ID","Right_anconeus_37706_ID"],38451:["Right_Pronator_teres_38451_ID"],38452:["Left_Pronator_teres_38452_ID"],38454:["Right_Pronator_quadratus_38454_ID"],38455:["Left_Pronator_quadratus_38455_ID"],38460:["Right_Flexor_carpi_radialis_longus_38460_ID"],38461:["Left_Flexor_carpi_radialis_longus_38461_ID"],38463:["Right_Palmaris_longus_38463_ID"],38464:["Left_Palmaris_longus_38464_ID"],38466:["Right_Flexor_carpi_ulnaris_38466_ID"],38467:["Left_Flexor_carpi_ulnaris_38467_ID"],38483:["Right_flexor_pollicis_longus_38483_ID"],
38484:["Left_flexor_pollicis_longus_38484_ID"],38486:["Right_Brachioradialis_38486_ID"],38487:["Left_Brachioradialis_38487_ID"],38495:["Right_Extensor_carpi_radialis_longus_38495_ID"],38496:["Left_Extensor_carpi_radialis_longus_38496_ID"],38498:["Right_Extensor_carpi_radialis_brevis_38498_ID"],38499:["Left_Extensor_carpi_radialis_brevis_38499_ID"],38504:["Right_Extensor_digiti_minimi_38504_ID"],38505:["Left_Extensor_digiti_minimi_38505_ID"],38507:["Right_Extensor_carpi_ulnaris_38507_ID"],38508:["Left_Extensor_carpi_ulnaris_38508_ID"],38513:["Right_Supinator_38513_ID"],38514:["Left_Supinator_38514_ID"],38516:["Right_Abductor_pollicis_longus_38516_ID"],38517:["Left_Abductor_pollicis_longus_38517_ID"],38519:["Right_Extensor_pollicis_brevis_38519_ID"],38520:["Left_Extensor_pollicis_brevis_38520_ID"],38522:["Right_Extensor_pollicis_longus_38522_ID"],38523:["Left_Extensor_pollicis_longus_38523_ID"],38525:["Right_Extensor_indicis_38525_ID"],38526:["Left_Extensor_indicis_38526_ID"],38928:["Right_Rectus_Femoris_38928_ID"],38929:["Left_Rectus_Femoris_38929_ID"],38930:["Right_Vastus_Lateralis_38930_ID"],38931:["Left_Vastus_Lateralis_38931_ID"],38932:["Right_Vastus_Medialis_38932_ID"],38933:["Left_Vastus_Medialis_38933_ID"],38934:["Right_Vastus_Intermedius_38934_ID"],38935:["Left_Vastus_Intermedius_38935_ID"],39091:["Left_forearm_muscles_39091_ID"],39092:["Right_forearm_muscles_39092_ID"],39987:["Right_Extensor_retinaculum_of_hand_39987_ID","Left_Extensor_retinaculum_of_hand_39987_ID"],39988:["Right_Flexor_retinaculum_of_hand_39988_ID","Left_Flexor_retinaculum_of_hand_39988_ID"],42313:["Right_Pisohamate_Ligament_42313_ID","Left_Pisohamate_Ligament_42313_ID"],42369:["Right_hand_muscles_42369_ID"],42370:["Left_hand_muscles_42370_ID"],43883:["Right_Gracilis_43883_ID"],43884:["Left_Gracilis_43884_ID"],43890:["Right_inferior_medial_genicular_artery_43890_ID"],43891:["Left_inferior_medial_genicular_artery_43891_ID","Right_inferior_medial_genicular_artery_43891_ID"],43892:["Right_inferior_lateral_genicular_artery_43892_ID"],43893:["Left_inferior_lateral_genicular_artery_43893_ID"],43896:["Right_anterior_tibial_artery_43896_ID"],43897:["Right_anterior_tibial_artery_43897_ID","Left_anterior_tibial_artery_43897_ID"],43898:["Left_anterior_tibial_artery_43898_ID","Right_posterior_tibial_artery_43898_ID"],43899:["Left_posterior_tibial_artery_43899_ID"],43907:["Right_anterior_tibial_recurrent_artery_43907_ID"],43908:["Left_anterior_tibial_recurrent_artery_43908_ID"],43916:["Right_dorsalis_pedis_artery_43916_ID"],43917:["Left_dorsalis_pedis_artery_43917_ID"],43922:["Right_fibular_artery_43922_ID"],43923:["Left_fibular_artery_43923_ID"],43929:["Right_medial_plantar_artery_43929_ID"],43930:["Left_medial_plantar_artery_43930_ID"],43931:["Right_lateral_plantar_artery_43931_ID"],43932:["Left_lateral_plantar_artery_43932_ID"],43935:["Right_deep_medial_plantar_artery_43935_ID"],43936:["Left_deep_medial_plantar_artery_43936_ID"],43943:["Right_plantar_arch_43943_ID"],43944:["Left_plantar_arch_43944_ID"],43950:["Calcaneal_branch_of_right_fibular_artery_43950_ID"],43951:["Calcaneal_branch_of_left_fibular_artery_43951_ID"],44227:["Left_Popliteal_Lymph_Nodes_44227_ID","Right_Popliteal_Lymph_Nodes_44227_ID"],44249:["Right_Long_plantar_ligament_44249_ID","Left_Long_plantar_ligament_44249_ID"],44310:["Lymphatics_of_the_Lower_Limb_44310_ID"],44326:["Descending_branch_of_right_lateral_circumflex_femoral_Vein_44326_ID"],44327:["Descending_branch_of_left_lateral_circumflex_femoral_Vein_44327_ID"],44328:["Right_Popliteal_vein_44328_ID"],44329:["Left_Popliteal_vein_44329_ID"],44334:["Right_small_saphenous_vein_44334_ID"],44335:["Left_small_saphenous_vein_44335_ID"],44336:["Right_Anterior_Tibial_Vein_44336_ID"],44337:["Left_Anterior_Tibial_Vein_44337_ID"],44338:["Right_Posterior_Tibial_Vein_44338_ID"],44339:["Left_Posterior_Tibial_Vein_44339_ID"],44340:["Right_superficial_epigastric_vein_44340_ID"],44341:["Left_superficial_epigastric_vein_44341_ID"],44583:["Right_Oblique_Popliteal_Ligament_44583_ID"],44584:["Left_Oblique_Popliteal_Ligament_44584_ID"],44585:["Right_Patellar_Ligament_44585_ID"],44586:["Left_Patellar_Ligament_44586_ID"],44597:["Right_Arcuate_Popliteal_Ligament_44597_ID"],44599:["Left_Arcuate_Popliteal_Ligament_44599_ID"],44601:["Right_Tibial_Collateral_Ligament_44601_ID"],44602:["Left_Tibial_Collateral_Ligament_44602_ID"],44609:["Right_Fibular_Collateral_Ligament_44609_ID"],44610:["Left_Fibular_Collateral_Ligament_44610_ID"],44615:["Right_Anterior_Cruciate_Ligament_44615_ID"],44616:["Left_Anterior_Cruciate_Ligament_44616_ID"],44618:["Right_Posterior_Cruciate_Ligament_44618_ID"],44619:["Left_Posterior_Cruciate_Ligament_44619_ID"],44741:["Right_proper_plantar_digital_nerves_44741_ID"],44742:["Left_proper_plantar_digital_nerves_44742_ID"],44874:["Right_dorsal_branch_of_ulnar_nerve_44874_ID"],44875:["Left_dorsal_branch_of_ulnar_nerve_44875_ID"],44881:["Branch_of_Dorsal_venous_arch_of_Right_foot_44881_ID","Right_Dorsalis_pedis_vein_44881_ID","Dorsal_venous_arch_of_Right_foot_44881_ID"],44882:["Branch_of_Dorsal_venous_arch_of_Left_foot_44882_ID","Dorsal_venous_arch_of_Left_foot_44882_ID","Left_Dorsalis_pedis_vein_44882_ID"],44883:["Medial_branch_of_Plantar_venous_arch_of_right_foot_44883_ID","Plantar_venous_arch_of_Right_foot_44883_ID","Lateral_branch_of_Plantar_venous_arch_of_right_foot_44883_ID"],44884:["Medial_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Lateral_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Plantar_venous_arch_of_Left_foot_44884_ID"],44885:["Right_Fibular_vein_44885_ID"],44886:["Left_Fibular_vein_44886_ID"],44887:["Right_Superior_Medial_Genicular_vein_44887_ID","Right_Genicular_Veins_44887_ID","Right_Inferior_Medial_Genicular_Vein_44887_ID","Right_Superior_Lateral_Genicular_vein_44887_ID","Right_Inferior_Lateral_Genicular_Vein_44887_ID"],44888:["Left_Inferior_Lateral_Genicular_Vein_44888_ID","Left_Genicular_Veins_44888_ID","Left_Inferior_Medial_Genicular_Vein_44888_ID","Left_Superior_Medial_Genicular_vein_44888_ID","Left_Superior_Lateral_Genicular_vein_44888_ID"],44918:["Right_medial_circumflex_femoral_vein_44918_ID"],44919:["Left_medial_circumflex_femoral_vein_44919_ID"],44920:["Right_lateral_circumflex_femoral_vein_44920_ID"],44922:["Left_lateral_circumflex_femoral_vein_44922_ID"],45257:["Right_Intermediate_Femoral_Cutaneous_Nerve_45257_ID"],45258:["Left_Intermediate_Femoral_Cutaneous_Nerve_45258_ID"],45263:["Right_saphenous_nerve_45263_ID"],45264:["Left_saphenous_nerve_45264_ID"],45338:["Right_Posterior_femoral_cutaneous_nerve_45338_ID"],45339:["Left_Posterior_femoral_cutaneous_nerve_45339_ID"],45357:["Right_common_fibular_nerve_45357_ID"],45358:["Left_common_fibular_nerve_45358_ID"],45363:["Right_superficial_fibular_nerve_45363_ID"],45364:["Left_superficial_fibular_nerve_45364_ID"],45387:["Right_deep_fibular_nerve_45387_ID"],45388:["Left_deep_fibular_nerve_45388_ID"],45389:["Right_Lateral_terminal_branch_of_deep_fibular_nerve_45389_ID"],45390:["Left_Lateral_terminal_branch_of_deep_fibular_nerve_45390_ID"],45426:["Right_sural_nerve_45426_ID"],45427:["Left_sural_nerve_45427_ID"],45434:["Right_medial_proper_plantar_nerve_45434_ID"],45435:["Left_medial_proper_plantar_nerve_45435_ID"],45450:["Right_lateral_plantar_nerve_45450_ID"],45451:["Left_lateral_plantar_nerve_45451_ID"],45654:["Female_Internal_Genitalia_45654_ID"],45739:["Right_platysma_45739_ID"],45740:["Left_platysma_45740_ID"],45769:["Internal_Urethral_Sphincter_45769_ID"],45826:["Right_Stylohyoid_45826_ID"],45827:["Left_Stylohyoid_45827_ID"],45858:["Right_Iliococcygeus_45858_ID"],45859:["Left_Iliococcygeus_45859_ID"],45890:["Right_Biceps_Femoris_Short_Head_45890_ID"],45891:["Left_Biceps_Femoris_Short_Head_45891_ID"],46283:["Superior_oblique_part_of_right_longus_colli_46283_ID"],46284:["Superior_oblique_part_of_left_longus_colli_46284_ID"],46285:["Vertical_Intermediate_part_of_right_longus_colli_46285_ID"],46286:["Vertical_Intermediate_part_of_left_longus_colli_46286_ID"],46287:["Inferior_oblique_part_of_right_longus_colli_46287_ID"],46288:["Inferior_oblique_part_of_left_longus_colli_46288_ID"],46292:["Right_Digastric_46292_ID","Right_Digastric_muscle_46292_ID"],46293:["Left_Digastric_46293_ID","Left_Digastric_muscle_46293_ID"],46309:["Right_Longus_capitis_46309_ID"],46310:["Left_Longus_capitis_46310_ID"],46313:["Right_Rectus_capitis_anterior_46313_ID"],46314:["Left_Rectus_capitis_anterior_46314_ID"],46317:["Right_Rectus_capitis_lateralis_46317_ID"],46318:["Right_Rectus_capitis_lateralis_46318_ID","Left_Rectus_capitis_lateralis_46318_ID"],46319:["Left_Rectus_capitis_lateralis_46319_ID"],46321:["Right_Mylohyoid_muscle_46321_ID","Right_Mylohyoid_Muscle_46321_ID"],46322:["Left_Mylohyoid_46322_ID","Left_Mylohyoid_Muscle_46322_ID"],46326:["Right_Geniohyoid_46326_ID"],46327:["Left_Geniohyoid_46327_ID"],46443:["Right_Coccygeus_46443_ID"],46444:["Left_Coccygeus_46444_ID"],46563:["Vertical_part_of_left_cricothyroid_muscle_46563_ID","Right_Cricothyroid_muscle_46563_ID","Oblique_part_of_left_cricothyroid_muscle_46563_ID"],46564:["Vertical_part_of_left_cricothyroid_muscle_46564_ID","Left_Cricothyroid_muscle_46564_ID","Oblique_part_of_left_cricothyroid_muscle_46564_ID"],46621:["Superior_Pharyngeal_Constrictor_46621_ID"],46622:["Middle_Pharyngeal_Constrictor_46622_ID"],46623:["Inferior_Pharyngeal_Constrictor_46623_ID"],46690:["Genioglossus_46690_ID"],46703:["Right_Hyoglossus_46703_ID"],46704:["Left_Hyoglossus_46704_ID"],46705:["Right_Styloglossus_46705_ID"],46706:["Right_Styloglossus_46706_ID","Left_Styloglossus_46706_ID"],46759:["Right_frontalis_46759_ID"],46760:["Left_frontalis_46760_ID"],46761:["Right_occipitalis_46761_ID"],46762:["Left_occipitalis_46762_ID"],46768:["Epicranial_aponeurosis_46768_ID"],46777:["Depressor_septi_nasi_46777_ID"],46792:["Right_orbicularis_oculi_46792_ID"],46793:["Left_orbicularis_oculi_46793_ID"],46796:["Right_corrugator_supercilii_46796_ID"],46797:["Left_corrugator_supercilii_46797_ID"],46803:["Right_levator_labii_superioris_alaeque_nasi_46803_ID"],46804:["Left_levator_labii_superioris_alaeque_nasi_46804_ID"],46806:["Right_levator_labii_superioris_46806_ID"],46807:["Left_levator_labii_superioris_46807_ID"],46812:["Right_zygomaticus_major_46812_ID"],46813:["Left_zygomaticus_major_46813_ID"],46814:["Right_zygomaticus_minor_46814_ID"],46815:["Left_zygomaticus_minor_46815_ID"],46817:["Right_depressor_labii_inferioris_46817_ID"],46818:["Left_depressor_labii_inferioris_46818_ID"],46823:["Right_levator_anguli_oris_46823_ID"],46824:["Left_levator_anguli_oris_46824_ID"],46826:["Right_mentalis_46826_ID"],46827:["Left_mentalis_46827_ID"],46829:["Right_depressor_anguli_oris_46829_ID"],46830:["Left_depressor_anguli_oris_46830_ID"],46835:["Right_buccinator_46835_ID"],46836:["Left_buccinator_46836_ID"],46839:["Right_risorius_46839_ID"],46840:["Left_risorius_46840_ID"],46841:["Orbicularis_oris_46841_ID"],48025:["Left_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_Muscle_48025_ID","Left_Tendon_of_Digastric_Muscle_48025_ID"],48957:["Right_auricularis_superior_48957_ID"],48958:["Left_auricularis_superior_48958_ID"],48959:["Right_auricularis_anterior_48959_ID"],48960:["Left_auricularis_anterior_48960_ID"],48961:["Right_auricularis_posterior_48961_ID"],48962:["Left_auricularis_posterior_48962_ID"],48997:["Right_masseter_48997_ID"],48998:["Left_masseter_48998_ID"],49007:["Right_temporalis_49007_ID"],49008:["Left_temporalis_49008_ID"],49012:["Right_Medial_Pterygoid_49012_ID"],49013:["Left_Medial_Pterygoid_49013_ID"],49016:["Right_inferior_lateral_pterygoid_49016_ID","Right_superior_lateral_pterygoid_49016_ID"],49017:["Left_superior_lateral_pterygoid_49017_ID","Left_inferior_lateral_pterygoid_49017_ID"],49036:["Left_inferior_rectus_49036_ID"],49044:["Right_superior_rectus_49044_ID"],49045:["Left_superior_rectus_49045_ID"],49046:["Right_inferior_rectus_49046_ID"],49047:["Left_inferior_rectus_49047_ID"],49048:["Right_levator_palpebrae_superioris_49048_ID"],49049:["Left_levator_palpebrae_superioris_49049_ID"],49050:["Right_inferior_oblique_49050_ID"],49051:["Left_inferior_oblique_49051_ID"],49052:["Right_superior_oblique_49052_ID"],49053:["Left_superior_oblique_49053_ID"],49054:["Right_lateral_rectus_49054_ID"],49055:["Left_lateral_rectus_49055_ID"],49056:["Right_medial_rectus_49056_ID"],49057:["Left_medial_rectus_49057_ID"],49152:["Right_Ciliary_Muscle_49152_ID"],49153:["Left_Ciliary_Muscle_49153_ID"],49177:["Upper_Gastrointestinal_Tract_49177_ID"],49386:["Right_Inferior_extensor_retinaculum_49386_ID","Left_Inferior_extensor_retinaculum_49386_ID"],49388:["Right_Superior_extensor_retinaculum_49388_ID","Left_Superior_extensor_retinaculum_49388_ID"],49481:["Right_superior_laryngeal_artery_49481_ID"],49482:["Left_superior_laryngeal_artery_49482_ID"],49486:["Right_superior_thyroid_artery_49486_ID"],49487:["Left_superior_thyroid_artery_49487_ID"],49498:["Right_ascending_pharyngeal_artery_49498_ID"],49499:["Left_ascending_pharyngeal_artery_49499_ID"],49550:["Right_facial_artery_49550_ID"],49551:["Left_facial_artery_49551_ID","Right_facial_artery_49551_ID"],49552:["Left_facial_artery_49552_ID"],49556:["Right_ascending_palatine_artery_49556_ID"],49557:["Left_ascending_palatine_artery_49557_ID"],49559:["Right_tonsillar_artery_49559_ID"],49560:["Left_tonsillar_artery_49560_ID"],49561:["Right_tonsillar_artery_49561_ID"],49567:["Inferior_labial_artery_49567_ID"],49570:["Superior_labial_artery_49570_ID"],49584:["Right_angular_artery_49584_ID"],49585:["Left_angular_artery_49585_ID"],49625:["Right_posterior_auricular_artery_49625_ID"],49626:["Left_posterior_auricular_artery_49626_ID"],49651:["Right_superficial_temporal_artery_49651_ID"],49652:["Left_superficial_temporal_artery_49652_ID"],49658:["Right_transverse_facial_artery_49658_ID"],49659:["Left_transverse_facial_artery_49659_ID"],49660:["Right_transverse_facial_artery_49660_ID"],49676:["Right_maxillary_artery_49676_ID"],49677:["Left_maxillary_artery_49677_ID"],49678:["Right_maxillary_artery_49678_ID"],49705:["Right_mental_artery_49705_ID","branch_of_right_mental_artery_49705_ID"],49706:["Left_mental_artery_49706_ID","branch_of_left_mental_artery_49706_ID"],49712:["Right_middle_meningeal_artery_49712_ID"],49713:["Left_middle_meningeal_artery_49713_ID"],49743:["Right_deep_temporal_artery_49743_ID"],49744:["Left_deep_temporal_artery_49744_ID"],49755:["Right_buccal_artery_49755_ID"],49756:["Left_buccal_artery_49756_ID"],49768:["Right_infraorbital_artery_49768_ID"],49769:["Left_infraorbital_artery_49769_ID"],49792:["Right_descending_palatine_artery_49792_ID"],49793:["Left_descending_palatine_artery_49793_ID"],49799:["Left_greater_palatine_artery_49799_ID"],49800:["Right_greater_palatine_artery_49800_ID"],49802:["Right_lesser_palatine_artery_49802_ID"],49803:["Left_lesser_palatine_artery_49803_ID"],49805:["Right_sphenopalatine_artery_49805_ID"],49806:["Left_sphenopalatine_artery_49806_ID"],49810:["Right_posterior_lateral_nasal_artery_49810_ID"],49811:["Left_posterior_lateral_nasal_artery_49811_ID"],49812:["Posterior_septal_branch_of_right_sphenopalatine_artery_49812_ID"],49813:["Posterior_septal_branch_of_left_sphenopalatine_artery_49813_ID"],49869:["Right_opthalmic_artery_49869_ID","Right_ophthalmic_artery_49869_ID"],49870:["Left_opthalmic_artery_49870_ID","Left_ophthalmic_artery_49870_ID"],49881:["Right_central_retinal_artery_49881_ID","Left_central_retinal_artery_49881_ID"],49911:["Right_Inferior_Pulmonary_vein_49911_ID"],49913:["Left_Inferior_Pulmonary_vein_49913_ID"],49914:["Right_Superior_Pulmonary_vein_49914_ID"],49916:["Left_Superior_Pulmonary_vein_49916_ID"],49928:["Right_lacrimal_artery_49928_ID"],49929:["Left_lacrimal_artery_49929_ID"],49974:["Right_supraorbital_artery_49974_ID"],49975:["Left_supraorbital_artery_49975_ID"],49987:["Right_anterior_ethmoidal_artery_49987_ID"],49988:["Left_anterior_ethmoidal_artery_49988_ID"],49990:["Right_posterior_ethmoidal_artery_49990_ID"],49991:["Left_posterior_ethmoidal_artery_49991_ID"],50001:["Right_dorsal_nasal_artery_50001_ID"],50002:["Left_dorsal_nasal_artery_50002_ID"],50026:["Right_supratrochlear_artery_50026_ID"],50027:["Left_supratrochlear_artery_50027_ID","Right_supratrochlear_artery_50027_ID"],50028:["Left_supratrochlear_artery_50028_ID"],50029:["Right_anterior_cerebral_artery_50029_ID"],50030:["Left_anterior_cerebral_artery_50030_ID"],50031:["Left_anterior_cerebral_artery_50031_ID"],50038:["Left_coronary_artery_50038_ID"],50039:["Right_Coronary_Artery_50039_ID"],50082:["Right_Middle_Cerebral_Artery_50082_ID"],50083:["Left_Middle_Cerebral_Artery_50083_ID"],50085:["Right_Posterior_Communicating_Artery_50085_ID"],50086:["Left_Posterior_Communicating_Artery_50086_ID"],50169:["Anterior_Communicating_Artery_50169_ID"],50197:["Muscles_of_the_Right_Arm_50197_ID"],50198:["Muscles_of_the_Right_Arm_50198_ID","Muscles_of_the_Left_Arm_50198_ID"],50203:["Right_upper_arm_muscles_50203_ID"],50204:["Right_upper_arm_muscles_50204_ID","Left_upper_arm_muscles_50204_ID"],50221:["Right_shoulder_muscles_50221_ID","Left_shoulder_muscles_50221_ID"],50222:["Left_shoulder_muscles_50222_ID","Right_shoulder_muscles_50222_ID"],50542:["Basilar_Artery_50542_ID"],50545:["Right_Anterior_Inferior_cerebellar_artery_50545_ID","Right_anterior_Inferior_cerebellar_artery_50545_ID"],50546:["Left_Anterior_Inferior_cerebellar_artery_50546_ID","Left_anterior_Inferior_cerebellar_artery_50546_ID"],50574:["Right_Superior_Cerebellar_artery_50574_ID"],50575:["Left_Superior_Cerebellar_Artery_50575_ID","Left_Superior_Cerebellar_artery_50575_ID"],50584:["Right_Posterior_cerebral_artery_50584_ID","Right_posterior_cerebral_artery_50584_ID"],50585:["Left_Posterior_cerebral_artery_50585_ID","Left_posterior_cerebral_artery_50585_ID"],50718:["Superior_Terminal_Branch_of_Right_Middle_Cerebral_Artery_50718_ID"],50719:["Superior_Terminal_Branch_of_Left_Middle_Cerebral_Artery_50719_ID"],50735:["Hepatic_Portal_and_Associated_Branches_50735_ID"],50764:["Right_transverse_sinus_50764_ID"],50765:["Left_transverse_sinus_50765_ID"],50767:["Superior_sagittal_sinus_50767_ID"],50768:["Inferior_Sagittal_Sinus_50768_ID"],50769:["Straight_Sinus_50769_ID"],50773:["Intercavernous_sinus_50773_ID"],50781:["Occipital_Sinus_50781_ID"],50784:["Sinus_Confluence_50784_ID"],50808:["Right_superior_thyroid_vein_50808_ID"],50809:["Left_superior_thyroid_vein_50809_ID"],50852:["Right_posterior_auricular_vein_50852_ID"],50853:["Left_posterior_auricular_vein_50853_ID"],50859:["Right_suprascapular_vein_50859_ID"],50860:["Left_suprascapular_vein_50860_ID","Right_suprascapular_vein_50860_ID"],50872:["Right_Pulmonary_artery_50872_ID"],50873:["Left_Pulmonary_artery_50873_ID"],50875:["Right_optic_nerve_50875_ID"],50876:["Left_Facial_Vein_50876_ID","Right_Facial_Vein_50876_ID"],50877:["Right_Facial_Vein_50877_ID","Left_Facial_Vein_50877_ID"],50878:["Left_optic_nerve_50878_ID"],50879:["Right_oculomotor_nerve_50879_ID"],50880:["Left_oculomotor_nerve_50880_ID"],50881:["Right_trochlear_nerve_50881_ID"],50882:["Left_trochlear_nerve_50882_ID"],50886:["Right_abducens_nerve_50886_ID"],50887:["Left_abducens_nerve_50887_ID"],50888:["Right_facial_nerve_50888_ID"],50889:["Left_facial_nerve_50889_ID"],50890:["Right_vestibulocochlear_nerve_50890_ID"],50891:["Left_vestibulocochlear_nerve_50891_ID"],50892:["Right_glossopharyngeal_nerve_50892_ID"],50894:["Left_glossopharyngeal_nerve_50894_ID"],50897:["Right_spinal_accessory_nerve_50897_ID","Left_spinal_accessory_nerve_50897_ID"],50899:["Left_spinal_accessory_nerve_50899_ID"],50902:["Right_hypoglossal_nerve_50902_ID"],50903:["Left_hypoglossal_Nerve_50903_ID"],50929:["Right_retromandibular_vein_50929_ID"],50930:["Left_retromandibular_vein_50930_ID"],50933:["Right_Superficial_Temporal_Vein_50933_ID"],50934:["Left_Superficial_Temporal_Vein_50934_ID"],51042:["Right_Deep_Femoral_vein_51042_ID"],51043:["Left_Deep_Femoral_vein_51043_ID"],51085:["Tendon_of_left_flexor_digitorum_brevis_51085_ID","Tendon_of_right_flexor_digitorum_brevis_51085_ID","Right_flexor_digitorum_longus_51085_ID","Left_flexor_digitorum_longus_51085_ID"],51289:["Right_superior_petrosal_sinus_51289_ID"],51290:["Left_superior_petrosal_sinus_51290_ID"],51402:["Right_Cavernous_sinus_51402_ID"],51403:["Left_Cavernous_Sinus_51403_ID"],51489:["Right_occipital_vein_51489_ID"],51490:["Left_occipital_vein_51490_ID"],51885:["Left_central_retinal_vein_51885_ID","Right_central_retinal_vein_51885_ID"],51942:["Right_superior_central_retinal_artery_51942_ID","Left_superior_central_retinal_artery_51942_ID"],51944:["Right_inferior_central_retinal_artery_51944_ID","Left_inferior_central_retinal_artery_51944_ID"],52619:["Right_trigeminal_ganglion_52619_ID"],52620:["Left_trigeminal_ganglion_52620_ID"],52629:["Right_lacrimal_nerve_52629_ID"],52630:["Left_lacrimal_nerve_52630_ID"],52639:["Right_opthalmic_nerve_52639_ID"],52640:["Left_opthalmic_nerve_52640_ID"],52643:["Right_supratrochlear_nerve_52643_ID"],52644:["Left_supratrochlear_nerve_52644_ID"],52661:["Medial_branch_of_right_supraorbital_nerve_52661_ID"],52662:["Medial_branch_of_left_supraorbital_nerve_52662_ID"],52663:["Lateral_branch_of_right_supraorbital_nerve_52663_ID"],52664:["Lateral_branch_of_left_supraorbital_nerve_52664_ID"],52669:["Right_nasociliary_nerve_52669_ID"],52670:["Left_nasociliary_nerve_52670_ID"],52725:["Right_maxillary_nerve_52725_ID"],52726:["Left_maxillary_nerve_52726_ID"],52734:["Frontal_bone_52734_ID"],52735:["Occipital_bone_52735_ID"],52736:["Sphenoid_bone_52736_ID"],52738:["Right_temporal_bone_52738_ID"],52739:["Left_temporal_bone_52739_ID"],52740:["Ethmoid_bone_52740_ID"],52745:["Nasal_bone_52745_ID"],52746:["Palatine_bone_52746_ID"],52748:["Mandible_52748_ID"],52749:["Hyoid_bone_52749_ID"],52784:["Left_lateral_posterior_superior_nasal_nerve_52784_ID"],52785:["Right_lateral_posterior_superior_nasal_nerve_52785_ID"],52788:["Right_parietal_bone_52788_ID"],52789:["Left_parietal_bone_52789_ID"],52803:["Right_greater_palatine_nerve_52803_ID"],52804:["Left_greater_palatine_nerve_52804_ID"],52806:["Right_lesser_palatine_nerve_52806_ID"],52807:["Left_lesser_palatine_nerve_52807_ID"],52824:["Left_posterior_inferior_nasal_nerve_52824_ID"],52825:["Right_posterior_inferior_nasal_nerve_52825_ID"],52892:["Right_zygomatic_bone_52892_ID"],52893:["Left_zygomatic_bone_52893_ID"],52974:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52974_ID"],52975:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52975_ID"],52976:["Zygomaticofacial_branch_of_right_zygomatic_nerve_52976_ID"],52977:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52977_ID","Zygomaticofacial_branch_of_left_zygomatic_nerve_52977_ID"],52978:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52978_ID"],52979:["Right_infraorbital_nerve_52979_ID"],52980:["Left_infra_orbital_nerve_52980_ID","Left_infraorbital_nerve_52980_ID"],52997:["Right_Mandibular_Nerve_52997_ID"],52998:["Left_Mandibular_Nerve_52998_ID"],53001:["Right_auriculotemporal_nerve_53001_ID"],53002:["Left_auriculotemporal_nerve_53002_ID"],53069:["Right_pterygopalatine_ganglion_53069_ID"],53070:["Left_pterygopalatine_ganglion_53070_ID"],53121:["Right_zygomatic_bone_53121_ID"],53122:["Left_zygomatic_bone_53122_ID"],53185:["Buccal_branch_of_right_facial_nerve_53185_ID","Buccal_branch_of_Right_Facial_Nerve_53185_ID"],53186:["Buccal_branch_of_Left_Facial_Nerve_53186_ID"],53219:["Right_lingual_nerve_53219_ID"],53220:["Left_lingual_nerve_53220_ID"],53244:["Right_Inferior_Alveolar_Nerve_53244_ID"],53245:["Left_Inferior_Alveolar_Nerve_53245_ID"],53251:["Right_mental_nerve_53251_ID","Left_mental_nerve_53251_ID"],53252:["Left_mental_nerve_53252_ID"],53279:["Right_posterior_auricular_nerve_53279_ID"],53280:["Left_posterior_auricular_nerve_53280_ID"],53290:["Temporal_branch_of_the_right_facial_nerve_53290_ID"],53291:["Temporal_branch_of_the_left_facial_nerve_53291_ID","Temporal_branch_of_the_right_facial_nerve_53291_ID"],53366:["Marginal_mandibular_branch_of_right_facial_nerve_53366_ID"],53367:["Marginal_mandibular_branch_of_left_facial_nerve_53367_ID"],53398:["Cervical_branch_of_right_facial_nerve_53398_ID"],53399:["Cervical_branch_of_left_facial_nerve_53399_ID"],53549:["Right_ciliary_ganglion_53549_ID"],53550:["Left_ciliary_ganglion_53550_ID"],53641:["Right_ear_53641_ID"],53642:["Left_ear_53642_ID"],53643:["Left_ear_53643_ID"],53645:["Right_Lacrimal_Bone_53645_ID"],53646:["Left_lacrimal_bone_53646_ID"],53654:["Palatine_bone_53654_ID"],54375:["Nasal_septum_54375_ID"],54449:["Right_eye_54449_ID"],54450:["Left_eye_54450_ID"],54640:["Tongue_54640_ID"],55099:["Thyroid_Cartilage_55099_ID"],55123:["Lower_part_of_cricopharyngeus_55123_ID"],55132:["Thyrohyoid_Membrane_55132_ID"],55143:["Right_ansa_cervicalis_nerve_55143_ID"],55144:["left_ansa_cervicalis_nerve_55144_ID"],55145:["Right_ansa_cervicalis_nerve_55145_ID"],55233:["Cricothyroid_ligament_55233_ID"],55560:["Right_Superior_Parathyroid_55560_ID"],55561:["Left_Superior_Parathyroid_55561_ID"],55562:["Right_Inferior_Parathyroid_55562_ID"],55563:["Left_Inferior_Parathyroid_55563_ID"],55610:["Right_procerus_55610_ID"],55611:["Left_procerus_55611_ID"],55612:["Transverse_part_of_right_nasalis_55612_ID"],55613:["Transverse_part_of_left_nasalis_55613_ID"],55614:["Alar_part_of_right_nasalis_55614_ID"],55615:["Alar_part_of_left_nasalis_55615_ID"],56103:["Right_Internal_acoustic_meatus_56103_ID"],56104:["Left_Internal_acoustic_meatus_56104_ID"],56427:["Right_tympanic_membrane_56427_ID"],56428:["Left_tympanic_membrane_56428_ID"],58236:["Right_Iris_58236_ID"],58237:["Left_Iris_58237_ID"],58242:["Right_Lens_58242_ID"],58243:["Left_Lens_58243_ID"],58271:["Right_Sclera_58271_ID"],58272:["Left_Sclera_58272_ID"],58299:["Right_Choroid_58299_ID"],58300:["Left_Choroid_58300_ID"],58302:["Right_Retina_58302_ID"],58303:["Left_Retina_58303_ID"],58841:["Right_Hyaloid_Canal_58841_ID"],58842:["Left_Hyaloid_Canal_58842_ID"],59102:["Right_lacrimal_gland_59102_ID"],59103:["Left_lacrimal_gland_59103_ID"],59505:["Right_major_alar_cartilage_59505_ID"],59506:["Left_major_alar_cartilage_59506_ID"],59512:["Right_lateral_nasal_cartilage_59512_ID"],59513:["Left_lateral_nasal_cartilage_59513_ID"],59545:["Right_lacrimal_sac_59545_ID"],59546:["Left_lacrimal_sac_59546_ID"],59797:["Left_Parotid_Gland_59797_ID","Right_Parotid_Gland_59797_ID"],59798:["Right_Parotid_Gland_59798_ID","Left_Parotid_Gland_59798_ID"],59802:["Right_Submandibular_Gland_59802_ID"],59803:["Left_Submandibular_Gland_59803_ID"],59804:["Right_Sublingual_Gland_59804_ID"],59805:["Left_Sublingual_Gland_59805_ID"],59866:["Right_Parotid_Duct_59866_ID"],59867:["Left_Parotid_Duct_59867_ID"],59964:["Right_Submandibular_Duct_59964_ID"],59965:["Left_Submandibular_Duct_59965_ID"],60180:["Right_osseous_labyrinth_60180_ID"],60181:["Left_osseous_labyrinth_60181_ID"],60188:["Right_Anterior_semicircular_canal_60188_ID"],60189:["Left_Anterior_semicircular_canal_60189_ID"],60191:["Right_Posterior_semicircular_canal_60191_ID"],60192:["Left_Posterior_semicircular_canal_60192_ID"],60194:["Right_Lateral_semicircular_canal_60194_ID"],60195:["Left_Lateral_semicircular_canal_60195_ID"],60202:["Right_Cochlea_60202_ID"],60203:["Left_Cochlea_60203_ID"],61020:["Right_Internal_Ear_61020_ID"],61021:["Left_Internal_Ear_61021_ID"],61735:["Right_external_acoustic_tube_61735_ID"],61736:["Left_external_acoustic_tube_61736_ID"],61965:["fornix_61965_ID"],62008:["hypothalamus_62008_ID"],62033:["Pineal_Gland_62033_ID"],62045:["optic_chiasm_62045_ID"],64919:["Right_Iliopsoas_64919_ID"],64920:["Left_Iliopsoas_64920_ID"],65015:["Left_Flexor_hallucis_longus_65015_ID","Right_Flexor_hallucis_longus_65015_ID"],65019:["Left_Tibialis_posterior_65019_ID","Right_Tibialis_posterior_65019_ID"],65281:["Right_long_thoracic_nerve_65281_ID"],65282:["Left_long_thoracic_nerve_65282_ID"],65536:["Right_lumbosacral_trunk_nerve_65536_ID"],65537:["Left_lumbosacral_trunk_nerve_65537_ID","Left_lumbosacral_trunk_65537_ID"],66321:["Right_thoracodorsal_artery_66321_ID"],66322:["right_thoracodorsal_artery_66322_ID","left_thoracodorsal_artery_66322_ID"],67584:["Left_nerve_of_pterygoid_canal_67584_ID","Right_nerve_of_pterygoid_canal_67584_ID"],67944:["cerebellum_67944_ID"],69316:["Right_Brachiocephalic_trunk_69316_ID"],69490:["Right_lateral_tarsal_artery_69490_ID"],69491:["Left_lateral_tarsal_artery_69491_ID"],69494:["Right_arcuate_artery_69494_ID"],69495:["Left_arcuate_artery_69495_ID"],69514:["Right_deep_plantar_artery_69514_ID"],69515:["Right_deep_plantar_artery_69515_ID"],69516:["Left_deep_plantar_artery_69516_ID"],69726:["Calcaneal_branch_of_right_posterior_tibial_artery_69726_ID"],69727:["Calcaneal_branch_of_left_posterior_tibial_artery_69727_ID"],70249:["Right_femoral_artery_70249_ID"],70250:["Left_femoral_artery_70250_ID"],70799:["Right_dorsal_metacarpal_arteries_70799_ID"],70800:["left_dorsal_metacarpal_arteries_70800_ID","right_dorsal_metacarpal_arteries_70800_ID"],70801:["left_dorsal_digital_arteries_70801_ID","right_dorsal_digital_arteries_70801_ID","Right_dorsal_digital_arteries_70801_ID","Right_palmar_metacarpal_arteries_70801_ID"],70802:["left_palmar_metacarpal_arteries_70802_ID","right_palmar_metacarpal_arteries_70802_ID","Right_common_palmar_digital_arteries_70802_ID"],70803:["right_common_palmar_digital_arteries_70803_ID","Right_proper_palmar_digital_arteries_70803_ID","left_common_palmar_digital_arteries_70803_ID"],70804:["left_proper_palmar_digital_arteries_70804_ID","right_proper_palmar_digital_arteries_70804_ID","left_common_palmar_digital_arteries_70804_ID"],70809:["Set_of_Jejunal_arteries_70809_ID"],70810:["Set_of_ileal_arteries_70810_ID"],70815:["Perforating_arteries_of_left_deep_fibular_artery_70815_ID","Perforating_arteries_of_right_deep_fibular_artery_70815_ID"],70889:["Left_lumbar_vein_70889_ID","Right_lumbar_vein_70889_ID"],70917:["Right_palmar_digital_veins_70917_ID"],70918:["right_palmar_digital_veins_70918_ID","left_palmar_digital_veins_70918_ID"],70922:["Right_distal_perforating_veins_70922_ID","Perforating_veins_of_right_deep_femoral_artery_70922_ID","Perforating_veins_of_left_deep_femoral_artery_70922_ID","Left_distal_perforating_veins_70922_ID"],70927:["Set_of_jejunal_veins_70927_ID"],70928:["Set_of_ileal_veins_70928_ID"],71132:["Gastrointestinal_Tract_71132_ID"],71211:["Right_lateral_thoracic_vein_71211_ID"],71212:["Left_lateral_thoracic_vein_71212_ID","Right_lateral_thoracic_vein_71212_ID"],71214:["Right_thoracodorsal_vein_71214_ID","Left_thoracodorsal_vein_71214_ID"],71215:["Right_thoracodorsal_vein_71215_ID"],71287:["Muscles_of_the_Head_and_Neck_71287_ID"],71291:["Muscles_of_the_Back_71291_ID"],71293:["Muscles_of_the_Thorax_71293_ID"],71310:["Left_Intertransversarii_71310_ID","Right_Intertransversarii_71310_ID"],71398:["Left_Radiate_Sternocostal_Ligaments_71398_ID","Right_Radiate_Sternocostal_Ligaments_71398_ID"],71894:["Right_carpal_bones_71894_ID","Left_carpal_bones_71894_ID"],71898:["Right_metacarpal_bones_of_hand_71898_ID","Left_metacarpal_bones_of_hand_71898_ID"],71900:["Phalanges_of_right_hand_71900_ID","Phalanges_of_left_hand_71900_ID"],72063:["Set_of_cervical_vertebrae_72063_ID"],72064:["Set_of_thoracic_vertebrae_72064_ID"],72065:["Set_of_lumbar_vertebrae_72065_ID"],72309:["Right_Stylohyoid_Ligament_72309_ID"],72311:["Left_Stylohyoid_Ligament_72311_ID"],72316:["Set_of_intervertebral_discs_72316_ID"],72826:["right_caudate_nucleus_72826_ID"],72827:["left_caudate_nucleus_72827_ID"],72828:["right_putamen_72828_ID"],72829:["left_putamen_72829_ID"],72832:["right_amygdaloid_body_72832_ID"],72833:["left_amygdaloid_body_72833_ID"],72856:["right_lateral_globus_pallidus_72856_ID"],72857:["left_lateral_globus_pallidus_72857_ID"],72858:["right_medial_globus_pallidus_72858_ID"],72859:["left_medial_globus_pallidus_72859_ID"],74048:["Right_stapes_74048_ID"],74049:["Left_stapes_74049_ID"],74050:["Right_Incus_74050_ID"],74051:["Left_Incus_74051_ID"],74052:["Right_malleus_74052_ID"],74053:["Left_malleus_74053_ID"],74073:["Right_Levatores_costarum_74073_ID"],74074:["Left_Levatores_costarum_74074_ID"],74075:["Right_Levatores_costarum_longi_74075_ID"],74076:["Left_Levatores_costarum_longi_74076_ID"],74079:["Right_Subcostales_74079_ID"],
74080:["Left_Subcostales_74080_ID"],74525:["Occipital_74525_ID"],75150:["Teeth_75150_ID"],75398:["Superficial_dorsal_vein_of_penis_75398_ID"],75492:["Right_common_plantar_digital_nerves_75492_ID"],75493:["Left_common_plantar_digital_nerves_75493_ID"],76767:["Anterior_cardiac_vein_76767_ID"],76829:["Right_Zonula_Fibers_76829_ID","Left_Zonula_Fibers_76829_ID"],77161:["Intermediate_Hepatic_Vein_77161_ID"],77380:["Right_popliteal_artery_77380_ID"],77381:["Left_popliteal_artery_77381_ID"],77596:["Hypogastric_nerve_77596_ID"],77949:["Right_circumflex_scapular_vein_77949_ID"],77950:["Right_circumflex_scapular_vein_77950_ID","Left_circumflex_scapular_vein_77950_ID"],78023:["Right_lateral_brachial_vein_78023_ID"],78024:["right_lateral_brachial_vein_78024_ID","left_lateral_brachial_vein_78024_ID"],78209:["trunk_of_Hepatic_portal_vein_78209_ID"],78508:["Right_tarsal_bones_78508_ID"],78509:["Left_tarsal_bones_78509_ID"],78510:["Right_metatarsal_bones_78510_ID"],79468:["Right_accessory_meningeal_artery_79468_ID"],79469:["Left_accessory_meningeal_artery_79469_ID"],82695:["trunk_of_Hepatic_portal_vein_82695_ID"],82933:["Right_Nerve_to_levator_ani_82933_ID"],82934:["Left_Nerve_to_levator_ani_82934_ID"],85274:["External_Urethral_Sphincter_85274_ID"],86233:["Lymphatics_of_the_Upper_Limb_86233_ID"],86917:["Muscles_of_the_Abdomen_86917_ID"],87217:["Descending_aorta_thoracic_87217_ID","Descending_thoracic_aorta_87217_ID"],228738:["Muscles_of_the_Throat_228738_ID"],231317:["Phalanges_of_the_right_foot_231317_ID"],231319:["Phalanges_of_the_left_foot_231319_ID"],258714:["right_thalamus_258714_ID"],258716:["left_thalamus_258716_ID"],258847:["Right_Calcaneal_Tendon__aka_Achilles_Tendon_258847_ID"],258848:["Left_Calcaneal_Tendon__aka_Achilles_Tendon_258848_ID"],268668:["Right_interosseous_recurrent_artery_268668_ID"],268669:["right_interosseous_recurrent_artery_268669_ID","left_interosseous_recurrent_artery_268669_ID"]},function(){"use strict";var a=Human.clients={};a.numConnections=0,a.addClient=function(b){b({connected:function(){a.numConnections++,Human.events.fire("clients.connected",{})},disconnected:function(){a.numConnections--,Human.events.fire("clients.disconnected",{})}})}}(),Human.clients.addClient(function(a){"use strict";function b(a){var b=JSON.stringify(a);return f?void f.postMessage(b,g):void i.push(b)}function c(){for(;i.length>0;)f.postMessage(i.pop(),g)}function d(a){var b=a.call;return"camera.pan"===b||"camera.orbit"===b||"camera.flyTo"===b||"camera.jumpTo"===b||"camera.zoom"===b||a.params&&a.params.connected?void e(a):void(0===k?e(a):(j.push(a),h||(h=setInterval(function(){j.length>0&&0===k&&e(j.shift()),0===j.length&&clearInterval(h)},20))))}function e(a){if(Human.rpc.windowClientEnabled)try{Human.rpc.call(a.id,a.call,a.params),Human.rpc.log(a.call)}catch(b){Human.log.error("Human.clients.windowClient","Error executing RPC call [callId: "+a.id+", procedure: "+a.call+"]: "+b)}}var f,g,h,i=[],j=[],k=0;Human.events.on("started",function(){b({message:"status",status:"ready"})}),window.addEventListener?(Human.events.on("error",function(a){b({error:a})}),Human.rpc.onResult(function(a,c){var d={};d[a]=Human.rpc.filterUnsafeProperties(c),b({results:d})}),addEventListener("message",function(e){var h;try{h=JSON.parse(e.data)}catch(i){return}"connect"===h.action?f||(Human.log.info("Human.clients.windowClient","Client connected"),a.connected(),f=e.source,g=e.origin,b({message:"connected"}),c()):h.call&&d(h)},!1)):Human.log.error("Human.clients.windowClient","Browser does not support cross-window messaging")}),function(){"use strict";var a=Human.cookies={};a.setCookie=function(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},a.getCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},a.eraseCookie=function(b){a.setCookie(b,"",-1)}}(),function(){"use strict";var a=Human.init={},b=!1;a.bookmark={},a.cameraBookmark={},a.saveReset=function(){var b=Human.bookmarks.capture(),c=b.modules;if(c){var d=c.active;d&&d.length>1&&(c.active=[c.active[0]])}a.bookmark=b,Human.timeline.activeRoot&&(a.bookmark.camera=Human.timeline.activeRoot._chapters[0].camera.location)},a.reset=function(b){return a.bookmark?(Human.renderer.lights.restoreDefaults(),void Human.bookmarks.restore(a.bookmark,function(){Human.events.fire("init.reset"),b&&b()},function(a){Human.log.error("Human.init.reset","Reset failed: "+a),b&&b()})):(Human.log.error("Human.init.reset","Bookmark for reset was not captured"),void(b&&b()))},a.resetCamera=function(b){var c=Human.timeline.getCurrentChapterCamera();if(c)return void Human.renderer.camera.fly.flyTo(c,b);var d,e,f=0,g=Human.modules.activeModules;for(var h in g)g.hasOwnProperty(h)&&(e=g[h],e.camera&&e.timeActivated>f&&(d=e));return d?void Human.renderer.camera.fly.flyTo(d.camera,b):a.bookmark?void Human.renderer.camera.fly.flyTo(a.bookmark.camera,b):(Human.log.error("Human.init.resetCamera","Bookmark for reset was not captured"),void(b&&b()))},a.init=function(a){Human.renderer.init(),Human.assets.init(),Human.events.fire("loaded"),a&&a()},a.start=function(){b=!0,a.saveReset(),Human.events.fire("started")}}(),function(){"use strict";function a(){b.setFogEnabled(i),b.setFogMode(j),b.setFogStart(l),b.setFogEnd(m),b.setFogMin(n),b.setFogMax(o),b.setFogDensity(k),b.setFogColor(p[0],p[1],p[2]),g=!1}var b,c=14,d=100,e=Human.renderer={highlightColor:new Float32Array([1.5,1.5,.5]),xrayBGColor:new Float32Array([.2,.2,.3]),frameRateThrottled:!1,testContextLoss:!1,viewportDirty:!0,lastFrameStats:{gpuTime:0,cpuTime:0}},f={alpha:SceneJS.TRANSPARENCY_FLAGS.ALPHA,improvedAlpha:SceneJS.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,addAlpha:SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA,alphaToCoverage:SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE,weightedOIT:SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT},g=!1,h=!1,i=!1,j=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,k=.01,l=0,m=1e3,n=0,o=1,p=new Float32Array([1,1,1]),q=0,r=0,s=0,t=1,u=0,v=!1,w={timeStarted:0,timeLast:0,timeNow:0,tick:0},x={frameStart:0,lastFrameStart:0},y={frameStart:0,frameEnd:0,lastFrameEnd:0},z=mat4.create(),A=mat4.create(),B=vec3.create(),C=vec4.create();Human.properties.subscribe({propId:"highlight.color",value:e.highlightColor,callback:function(a){e.highlightColor=a,g=!0}}),Human.properties.subscribe({propId:"fog.enabled",value:i,callback:function(a){i=a,g=!0}}),Human.properties.subscribe({propId:"fog.mode",value:j,callback:function(a){j=a,g=!0}}),Human.properties.subscribe({propId:"fog.start",value:l,callback:function(a){l=a,g=!0}}),Human.properties.subscribe({propId:"fog.end",value:m,callback:function(a){m=a,g=!0}}),Human.properties.subscribe({propId:"fog.min",value:n,callback:function(a){n=a,g=!0}}),Human.properties.subscribe({propId:"fog.max",value:o,callback:function(a){o=a,g=!0}}),Human.properties.subscribe({propId:"fog.density",value:k,callback:function(a){k=a,g=!0}}),Human.properties.subscribe({propId:"fog.color",value:p,callback:function(a){p=a,g=!0}}),e.init=function(){SceneJS.WEBGL_INFO.SOFTWARE_RENDERER&&Human.log.error("This browser is using a software renderer for WebGL. Expect substantially reduced rendering performance.");var f=Date.now(),i=f,j=0;SceneJS.setMaxPointSize(255),b=this.graph.init(),this.postprocess.init(b),this.canvas.init(),this.lights.init(),this.setXrayBGColor(this.xrayBGColor),requestAnimationFrame(function k(){requestAnimationFrame(k);var l=b.getGPUTimer(),m=b.getGPUTimerQuery(),n=b.getGL();if(l&&v){var o=l.getQueryObjectEXT(m,l.QUERY_RESULT_AVAILABLE_EXT),p=n.getParameter(l.GPU_DISJOINT_EXT);o&&(v=!1),o&&!p&&(e.lastFrameStats.gpuTime=l.getQueryObjectEXT(m,l.QUERY_RESULT_EXT)/1e6)}if(!(h||(++u,t>u))){u=0;var z=Human.timer.now();l&&!v&&l.beginQueryEXT(l.TIME_ELAPSED_EXT,m),x.frameStart=Human.timer.now(),Human.events.fire("frameStart",x),x.lastFrameStart=x.frameStart,g&&a(),e.viewportDirty&&(b.setViewport(0,0,e.canvas.width,e.canvas.height),e.viewportDirty=!1);var A=Human.timer.now();if(w.timeStarted=f,w.timeLast=i,w.timeNow=A,w.tick=j,Human.events.fire("tick",w),i=A,j++,!e.frameRateThrottled){var B=b.stats.frame;if(r+=B.gpuTime,s+=B.cpuTime,++q===d){var C=r/q,D=s/q;(D>c||C>c)&&(e.setTicksPerRender(2),e.frameRateThrottled=!0),r=0,s=0,q=0}}e.prepareFrame(w),b.render(),y.frameStart=x.frameStart,y.frameEnd=Human.timer.now(),Human.events.fire("frameEnd",y),y.lastFrameEnd=y.frameEnd,l&&!v&&(l.endQueryEXT(l.TIME_ELAPSED_EXT),v=!0),e.lastFrameStats.cpuTime=Human.timer.now()-z}})},e.prepareFrame=function(){Human.timeline.onFrame(),Human.renderer.lights.onFrame(),Human.renderer.clip.onFrame(),Human.renderer.camera.onFrame(),Human.scene.onFrame(),Human.scene.markers.onFrame(),Human.events.fire("cull",w),Human.scene.cull()},e.updateDisplayForBG=function(){g=!0},e.pushPause=function(){e._pauses=e._pauses?e._pauses+1:1,1===e._pauses&&(h=!0)},e.popPause=function(){e._pauses&&0===--e._pauses&&(h=!1,b.render())},e.pauseCompilation=function(){b.pauseCompilation()},e.resumeCompilation=function(){b.resumeCompilation()},e.setTicksPerRender=function(a){t=a,u=0},e.resetFrameThrottling=function(){e.frameRateThrottled&&(e.setTicksPerRender(1),e.frameRateThrottled=!1)},e.setTransparencyMode=function(a){var c=f[a];return void 0===c?void Human.log.error("Unrecognized transparency mode: "+a):(b.setTransparencyMode(c),void("alphaToCoverage"===a?Human.renderer.postprocess.disable():Human.renderer.postprocess.enable()))},e.setDepthSort=function(a){b.setDepthSort(a)},e.onTasksComplete=function(a){void 0!==e._pauses&&null!==e._pauses&&e._pauses>0&&Human.log.error("Human.renderer.onTaskComplete","Renderer deadlock: Human.renderer.pushPause has paused renderer. Renderer needs to be unpaused in order to complete pending tasks.");var b=Human.renderer.getScene().getStatus().numTasks;if(!b||0===b)return void a();if(e.__checkLoaded)throw"Human.renderer.onTasksComplete: already blocking";e.__checkLoaded=window.setInterval(function(){var b=Human.renderer.getScene().getStatus().numTasks;b&&0!==b||(window.clearInterval(e.__checkLoaded),e.__checkLoaded=null,a())},200)},e.compile=function(){b.compile()},e.forceRenderFrame=function(a){a=a||{},a.force=!0,b.render(a)},e.getScene=function(){return b},e.getLibraryRoot=function(){return b},e.getNode=function(a){return b.findNode(a)},e.nodeExists=function(a){var c=b.findNode(a);return null!==c&&void 0!==c},e.loseContext=function(){b.loseWebGLContext()},e.getViewMat=function(){return b.getViewMatrix()},e.getProjMat=function(){return b.getProjectionMatrix()},e.checkWebGLExtension=function(a){return SceneJS.checkExtension(a)},e.setXrayBGColor=function(a){this.xrayBGColor.set(a),b.setXrayColor(a[0],a[1],a[2])},e.viewPositionToCanvas=function(a,b){var c=e.getProjMat();C.set(a),C[3]=1,vec4.transformMat4(C,C,c);var d=C[3];return b[0]=.5*this.canvas.width*(1+C[0]/d),b[1]=.5*this.canvas.height*(1-C[1]/d),b},e.worldPositionToCanvas=function(a,b){return vec3.transformMat4(B,a,e.getViewMat()),e.viewPositionToCanvas(B,b)},e.canvasPositionToWorldRay=function(a,b,c,d){var e=2*a/Human.renderer.canvas.width-1,f=1-2*b/Human.renderer.canvas.height,g=Human.renderer.camera.eye;c[0]=g.x,c[1]=g.y,c[2]=g.z,d[0]=e,d[1]=f,d[2]=.5;var h=mat4.invert(z,this.getProjMat()),i=mat4.invert(A,this.getViewMat());vec3.transformMat4(d,d,h),vec3.transformMat4(d,d,i),vec3.subtract(d,d,c),vec3.normalize(d,d)};var D=vec3.create(),E=vec3.create(),F=vec3.create(),G=vec3.create(),H=vec3.create(),I=vec3.create();e.canvasCircleToWorldSphereRadius=function(a,b,c,d){this.canvasPositionToWorldRay(a,b+c,H,I);var e=Human.renderer.camera.getLookDir(B),f=vec3.dot(e,I);if(f>.001){vec3.subtract(D,d,H);var g=vec3.dot(D,e)/f;return vec3.scale(F,I,g),vec3.add(E,H,F),vec3.subtract(G,E,d),vec3.length(G)}return 0}}(),function(){"use strict";var a,b={xform:1,properties:2,texture:3,material:3,cubemap:3,fresnel:3,billboard:3,morphGeometry:4,geometry:5},c=Human.renderer.graph={libraryRootNode:null},d={type:"scene",canvasId:Human.canvasId,transparent:!0,contextAttr:{preserveDrawingBuffer:!1,antialias:!0}};c.init=function(){return d.canvasId=Human.canvasId,a=SceneJS.createScene(d,{simulateWebGLContextLost:Human.renderer.testContextLoss}),this.libraryRootNode=a.addNode({type:"library"}),a.setCamera({eye:[0,0,55],look:[0,0,0],up:[0,1,0]}),a.setProjection({type:"perspective",fov:60,near:.01,far:400,fovAxis:"y",pan:{x:0,y:0,z:0}}),a},c.createSubtree=function(b){return a.addNode(b)},c.insertNode=function(a,c){c instanceof SceneJS.Node?c.parent&&"library"===c.parent.type?c.disconnect():c={type:c.type,coreId:c.getCoreId()}:"reflect"===c.type&&(c.type="cubemap");for(var d=c.type,e=b[d],f=a;f;){var g=b[f.type]?b[f.type]:0;if(g>e){var h=f.parent;return f.disconnect(),c=h.addNode(c),c.addNode(f),c}if(0===f.nodes.length)return f.addNode(c);f=f.nodes[0]}},c.disconnectNode=function(a){var b=a.parent,c=a.disconnectNodes();a.disconnect(),b.addNodes(c)},c.destroySubtree=function(a){a.destroy()}}(),function(){"use strict";var a=Human.renderer.bg={},b=null;a.getBGColor=function(){var a=null;if(b){a=[];for(var c=0;c<b.length;c++)a.push(b[c])}return a},a.setBGColor=function(a){Array.isArray(a)&&(b=a)}}(),function(){"use strict";function a(){var a=Human.renderer.canvas.canvas,b=Human.renderer.canvas.annotationCanvas,c=a.parentNode,d=c.clientWidth,e=c.clientHeight;Human.renderer.canvas.width=d,Human.renderer.canvas.height=e,a.width=d,a.height=e,b.width=d,b.height=e,Human.renderer.viewportDirty=!0,Human.renderer.camera.updateCanvas(),Human.renderer.postprocess.updateCanvas(),Human.renderer.draw.updateCanvas(),Human.events.fire("canvas.resized",{canvasWidth:d,canvasHeight:e})}Human.renderer.canvas={canvas:null,annotationCanvas:null,context2D:null,width:0,height:0},Human.renderer.canvas.init=function(){this.canvas=document.getElementById(Human.canvasId),this.annotationCanvas=document.getElementById(Human.annotationCanvasId),this.context2D=this.annotationCanvas.getContext("2d"),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,a()},Human.renderer.resize=a,window.addEventListener("resize",a)}(),function(){"use strict";function a(){var a=b,f=a.near,j=a.far,k=a.aspect,l=a.fovy*Math.PI/180;c[0]=a.eye.x,c[1]=a.eye.y,c[2]=a.eye.z,d[0]=a.look.x,d[1]=a.look.y,d[2]=a.look.z,e[0]=a.up.x,e[1]=a.up.y,e[2]=a.up.z;var o=Math.tan(.5*l)*f,q=o*k;vec3.subtract(m,d,c),vec3.normalize(m,m),vec3.cross(g,m,e),vec3.normalize(g,g),vec3.cross(e,g,m),vec3.scale(n,m,f),vec3.add(h,c,n),vec3.scale(n,m,j),vec3.add(i,c,n),vec3.scale(p[a.FRUSTUM_NEAR].n,m,-1),p[a.FRUSTUM_NEAR].d=-vec3.dot(h,p[a.FRUSTUM_NEAR].n),p[a.FRUSTUM_FAR].n.set(m),p[a.FRUSTUM_FAR].d=-vec3.dot(i,p[a.FRUSTUM_FAR].n),vec3.scale(n,g,q),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_RIGHT].n,n,e),p[a.FRUSTUM_RIGHT].d=-vec3.dot(c,p[a.FRUSTUM_RIGHT].n),vec3.scale(n,g,-q),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_LEFT].n,e,n),p[a.FRUSTUM_LEFT].d=-vec3.dot(c,p[a.FRUSTUM_LEFT].n),vec3.scale(n,e,o),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_TOP].n,g,n),p[a.FRUSTUM_TOP].d=-vec3.dot(c,p[a.FRUSTUM_TOP].n),vec3.scale(n,e,-o),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(p[a.FRUSTUM_BOTTOM].n,n,g),p[a.FRUSTUM_BOTTOM].d=-vec3.dot(c,p[a.FRUSTUM_BOTTOM].n)}var b=Human.renderer.camera={FRUSTUM_TOP:0,FRUSTUM_BOTTOM:1,FRUSTUM_LEFT:2,FRUSTUM_RIGHT:3,FRUSTUM_NEAR:4,FRUSTUM_FAR:5,autoSetNearFar:!0,nearFarDirty:!1},c=vec3.create(),d=vec3.create(),e=vec3.create(),f=vec3.create(),g=vec3.create(),h=vec3.create(),i=vec3.create(),j=vec3.create(),k=vec3.create(),l=vec3.create(),m=vec3.create(),n=vec3.create(),o=mat4.create(),p=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],q=!0;b.eye={x:0,y:0,z:-80},b.look={x:0,y:0,z:0},b.up={x:0,y:1,z:0},b.rotationCenter=vec3.create(),b.lookDistance=80,b._screenPan={x:0,y:0,z:0},b._startcamera={eye:b.eye,look:b.look,up:b.up};var r=!0,s=!0,t=!1;b.lock=!1,b.aspect=1,b.fovy=55,Human.properties.subscribe({propId:"camera.optics.fov",value:b.fovy,callback:function(a){b.fovy=a,s=!0}}),b.near=.1,b.far=5e3,b.minZoom=.01,b.maxZoom=150,Human.properties.subscribe({propId:"camera.zoomLimits",value:{min:.01,max:150},callback:function(a){return a.min<.01?void Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' too small - should be >= 0.01"):a.min>=a.max?void Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' should be less than camera.zoomLimits.max"):(b.minZoom=a.min,b.maxZoom=a.max,void(r=!0))}}),b.updateCanvas=function(){b.setAspect(Human.renderer.canvas.width/Human.renderer.canvas.height)},b.setLookAt=function(a){var e=a.eye||b.eye,f=a.look||b.look,g=a.up||b.up;b.eye=e,b.look=f,b.up=g,Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),b.lookDistance=vec3.distance(c,d),a.look&&!a.preserveCenter&&this.setRotationCenter(a.look.x,a.look.y,a.look.z),r=!0},b.setRotationCenter=function(a,c,d){b.rotationCenter[0]=a,b.rotationCenter[1]=c,b.rotationCenter[2]=d},b.getLookAt=function(){return{eye:b.eye,look:b.look,up:b.up}},b.getLookDir=function(a){var b=this.eye,c=this.look;return a[0]=c.x-b.x,a[1]=c.y-b.y,a[2]=c.z-b.z,vec3.normalize(a,a),a},b.setScreenPan=function(a){b._screenPan.x=a.x||0,b._screenPan.y=a.y||0,b._screenPan.z=a.z||0,s=!0},b.getScreenPan=function(){return b._screenPan},b._reset={eye:{x:b.eye.x,y:b.eye.y,z:b.eye.z},look:{x:b.look.x,y:b.look.y,z:b.look.z},up:{x:b.up.x,y:b.up.y,z:b.up.z}},b.reset=function(){b.yaw=0,b.pitch=90,b._eye={x:b._reset.eye.x,y:b._reset.eye.y,z:b._reset.eye.z},b._look={x:b._reset.look.x,y:b._reset.look.y,z:b._reset.look.z},b._up={x:b._reset.up.x,y:b._reset.up.y,z:b._reset.up.z},b.rotationCenter.set([b._reset.look.x,b._reset.look.y,b._reset.look.z]),r=!0},b.rotateY=function(a){if(!b.lock){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e),vec3.subtract(c,c,b.rotationCenter),vec3.subtract(d,d,b.rotationCenter);var f=Human.math.sign(e[1])||1;mat4.fromRotation(o,f*a*.0174532925,Human.math.Y_AXIS),vec3.transformMat4(c,c,o),vec3.transformMat4(d,d,o),vec3.transformMat4(e,e,o),vec3.add(c,c,b.rotationCenter),vec3.add(d,d,b.rotationCenter),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},look:{x:d[0],y:d[1],z:d[2]},up:{x:e[0],y:e[1],z:e[2]},preserveCenter:!0})}},b.rotateX=function(a){b.lock||(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e),vec3.subtract(c,c,b.rotationCenter),vec3.subtract(d,d,b.rotationCenter),vec3.subtract(k,d,c),vec3.normalize(k,k),vec3.normalize(l,e),vec3.cross(f,l,k),mat4.fromRotation(o,.0174532925*a,f),vec3.transformMat4(c,c,o),vec3.transformMat4(d,d,o),vec3.transformMat4(e,e,o),vec3.add(c,c,b.rotationCenter),vec3.add(d,d,b.rotationCenter),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},look:{x:d[0],y:d[1],z:d[2]},up:{x:e[0],y:e[1],z:e[2]},preserveCenter:!0}))};var u=vec3.create();b.pan=function(a){if(!b.lock){if(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e),vec3.subtract(u,c,d),j[0]=j[1]=j[2]=0,void 0!==a.x){vec3.normalize(k,u),vec3.normalize(l,e);var g=vec3.cross(f,u,e);vec3.normalize(g,vec3.cross(f,u,e)),vec3.scale(n,g,a.x),j[0]+=n[0],j[1]+=n[1],j[2]+=n[2]}void 0!==a.y&&(vec3.normalize(l,e),vec3.scale(n,l,a.y),j[0]+=n[0],j[1]+=n[1],j[2]+=n[2]),void 0!==a.z&&(vec3.normalize(k,c),vec3.scale(n,k,a.z),j[0]+=n[0],j[1]+=n[1],j[2]+=n[2]),vec3.add(c,c,j),vec3.add(d,d,j),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},look:{x:d[0],y:d[1],z:d[2]},preserveCenter:!0})}},b.setAspect=function(a){b.aspect=a,s=!0},b.viewRight=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:-c,y:d,z:0},up:{x:0,y:1,z:0}})}},b.viewLeft=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:c,y:d,z:0},up:{x:0,y:1,z:0}})}},b.viewPosterior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:d,z:-c},up:{x:0,y:1,z:0}})}},b.viewAnterior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:d,z:c},up:{x:0,y:1,z:0}})}},b.viewSuperior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:-c+d,z:0},up:{x:0,y:0,z:1}})}},b.viewInferior=function(){if(!b.lock){var a=Human.init.bookmark.camera.eye,c=a.z,d=a.y;b.setLookAt({look:{x:0,y:d,z:0},eye:{x:0,y:c+d,z:0},up:{x:0,y:0,z:-1}})}},b.zoom=function(a){if(!b.lock){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d);var e=Math.abs(vec3.length(c)),f=Math.abs(e+a);if(b.minZoom&&b.maxZoom){var g=e/b.maxZoom*.6;a=40*a*g,f=Math.abs(e+a),f<b.minZoom?f=b.minZoom:f>b.maxZoom&&(f=b.maxZoom)}vec3.normalize(k,c),vec3.scale(c,k,f),vec3.add(c,d,c),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},preserveCenter:!0})}},b.setZoom=function(a){b.lock||(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d),vec3.normalize(k,c),vec3.scale(c,k,b.minZoom+(1-a)*(b.maxZoom-b.minZoom)),vec3.add(c,d,c),b.setLookAt({eye:{x:c[0],y:c[1],z:c[2]},preserveCenter:!0}))},b.getZoom=function(){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d);var a=Math.abs(vec3.length(c));return 1-(a-b.minZoom)/b.maxZoom},b.setZoomPercent=function(a){b.lock||(Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d),vec3.normalize(k,c),vec3.scale(c,k,b.minZoom+.01*(100-a)*(b.maxZoom-b.minZoom)),b.setLookAt({eye:{x:d[0]+c[0],y:d[1]+c[1],z:d[2]+c[2]},preserveCenter:!0}))},b.getZoomPercent=function(){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(c,c,d);var a=Math.abs(vec3.length(c));return 100-(a-b.minZoom)/b.maxZoom*100},b.getFrustum=function(){return q&&(a(),q=!1),p},b.getSubRegionFrustum=function(a,f,j,k){var l=b,o=l.near,p=l.far,q=l.aspect,r=l.fovy*Math.PI/180;c[0]=l.eye.x,c[1]=l.eye.y,c[2]=l.eye.z,d[0]=l.look.x,d[1]=l.look.y,d[2]=l.look.z,e[0]=l.up.x,e[1]=l.up.y,e[2]=l.up.z,vec3.subtract(m,d,c),vec3.normalize(m,m),vec3.cross(g,m,e),vec3.normalize(g,g),vec3.cross(e,g,m),vec3.normalize(e,e),vec3.scale(n,m,o),vec3.add(h,c,n);var s=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],t=Math.tan(.5*r)*o,u=t*q,v=Human.renderer.canvas.width/2,w=Human.renderer.canvas.height/2,x=(a-v)/v,y=x+j/v,z=(w-f)/w,A=z-k/w;return s[b.FRUSTUM_NEAR].n.set(m),s[b.FRUSTUM_NEAR].d=-vec3.dot(s[b.FRUSTUM_NEAR].n,h),vec3.scale(n,m,p),vec3.add(i,c,n),s[b.FRUSTUM_FAR].n.set([-m[0],-m[1],-m[2]]),s[b.FRUSTUM_FAR].d=-vec3.dot(s[b.FRUSTUM_FAR].n,i),vec3.scale(n,g,x*u),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,n,e),vec3.normalize(n,n),s[b.FRUSTUM_LEFT].n.set(n),s[b.FRUSTUM_LEFT].d=-vec3.dot(n,c),vec3.scale(n,g,y*u),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,e,n),vec3.normalize(n,n),s[b.FRUSTUM_RIGHT].n.set(n),s[b.FRUSTUM_RIGHT].d=-vec3.dot(n,c),vec3.scale(n,e,A*t),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,g,n),vec3.normalize(n,n),s[b.FRUSTUM_BOTTOM].n.set(n),s[b.FRUSTUM_BOTTOM].d=-vec3.dot(n,c),vec3.scale(n,e,z*t),vec3.add(n,h,n),vec3.subtract(n,n,c),vec3.normalize(n,n),vec3.cross(n,n,g),vec3.normalize(n,n),s[b.FRUSTUM_TOP].n.set(n),s[b.FRUSTUM_TOP].d=-vec3.dot(n,c),s},b.onFrame=function(){if(r){Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),Human.math.vec3ObjToArray(b.up,e);var a=Human.renderer.getScene();a.setCamera({eye:c,look:d,up:e}),vec3.subtract(n,c,d),Human.events.fire("camera.updated",{eye:b.eye,look:b.look,up:b.up,dist:Math.abs(vec3.length(n))}),t=!1,r=!1,q=!0,b.nearFarDirty=!0}else t||(t=!0,Human.math.vec3ObjToArray(b.eye,c),Human.math.vec3ObjToArray(b.look,d),vec3.subtract(n,c,d),Human.events.fire("camera.rested",{eye:b.eye,look:b.look,up:b.up,dist:Math.abs(vec3.length(n))}));if(b.autoSetNearFar&&b.nearFarDirty){var f=Human.scene.getBoundary(),g=Human.particles.getBoundary(),h=Math.min(f.xmin,g.xmin),i=Math.min(f.ymin,g.ymin),j=Math.min(f.zmin,g.zmin),k=Math.max(f.xmax,g.xmax),l=Math.max(f.ymax,g.ymax),m=Math.max(f.zmax,g.zmax),o=Human.renderer.getViewMat(),p=o[2],u=o[6],v=o[10],w=o[14],x=k-h,y=l-i,z=m-j,A=Math.sqrt(x*x+y*y+z*z),B=h*p+i*u+j*v+w;isFinite(B)&&(B=Math.max(B,k*p+i*u+j*v+w),B=Math.max(B,h*p+l*u+j*v+w),B=Math.max(B,h*p+i*u+m*v+w),B=Math.max(B,k*p+l*u+j*v+w),B=Math.max(B,k*p+i*u+m*v+w),B=Math.max(B,h*p+l*u+m*v+w),B=Math.max(B,k*p+l*u+m*v+w),b.near=Math.max(-B,.1),b.far=b.near+A,b.nearFarDirty=!1,s=!0)}s&&(Human.renderer.getScene().setProjection({type:"perspective",fov:b.fovy,near:b.near,far:b.far,aspect:b.aspect,pan:b._screenPan}),s=!1,q=!0,Human.renderer.postprocess.updateProjection())}}(),function(){"use strict";var a=Human.renderer.pick={};a.pick=function(a,b,c){var d=Human.renderer.getScene();if(!d)return null;var e={objectId:null},f=null,g=d.pick(a,b,c)||null;if(g){f=Human.scene.objects[g.name];var h=g.objectId;if(e=Human.utils.apply(g,e),f&&(e.objectId=f.objectId,h))for(var i=0,j=f.renderables.length;j>i;++i){var k=f.renderables[i].getRenderObject();if(k&&k.id===h){e.renderableIndex=i;break}}}return f?Human.events.fire("pick.picked",e):Human.events.fire("pick.missed",e),e}}(),function(){"use strict";function a(){k=Human.renderer.getScene().addNode({type:"properties",properties:{enabled:!1,backfaces:!0,clipping:!1,picking:!1,noDepthMask:!0}}),l=k.addNode({type:"xform"}),l.addNode({type:"material",emit:.9,baseColor:{r:.3,g:.3,b:.4},specularColor:{r:.3,g:.3,b:.4},specular:0,shine:100,alpha:.2,nodes:[{type:"geometry/plane"}]})}var b=Human.renderer.clip={};b.LEFT=0,b.RIGHT=1,b.BOTTOM=2,b.TOP=3,b.FRONT=4,b.BACK=5;var c=[{n:new Float32Array([-1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,-1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,-1]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,1]),d:0,fade:!1,fadeDistance:0}],d={xmin:1/0,xmax:-(1/0),ymin:1/0,ymax:-(1/0),zmin:1/0,zmax:-(1/0)},e=new Array(c.length),f=new Float32Array(c.length),g=new Array(c.length),h=[],i=!0,j={left:b.LEFT,right:b.RIGHT,bottom:b.BOTTOM,top:b.TOP,front:b.FRONT,back:b.BACK},k=null,l=null,m=mat4.create(),n=mat4.create(),o=mat4.create(),p=mat4.create(),q=vec3.create(),r=vec3.fromValues(1,1,1);b.setClip=function(a){var d=void 0!==j[a.clipId]?j[a.clipId]:a.clipId,h=c[d],k=g[d]=a.boundary||Human.scene.getBoundary();if(void 0!==a.enabled&&(e[d]=a.enabled),void 0!==a.fade&&(h.fade=a.fade),void 0!==a.fadeDistance&&(h.fadeDistance=a.fadeDistance),void 0!==a.progress){var l=f[d]=a.progress,m=0,n=0;(d===b.LEFT||d===b.RIGHT)&&(m=k.xmax-k.xmin,n=k.xmin+.5*m),(d===b.TOP||d===b.BOTTOM)&&(m=k.ymax-k.ymin,n=k.ymin+.5*m),(d===b.FRONT||d===b.BACK)&&(m=k.zmax-k.zmin,n=k.zmin+.5*m),(d===b.LEFT||d===b.BOTTOM||d===b.FRONT)&&(n*=-1),l=1-l,l-=.5,h.d=-(l*m+n)}i=!0,Human.events.fire("clip.updated",{clipId:d,progress:a.progress||this.getProgress(d),enabled:!!e[d],fade:h.fade,fadeDistance:h.fadeDistance})},b.getActiveClips=function(){return h},b.isEnabled=function(a){return!!e[j[a]||a]},b.getProgress=function(a){return f[j[a]||a]},b.serialize=function(){for(var a={},b=0,d=c.length;d>b;++b)a[b]={clipId:b,enabled:!!e[b],progress:f[b],fade:c[b].fade,fadeDistance:c[b].fadeDistance,boundary:g[b]};return a},b.show=function(d){k||a();var e=c[d],f=Human.scene.getBoundary(),g=f.xmax-f.xmin,h=f.ymax-f.ymin,i=f.zmax-f.zmin,j=.5*(f.xmin+f.xmax),s=.5*(f.ymin+f.ymax),t=.5*(f.zmin+f.zmax);k.setEnabled(!0),(d===b.LEFT||d===b.RIGHT)&&(mat4.fromYRotation(n,.5*Math.PI),q[0]=-e.d*e.n[0],q[1]=s,q[2]=t,r[0]=i,r[1]=h),(d===b.TOP||d===b.BOTTOM)&&(mat4.fromXRotation(n,.5*Math.PI),q[0]=j,q[1]=-e.d*e.n[1],q[2]=t,r[0]=g,r[1]=i),(d===b.FRONT||d===b.BACK)&&(mat4.identity(n),q[0]=j,q[1]=s,q[2]=-e.d*e.n[2],r[0]=g,r[1]=h),mat4.fromScaling(o,r),mat4.fromTranslation(m,q),mat4.multiply(p,n,o),mat4.multiply(p,m,p),l.setElements(p)},b.hide=function(){k&&k.setEnabled(!1)},b.reset=function(){for(var a=0,b=c.length;b>a;++a)e[a]=!1;i=!0,Human.events.fire("CrossSections.Reset")},b.onFrame=function(){if(i){h.length=0;for(var a=0,b=c.length;b>a;++a)e[a]&&h.push(c[a]);Human.renderer.getScene().setClips(h),i=!1}},b.getBoundary=function(){return d.xmin=e[b.LEFT]?c[b.LEFT].d:-(1/0),d.xmax=e[b.RIGHT]?-c[b.RIGHT].d:1/0,d.ymin=e[b.BOTTOM]?c[b.BOTTOM].d:-(1/0),d.ymax=e[b.TOP]?-c[b.TOP].d:1/0,d.zmin=e[b.BACK]?c[b.BACK].d:-(1/0),d.zmax=e[b.FRONT]?-c[b.FRONT].d:1/0,d}}(),function(){"use strict";var a=Human.renderer.lights={};a.lights={},a.defaultLightIds=[];var b=[],c=!0,d=!0;a.init=function(){a.addLight({lightId:"light0",enabled:!0,params:{mode:"ambient",color:{r:.2,g:.2,b:.2,diffuse:!0}}}),a.addLight({lightId:"light1",enabled:!0,params:{mode:"dir",dir:{x:1,y:0,z:-.5},color:{r:.1,g:.1,b:.2},diffuse:!0,specular:!0,space:"view"}}),a.addLight({lightId:"light2",enabled:!0,params:{mode:"dir",dir:{x:-1,y:0,z:1},color:{r:.55,g:.5,b:.5},diffuse:!0,specular:!0,space:"view"}}),a.addLight({lightId:"light3",enabled:!0,params:{mode:"dir",dir:{x:.25,y:0,z:-1},color:{r:.9,g:.9,b:.9},diffuse:!0,specular:!1,space:"view"}}),a.defaultLightIds.push("light0"),a.defaultLightIds.push("light1"),a.defaultLightIds.push("light2"),a.defaultLightIds.push("light3")},a.addLight=function(e){return a.lights.hasOwnProperty(e.lightId)?void Human.log.warn("Human.renderer.lights.addLights","The lightId already exists: "+e.lightId):(a.lights[e.lightId]={lightId:e.lightId,enabled:!!e.enabled,params:e.params,index:b.length},c=!0,void(d=!0))},a.addLights=function(b){for(var c in b)b.hasOwnProperty(c)&&a.addLight(b[c])},a.removeLight=function(b){a.lights[b]&&(delete a.lights[b],c=!0,d=!0)},a.removeAllLights=function(){a.lights={},b.length=0,d=!0},a.removeCustomLights=function(){for(var b in a.lights)a.lights.hasOwnProperty(b)&&a.defaultLightIds.indexOf(b)<0&&(delete a.lights[b],d=!0)},a.setEnabled=function(b){var e=!1;for(var f in b){var g=a.lights[f];if(g){var h=!!b[f];g.enabled!==h&&(g.enabled=h,e=!0)}else Human.log.error("Human.renderer.lights.setEnabled","Light not found: "+f)}e&&(c=!0,d=!0)},a.clearEnabled=function(){var b=!1;for(var e in a.lights)a.lights[e].enabled=!1,b=!0;b&&(c=!0,d=!0)},a.setLight=function(b){var c=b.lightId,e=a.lights[c];return e?(void 0!==b.mode&&(e.params.mode=b.mode),void 0!==b.color&&(e.params.color=b.color),void 0!==b.dir&&(e.params.dir=b.dir),void 0!==b.pos&&(e.params.pos=b.pos),void 0!==b.diffuse&&(e.params.diffuse=b.diffuse),void 0!==b.specular&&(e.params.specular=b.specular),void 0!==b.innerCone&&(e.params.innerCone=b.innerCone),void 0!==b.outerCone&&(e.params.outerCone=b.outerCone),void 0!==b.constantAttenuation&&(e.params.constantAttenuation=b.constantAttenuation),void 0!==b.linearAttenuation&&(e.params.linearAttenuation=b.linearAttenuation),void 0!==b.quadraticAttenuation&&(e.params.quadraticAttenuation=b.quadraticAttenuation),void 0!==b.space&&(e.params.space=b.space),void(d=!0)):void Human.log.error("Light "+c+" does not exist")},a.restoreDefaults=function(){var b={};a.defaultLightIds.forEach(function(a){b[a]=!0}),a.clearEnabled(),a.setEnabled(b)},a.onFrame=function(){if(c){var e=0;b.length=0;for(var f in a.lights){var g=a.lights[f];g.enabled&&(b.push(g.params),g.index=e++)}c=!1,d=!0}d&&(Human.renderer.getScene().setLights(b),d=!1)}}(),function(){"use strict";function a(a){if(b.enabled){var c,d,e,f,g,h={opaquePipeline:[],transparentPipeline:[],finalPipeline:[],pipelineFramebuffers:{opaque:{read:"__MAIN",write:"__BDS_COLOR1"},transparent:{read:"__MAIN",write:"__BDS_COLOR1"},"final":{read:"__MAIN",write:"__BDS_COLOR1"}},getIOFramebuffers:function(a){
var b=this.pipelineFramebuffers[a],c={read:b.read,write:b.write};return"__BDS_COLOR1"===b.write?(b.read="__BDS_COLOR1",b.write="__BDS_COLOR2"):(b.read="__BDS_COLOR2",b.write="__BDS_COLOR1"),c}};for(f=0,g=a.length;g>f;++f){var i=b.effects[a[f]];i?i.addStage(h):Human.log.error("Unknown effect: "+a[f])}if(0!==h.opaquePipeline.length||0!==h.transparentPipeline.length||0!==h.finalPipeline.length){if(b.framebuffersInitialized||(b.scene.createFramebuffer("__BDS_COLOR1",{depthAttachment:!1}),b.scene.createFramebuffer("__BDS_COLOR2",{depthAttachment:!1}),b.framebuffersInitialized=!0),h.opaquePipeline.length>0){c=h.opaquePipeline[h.opaquePipeline.length-1],d=c.textures,e=!1;for(var j in d)if("__MAIN"===d[j].framebuffer){e=!0;break}e?h.opaquePipeline.push({type:"blit",id:"blitOpaqueToMain",textures:{uColorBuffer:{framebuffer:c.framebuffer,target:"color"}},framebuffer:"__MAIN"}):c.framebuffer="__MAIN",b.scene.postProcessOpaque(h.opaquePipeline)}h.finalPipeline.length>0?(c=h.finalPipeline[h.finalPipeline.length-1],c.framebuffer=!1):h.finalPipeline.push({type:"blit",id:"blitToScreen",textures:{uColorBuffer:{framebuffer:"__MAIN",target:"color"}},framebuffer:!1}),b.scene.postProcessFinal(h.finalPipeline)}}}var b=Human.renderer.postprocess={scene:null,framebuffersInitialized:!1,enabled:!0,effects:{},currentConfig:[]};b.init=function(a){this.scene=a,a.createPostProcessType("blit",["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","void main() {","gl_FragColor = texture2D(uColorBuffer, vUV);","}"].join("\n"));for(var b in this.effects)this.effects[b].init(a)},b.enable=function(){this.enabled||(this.enabled=!0,b.parse(this.currentConfig))},b.disable=function(){this.enabled&&(this.destroyPipeline(),this.enabled=!1)},b.parse=function(b){if(this.destroyPipeline(),this.currentConfig=b,this.enabled){for(var c=[],d=0,e=b.length;e>d;++d){var f=b[d],g=Human.renderer.postprocess.effects[f.effect];g?(c.push(f.effect),Human.renderer.postprocess.effects[f.effect].configure(f)):Human.log.error("Unknown postprocess effect: ",f.effect)}a(c)}},b.destroyPipeline=function(){this.scene.postProcessOpaque(null),this.scene.postProcessFinal(null)},b.updateProjection=function(){for(var a in this.effects)this.effects[a].updateProjection&&this.effects[a].updateProjection()},b.updateCanvas=function(){for(var a in this.effects)this.effects[a].updateCanvas&&this.effects[a].updateCanvas()}}(),function(){"use strict";function a(){var a=Human.renderer.canvas.context2D;a.lineWidth=2*g.brushRadius,a.lineJoin="round",a.lineCap="round",g.erase?(a.strokeStyle="#FFFFFF",a.fillStyle="#FFFFFF"):(a.strokeStyle=g.brushColorCSS,a.fillStyle=g.brushColorCSS)}function b(a,b){var c=Human.renderer.pick.corePick(a,b,{rayPick:!0});if(c&&c.worldPos){var h=c.objectId+f+c.renderableIndex,i=Human.scene.objects[c.objectId],j=i.renderables[c.renderableIndex];l[h]||e(j,h);var k=Human.renderer.canvasCircleToWorldSphereRadius(a,b,g.brushRadius,c.worldPos),q=c.worldPos,r=j.geometryNode,s=j.getRenderObject();mat4.invert(y,i.worldMatrix),vec3.transformMat4(z,q,y);var t,A,B=l[h],C=B.triangleUVs,D=Human.math.intersections.spherePolyhedron(r,z,k);if(0!==D.length){var E={};if(g.erase){var F=Human.math.intersections.sphereInPolyhedron(r,z,k);for(t=0,A=F.length;A>t;++t)E[F[t]]=!0}var G,H,I=Human.renderer.camera.getLookDir(n);for(t=0,A=D.length;A>t;++t)G=D[t],E[G]&&C[G]?delete C[G]:(s.getTrianglePositionOnSurface(3*G,v,w,x),Human.math.triangleNormal(v,w,x,u),vec4.transformMat4(u,u,i.worldMatrix),vec3.dot(u,I)>0||(s.getPointInWorldSpace(v,v),s.getPointInWorldSpace(w,w),s.getPointInWorldSpace(x,x),C[G]?C[G].patchId!==o&&(C[G].patchId=o,d(v,w,x,C[G].uvs)):(H=new Array(3),d(v,w,x,H),C[G]={patchId:o,uvs:H})));var J=B.bb;for(G in C){H=C[G].uvs;var K=H[0],L=H[1],M=H[2];J.min[0]=Math.min(J.min[0],K[0]),J.min[0]=Math.min(J.min[0],L[0]),J.min[0]=Math.min(J.min[0],M[0]),J.max[0]=Math.max(J.max[0],K[0]),J.max[0]=Math.max(J.max[0],L[0]),J.max[0]=Math.max(J.max[0],M[0]),J.min[1]=Math.min(J.min[1],K[1]),J.min[1]=Math.min(J.min[1],L[1]),J.min[1]=Math.min(J.min[1],M[1]),J.max[1]=Math.max(J.max[1],K[1]),J.max[1]=Math.max(J.max[1],L[1]),J.max[1]=Math.max(J.max[1],M[1])}p[h]=j,m=!0}}}function c(){A.length=0;var a,b;for(a in p)b=l[a],A.push(p[a].getRenderObject());Human.renderer.forceRenderFrame({custom:{renderMode:"drawTexture",objects:A}});var c=Human.renderer.canvas.canvas,d=Human.renderer.canvas.annotationCanvas,e=Human.renderer.canvas.context2D;k.globalCompositeOperation="source-over",k.drawImage(c,0,0),k.globalCompositeOperation=g.erase?"destination-out":"source-over",k.drawImage(d,0,0);var f=k.getImageData(0,0,q,r);k.clearRect(0,0,q,r);var i,j,m;for(a in p){var n=p[a];b=l[a];var s=b.bb;if(s.min[0]!==1/0){e.putImageData(f,0,0);var t=e.getImageData(s.min[0]*q,s.min[1]*r,(s.max[0]-s.min[0])*q,(s.max[1]-s.min[1])*r);e.clearRect(0,0,q,r);var u=b.patches;u[o]={w:t.width,h:t.height,imageData:t},B.length=0;for(m in u)B.push(u[m]);B.sort(function(a,b){return b.h-a.h}),h.fit(B);var v=Math.min(Human.math.nextPowerOf2(h.root.w),4096),w=Math.min(Human.math.nextPowerOf2(h.root.h),4096);for(d.width=Math.max(d.width,v),d.height=Math.max(d.height,w),i=0,j=B.length;j>i;++i)e.putImageData(B[i].imageData,B[i].fit.x,B[i].fit.y);var x=e.getImageData(0,0,v,w);n.drawTexture.setImage(x);var y=b.triangleUVs,z=n.geometryNode.getUVs(),C=z[z.length-1],D={};for(var E in y){var F=y[E];if(F.patchId===o){var G=s.min[0],H=s.min[1],I=s.max[0]-s.min[0],J=s.max[1]-s.min[1];for(i=0;3>i;++i){var K=F.uvs[i];K[0]=(K[0]-G)/I,K[1]=(K[1]-H)/J}}var L=u[F.patchId],M=F.uvs[0],N=F.uvs[1],O=F.uvs[2],P=L.fit.x/v,Q=L.fit.y/w,R=L.w/v,S=L.h/w;C[3*E*2]=M[0]*R+P,C[3*E*2+1]=1-M[1]*S+1-Q,C[2*(3*E+1)]=N[0]*R+P,C[2*(3*E+1)+1]=1-N[1]*S+1-Q,C[2*(3*E+2)]=O[0]*R+P,C[2*(3*E+2)+1]=1-O[1]*S+1-Q,D[F.patchId]=!0}for(m in u)D[m]||delete u[m];n.geometryNode.setUV(z.length-1,C),d.width=q,d.height=r}else Human.console.error("Draw mesh data invalid.")}}function d(a,b,c,d){var e=vec2.create();Human.renderer.worldPositionToCanvas(a,e),e[0]/=q,e[1]/=r,d[0]=e;var f=vec2.create();Human.renderer.worldPositionToCanvas(b,f),f[0]/=q,f[1]/=r,d[1]=f;var g=vec2.create();Human.renderer.worldPositionToCanvas(c,g),g[0]/=q,g[1]/=r,d[2]=g}function e(a,b){var c=a.geometryNode,d={type:"geometry",primitive:"triangles",id:b+"_draw_geometry",positionDecodeMat:c.getPositionDecodeMat()},e=c.getPositions(),f=c.getNormals(),g=c.getUVs(),h=c.getIndices(),i=h.length,j=e.constructor;if(d.positions=new j(3*i),f&&(d.normals=c.hasCompressedNormals()?new Int8Array(2*i):new Float32Array(3*i)),g){d.uvs=new Array(g.length+1);for(var k=0,m=g.length;m>k;k++)d.uvs[k]=new Float32Array(2*i);d.uvs[k]=new Float32Array(2*i)}else d.uvs=[new Float32Array(2*i)];for(var n=d.positions,o=d.normals,p=d.uvs,q=0,r=h.length;r>q;q+=3){var s=h[q],t=h[q+1],u=h[q+2];if(n[3*q]=e[3*s],n[3*q+1]=e[3*s+1],n[3*q+2]=e[3*s+2],n[3*q+3]=e[3*t],n[3*q+4]=e[3*t+1],n[3*q+5]=e[3*t+2],n[3*q+6]=e[3*u],n[3*q+7]=e[3*u+1],n[3*q+8]=e[3*u+2],o&&(c.hasCompressedNormals()?(o[2*q]=f[2*s],o[2*q+1]=f[2*s+1],o[2*q+2]=f[2*t],o[2*q+3]=f[2*t+1],o[2*q+4]=f[2*u],o[2*q+5]=f[2*u+1]):(o[3*q]=f[3*s],o[3*q+1]=f[3*s+1],o[3*q+2]=f[3*s+2],o[3*q+3]=f[3*t],o[3*q+4]=f[3*t+1],o[3*q+5]=f[3*t+2],o[3*q+6]=f[3*u],o[3*q+7]=f[3*u+1],o[3*q+8]=f[3*u+2])),p){var v,w,x=0;if(g)for(var y=g.length;y>x;x++){v=g[x],w=p[x],C[0]=v[2*s],C[1]=v[2*s+1],D[0]=v[2*t],D[1]=v[2*t+1],E[0]=v[2*u],E[1]=v[2*u+1];var z=c.getUVDecodeMat(x);z&&(Human.math.decompressUV(C,C,z),Human.math.decompressUV(D,D,z),Human.math.decompressUV(E,E,z)),w[2*q]=C[0],w[2*q+1]=C[1],w[2*q+2]=D[0],w[2*q+3]=D[1],w[2*q+4]=E[0],w[2*q+5]=E[1]}w=p[x],w[2*q]=-1,w[2*q+1]=-1,w[2*q+2]=-1,w[2*q+3]=-1,w[2*q+4]=-1,w[2*q+5]=-1}}l[b]={triangleUVs:{},patches:{},bb:{min:vec2.fromValues(1/0,1/0),max:vec2.fromValues(-(1/0),-(1/0))}};var A=0;g&&(A=g.length),a.attachDrawTexture({type:"texture",applyFrom:"uv"+A,applyTo:"color",blendMode:"conditionalAlpha",drawTexture:!0});var B=b+"-draw-mesh";Human.assets.geometries.createGeometry(B,{geometry:d}),a.setGeometry(B)}var f="---",g=Human.renderer.draw={initalized:!1,erase:!1,brushRadius:20,brushColor:vec3.fromValues(1,0,0),brushColorCSS:null},h=null,i=null,j=null,k=null,l={},m=!1,n=vec3.create(),o=0,p={},q=0,r=0,s=-1,t=-1;g.init=function(){this.initalized||(i=Human.renderer.getScene(),j=document.createElement("canvas"),k=j.getContext("2d"),h=new GrowingPacker,this.initalized=!0,this.setBrushColor(this.brushColor[0],this.brushColor[1],this.brushColor[2]),this.updateCanvas())},g.setBrushColor=function(a,b,c){this.brushColor[0]=a,this.brushColor[1]=b,this.brushColor[2]=c,this.brushColorCSS=Human.utils.floatRGBToHexString(a,b,c)},g.beginStroke=function(c,d){a(),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.arc(c,d,this.brushRadius,0,2*Math.PI,!1),Human.renderer.canvas.context2D.fill(),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.moveTo(c,d),b(c,d),s=c,t=d},g.strokeTo=function(a,c){Human.renderer.canvas.context2D.lineTo(a,c),Human.renderer.canvas.context2D.stroke();var d=2*this.brushRadius,e=a-s,f=c-t,g=Math.sqrt(e*e+f*f);if(g>d)for(var h=Math.floor(g/d),i=d*(e/g),j=d*(f/g),k=1;h>=k;++k){var l=s+k*i,m=t+k*j;b(l,m)}b(a,c),s=a,t=c},g.record=function(){m&&(c(),++o);for(var a in l){var b=l[a];b.bb.min[0]=b.bb.min[1]=1/0,b.bb.max[0]=b.bb.max[1]=-(1/0)}p={},Human.renderer.canvas.context2D.clearRect(0,0,q,r),k.clearRect(0,0,q,r),m=!1},g.updateCanvas=function(){if(this.initalized){var a=Human.renderer.canvas;j.width=q=a.width,j.height=r=a.height}};var u=vec4.create(),v=vec3.create(),w=vec3.create(),x=vec3.create(),y=mat4.create(),z=vec3.create(),A=[],B=[],C=vec2.create(),D=vec2.create(),E=vec2.create()}(),function(){"use strict";Human.renderer.camera.CurvePath=function(){var a,b,c=[],d=0,e=vec3.create(),f=Human.math.bezier;this.init=function(g){c=[],d=0,a=g.length,b=a-1,2>a&&Human.log.error("curvePath init no enough points");var h=vec3.create(),i=vec3.create();vec3.subtract(e,g[0],g[1]),vec3.scale(e,e,.25),vec3.add(h,g[0],e),vec3.subtract(e,g[a-1],g[a-2]),vec3.scale(e,e,.25),vec3.add(i,g[a-1],e);var j,k,l,m,n,o,p,q=vec3.create(),r=vec3.create();for(j=1;a>j;++j)l=g[j-1],m=g[j],o=l,p=m,1>=j?vec3.subtract(e,l,h):(k=g[j-2],vec3.subtract(e,m,k),vec3.scale(e,e,.25)),vec3.add(q,o,e),j>=a-1?vec3.subtract(e,i,m):(n=g[j+1],vec3.subtract(e,n,l),vec3.scale(e,e,.25)),vec3.subtract(r,p,e),c.push(new f(o[0],o[1],o[2],q[0],q[1],q[2],r[0],r[1],r[2],p[0],p[1],p[2]));for(j=0;b>j;++j)d+=c[j].length()},this.getPosition=function(a){var b=this.getParameter(a);return{position:c[b.i].compute(b.t01),i:b.i,t01:b.t01}},this.getParameter=function(b){var c,d;return d=b*(a-1),d=Human.math.clamp(d,0,a-1),c=Math.floor(d),c>=a-1&&(c-=1),d-=c,{i:c,t01:d}},this.getPathLength=function(){return d}}}(),function(){"use strict";function a(a,b){Human.renderer.camera.lock=!0,b&&g.push(b),a=a||{},h=new Human.renderer.camera.fly.CurvePathAnimation({eyeCurvePath:a.eyeCurvePath,lookCurvePath:a.lookCurvePath,upVecs:a.upVecs,velocity:a.velocity,constrainUp:a.constrainUp,easeIn:a.easeIn,easeOut:a.easeOut,onComplete:c}),h.update(Date.now())}function b(a,b){Human.renderer.camera.lock=!0,b&&g.push(b),a=a||{},h=new Human.renderer.camera.fly.Animation({animationDuration:a.animationDuration,velocity:a.velocity,target:a.target,arc:a.arc,backOff:a.backOff,constrainUp:a.constrainUp,onComplete:c,cylindricalView:a.cylindricalView,easeIn:a.easeIn,easeOut:a.easeOut}),h.update(Date.now())}function c(){for(h=null;g.length>0;)g.pop()();Human.renderer.camera.lock=!1}function d(a){var b=a.backOff||0;0>b?b=0:b>1&&(b=1),b=1-b;var c=Human.math.vec3ObjToArray(Human.renderer.camera.look),d=Human.math.vec3ObjToArray(Human.renderer.camera.eye),e=vec3.create();vec3.subtract(e,d,c),vec3.normalize(e,e);var f=a.boundary,g=Human.math.getBoundaryCenter(f),h=a.stopFOV,i=vec3.length(e),j=Human.math.getBoundaryDiag(f),k=Math.abs(j/(1+.8*b)/Math.tan(h/2)),l=k/i;return vec3.scale(e,e,l),vec3.add(e,g,e),{target:{eye:{x:e[0],y:e[1],z:e[2]},look:{x:g[0],y:g[1],z:g[2]},up:{x:0,y:1,z:0}}}}var e=Human.renderer.camera.fly={};e.flyTimeScale=1,e.velocity=1,e.cylindricalArcScale=1,e.cylindricalView=!1,e.cylindricalOnly=!1,e.cylindricalRotationLerpMin=Math.PI/6,e.cylindricalRotationLerpMax=Math.PI/2,e.cylindricalRadiusLerpMin=.2,e.cylindricalRadiusLerpMax=1;var f=55,g=[],h=null,i=new Human.renderer.camera.CurvePath,j=new Human.renderer.camera.CurvePath;e.onFrame=function(){h&&h.update(Date.now())},e.cancelAnimation=function(){h&&(c(),h=null)},e.flyAlongCurvePath=function(b,c,d){c=c||function(){},d=d||function(a){Human.log.error("Human.renderer.camera.fly.flyAlongCurvePath",a),c()},b||(d("params must be defined"),c());var e,f,g=void 0!==b.velocity?b.velocity:1,h=[],k=[],l=[];for(e=0,f=b.points.length;f>e;++e)h.push(Human.math.vec3ObjToArray(b.points[e].eye||b.points[e].position)),k.push(Human.math.vec3ObjToArray(b.points[e].look||b.points[e].target)),l.push(Human.math.vec3ObjToArray(b.points[e].up));i.init(h),j.init(k),a({eyeCurvePath:i,lookCurvePath:j,upVecs:l,velocity:g,constrainUp:b.constrainUp,easeIn:b.easeIn,easeOut:b.easeOut},c)},e.flyTo=function(a,c,d){var e,f,g;if(c=c||function(){},d=d||function(a){Human.log.error("Human.renderer.camera.fly",a),c()},a.objectId){if(g=a.objectId,e=Human.scene.objects[g],!e)return void d("No scene object found for the given ID: '"+g+"'");f=e.getBoundary(),f?b({target:{boundary:f},arc:a.arc,backOff:a.backOff,cylindricalView:a.cylindricalView,animationDuration:a.animationDuration,velocity:a.velocity,easeIn:a.easeIn,easeOut:a.easeOut},c):c()}else a.boundary?(f=a.boundary,b({target:{boundary:f},arc:a.arc,backOff:a.backOff,cylindricalView:a.cylindricalView,animationDuration:a.animationDuration,velocity:a.velocity,easeIn:a.easeIn,easeOut:a.easeOut},c)):a.eye||a.look?b({target:{eye:a.eye,look:a.look,up:a.up},arc:a.arc,backOff:a.backOff,animationDuration:a.animationDuration,velocity:a.velocity,constrainUp:!1,cylindricalView:a.cylindricalView,easeIn:a.easeIn,easeOut:a.easeOut},c):b({target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},arc:a.arc,backOff:a.backOff,cylindricalView:a.cylindricalView,animationDuration:a.animationDuration,velocity:a.velocity,easeIn:a.easeIn,easeOut:a.easeOut},c)},e.jumpTo=function(a,b,e){var g,h,i;b=b||function(){},e=e||function(a){Human.log.error("Human.renderer.camera.fly",a),b()};var j;if(a.objectId){if(i=a.objectId,g=Human.scene.objects[i],!g)return void e("No scene object found for the given ID: '"+i+"'");h=g.getBoundary(),h&&(j={target:{boundary:h},backOff:a.backOff})}else if(a.boundary)j=d(a);else if(a.eye||a.look){if(!a.eye&&!a.look)return void e("incomplete parameter configuration: both 'eye' and 'look' expected");j={target:{eye:a.eye,look:a.look,up:a.up}}}else j={target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},backOff:a.backOff};j&&(c(),j.target.boundary?(j.target.stopFOV=f||j.target.stopFOV,Human.renderer.camera.fly.jumpTo(j.target)):Human.renderer.camera.setLookAt(j.target)),b()},e.cancel=c}(),function(){"use strict";function a(a,b){var c=Human.renderer.camera.fly,d=Human.math.clamp((a-c.cylindricalRotationLerpMin)/(c.cylindricalRotationLerpMax-c.cylindricalRotationLerpMin),0,1),e=Human.math.clamp((b-c.cylindricalRadiusLerpMin)/(c.cylindricalRadiusLerpMax-c.cylindricalRadiusLerpMin),0,1);return Math.min(d,e)}var b=55,c=vec3.create(),d=vec3.create(),e=vec3.create();Human.renderer.camera.fly.Animation=function(f){var g=f.target,h=void 0!==f.cylindricalView?f.cylindricalView:Human.renderer.camera.fly.cylindricalView;if(this.arc=h?void 0===f.arc?1:f.arc:0,this.scaleArc=void 0===f.scaleArc?Human.renderer.camera.fly.cylindricalArcScale:f.scaleArc,this.easeIn=!!f.easeIn,this.easeOut=f.easeOut!==!1,this.constrainUp=void 0===f.constrainUp?!1:f.constrainUp,!g)return Human.log.error("Human.renderer.camera.fly.Animation config missing: target"),void(f.onComplete&&f.onComplete());var i=Human.renderer.camera;this._look1=Human.math.vec3ObjToArray(i.look),this._eye1=Human.math.vec3ObjToArray(i.eye),this._up1=Human.math.vec3ObjToArray(i.up),vec3.subtract(c,this._eye1,this._look1),this._vec=vec3.create(),vec3.normalize(this._vec,c);var j=f.backOff||0;if(0>j?j=0:j>1&&(j=1),j=1-j,g.boundary){var k=g.boundary,l=g.dist||2.5,m=Math.abs(vec3.length(this._vec)),n=Human.math.getBoundaryDiag(k),o=Math.abs(n/(1+.8*j)/Math.tan(b/2)),p=o/m*l;this._look2=Human.math.getBoundaryCenter(k),g.offset&&(this._look2[0]+=g.offset[0],this._look2[1]+=g.offset[1],this._look2[2]+=g.offset[2]);var q=Human.renderer.camera.fly.cylindricalOnly;if(h){this.arc=1,Human.math.cartesianToCylindrical(this._look1,d),Human.math.cartesianToCylindrical(this._look2,e);var r=Human.math.getShortRotation(d[1],e[1]),s=e[0],t=a(Math.abs(r),s);q?(e[0]=e[0]+p,this._eye2=Human.math.cylindricalToCartesian(e)):(e[0]=p,e[2]=0,this._eye2=Human.math.cylindricalToCartesian(e),vec3.scale(c,this._vec,p),Human.math.lerpVec3(t,0,1,c,this._eye2,c),vec3.normalize(c,c),vec3.scale(c,c,p),vec3.add(this._eye2,this._look2,c))}else vec3.scale(c,this._vec,p),this._eye2=vec3.add(vec3.create(),this._look2,c);this._up2=vec3.create(),this.constrainUp?(this._up2[0]=i.up.x,this._up2[1]=i.up.y,this._up2[2]=i.up.z):g.up?(this._up2[0]=g.up.x||0,this._up2[1]=g.up.y||0,this._up2[2]=g.up.z||0):this._up2[1]=1}else{var u=g.look,v=g.eye,w=g.up,x=Human.renderer.camera.eye,y=Human.renderer.camera.look,z=Human.renderer.camera.up;this._look2=vec3.create(),this._eye2=vec3.create(),this._up2=vec3.create(),u?(this._look2[0]=u.x||0,this._look2[1]=u.y||0,this._look2[2]=u.z||0):(this._look2[0]=y.x,this._look2[1]=y.y,this._look2[2]=y.z),v?(this._eye2[0]=v.x||0,this._eye2[1]=v.y||0,this._eye2[2]=v.z||0):(this._eye2[0]=x.x,this._eye2[1]=x.y,this._eye2[2]=x.z),w&&!this.constrainUp?(this._up2[0]=w.x||0,this._up2[1]=w.y||0,this._up2[2]=w.z||0):(this._up2[0]=z.x,this._up2[1]=z.y,this._up2[2]=z.z)}vec3.subtract(c,this._look2,this._look1);var A=Math.abs(vec3.length(c));vec3.subtract(c,this._eye2,this._eye1);var B=Math.abs(vec3.length(c));if(this.arc>0){Human.math.cartesianToCylindrical(this._eye1,d),Human.math.cartesianToCylindrical(this._eye2,e);var C=Human.math.getShortRotation(d[1],e[1]),D=(d[0]+e[0])*Math.abs(C),E=e[2]-d[1],F=Math.sqrt(D*D+E*E);B=(1-this.arc)*B+this.arc*F}this._dist=A>B?A:B,this._animationDuration=f.animationDuration?1e3*f.animationDuration:1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(f.velocity||Human.renderer.camera.fly.velocity))+1),this._onComplete=f.onComplete};var f=vec3.create(),g=vec3.create();Human.renderer.camera.fly.Animation.prototype.update=function(a){if(void 0===this._time1&&(this._time1=a,this._time2=this._time1+this._animationDuration),this._done||a>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var b,h=(a-this._time1)/this._animationDuration;if(b=this.easeIn&&this.easeOut?Human.math.easeInOut(h,0,1,1):this.easeIn?Human.math.easeIn(h,0,1,1):this.easeOut?Human.math.easeOut(h,0,1,1):h,Human.math.lerpVec3(b,0,1,this._look1,this._look2,g),this.arc>0){if(Human.math.lerpVec3Cylindrical(b,0,1,d,e,c),1!==this.scaleArc){var i=c[0],j=this.scaleArc*i;i=.5>b?Human.math.lerpScalar(b,0,.5,i,j):Human.math.lerpScalar(b,.5,1,j,i),c[0]=i}Human.math.cylindricalToCartesian(c,f),this.arc<1&&(Human.math.lerpVec3(b,0,1,this._eye1,this._eye2,c),Human.math.lerpVec3(this.arc,0,1,c,f,f))}else Human.math.lerpVec3(b,0,1,this._eye1,this._eye2,f);if(this.constrainUp)Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(g),eye:Human.math.vec3ArrayToObj(f)});else{var k=Human.math.lerpVec3(b,0,1,this._up1,this._up2,[]);Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(g),eye:Human.math.vec3ArrayToObj(f),up:Human.math.vec3ArrayToObj(k)})}},Human.renderer.camera.fly.Animation.prototype.stop=function(){}}(),function(){"use strict";var a=1,b=vec3.create();Human.properties.subscribe({propId:"camera.flyCurvePath",value:{velocity:1},callback:function(b){a=b.velocity||1}}),Human.renderer.camera.fly.CurvePathAnimation=function(b){this.easeIn=!!b.easeIn,this.easeOut=b.easeOut!==!1,this.constrainUp=void 0===b.constrainUp?!1:b.constrainUp,this._eyeCurvePath=b.eyeCurvePath,this._lookCurvePath=b.lookCurvePath,this._upVecs=b.upVecs;var c=Human.renderer.camera,d=1,e=this._lookCurvePath.getParameter(d),f=e.i;this._look2=Human.math.vec3ObjToArray(this._lookCurvePath.getPosition(d).position),this._eye2=Human.math.vec3ObjToArray(this._eyeCurvePath.getPosition(d).position),this._up2=this.constrainUp?Human.math.vec3ObjToArray(c.up):this._upVecs[f+1];var g=this._eyeCurvePath.getPathLength(),h=this._lookCurvePath.getPathLength();this._dist=Math.max(g,h),this._duration=1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(b.velocity||a))+1),this._onComplete=b.onComplete},Human.renderer.camera.fly.CurvePathAnimation.prototype.update=function(a){if(void 0===this._time1&&(this._time1=a,this._time2=this._time1+this._duration),this._done||a>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var c,d=(a-this._time1)/this._duration;c=this.easeIn&&this.easeOut?Human.math.easeInOut(d,0,1,1):this.easeIn?Human.math.easeIn(d,0,1,1):this.easeOut?Human.math.easeOut(d,0,1,1):d;var e=this._lookCurvePath.getPosition(c).position,f=this._eyeCurvePath.getPosition(c).position;if(this.constrainUp)Human.renderer.camera.setLookAt({look:e,eye:f});else{var g=this._lookCurvePath.getParameter(c);Human.math.lerpVec3(g.t01,0,1,this._upVecs[g.i],this._upVecs[g.i+1],b),Human.renderer.camera.setLookAt({look:e,eye:f,up:Human.math.vec3ArrayToObj(b)})}}}(),function(){"use strict";var a=90,b=130,c=.1,d=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uFocusStart;","uniform float uFocusEnd;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform sampler2D uDepth;","uniform vec2 uTexelOffset;","uniform vec2 uDepthRange;","void main() {","float ndc = 2.0 * texture2D(uDepth, vUV).r - 1.0;","float depth = -(2.0 * uDepthRange.y * uDepthRange.x) / (ndc * (uDepthRange.y - uDepthRange.x) - uDepthRange.y - uDepthRange.x);","float deltaDepth = max(depth - uFocusEnd, 0.0) + max(uFocusStart - depth, 0.0);","vec4 color = vec4(0.0);","if (ndc < 1.0 && deltaDepth > 0.0) {","float blurRadius = min(floor(uBlurCoefficient * deltaDepth), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),e={type:"dof",id:"dofHorizontal",uniforms:{uFocusStart:a,uFocusEnd:b,uBlurCoefficient:c,uTexelOffset:new Float32Array([1/window.innerWidth,0]),uDepthRange:new Float32Array([.1,1e4])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},f={type:"dof",id:"dofVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},g=Human.renderer.postprocess.effects.dof={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,focusStart:a,focusEnd:b,blurCoefficient:c};g.init=function(a){this.scene=a,this.supported&&a.createPostProcessType("dof",d)},g.addStage=function(a){if(this.supported){var b=a.getIOFramebuffers("final");e.uniforms.uFocusStart=this.focusStart,e.uniforms.uFocusEnd=this.focusEnd,e.uniforms.uBlurCoefficient=this.blurCoefficient,e.uniforms.uDepthRange[0]=Human.renderer.camera.near,e.uniforms.uDepthRange[1]=Human.renderer.camera.far,e.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,e.textures.uTexture.framebuffer=b.read,e.framebuffer=b.write,b=a.getIOFramebuffers("final"),f.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,f.textures.uTexture.framebuffer=b.read,f.framebuffer=b.write,a.finalPipeline.push(e),a.finalPipeline.push(f)}},g.setFocusStart=function(a){this.focusStart=e.uniforms.uFocusStart=a;var b=this.scene.getPostProcessStage("dofHorizontal");b&&b.setUniform("uFocusStart",this.focusStart)},g.setFocusEnd=function(a){this.focusEnd=e.uniforms.uFocusEnd=a;var b=this.scene.getPostProcessStage("dofHorizontal");b&&b.setUniform("uFocusEnd",this.focusEnd)},g.setBlurCoefficient=function(a){this.blurCoefficient=e.uniforms.uBlurCoefficient=a;var b=this.scene.getPostProcessStage("dofHorizontal");b&&b.setUniform("uBlurCoefficient",this.blurCoefficient)},g.configure=function(d){d=d||{},d.focusStart=void 0===d.focusStart?a:d.focusStart,d.focusEnd=void 0===d.focusEnd?b:d.focusEnd,d.blur=void 0===d.blur?c:d.blur,this.setFocusStart(d.focusStart),this.setFocusEnd(d.focusEnd),this.setBlurCoefficient(d.blur)},g.updateProjection=function(){e.uniforms.uDepthRange[0]=Human.renderer.camera.near,e.uniforms.uDepthRange[1]=Human.renderer.camera.far;var a=this.scene.getPostProcessStage("dofHorizontal");a&&a.setUniform("uDepthRange",e.uniforms.uDepthRange)},g.updateCanvas=function(){var a=Human.renderer.canvas;e.uniforms.uTexelOffset[0]=1/a.width,f.uniforms.uTexelOffset[1]=1/a.height;var b=this.scene.getPostProcessStage("dofHorizontal"),c=this.scene.getPostProcessStage("dofVertical");b&&c&&(b.setUniform("uTexelOffset",e.uniforms.uTexelOffset),c.setUniform("uTexelOffset",f.uniforms.uTexelOffset))}}(),function(){"use strict";var a=.1,b=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","void main() {","vec4 color = vec4(0.0);","float blurRadius = min(floor(uBlurCoefficient * 100.0), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","gl_FragColor = color;","}"].join("\n"),c={type:"blur",id:"blurHorizontal",uniforms:{uBlurCoefficient:a,uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},d={type:"blur",id:"blurVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},e=Human.renderer.postprocess.effects.blur={scene:null,blurCoefficient:a};e.init=function(a){this.scene=a,a.createPostProcessType("blur",b)},e.addStage=function(a){var b=a.getIOFramebuffers("final");c.uniforms.uBlurCoefficient=this.blurCoefficient,c.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,c.textures.uTexture.framebuffer=b.read,c.framebuffer=b.write,b=a.getIOFramebuffers("final"),d.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,d.textures.uTexture.framebuffer=b.read,d.framebuffer=b.write,a.finalPipeline.push(c),a.finalPipeline.push(d)},e.setBlurCoefficient=function(a){this.blurCoefficient=c.uniforms.uBlurCoefficient=a;var b=this.scene.getPostProcessStage("blurHorizontal");b&&b.setUniform("uBlurCoefficient",this.blurCoefficient)},e.configure=function(b){b=b||{},b.blur=void 0===b.blur?a:b.blur,this.setBlurCoefficient(b.blur)},e.updateCanvas=function(){var a=Human.renderer.canvas,b=this.scene.getPostProcessStage("blurHorizontal"),e=this.scene.getPostProcessStage("blurVertical");b&&e&&(c.uniforms.uTexelOffset[0]=1/a.width,d.uniforms.uTexelOffset[1]=1/a.height,b.setUniform("uTexelOffset",c.uniforms.uTexelOffset),e.setUniform("uTexelOffset",d.uniforms.uTexelOffset))}}(),function(){"use strict";var a=.2,b=new Float32Array([0,0]),c=.1,d=new Float32Array(4),e=new Float32Array(3),f=new Float32Array(3),g=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform sampler2D uTexture;","uniform vec4 uBlurParams;","uniform vec3 uTexelParams;","void main() {","vec2 center = uBlurParams.xy;","float radius = uBlurParams.z;","float blurCoefficient = uBlurParams.w;","vec2 texelOffset = uTexelParams.xy;","float aspect = uTexelParams.z;","vec2 pos = vUV * 2.0 - 1.0;","pos.x *= aspect;","float r = length(pos - center);","float deltaR = max(r - radius, 0.0);","vec4 color = vec4(0.0);","if (deltaR > 0.0) {","float blurRadius = min(floor(blurCoefficient * 100.0 * deltaR), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * texelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),h={type:"radialBlur",id:"radialBlurHorizontal",uniforms:{uBlurParams:d,uTexelParams:e},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},i={type:"radialBlur",id:"radialBlurVertical",uniforms:{uTexelParams:f},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},j=Human.renderer.postprocess.effects.radialBlur={scene:null,radius:a,center:new Float32Array(b),blurCoefficient:c};j.init=function(a){this.scene=a,a.createPostProcessType("radialBlur",g)},j.addStage=function(a){var b=a.getIOFramebuffers("final");d.set(this.center),d[2]=this.radius,d[3]=this.blurCoefficient;var c=Human.renderer.canvas.width/Human.renderer.canvas.height;e[0]=c/Human.renderer.canvas.width,e[2]=c,f[1]=1/Human.renderer.canvas.height,f[2]=c,h.textures.uTexture.framebuffer=b.read,h.framebuffer=b.write,b=a.getIOFramebuffers("final"),i.textures.uTexture.framebuffer=b.read,i.framebuffer=b.write,a.finalPipeline.push(h),a.finalPipeline.push(i)},j.setRadius=function(a){this.radius=d[2]=a;var b=this.scene.getPostProcessStage("radialBlurHorizontal");b&&b.setUniform("uBlurParams",d)},j.setCenter=function(a,b){this.center[0]=a,this.center[1]=b,d.set(this.center);var c=this.scene.getPostProcessStage("radialBlurHorizontal");c&&c.setUniform("uBlurParams",d)},j.setBlurCoefficient=function(a){this.blurCoefficient=d[3]=a;var b=this.scene.getPostProcessStage("radialBlurHorizontal");b&&b.setUniform("uBlurParams",d)},j.configure=function(d){d=d||{},d.radius=void 0===d.radius?a:d.radius,d.center=void 0===d.center?b:d.center,d.blur=void 0===d.blur?c:d.blur,this.setRadius(d.radius),this.setCenter(d.center[0],d.center[1]),this.setBlurCoefficient(d.blur)},j.updateCanvas=function(){var a=Human.renderer.canvas,b=a.width/a.height;e[0]=b/a.width,e[2]=b,f[1]=1/a.height,f[2]=b;var c=this.scene.getPostProcessStage("radialBlurHorizontal"),d=this.scene.getPostProcessStage("radialBlurVertical");c&&d&&(c.setUniform("uTexelParams",e),d.setUniform("uTexelParams",f))}}(),function(){"use strict";var a=2.2,b=!1,c=["precision highp float;","varying vec2 vUV;","uniform float uGamma;","uniform bool uToneMap;","uniform sampler2D uTexture;","vec3 toneMapReinhard(vec3 color) {","    return color / (color + 1.0);","}","void main() {","   vec4 color = texture2D(uTexture, vUV);","   if (uToneMap) {","       color.rgb = toneMapReinhard(color.rgb);","   }","   color.rgb = pow(color.rgb, vec3(1.0 / uGamma));","   gl_FragColor = color;","}"].join("\n"),d={type:"gammaCorrect",id:"gammaCorrect",uniforms:{uGamma:a,uToneMap:b},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},e=Human.renderer.postprocess.effects.gammaCorrect={scene:null,gamma:a,toneMap:b};e.init=function(a){this.scene=a,a.createPostProcessType("gammaCorrect",c)},e.addStage=function(a){var b=a.getIOFramebuffers("final");d.uniforms.uGamma=this.gamma,d.uniforms.uToneMap=this.toneMap,d.textures.uTexture.framebuffer=b.read,d.framebuffer=b.write,a.finalPipeline.push(d)},e.setGamma=function(a){this.gamma=d.uniforms.uGamma=a;var b=this.scene.getPostProcessStage("gammaCorrect");

b&&b.setUniform("uGamma",this.gamma)},e.setToneMap=function(a){this.toneMap=d.uniforms.uToneMap=a;var b=this.scene.getPostProcessStage("gammaCorrect");b&&b.setUniform("uToneMap",this.toneMap)},e.configure=function(c){c=c||{},c.gamma=void 0===c.gamma?a:c.gamma,c.toneMap=void 0===c.toneMap?b:c.toneMap,this.setGamma(c.gamma),this.setToneMap(c.toneMap)}}(),function(){"use strict";var a=["precision highp float;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","varying vec2 vUV;","const float fxaaQualitySubpix = 0.75;","const float fxaaQualityEdgeThreshold = 0.125;","const float fxaaQualityEdgeThresholdMin = 0.0;","#define FXAA_QUALITY_PRESET 25","#if (FXAA_QUALITY_PRESET == 10)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 3.0","#define FXAA_QUALITY_P2 12.0","#endif","#if (FXAA_QUALITY_PRESET == 11)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 3.0","#define FXAA_QUALITY_P3 12.0","#endif","#if (FXAA_QUALITY_PRESET == 12)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 4.0","#define FXAA_QUALITY_P4 12.0","#endif","#if (FXAA_QUALITY_PRESET == 13)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 4.0","#define FXAA_QUALITY_P5 12.0","#endif","#if (FXAA_QUALITY_PRESET == 14)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 4.0","#define FXAA_QUALITY_P6 12.0","#endif","#if (FXAA_QUALITY_PRESET == 15)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 12.0","#endif","#if (FXAA_QUALITY_PRESET == 20)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 2.0","#define FXAA_QUALITY_P2 8.0","#endif","#if (FXAA_QUALITY_PRESET == 21)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 8.0","#endif","#if (FXAA_QUALITY_PRESET == 22)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 8.0","#endif","#if (FXAA_QUALITY_PRESET == 23)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 8.0","#endif","#if (FXAA_QUALITY_PRESET == 24)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 3.0","#define FXAA_QUALITY_P6 8.0","#endif","#if (FXAA_QUALITY_PRESET == 25)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 8.0","#endif","#if (FXAA_QUALITY_PRESET == 26)","#define FXAA_QUALITY_PS 9","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 4.0","#define FXAA_QUALITY_P8 8.0","#endif","#if (FXAA_QUALITY_PRESET == 27)","#define FXAA_QUALITY_PS 10","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 4.0","#define FXAA_QUALITY_P9 8.0","#endif","#if (FXAA_QUALITY_PRESET == 28)","#define FXAA_QUALITY_PS 11","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 4.0","#define FXAA_QUALITY_P10 8.0","#endif","#if (FXAA_QUALITY_PRESET == 29)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#if (FXAA_QUALITY_PRESET == 39)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.0","#define FXAA_QUALITY_P2 1.0","#define FXAA_QUALITY_P3 1.0","#define FXAA_QUALITY_P4 1.0","#define FXAA_QUALITY_P5 1.5","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#define FxaaBool bool","#define FxaaFloat float","#define FxaaFloat2 vec2","#define FxaaFloat3 vec3","#define FxaaFloat4 vec4","#define FxaaHalf float","#define FxaaHalf2 vec2","#define FxaaHalf3 vec3","#define FxaaHalf4 vec4","#define FxaaInt2 vec2","#define FxaaTex sampler2D","#define FxaaSat(x) clamp(x, 0.0, 1.0)","#define FxaaTexTop(t, p) texture2D(t, p)","#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))","FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","FxaaFloat4 FxaaPixelShader(","FxaaFloat2 pos,","FxaaTex tex,","FxaaFloat2 fxaaQualityRcpFrame,","FxaaFloat fxaaQualitySubpix,","FxaaFloat fxaaQualityEdgeThreshold,","FxaaFloat fxaaQualityEdgeThresholdMin",") {","FxaaFloat2 posM;","posM.x = pos.x;","posM.y = pos.y;","FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","#define lumaM rgbyM.y","FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat maxSM = max(lumaS, lumaM);","FxaaFloat minSM = min(lumaS, lumaM);","FxaaFloat maxESM = max(lumaE, maxSM);","FxaaFloat minESM = min(lumaE, minSM);","FxaaFloat maxWN = max(lumaN, lumaW);","FxaaFloat minWN = min(lumaN, lumaW);","FxaaFloat rangeMax = max(maxWN, maxESM);","FxaaFloat rangeMin = min(minWN, minESM);","FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","FxaaFloat range = rangeMax - rangeMin;","FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","FxaaBool earlyExit = range < rangeMaxClamped;","if(earlyExit)","return rgbyM;","FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNS = lumaN + lumaS;","FxaaFloat lumaWE = lumaW + lumaE;","FxaaFloat subpixRcpRange = 1.0/range;","FxaaFloat subpixNSWE = lumaNS + lumaWE;","FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","FxaaFloat lumaNESE = lumaNE + lumaSE;","FxaaFloat lumaNWNE = lumaNW + lumaNE;","FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","FxaaFloat lumaNWSW = lumaNW + lumaSW;","FxaaFloat lumaSWSE = lumaSW + lumaSE;","FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","FxaaBool horzSpan = edgeHorz >= edgeVert;","FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","if(!horzSpan) lumaN = lumaW;","if(!horzSpan) lumaS = lumaE;","if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","FxaaFloat gradientN = lumaN - lumaM;","FxaaFloat gradientS = lumaS - lumaM;","FxaaFloat lumaNN = lumaN + lumaM;","FxaaFloat lumaSS = lumaS + lumaM;","FxaaBool pairN = abs(gradientN) >= abs(gradientS);","FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","if(pairN) lengthSign = -lengthSign;","FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","FxaaFloat2 posB;","posB.x = posM.x;","posB.y = posM.y;","FxaaFloat2 offNP;","offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","if(!horzSpan) posB.x += lengthSign * 0.5;","if( horzSpan) posB.y += lengthSign * 0.5;","FxaaFloat2 posN;","posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","FxaaFloat2 posP;","posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","FxaaFloat subpixE = subpixC * subpixC;","FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","if(!pairN) lumaNN = lumaSS;","FxaaFloat gradientScaled = gradient * 1.0/4.0;","FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","FxaaFloat subpixF = subpixD * subpixE;","FxaaBool lumaMLTZero = lumaMM < 0.0;","lumaEndN -= lumaNN * 0.5;","lumaEndP -= lumaNN * 0.5;","FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","FxaaBool doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","#if (FXAA_QUALITY_PS > 3)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","#if (FXAA_QUALITY_PS > 4)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","#if (FXAA_QUALITY_PS > 5)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","#if (FXAA_QUALITY_PS > 6)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","#if (FXAA_QUALITY_PS > 7)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","#if (FXAA_QUALITY_PS > 8)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","#if (FXAA_QUALITY_PS > 9)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","#if (FXAA_QUALITY_PS > 10)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","#if (FXAA_QUALITY_PS > 11)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","#if (FXAA_QUALITY_PS > 12)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","FxaaFloat dstN = posM.x - posN.x;","FxaaFloat dstP = posP.x - posM.x;","if(!horzSpan) dstN = posM.y - posN.y;","if(!horzSpan) dstP = posP.y - posM.y;","FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","FxaaFloat spanLength = (dstP + dstN);","FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","FxaaFloat spanLengthRcp = 1.0/spanLength;","FxaaBool directionN = dstN < dstP;","FxaaFloat dst = min(dstN, dstP);","FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","FxaaFloat subpixG = subpixF * subpixF;","FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","return FxaaTexTop(tex, posM);","}","void main() {","gl_FragColor = FxaaPixelShader(","vUV,","uTexture,","uTexelOffset,","fxaaQualitySubpix,","fxaaQualityEdgeThreshold,","fxaaQualityEdgeThresholdMin);","}"].join("\n"),b={type:"fxaa",id:"fxaa",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},c=Human.renderer.postprocess.effects.fxaa={scene:null};c.init=function(b){this.scene=b,b.createPostProcessType("fxaa",a)},c.addStage=function(a){var c=a.getIOFramebuffers("final");b.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,b.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,b.textures.uTexture.framebuffer=c.read,b.framebuffer=c.write,a.finalPipeline.push(b)},c.configure=function(){},c.updateCanvas=function(){b.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,b.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height;var a=this.scene.getPostProcessStage("fxaa");a&&a.setUniform("uTexelOffset",b.uniforms.uTexelOffset)}}(),function(){"use strict";function a(a){a.createFramebuffer("__BDS_SAO",{depthAttachment:!1})}var b=.9,c=50,d=.1,e=.9,f=.3,g=["#extension GL_OES_standard_derivatives : require","precision highp float;","#define PI2 6.283185","#define TAU (PI2 * 2.0)","#define NUM_SAMPLES 16.0","#define SAMPLE_WEIGHT (1.0 / NUM_SAMPLES)","#define EPSILON 0.0001","varying vec2 vUV;","uniform float uSampleRadius;","uniform float uIntensity;","uniform float uContrast;","uniform float uBias;","uniform vec2 uTexelOffset;","uniform vec3 uDepthParams;","uniform vec3 uXYParams;","uniform sampler2D uDepthBuffer;","vec3 getPosition(float fragDepth, vec2 uv) {","vec2 clipCoord = uv * 2.0 - 1.0;","float zView = uDepthParams.x / (fragDepth * uDepthParams.y + uDepthParams.z);","return vec3(","clipCoord.x * zView * uXYParams.x * uXYParams.y,","clipCoord.y * zView * uXYParams.y,","zView",");","}","vec2 packDepth(float viewZ) {","    float d = viewZ / -uDepthParams.z;","float temp = floor(d * 256.0);","return vec2(","    temp / 256.0,","    d * 256.0 - temp",");","}","void main() {","float fragDepth = texture2D(uDepthBuffer, vUV).x;","if (fragDepth == 1.0) { discard; }","vec3 position = getPosition(fragDepth, vUV);","vec3 normal = normalize(cross(dFdx(position), dFdy(position)));","float ssRadius = min((uXYParams.z * uSampleRadius) / (position.z + EPSILON), 32.0);","if (ssRadius < 4.0) { discard; }","float occlusion = 0.0;","for (int i = 0; i < int(NUM_SAMPLES); ++i) {","   float a = (float(i) + 0.5) * SAMPLE_WEIGHT;","   float h = ssRadius * a;","   float theta = a * TAU;","   vec2 u = vec2(cos(theta), sin(theta));","   vec2 uv = vUV + h * u * uTexelOffset;","   fragDepth = texture2D(uDepthBuffer, uv).x;","   vec3 samplePosition = getPosition(fragDepth, uv);","   vec3 dir = samplePosition - position;","   float len2 = dot(dir, dir);","   float f = max(0.0, uSampleRadius * uSampleRadius - len2);","   occlusion += f * f * f * max(0.0, dot(dir, normal) - uBias) / (len2 + EPSILON);","}","occlusion = max(0.0, occlusion * 2.0 * uIntensity * SAMPLE_WEIGHT);","vec2 odd = mod(gl_FragCoord.xy, 2.0);","if (abs(dFdx(position.z)) < 0.02) {","    occlusion -= dFdx(occlusion) * (odd.x - 0.5);","}","if (abs(dFdy(position.z)) < 0.02) {","    occlusion -= dFdy(occlusion) * (odd.y - 0.5);","}","gl_FragColor.r = occlusion;","gl_FragColor.gb = packDepth(position.z);","}"].join("\n"),h=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform vec2 uTexelOffset;","float unpackDepth(vec2 p) {","    return p.x + p.y / 256.0;","}","void main() {","float gaussian[5];","gaussian[0] = 0.153170;","gaussian[1] = 0.144893;","gaussian[2] = 0.122649;","gaussian[3] = 0.092902;","gaussian[4] = 0.062970;","vec3 centerValue = texture2D(uColorBuffer, vUV).rgb;","float totalWeight = gaussian[0];","float sum = centerValue.r * totalWeight;","float centerDepth = unpackDepth(centerValue.gb);","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * -float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","gl_FragColor.r = sum / (totalWeight + 0.0001);","}"].join("\n"),i=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform sampler2D uOcclusionBuffer;","uniform float uOcclusionScale;","uniform float uOcclusionCutoff;","void main() {","vec4 color = texture2D(uColorBuffer, vUV);","float ambient = 1.0 - smoothstep(uOcclusionCutoff, 1.0, texture2D(uOcclusionBuffer, vUV).r) * uOcclusionScale;","gl_FragColor = vec4(color.rgb * ambient, color.a);","}"].join("\n"),j={type:"sao",id:"sao",uniforms:{uSampleRadius:.4,uIntensity:8,uBias:.001,uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight]),uXYParams:new Float32Array(3),uDepthParams:new Float32Array(3)},textures:{uDepthBuffer:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"__BDS_SAO"},k={type:"saoblur",id:"saohblur",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uColorBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"---SET_ME---"},l={type:"saoblur",id:"saovblur",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"__BDS_SAO"},m={type:"saoblend",id:"saoblend",uniforms:{uOcclusionScale:e,uOcclusionCutoff:f},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"},uOcclusionBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"--SET_ME---"},n=Human.renderer.postprocess.effects.sao={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,fbInitialized:!1,sampleRadius:b,intensity:c,bias:d,scale:e};n.init=function(a){this.scene=a,this.supported&&(a.createPostProcessType("sao",g),a.createPostProcessType("saoblur",h),a.createPostProcessType("saoblend",i))},n.addStage=function(b){if(this.supported){this.fbInitialized||a(this.scene);var c=this.scene.getProjection(),d=c.aspect,e=c.fov*Math.PI/180,f=c.near,g=c.far,h=-Math.tan(.5*e),i=-Human.renderer.canvas.height/(2*Math.tan(.5*e)),n=Human.renderer.canvas.width,o=Human.renderer.canvas.height,p=b.getIOFramebuffers("opaque"),q=p.read,r=p.write;j.uniforms.uSampleRadius=this.sampleRadius,j.uniforms.uIntensity=this.intensity,j.uniforms.uBias=this.bias,j.uniforms.uTexelOffset[0]=1/n,j.uniforms.uTexelOffset[1]=1/o,j.uniforms.uXYParams[0]=d,j.uniforms.uXYParams[1]=h,j.uniforms.uXYParams[2]=i,j.uniforms.uDepthParams[0]=-f*g,j.uniforms.uDepthParams[1]=f-g,j.uniforms.uDepthParams[2]=g,k.uniforms.uTexelOffset[0]=1/n,k.uniforms.uTexelOffset[1]=0,k.framebuffer=r,l.uniforms.uTexelOffset[0]=0,l.uniforms.uTexelOffset[1]=1/o,l.textures.uColorBuffer.framebuffer=r,m.uniforms.uOcclusionScale=this.scale,m.textures.uColorBuffer.framebuffer=q,m.framebuffer=r,b.opaquePipeline.push(j),b.opaquePipeline.push(k),b.opaquePipeline.push(l),b.opaquePipeline.push(m)}},n.setSampleRadius=function(a){this.sampleRadius=j.uniforms.uSampleRadius=a;var b=this.scene.getPostProcessStage("sao");b&&b.setUniform("uSampleRadius",this.sampleRadius)},n.setIntensity=function(a){this.intensity=j.uniforms.uIntensity=a;var b=this.scene.getPostProcessStage("sao");b&&b.setUniform("uIntensity",this.intensity)},n.setBias=function(a){this.bias=j.uniforms.uBias=a;var b=this.scene.getPostProcessStage("sao");b&&b.setUniform("uBias",this.bias)},n.setOcclusionScale=function(a){this.scale=m.uniforms.uOcclusionScale=a;var b=this.scene.getPostProcessStage("saoblend");b&&b.setUniform("uOcclusionScale",this.scale)},n.setOcclusionCutoff=function(a){this.cutoff=m.uniforms.uOcclusionCutoff=a;var b=this.scene.getPostProcessStage("saoblend");b&&b.setUniform("uOcclusionCutoff",this.cutoff)},n.configure=function(a){a=a||{},a.sampleRadius=void 0===a.sampleRadius?b:a.sampleRadius,a.intensity=void 0===a.intensity?c:a.intensity,a.bias=void 0===a.bias?d:a.bias,a.scale=void 0===a.scale?e:a.scale,a.cutoff=void 0===a.cutoff?f:a.cutoff,this.setSampleRadius(a.sampleRadius),this.setIntensity(a.intensity),this.setBias(a.bias),this.setOcclusionScale(a.scale),this.setOcclusionCutoff(a.cutoff)},n.updateProjection=function(){var a=this.scene.getProjection(),b=a.aspect,c=a.fov*Math.PI/180,d=a.near,e=a.far,f=-Math.tan(.5*c),g=-Human.renderer.canvas.height/(2*Math.tan(.5*c));j.uniforms.uXYParams[0]=b,j.uniforms.uXYParams[1]=f,j.uniforms.uXYParams[2]=g,j.uniforms.uDepthParams[0]=-d*e,j.uniforms.uDepthParams[1]=d-e,j.uniforms.uDepthParams[2]=e;var h=this.scene.getPostProcessStage("sao");h&&(h.setUniform("uXYParams",j.uniforms.uXYParams),h.setUniform("uDepthParams",j.uniforms.uDepthParams))},n.updateCanvas=function(){var a=Human.renderer.canvas.width,b=Human.renderer.canvas.height,c=this.scene.getProjection(),d=c.aspect,e=c.fov*Math.PI/180,f=-Math.tan(.5*e),g=-Human.renderer.canvas.height/(2*Math.tan(.5*e));j.uniforms.uTexelOffset[0]=1/a,j.uniforms.uTexelOffset[1]=1/b,j.uniforms.uXYParams[0]=d,j.uniforms.uXYParams[1]=f,j.uniforms.uXYParams[2]=g,k.uniforms.uTexelOffset[0]=1/a,l.uniforms.uTexelOffset[1]=1/b;var h=this.scene.getPostProcessStage("sao"),i=this.scene.getPostProcessStage("saohblur"),m=this.scene.getPostProcessStage("saovblur");h&&i&&m&&(h.setUniform("uXYParams",j.uniforms.uXYParams),h.setUniform("uTexelOffset",j.uniforms.uTexelOffset),i.setUniform("uTexelOffset",k.uniforms.uTexelOffset),m.setUniform("uTexelOffset",l.uniforms.uTexelOffset))}}(),function(){"use strict";function a(b,c){var d,e,f=b.matrixDirty,g=f||c,h=g;if(f&&b.buildMatrix(),g&&(b.parent?mat4.multiply(b.worldMatrix,b.parent.worldMatrix,b.localMatrix):b.worldMatrix.set(b.localMatrix),b.matrixDirty=!1),b.isLeaf())return g?(b.compileXform(),!0):b.geoDirty?(b.compileBoundary(),b.geoDirty=!1,!0):!1;for(d=0,e=b.objects.length;e>d;++d)a(b.objects[d],g)&&(h=!0);if(h){for(b.boundary.xmin=Number.POSITIVE_INFINITY,b.boundary.ymin=Number.POSITIVE_INFINITY,b.boundary.zmin=Number.POSITIVE_INFINITY,b.boundary.xmax=Number.NEGATIVE_INFINITY,b.boundary.ymax=Number.NEGATIVE_INFINITY,b.boundary.zmax=Number.NEGATIVE_INFINITY,d=0,e=b.objects.length;e>d;++d){var i=b.objects[d].getBoundary();b.boundary.xmin=Math.min(b.boundary.xmin,i.xmin),b.boundary.ymin=Math.min(b.boundary.ymin,i.ymin),b.boundary.zmin=Math.min(b.boundary.zmin,i.zmin),b.boundary.xmax=Math.max(b.boundary.xmax,i.xmax),b.boundary.ymax=Math.max(b.boundary.ymax,i.ymax),b.boundary.zmax=Math.max(b.boundary.zmax,i.zmax)}b.center[0]=.5*(b.boundary.xmin+b.boundary.xmax),b.center[1]=.5*(b.boundary.ymin+b.boundary.ymax),b.center[2]=.5*(b.boundary.zmin+b.boundary.zmax)}return h}function b(a,c,d){var g=vec3.create(),h=vec3.create(),j={objects:a,left:null,right:null,bb:{min:g,max:h}};if(0===a.length)return j;g[0]=g[1]=g[2]=Number.POSITIVE_INFINITY,h[0]=h[1]=h[2]=Number.NEGATIVE_INFINITY;var k,l,m,n;for(m=0,n=a.length;n>m;++m)k=a[m],l=k.getBoundary(),l.xmin<g[0]&&(g[0]=l.xmin),l.xmax>h[0]&&(h[0]=l.xmax),l.ymin<g[1]&&(g[1]=l.ymin),l.ymax>h[1]&&(h[1]=l.ymax),l.zmin<g[2]&&(g[2]=l.zmin),l.zmax>h[2]&&(h[2]=l.zmax);if(d>e)return j;var o=i[c],p=(g[c]+h[c])/2,q=new Array(a.length),r=0,s=new Array(a.length),t=0;for(m=0,n=a.length;n>m;++m)k=a[m],l=k.getBoundary(),l[o]<=p?q[r++]=k:s[t++]=k;return f>r||f>t?j:(q.length=r,s.length=t,j.left=b(q,(c+1)%3,d+1),j.right=b(s,(c+1)%3,d+1),j)}function c(a,b,e){var f,g,h=a.bb.min,i=a.bb.max,j=1,k=1;if(b&&(j=Human.math.intersections.planesAabb(b,h,i)),e&&(k=Human.math.intersections.planesAabb(e,h,i)),-1!==k)if(-1!==j)if(1===j&&(b=null),1===k&&(e=null),0===j||0===k)if(a.left)c(a.left,b,e),c(a.right,b,e);else for(f=0,g=a.objects.length;g>f;++f)d(a.objects[f],b,e);else for(f=0,g=a.objects.length;g>f;++f)a.objects[f].frustumCull(!1),a.objects[f].clipCull(!1);else for(f=0,g=a.objects.length;g>f;++f)a.objects[f].frustumCull(!0);else for(f=0,g=a.objects.length;g>f;++f)a.objects[f].clipCull(!0)}function d(a,b,c){var d=a.getBoundary();j[0]=d.xmin,j[1]=d.ymin,j[2]=d.zmin,k[0]=d.xmax,k[1]=d.ymax,k[2]=d.zmax;var e=1,f=1,g=!1;if(b&&(e=Human.math.intersections.planesAabb(b,j,k,l)),c){m.length=c.length,f=Human.math.intersections.planesAabb(c,j,k,m);for(var h=0,i=m.length;i>h&&void 0!==m[h];++h)if(0===m[h]&&c[h].fade){g=!0;break}}a.frustumCull(-1===e),a.clipCull(-1===f),-1!==e&&-1!==f&&(a.clipFade(g),a.setVisiblyClipped(0===e&&0===l[Human.renderer.camera.FRUSTUM_NEAR]||0===f))}var e=10,f=1,g=new Human.utils.selection.GraphMatcher,h=Human.scene={};h.rootObjects=[],h.modelObjects={},h.objects={},h.colorModPriorities={__HIGHLIGHT:Number.POSITIVE_INFINITY},h.objectsByFMAID={},h.objectsForTags={},h._kdTree=null,h.kdTreeDirty=!0,h.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},h.center=vec3.create(),h.enabledObjects={},h._leavesCache={},h.createObject=function(a){if(!a.objectId)return void Human.log.error("Scene.createObject","Param expected: objectId");if(h.objects[a.objectId])return void Human.log.error("Scene.createObject","Param: objectId already in use");var b=a.parentObjectId?h.objects[a.parentObjectId]:null,c=a.modelId;a.tags=a.tags||[];var d=b?h._inheritTags(a.tags,b):a.tags;a.modelId=c,a.parent=b,a.tags=d,b&&(a.reflectedX=b.reflectedX,a.reflectedY=b.reflectedY,a.reflectedZ=b.reflectedZ);var e;return e=a.group?new Human.scene.Group(a):new Human.scene.Object(a),h.objects[a.objectId]=e,e.fmaId&&(h.objectsByFMAID[e.fmaId]=e),b?b.objects.push(e):h.rootObjects.push(e),(h.modelObjects[c]=h.modelObjects[c]||{})[a.objectId]=e,h._registerObjectForTags(e),Human.events.fire("scene.objectCreated",{
moduleId:a.moduleId,modelId:c,objectId:e.objectId,name:e.displayName,description:e.description,displayName:e.displayName,fmaId:e.fmaId,tags:e.tags,parentObjectId:b?b.objectId:null}),void 0!==a.shown&&(e.show(a.shown),a.shown&&(h.enabledObjects[a.objectId]=e)),h._leavesCache={},e},h._inheritTags=function(a,b){var c,d,e=a||[],f=b.tags,g=[];if(e){for(var h=0,i=f.length;i>h;h++){d=f[h];for(var j=!0,k=0,l=e.length;l>k;k++)c=e[k],c===d&&(j=!1);j&&g.push(d)}return e.concat(g)}return e},h._registerObjectForTags=function(a){for(var b,c,d=a.tags,e=0,f=d.length;f>e;e++)b=d[e],c=h.objectsForTags[b],c||(c=h.objectsForTags[b]={}),c[a.objectId]=a},h._deregisterObjectForTags=function(a){for(var b,c,d=a.tags,e=0,f=d.length;f>e;e++)b=d[e],c=h.objectsForTags[b],c&&delete c[a.objectId]},h.setEnabledObjects=function(a){var b=a.objects||a.objectIds,c={},d=a.replace?!1:void 0,e=a.fetchAssets?[]:null;h.setEnabledSubtree(Human.scene.rootObjects,b,d,e,c),e&&Human.scene.graph.attachAssetSetsToSubtree(e),Human.utils.isEmpty(c)||Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:c})},h.setEnabledSubtree=function(a,b,c,d,e){for(var f=0,g=a.length;g>f;++f){var i=a[f],j=void 0!==b[i.objectId]?b[i.objectId]:c;i.isLeaf()?j===!0?h.enabledObjects[i.objectId]||(h.enabledObjects[i.objectId]=i,e[i.objectId]=!0,i.show(!0),d&&!i.isRenderable()&&d.push(i)):j===!1&&h.enabledObjects[i.objectId]&&(delete h.enabledObjects[i.objectId],e[i.objectId]=!1,i.show(!1)):h.setEnabledSubtree(i.objects,b,j,d,e)}},h.setColorModPriority=function(a,b){this.colorModPriorities[a]=b;for(var c=this.getLeaves(),d=0,e=c.length;e>d;++d)Human.scene.objects[c[d]].colorModPrioritiesDirty()},h.getLeaves=function(a){var b=h._leavesCache[a];if(!b){if(b=[],a){var c=h.objects[a];c&&h._getLeaves([c],b)}else h._getLeaves(Human.scene.rootObjects,b);h._leavesCache[a]=b}return b},h._getLeaves=function(a,b){for(var c,d=0,e=a.length;e>d;d++)c=a[d],0===c.objects.length?b.push(c.objectId):h._getLeaves(c.objects,b)},h.getEnabledLeaves=function(a){var b;if(a){var c=h.objects[a];b=[],c&&h._getEnabledLeaves([c],b)}else b=Object.keys(h.enabledObjects);return b},h._getEnabledLeaves=function(a,b){for(var c,d=0,e=a.length;e>d;d++)c=a[d],0===c.objects.length?h.enabledObjects.hasOwnProperty(c.objectId)&&b.push(c.objectId):h._getEnabledLeaves(c.objects,b)},h._getKeys=function(a,b){var c={};for(var d in a)a.hasOwnProperty(d)&&(d[d]=b);return c},h.destroyObject=function(a){var b=h.objects[a];if(b&&!b._destroyed){var c,d;for(c=0,d=h.rootObjects.length;d>c;c++)if(h.rootObjects[c].objectId===a){h.rootObjects.splice(c,1);break}delete h.objects[a],b.fmaId&&delete h.objectsByFMAID[b.fmaId],delete h.enabledObjects[a],b.parent&&b.parent._removeObject(a);var e=b.objects.slice(0);for(c=0,d=e.length;d>c;c++)h.destroyObject(e[c].objectId);b.isLeaf()&&b.destroyNodes(),delete h.modelObjects[b.modelId][b.objectId],h._deregisterObjectForTags(b),h._leavesCache={},Human.events.fire("scene.objectDestroyed",{objectId:a})}},h.getBoundary=function(a){if(!a)return this.boundary;a=a||{};var b,c,d,e;if(a.objectIds){d={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};for(var f=a.objectIds,g=0,i=f.length;i>g;g++)b=h.objects[f[g]],b&&0===b.objects.length&&(e=b.getBoundary(),e.xmin<d.xmin&&(d.xmin=e.xmin),e.ymin<d.ymin&&(d.ymin=e.ymin),e.zmin<d.zmin&&(d.zmin=e.zmin),e.xmax>d.xmax&&(d.xmax=e.xmax),e.ymax>d.ymax&&(d.ymax=e.ymax),e.zmax>d.zmax&&(d.zmax=e.zmax))}else if(a.objects){d={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};var j=a.objects;for(c in j)j[c]&&h.objects[c]&&(b=h.objects[c],0===b.objects.length&&(e=b.getBoundary(),e.xmin<d.xmin&&(d.xmin=e.xmin),e.ymin<d.ymin&&(d.ymin=e.ymin),e.zmin<d.zmin&&(d.zmin=e.zmin),e.xmax>d.xmax&&(d.xmax=e.xmax),e.ymax>d.ymax&&(d.ymax=e.ymax),e.zmax>d.zmax&&(d.zmax=e.zmax)))}else d=a.clipped?Human.utils.deepClone(this.boundary):this.boundary;if(a.clipped){var k=Human.renderer.clip.getBoundary();d.xmin=Math.max(d.xmin,k.xmin),d.xmax=Math.min(d.xmax,k.xmax),d.ymin=Math.max(d.ymin,k.ymin),d.ymax=Math.min(d.ymax,k.ymax),d.zmin=Math.max(d.zmin,k.zmin),d.zmax=Math.min(d.zmax,k.zmax)}return d},h.getKdTree=function(){if(this.kdTreeDirty){for(var a=Human.scene.rootObjects,c=[],d=function(a){a.shown&&0===a.objects.length&&c.push(a)},e=0,f=a.length;f>e;++e)a[e].traverseDown(d);this._kdTree=b(c,0,0),this.kdTreeDirty=!1}return this._kdTree},h.access=function(a){return h.getLeaves(a)},h.select=function(a){return g.match(h,a)},h.setObjectProperties=function(a){function b(b){var g=c[b.objectId]=a[b.objectId]||{};if(b.parent){var i=c[b.parent.objectId];for(var j in i)void 0!==g[j]||f[j]||(g[j]=i[j]);g.glassFactor=b.glassFactor,g.murkiness=b.murkiness}g.hasOwnProperty("shown")&&b.shown!==g.shown&&b.isLeaf()&&(d[b.objectId]=g.shown),b.isLeaf()&&(g.shown?(e[b.objectId]=b,h.enabledObjects[b.objectId]=b):delete h.enabledObjects[b.objectId],b.clearColorModifiers(),b.clearOpacityModifiers(),b.setProperties(g))}a=a||{};for(var c={},d={},e={},f={transform:!0},g=Human.scene.rootObjects,i=0,j=g.length;j>i;i++)g[i].traverseDown(b);Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:d,showSelectedObjects:h.showSelectedObjects}),Human.events.fire("scene.objectPropertiesSet",{instructions:a})},h.onFrame=function(){var b,c,d=!1;for(b=0,c=this.rootObjects.length;c>b;++b)a(this.rootObjects[b],!1)&&(d=!0);if(d){for(this.boundary.xmin=Number.POSITIVE_INFINITY,this.boundary.ymin=Number.POSITIVE_INFINITY,this.boundary.zmin=Number.POSITIVE_INFINITY,this.boundary.xmax=Number.NEGATIVE_INFINITY,this.boundary.ymax=Number.NEGATIVE_INFINITY,this.boundary.zmax=Number.NEGATIVE_INFINITY,b=0,c=this.rootObjects.length;c>b;++b){var e=this.rootObjects[b].getBoundary();this.boundary.xmin=Math.min(this.boundary.xmin,e.xmin),this.boundary.ymin=Math.min(this.boundary.ymin,e.ymin),this.boundary.zmin=Math.min(this.boundary.zmin,e.zmin),this.boundary.xmax=Math.max(this.boundary.xmax,e.xmax),this.boundary.ymax=Math.max(this.boundary.ymax,e.ymax),this.boundary.zmax=Math.max(this.boundary.zmax,e.zmax)}this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)}},h.cull=function(){c(this.getKdTree(),Human.renderer.camera.getFrustum(),Human.renderer.clip.getActiveClips())};var i=["xmin","ymin","zmin"],j=vec3.create(),k=vec3.create(),l=new Array(6),m=[]}(),function(){"use strict";Human.scene.Group=function(a){this.modelId=a.modelId,this.objectId=a.objectId,this.fmaId=a.fmaId,this.layer=a.layer,this.displayName=a.displayName,this.description=a.description,this.parent=a.parent,this.tags=a.tags,this.anonymous=a.anonymous,this.objects=[],this.reflectedX=a.reflectedX||!1,this.reflectedY=a.reflectedY||!1,this.reflectedZ=a.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=a.transformId,this.transformInitialized=!a.transformId,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,(a.pivot||a.translate||a.scale||a.rotate)&&this.setTransform(a)},Human.scene.Group.prototype.checkRenderable=function(){for(var a=0,b=this.objects.length;b>a;++a)this.objects[a].checkRenderable()},Human.scene.Group.prototype.isVisible=function(){var a=this.getLeafObjects().length;return this.getShownObjects().length===a&&this.getRenderableObjects().length===a},Human.scene.Group.prototype.isLeaf=function(){return!1},Human.scene.Group.prototype.setTransform=function(a){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),a.pivot&&(void 0!==a.pivot.x&&(this.pivot.x=a.pivot.x),void 0!==a.pivot.y&&(this.pivot.y=a.pivot.y),void 0!==a.pivot.z&&(this.pivot.z=a.pivot.z)),a.translate&&(void 0!==a.translate.x&&(this.translate.x=a.translate.x),void 0!==a.translate.y&&(this.translate.y=a.translate.y),void 0!==a.translate.z&&(this.translate.z=a.translate.z)),a.scale&&(void 0!==a.scale.x&&(this.scale.x=a.scale.x),void 0!==a.scale.y&&(this.scale.y=a.scale.y),void 0!==a.scale.z&&(this.scale.z=a.scale.z),a.scale.x<0&&this.setReflectedX(!0),a.scale.y<0&&this.setReflectedY(!0),a.scale.z<0&&this.setReflectedZ(!0)),a.rotate&&(void 0!==a.rotate.x&&(this.rotate.x=a.rotate.x),void 0!==a.rotate.y&&(this.rotate.y=a.rotate.y),void 0!==a.rotate.z&&(this.rotate.z=a.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var a=mat4.create(),b=mat4.create(),c=mat4.create(),d=mat4.create(),e=mat4.create(),f=mat4.create();Human.scene.Group.prototype.buildMatrix=function(){var g=this.pivot,h=this.translate;mat4.fromTranslation(a,[-g.x,-g.y,-g.z]);var i=this.scale;mat4.fromScaling(b,[i.x,i.y,i.z]),mat4.fromTranslation(c,[h.x+g.x,h.y+g.y,h.z+g.z]);var j=this.rotate;mat4.fromRotation(d,j.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(e,j.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(f,j.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,a,this.localMatrix),mat4.multiply(this.localMatrix,b,this.localMatrix),mat4.multiply(this.localMatrix,f,this.localMatrix),mat4.multiply(this.localMatrix,e,this.localMatrix),mat4.multiply(this.localMatrix,d,this.localMatrix),mat4.multiply(this.localMatrix,c,this.localMatrix),this.matrixDirty=!1},Human.scene.Group.prototype.reflectedTransform=function(){var a=0;return this.reflectedX&&++a,this.reflectedY&&++a,this.reflectedZ&&++a,a%2===1},Human.scene.Group.prototype.getBoundary=function(){return this.boundary},Human.scene.Group.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Group.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Group.prototype.getCenter=function(){return this.center},Human.scene.Group.prototype.setReflectedX=function(a){this.reflectedX=a;for(var b=0,c=this.objects.length;c>b;++b)this.objects[b].setReflectedX(a)},Human.scene.Group.prototype.setReflectedY=function(a){this.reflectedY=a;for(var b=0,c=this.objects.length;c>b;++b)this.objects[b].setReflectedY(a)},Human.scene.Group.prototype.setReflectedZ=function(a){this.reflectedZ=a;for(var b=0,c=this.objects.length;c>b;++b)this.objects[b].setReflectedZ(a)},Human.scene.Group.prototype._removeObject=function(a){for(var b=0,c=this.objects.length;c>b;b++)if(this.objects[b].objectId===a)return void this.objects.splice(b,1)},Human.scene.Group.prototype.isRenderable=function(){for(var a=0,b=this.objects.length;b>a;++a)if(!this.objects[a].isRenderable())return!1;return!0},Human.scene.Group.prototype.isPinnable=function(){for(var a=0,b=this.objects.length;b>a;++a)if(!this.objects[a].isPinnable())return!1;return!0},Human.scene.Group.prototype.getDefaultProperties=function(){return{shown:!1,pickable:!0,backfaces:!1,glassFactor:0,murkiness:1,opacity:1}},Human.scene.Group.prototype.traverseUp=function(a){a(this),this.parent&&this.parent.traverseUp(a)},Human.scene.Group.prototype.traverseDown=function(a){a(this);for(var b=0,c=this.objects.length;c>b;b++)this.objects[b].traverseDown(a)},Human.scene.Group.prototype.getLeafObjects=function(a){var b=[];return this.traverseDown(function(c){c.isLeaf()&&(b.push(c),a&&a(c))}),b},Human.scene.Group.prototype.getRenderableObjects=function(a){var b=[];return this.getLeafObjects(function(c){c.isRenderable()&&(b.push(c),a&&a(c))}),b},Human.scene.Group.prototype.getShownObjects=function(a){var b=[];return this.getLeafObjects(function(c){c.shown&&(b.push(c),a&&a(c))}),b}}(),function(){"use strict";function a(a,b){var c=a.constructor.name,d=a.constructor.name;return c===d?"Number"===c||"Boolean"===c?a===b:"Array"===c||"Float32Array"===c?a.reduce(function(a,c,d){return a&&c===b[d]},!0):"ScalarFresnel"===c?j.prototype.isEqual(a,b):"ColorFresnel"===c?i.prototype.isEqual(a,b):!1:!1}function b(a){var b=a.constructor.name;return"Array"===b?a.slice(0):"ColorFresnel"===b?new i(a.center,a.edge,a.centerBias,a.edgeBias,a.power):"ScalarFresnel"===b?new j(a.center,a.edge,a.centerBias,a.edgeBias,a.power):a}function c(a,b){a._propertiesNode&&(a.tintColor=b,a.setColorModifier("__TINT_COLOR",{applyTo:"tintColor",value:a.tintColor}))}function d(a){a._propertiesNode.setEnabled(a.shown&&!a.culledByFrustum&&!a.culledByClip)}function e(a){for(var b=a.renderables,c=0,d=b.length;d>c;++c)b[c].setBackfaces(a.backfaces||a.visiblyClipped)}function f(a,b){return a.priority-b.priority}function g(a){a.colorModifierList.length=0;for(var b in a.colorModifiers)a.colorModifierList.push(a.colorModifiers[b]);a.colorModifierList.sort(f),a.colorModifierConfigs.length=a.colorModifierList.length;for(var c=0,d=a.colorModifierList.length;d>c;++c)a.colorModifierConfigs[c]=a.colorModifierList[c].params}function h(a){a.opacityModifierConfigs.length=0;for(var b in a.opacityModifiers)a.opacityModifierConfigs.push(a.opacityModifiers[b])}var i=window.ColorFresnel,j=window.ScalarFresnel;Human.scene.Object=function(a){if(this.modelId=a.modelId,this.objectId=a.objectId,this.anonymous=a.anonymous,this.fmaId=a.fmaId,this.layer=a.layer,this.displayName=a.displayName,this.description=a.description,this.parent=a.parent,this.shown=!1,this.culledByFrustum=!1,this.culledByClip=!1,this.fadeByClip=!1,this.pickable=!0,this.clippable=!0,this.xray=!1,this.opacity=void 0!==a.opacity?a.opacity:1,this.glassFactor=1,this.murkiness=1,this.highlight=!1,this.tintColor=new Float32Array([1,1,1]),this.saturation=0,this.contrast=0,this.brightness=0,this.colorModifiers={},this.colorModifierList=[],this.colorModifierConfigs=[],this.opacityModifiers={},this.opacityModifierConfigs=[],this.backfaces=!1,this.visiblyClipped=!1,this.windingOrder="ccw",this.tags=a.tags,this.objects=[],this.reflectedX=a.reflectedX||!1,this.reflectedY=a.reflectedY||!1,this.reflectedZ=a.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=a.transformId,this.transformInitialized=!a.transformId,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,this._rootNode=null,this._renderableRoot=null,this.renderables=[],this.anonymousIdToRenderableIndex=a.anonymousIdToRenderableIndex||{},a.renderables){this.initRenderables();for(var b=0,c=a.renderables.length;c>b;++b)this.addRenderable(a.renderables[b])}(a.geometryId||a.morphId)&&(this.initRenderables(),this.addRenderable(a)),(a.pivot||a.translate||a.scale||a.rotate)&&this.setTransform(a),this._checkFlippedWinding(),this._propertiesNode&&this._propertiesNode.setSolidColor(a.capColor||{r:.7,g:.7,b:.7})},Human.scene.Object.prototype.initRenderables=function(){if(!this._rootNode){this._rootNode=this._transformNode=Human.renderer.graph.createSubtree({type:"xform"});var a=this.getDefaultFlags();this._xrayBackfaces=!1,a.enabled=!1,a.pickable=!0,a.solid=Human.scene.enableSolidObjects,a.layer=this.layer||0,a.name=this.objectId,a.xray=!1,a.highlight=!1,a.opacity=this.opacity,a.glassFactor=this.glassFactor,a.murkiness=this.murkiness,a.xrayEnabled=!0,this._renderableRoot=this._propertiesNode=Human.renderer.graph.insertNode(this._rootNode,{type:"properties",properties:a})}},Human.scene.Object.prototype.addRenderable=function(a){this.renderables.push(new Human.scene.Renderable(this,a))},Human.scene.Object.prototype.detachAsset=function(a){var b,c;switch(a){case"geometry":for(b=0,c=this.renderables.length;c>b;++b)this.renderables[b].detachGeometry();break;case"material":for(b=0,c=this.renderables.length;c>b;++b)this.renderables[b].detachMaterial();break;case"morph":for(b=0,c=this.renderables.length;c>b;++b)this.renderables[b].detachMorph()}},Human.scene.Object.prototype.checkRenderable=function(){this.isRenderable()&&Human.events.fire("scene.objectRenderable",{objectId:this.objectId})},Human.scene.Object.prototype.isRenderable=function(){for(var a=0,b=this.renderables.length;b>a;++a)if(!this.renderables[a].isRenderable())return!1;for(var c=this;c;){if(c.transformId&&!c.transformInitialized)return!1;c=c.parent}return!0},Human.scene.Object.prototype.isVisible=function(){return this.shown&&this.isRenderable()},Human.scene.Object.prototype.isLeaf=function(){return!0},Human.scene.Object.prototype.setTransform=function(a){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),a.pivot&&(void 0!==a.pivot.x&&(this.pivot.x=a.pivot.x),void 0!==a.pivot.y&&(this.pivot.y=a.pivot.y),void 0!==a.pivot.z&&(this.pivot.z=a.pivot.z)),a.translate&&(void 0!==a.translate.x&&(this.translate.x=a.translate.x),void 0!==a.translate.y&&(this.translate.y=a.translate.y),void 0!==a.translate.z&&(this.translate.z=a.translate.z)),a.scale&&(void 0!==a.scale.x&&(this.scale.x=a.scale.x),void 0!==a.scale.y&&(this.scale.y=a.scale.y),void 0!==a.scale.z&&(this.scale.z=a.scale.z),a.scale.x<0&&this.setReflectedX(!0),a.scale.y<0&&this.setReflectedY(!0),a.scale.z<0&&this.setReflectedZ(!0)),a.rotate&&(void 0!==a.rotate.x&&(this.rotate.x=a.rotate.x),void 0!==a.rotate.y&&(this.rotate.y=a.rotate.y),void 0!==a.rotate.z&&(this.rotate.z=a.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var k=mat4.create(),l=mat4.create(),m=mat4.create(),n=mat4.create(),o=mat4.create(),p=mat4.create();Human.scene.Object.prototype.buildMatrix=function(){var a=this.pivot,b=this.translate;mat4.fromTranslation(k,[-a.x,-a.y,-a.z]);var c=this.scale;mat4.fromScaling(l,[c.x,c.y,c.z]),mat4.fromTranslation(m,[b.x+a.x,b.y+a.y,b.z+a.z]);var d=this.rotate;mat4.fromRotation(n,d.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(o,d.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(p,d.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,k,this.localMatrix),mat4.multiply(this.localMatrix,l,this.localMatrix),mat4.multiply(this.localMatrix,p,this.localMatrix),mat4.multiply(this.localMatrix,o,this.localMatrix),mat4.multiply(this.localMatrix,n,this.localMatrix),mat4.multiply(this.localMatrix,m,this.localMatrix),this.matrixDirty=!1},Human.scene.Object.prototype.compileXform=function(){this._transformNode&&(this._transformNode.setElements(this.worldMatrix),this.compileBoundary())},Human.scene.Object.prototype.compileBoundary=function(){Human.scene.kdTreeDirty=!0,Human.renderer.camera.nearFarDirty=!0;var a=this.worldMatrix,b=this._getBoundary(a);this.boundary.xmin=b.xmin,this.boundary.ymin=b.ymin,this.boundary.zmin=b.zmin,this.boundary.xmax=b.xmax,this.boundary.ymax=b.ymax,this.boundary.zmax=b.zmax,this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)},Human.scene.Object.prototype.reflectedTransform=function(){var a=0;return this.reflectedX&&++a,this.reflectedY&&++a,this.reflectedZ&&++a,a%2===1},Human.scene.Object.prototype._checkFlippedWinding=function(){if(this._propertiesNode){var a=this.reflectedTransform(),b=this.windingOrder,c="ccw"===this.windingOrder?"cw":"ccw";this._propertiesNode.setFrontface(a?c:b)}},Human.scene.Object.prototype.getBoundary=function(){return this.boundary},Human.scene.Object.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Object.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Object.prototype.getCenter=function(){return this.center};var q=vec3.create(),r=vec3.create();Human.scene.Object.prototype._getBoundary=function(a){for(var b,c,d,e=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY,k=0,l=this.renderables.length;l>k;++k){var m=this.renderables[k],n=m.boundary;if(m.isRenderable()){if(this._propertiesNode.getSkybox()){var o=Human.renderer.camera.eye;r[0]=o.x,r[1]=o.y,r[2]=o.z}else r[0]=0,r[1]=0,r[2]=0;for(var p=0;8>p;p++)q[0]=1&p?n.xmin:n.xmax,q[1]=2&p?n.ymin:n.ymax,q[2]=4&p?n.zmin:n.zmax,vec3.transformMat4(q,q,a),b=q[0]-r[0],c=q[1]-r[1],d=q[2]-r[2],e>b&&(e=b),f>c&&(f=c),g>d&&(g=d),b>h&&(h=b),c>i&&(i=c),d>j&&(j=d)}}return{xmin:e,ymin:f,zmin:g,xmax:h,ymax:i,zmax:j}},Human.scene.Object.prototype.show=function(a){if(this.shown!==a&&(this.shown=a,this._propertiesNode)){d(this),Human.scene.kdTreeDirty=!0;var b="scene.object"+(this.shown?"Shown":"Hidden");Human.events.fire(b,{objectId:this.objectId})}},Human.scene.Object.prototype.frustumCull=function(a){this.culledByFrustum!==a&&this._propertiesNode&&(this.culledByFrustum=a,d(this))},Human.scene.Object.prototype.clipCull=function(a){this.culledByClip!==a&&this._propertiesNode&&(this.culledByClip=a,d(this))},Human.scene.Object.prototype.clipFade=function(a){this.fadeByClip!==a&&this._propertiesNode&&(this.fadeByClip=a,this._propertiesNode.setProperties({forceTransparent:a,partiallyOpaque:a}))},Human.scene.Object.prototype.setOpacity=function(c){return c===!1?void this.clearOpacityModProperties({opacity:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(a(this.opacity,c)||(this.opacity=c,this._propertiesNode&&this.setOpacityModifier("__OPACITY",{value:this.opacity}))))},Human.scene.Object.prototype.setXRay=function(a){this.setXRayColors(a),this.xray=a},Human.scene.Object.prototype.setXRayColors=function(a){this._propertiesNode&&(this._propertiesNode.setProperties({xray:a}),e(this))},Human.scene.Object.prototype.setGlassFactor=function(a){this.glassFactor=a,this._propertiesNode&&this._propertiesNode.setProperties({glassFactor:a})},Human.scene.Object.prototype.setMurkiness=function(a){this.murkiness=a,this._propertiesNode&&this._propertiesNode.setProperties({murkiness:a})},Human.scene.Object.prototype.setPickable=function(a){this.pickable!==a&&(this._propertiesNode&&this._propertiesNode.setPicking(a),this.pickable=a)},Human.scene.Object.prototype.setClippable=function(a){this.clippable!==a&&(this._propertiesNode&&this._propertiesNode.setClipping(a),this.clippable=a)},Human.scene.Object.prototype.setColorModifier=function(a,b){if(this._propertiesNode){var c=!1;if(null===b)delete this.colorModifiers[a],c=!0;else if(this.colorModifiers[a]){var d=this.colorModifiers[a];void 0!==b.applyTo&&(d.params.applyTo=b.applyTo),void 0!==b.value&&(d.params.value=b.value),d.params.range=void 0!==b.range?b.range:null}else this.colorModifiers[a]={priority:Human.scene.colorModPriorities[a]||0,params:{applyTo:b.applyTo,value:b.value,range:b.range||null}},c=!0;c&&g(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})}},Human.scene.Object.prototype.clearColorModifiers=function(){this._propertiesNode&&(this.colorModifiers={},g(this),this.tintColor=s.tintColor.value.slice(0),this.brightness=s.brightness.value,this.saturation=s.saturation.value,this.contrast=s.contrast.value,this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.clearColorModProperties=function(a){this._propertiesNode&&((!a||a.tintColor)&&(delete this.colorModifiers.__TINT_COLOR,this.tintColor=s.tintColor.value.slice(0)),(!a||a.brightness)&&(delete this.colorModifiers.__BRIGHTNESS,this.brightness=s.brightness.value),(!a||a.saturation)&&(delete this.colorModifiers.__SATURATION,this.saturation=s.saturation.value),(!a||a.contrast)&&(delete this.colorModifiers.__CONTRAST,this.contrast=s.contrast.value),g(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.setOpacityModifier=function(a,b){if(this._propertiesNode){var c=!1;if(null===b)delete this.opacityModifiers[a],c=!0;else if(this.opacityModifiers[a]){var d=this.opacityModifiers[a];void 0!==b.value&&(d.value=b.value),d.range=void 0!==b.range?b.range:null}else this.opacityModifiers[a]={value:b.value,range:b.range||null},c=!0;c&&h(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs})}},Human.scene.Object.prototype.clearOpacityModifiers=function(){this._propertiesNode&&(this.opacityModifiers={},this.opacity=s.opacity.value,h(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.clearOpacityModProperties=function(a){this._propertiesNode&&((!a||a.opacity)&&(delete this.opacityModifiers.__OPACITY,this.opacity=s.opacity.value),h(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.colorModPrioritiesDirty=function(){for(var a in this.colorModifiers)this.colorModifiers[a].priority=Human.scene.colorModPriorities[a]||0;g(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})},Human.scene.Object.prototype.setHighlight=function(a){if(this._propertiesNode){if(a){var b=Human.renderer.highlightColor;this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:b})}else this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:Human.math.VEC3_ONES});this.highlight=a}},Human.scene.Object.prototype.setTintColor=function(d){if(d===!1)return void this.clearColorModProperties({tintColor:!0});var e;3===arguments.length?e=[arguments[0],arguments[1],arguments[2]]:(e=b(arguments[0]),Array.isArray(e)&&5===e.length&&(e=new i(e))),a(this.tintColor,e)||c(this,e)},Human.scene.Object.prototype.setContrast=function(c){return c===!1?void this.clearColorModProperties({contrast:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(this._propertiesNode&&!a(this.contrast,c)&&(this.contrast=c,this.setColorModifier("__CONTRAST",{applyTo:"contrast",value:this.contrast}))))},Human.scene.Object.prototype.setSaturation=function(c){return c===!1?void this.clearColorModProperties({saturation:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(this._propertiesNode&&!a(this.saturation,c)&&(this.saturation=c,this.setColorModifier("__SATURATION",{applyTo:"saturation",value:this.saturation}))))},Human.scene.Object.prototype.setBrightness=function(c){return c===!1?void this.clearColorModProperties({brightness:!0}):(c=b(c),Array.isArray(c)&&5===c.length&&(c=new j(c)),void(this._propertiesNode&&!a(this.brightness,c)&&(this.brightness=c,this.setColorModifier("__BRIGHTNESS",{applyTo:"brightness",value:this.brightness}))))},Human.scene.Object.prototype.setPartiallyOpaque=function(a){this._propertiesNode&&this._propertiesNode.setProperties({partiallyOpaque:a})},Human.scene.Object.prototype.setBackfaces=function(a){this.backfaces!==a&&(this.backfaces=a,e(this))},Human.scene.Object.prototype.setVisiblyClipped=function(a){this.visiblyClipped!==a&&this.hasRenderObjects()&&(this.visiblyClipped=a,e(this))},Human.scene.Object.prototype.setReflectedX=function(a){this.reflectedX=a,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedY=function(a){this.reflectedY=a,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedZ=function(a){this.reflectedZ=a,this._checkFlippedWinding()},Human.scene.Object.prototype.destroyNodes=function(){this._rootNode&&(Human.renderer.graph.destroySubtree(this._rootNode),this.renderables.length=0,this._rootNode=null)};var s={shown:{setter:Human.scene.Object.prototype.show,value:!1,keyable:!0,type:"boolean"},pickable:{setter:Human.scene.Object.prototype.setPickable,value:!0,keyable:!1,type:"boolean"},backfaces:{setter:Human.scene.Object.prototype.setBackfaces,value:!1,keyable:!1,type:"boolean"},glassFactor:{setter:Human.scene.Object.prototype.setGlassFactor,value:0,keyable:!1,type:"number"},murkiness:{setter:Human.scene.Object.prototype.setMurkiness,value:1,keyable:!1,type:"number"},opacity:{setter:Human.scene.Object.prototype.setOpacity,value:1,keyable:!0,type:"number"},tintColor:{setter:Human.scene.Object.prototype.setTintColor,value:new Float32Array([1,1,1]),keyable:!1,type:"Float32Array"},saturation:{setter:Human.scene.Object.prototype.setSaturation,value:0,keyable:!1,type:"number"},brightness:{setter:Human.scene.Object.prototype.setBrightness,value:0,keyable:!1,type:"number"},contrast:{setter:Human.scene.Object.prototype.setContrast,value:0,keyable:!1,type:"number"}},t=Object.keys(s);Human.scene.Object.prototype.getDefaultFlags=function(){return{picking:this.pickable,enabled:!1,specular:!0,backfaces:!1,reflection:!0,solid:Human.scene.enableSolidObjects}},Human.scene.Object.prototype.getDefaultProperties=function(){for(var a={},b=0,c=t.length;c>b;b++){var d=t[b];a[d]=s[d].value}return a},Human.scene.Object.prototype.getProperties=function(){for(var a=this,b={},c=0,d=t.length;d>c;c++){var e=t[c];b[e]=a[e]}return b},Human.scene.Object.prototype.setProperties=function(b){b=b||{};var c,d,e,f,g=this;for(this.clearColorModifiers(),this.clearOpacityModifiers(),e=0,f=t.length;f>e;e++){var h=t[e];c=s[h],d=void 0!==b[h]?b[h]:c.value,a(g[h],d)||c.setter.call(g,d)}var i,j=Human.scene.colorRecipes.getRecipes();for(e=0;e<j.length;e++)i=j[e],Human.scene.colorRecipes.setObjectRecipe(this.objectId,i,b[i]||!1)},Human.scene.Object.prototype.barycentricToModelSpace=function(a,b,c,d){if(this.renderables.length<=a)return!1;var e=this.renderables[a].getRenderObject();return e?(e.barycentricToCartesian(b,c,d),d):!1},Human.scene.Object.prototype.barycentricToWorldSpace=function(a,b,c,d){return Human.scene.Object.barycentricToModelSpace(a,b,c,d),d?(vec3.transformMat4(d,d,this.getWorldMatrix()),d):!1},Human.scene.Object.prototype.isPinnable=function(){return this.hasRenderObjects()},Human.scene.Object.prototype.hasRenderObjects=function(){for(var a=0,b=this.renderables.length;b>a;++a)if(!this.renderables[a].getRenderObject())return!1;return!0},Human.scene.Object.prototype.serialize=function(){var b={};for(var c in s){var d=s[c];if(!a(d.value,this[c])){var e,f=this[c];e=JSON.parse(f instanceof j||f instanceof i?JSON.stringify([f.center,f.edge,f.centerBias,f.edgeBias,f.power]):JSON.stringify(f)),b[c]=e}}return b},Human.scene.Object.prototype.traverseUp=function(a){a(this),this.parent&&this.parent.traverseUp(a)},Human.scene.Object.prototype.traverseDown=function(a){a(this)},Human.scene.Object.prototype.getLeafObjects=function(a){return a&&a(this),[this]}}(),function(){"use strict";var a=0,b=Human.scene.Renderable=function(b,c){this.id=a++,this.object=b,this.rootNode=b._renderableRoot.addNode(),this.geometryId=c.geometryId||null,this.materialId=c.materialId||null,this.morphId=c.morphId||null,this.drawTexture=null,this.geometryAttached=!1,this.materialAttached=!1,this.morphAttached=!1,this.geometryNode=null,this.materialNode=null,this.textureNodes=null,this.fresnelNodes=null,this.reflectionNode=null,this.lightMapNode=null,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.backfaces=!1,this.addBlend=!1,this.layer=c.layer||0};b.prototype.attachAsset=function(a,b){var c=this.isRenderable();this[a+"Attached"]=!0,c!==this.isRenderable()?(this.compileMaterial(),this.compileGeometry(),this.morphAttached&&this.compileMorph(),this.setBackfaces(this.backfaces),this.setAddBlend(this.addBlend),this.setLayer(this.layer),this.object.checkRenderable()):this.isRenderable()&&this.compileMorph(),
("morph"===a||"geometry"===a&&!this.morph)&&(this.boundary=b.boundary)},b.prototype.detachGeometry=function(){this.geometryNode&&(this.geometryNode.splice(),this.geometryNode.destroy(),this.geometryNode=null,this.geometryAttached=!1,Human.assets.putAsset(this.geometryId))},b.prototype.detachMaterial=function(){if(this.materialNode&&(this.materialNode.splice(),this.materialNode.destroy(),this.materialNode=null),this.textureNodes){for(var a=0,b=this.textureNodes.length;b>a;++a)this.textureNodes[a].splice(),this.textureNodes[a].destroy();this.textureNodes=null}if(this.fresnelNodes){for(var c in this.fresnelNodes)this.fresnelNodes[c].splice(),this.fresnelNodes[c].destroy();this.fresnelNodes=null}this.reflectionNode&&(this.reflectionNode.splice(),this.reflectionNode.destroy(),this.reflectionNode=null),this.lightMapNode&&(this.lightMapNode.splice(),this.lightMapNode.destroy(),this.lightMapNode=null),this.materialAttached=!1,Human.assets.putAsset(this.materialId)},b.prototype.detachMorph=function(){this.morphNode&&(this.morphNode.splice(),this.morphNode.destroy(),this.morphNode=null,this.morphAttached=!1,Human.assets.putAsset(this.morphId))},b.prototype.disconnectGeometry=function(){this.geometryNode&&(Human.renderer.graph.disconnectNode(this.geometryNode),this.geometryNode=null,this.geometryAttached=!1)},b.prototype.disconnectMaterial=function(){if(this.materialNode&&(Human.renderer.graph.disconnectNode(this.materialNode),this.materialNode=null),this.textureNodes){for(var a=0,b=this.textureNodes.length;b>a;++a)Human.renderer.graph.disconnectNode(this.textureNodes[a]);this.textureNodes=null}if(this.fresnelNodes){for(var c in this.fresnelNodes)Human.renderer.graph.disconnectNode(this.fresnelNodes[c]);this.fresnelNodes=null}this.reflectionNode&&(Human.renderer.graph.disconnectNode(this.reflectionNode),this.reflectionNode=null),this.lightMapNode&&(Human.renderer.graph.disconnectNode(this.lightMapNode),this.lightMapNode=null),this.materialAttached=!1},b.prototype.disconnectMorph=function(){this.morphNode&&(Human.renderer.graph.disconnectNode(this.morphNode),this.morphNode=null,this.morphAttached=!1)},b.prototype.isRenderable=function(){return!(!this.materialAttached||!this.geometryAttached)},b.prototype.getRenderObject=function(){return this.geometryNode?this.geometryNode.getObject():null},b.prototype.isTransparent=function(){var a=this.getRenderObject();return a?a.isTransparent():!1},b.prototype.setBackfaces=function(a){a=a&&!this.isTransparent(),this.backfaces=a,this.geometryNode&&this.geometryNode.setBackfaces(this.backfaces)},b.prototype.setAddBlend=function(a){this.addBlend=a,this.geometryNode&&this.geometryNode.setAddBlend(this.addBlend)},b.prototype.setLayer=function(a){this.layer=a,this.geometryNode&&this.geometryNode.setLayer(this.layer)},b.prototype.setGeometry=function(a){this.disconnectGeometry(),this.geometryId=a,this.geometryAttached=!0,this.compileGeometry()},b.prototype.setMaterial=function(a){this.disconnectMaterial(),this.materialId=a,this.materialAttached=!0,this.compileMaterial()},b.prototype.attachDrawTexture=function(a){this.drawTexture=Human.renderer.graph.insertNode(this.rootNode,a)},b.prototype.compileGeometry=function(){var a=Human.assets.geometries.geometries[this.geometryId];if(a){this.geometryNode=Human.renderer.graph.insertNode(this.rootNode,{type:"geometry",coreId:a.geometry.getCoreId()});var b=this;this.geometryNode.onObjectCreate=function(a){b.isTransparent()&&b.setBackfaces(b.backfaces),a.sortTieBreaker=b.id},this.object.geoDirty=!0}},b.prototype.compileMaterial=function(){var a=Human.assets.materials.materials[this.materialId];if(a){if(a.textures){var b=a.textures;this.textureNodes=[];var c,d;for(c=0,d=b.length;d>c;c++)b[c]&&this.textureNodes.push(Human.renderer.graph.insertNode(this.rootNode,{type:"texture",coreId:b[c].getCoreId()}))}if(a.material&&(this.materialNode=Human.renderer.graph.insertNode(this.rootNode,{type:"material",coreId:a.material.getCoreId()})),a.flags){var e=Human.utils.apply(a.flags,this.object._propertiesNode.getProperties());void 0!==e.frontface&&(this.object.windingOrder=e.frontface),void 0!==e.backfaces&&this.setBackfaces(e.backfaces),void 0!==e.addBlend&&this.setAddBlend(e.addBlend),this.object._propertiesNode.setProperties(e)}if(a.reflection&&(this.reflectionNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:a.reflection.getCoreId()})),a.lightmap&&(this.lightMapNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:a.lightmap.getCoreId()})),a.fresnels){var f=a.fresnels;this.fresnelNodes={};for(var g in f)f.hasOwnProperty(g)&&(this.fresnelNodes[g]=Human.renderer.graph.insertNode(this.rootNode,{type:"fresnel",coreId:f[g].getCoreId()}))}void 0!==a.glassFactor&&this.object.setGlassFactor(a.glassFactor),void 0!==a.murkiness&&this.object.setMurkiness(a.murkiness)}},b.prototype.compileMorph=function(){var a=Human.assets.morphs.morphs[this.morphId];a&&(this.morphNode=Human.renderer.graph.insertNode(this.rootNode,{type:"morphGeometry",coreId:a.morphGeometry.getCoreId()}),this.object.geoDirty=!0)},b.prototype.isAttached=function(){return this.object.renderables.indexOf(this)>-1}}(),function(){"use strict";var a=Human.scene.sets={},b=function(a,b){var c=[null,void 0];return c.indexOf(b)<0?b:c.indexOf(a)<0?a:null},c=function(a,b){return b===a?!0:!1};a.keys=function(a,b){b=b||!1;var c=Object.keys(a),d=[];return b?c.forEach(function(a){b(a)&&d.push(a)}):d=c,d},a.filterKeys=function(b,c){var d,e=[];if(c instanceof RegExp)d=c;else try{d=new RegExp(c)}catch(f){return{}}var g=function(a){return d.test(a)};return e=a.keys(b).filter(g)},a.keysWhere=function(a,b){var c=[];for(var d in a)a.hasOwnProperty(d)&&b(a[d])&&c.push(d);return c},a.hasKey=function(b,c){var d=a.keys(b);return d.indexOf(c)>=0?!0:!1},a.getSetIterator=function(b){var c=0,d=a.keys(b),e=d.length;return{next:function(){var a;if(!this.hasNext())return null;var e=d[c];return a={key:e,value:b[e]},c++,a},hasNext:function(){return e>c},rewind:function(){return c=0,b[d[0]]},current:function(){return b[d[c]]}}},a.values=function(b){var c=a.keys(b),d=[];return c.forEach(function(a){d.push(b[a])}),d},a.jointKeys=function(b,c){var d={},e=function(a){d[a]=!0},f=a.keys(b),g=a.keys(c);return f.forEach(e),g.forEach(e),a.keys(d)},a.commonKeys=function(b,c){var d={},e=a.keys(b),f=a.keys(c);return e.forEach(function(a){d[a]=1}),f.forEach(function(a){d[a]=(d[a]||0)+1}),a.keysWhere(d,function(a){return a>1?!0:!1})},a.uniqueKeys=function(b,c){var d={},e=function(a){d[a]=1},f=function(a){d[a]=0},g=a.keys(b),h=a.keys(c);return g.forEach(e),h.forEach(f),a.keysWhere(d,function(a){return a>0?!0:!1})},a.union=function(c,d,e){var f,g={},h=null;return e||(e=b),f=a.jointKeys(c,d),f.forEach(function(a){h=e(c[a],d[a]),null!==h&&(g[a]=h)}),g},a.intersection=function(c,d,e){var f,g={},h=null;return e||(e=b),f=a.commonKeys(c,d),f.forEach(function(a){h=e(c[a],d[a]),null!==h&&(g[a]=h)}),g},a.difference=function(c,d,e){var f=a.uniqueKeys(c,d),g=null;e||(e=b);var h={};return f.forEach(function(a){g=e(c[a]),null!==g&&(h[a]=g)}),h},a.isin=function(b,d,e){e||(e=c);for(var f,g=!1,h=a.getSetIterator(d);h.hasNext()&&!g;)f=h.next(),g=e(b,f.key,f.value);return g}}(),function(){"use strict";function a(a,b){var c=a.objectId,d=a.geometryId||null,e=a.morphId||null,f=a.materialId||null,g=a.transformId||null;if(Human.scene.objects[c])return null;void 0===a.layer&&(a.layer=b?b.layer:0),a.objectId=c,a.parent=b,a.parentObjectId=b?b.objectId:null,a.materialId=f,a.geometryId=d,a.morphId=e,a.transformId=g,a.tags=a.tags||[],a.capColor=j("capColor",a,b),a.modelId=a.objectId.split("-")[0];var h=Human.scene.createObject(a);return void 0!==a.opacity&&h.setOpacity(a.opacity),void 0!==a.shown&&h.show(a.shown),h}function b(a,d,e,f){var g=d.shift();c(a,g,function(){if(f){for(var c={},h=0,i=g.length;i>h;h++)c[g[h]]=!0;f(c,e,!d.length)}d.length&&b(a,d,e+1,f)})}function c(a,b,c){function d(){0===--f&&c&&c()}var e,f=a.length;if(0===f)return void(c&&Human.utils.async(c));for(var g=0,h=f;h>g;g++)e=a[g],n.attachAssetsToObject(e,b,d)}function d(a){s.geometryId&&a.detachAsset("geometry"),s.materialId&&a.detachAsset("material"),s.transformId&&a.detachAsset("transform"),s.morphId&&a.detachAsset("morph")}function e(a,b,c){for(var d=0,e=b.length;e>d;d++){var f,g=b[d];if("transform"===g){var h=a.transformId;h&&!a.transformInitialized&&(c.transform=c.transform||{},f=c.transform[h]=c.transform[h]||[],f.push(a))}else if(a.renderables)for(var i=0,j=a.renderables.length;j>i;++i){var k=a.renderables[i],l=k[g+"Id"],m=k[g+"Attached"];l&&!m&&(c[g]=c[g]||{},f=c[g][l]=c[g][l]||[],f.push(k))}}return c}function f(){Human.events.fire("graph.assetAttach.start")}function g(a,b,c,d){q++,Human.events.fire("graph.assetAttach.progress",{assetId:a,targetObjects:c,assetType:b,nullAsset:d}),o[b]||(o[b]=[]),d||o[b].push(a),p===q&&h()}function h(){Human.events.fire("graph.assetAttach.finish",o),o={},p=0,q=0}function i(a,b,c,d){0===p&&f(),p++,Human.assets.getAsset(a,b,function(e){if(e)for(var f=0,h=c.length;h>f;f++)if("transform"===b){var i=c[f];Human.scene.objects[i.objectId]&&i.setTransform(e)}else{var j=c[f];j.attachAsset(b,e)}g(a,b,c,!e),d(e)})}function j(a,b,c){return c?void 0!==b[a]&&null!==b[a]?b[a]:c[a]:b[a]}function k(a){if(a.objects&&a.objectId){for(var b,c=0,d=a.objects.length;d>c;++c)if(!a.objects[c].objectId){b=[];break}b&&l(a)&&(a.anonymousIdToRenderableIndex={},m(a,b,a),a.renderables=b,a.objects.length=0)}}function l(a){if(!a.objects)return!0;for(var b=0,c=a.objects.length;c>b;++b){var d=a.objects[b];if(d.transformId||d.objectId||d.pivot||d.translate||d.scale||d.rotate||!l(d))return!1}return!0}function m(a,b,c){if(a.objects)for(var d=0,e=a.objects.length;e>d;++d){var f=a.objects[d];void 0===f.layer&&(f.layer=a.layer),f.geometryId?(c.anonymousIdToRenderableIndex[c.objectId+r++]=b.length,b.push({geometryId:f.geometryId,materialId:f.materialId,morphId:f.morphId,layer:f.layer})):(r++,m(f,b,c,c.objectId))}}var n=Human.scene.graph={},o={},p=0,q=0,r=0,s={};n.buildGraph=function(b,c){if(b){c||(r=0);for(var d,e,f=0;f<b.length;f++)d=b[f],k(d),d.objectId||(d.objectId=c.objectId+r++,d.anonymous=!0),d.group=d.objects&&d.objects.length>0,e=a(d,c),null!==e&&d.objects&&n.buildGraph(d.objects,e)}},n.gatherAssetIdsFromObject=function(a,b,c){Array.isArray(a)||(a=[a]),b=b||["geometry","material","transform","morph"],c=c||{};for(var d=0,f=a.length;f>d;d++)e(a[d],b,c);return c},n.attachAssetsToObject=function(a,b,c){function d(){0===--e&&c&&c()}"function"==typeof b&&(c=b,b=null),Array.isArray(a)||(a=[a]),b=b||["geometry","material","transform","morph"];for(var e=0,f=0,g=a.length;g>f;f++){var h=n.gatherAssetIdsFromObject(a[f],b);e++,n.attachAssets(h,d)}},n.attachAssetSetsToSubtree=function(a,c,d){function e(a){k[a.objectId]=a}function f(a){i[a.objectId]||(j.push(a),i[a.objectId]=!0)}"function"==typeof c&&(d=c,c=null),Array.isArray(a)||(a=[a]),c=c||[["geometry","material","transform"],["morph"]];for(var g,h,i={},j=[],k={},l=0;l<a.length;l++)a[l].getLeafObjects(e);for(g in k)k.hasOwnProperty(g)&&(h=k[g],h&&h.traverseUp(f));b(j,c,0,d)},n.attachAssets=function(a,b){function c(){0===--d&&b&&b()}var d=0,e=Object.keys(a);if(0===e.length)return void(b&&Human.utils.async(b));for(var f=0,g=e.length;g>f;f++){var h=e[f],j=a[h];if(j)for(var k in j)if(j.hasOwnProperty(k)){var l=j[k];d++,i(k,h,l,c)}}},n.destroySubtree=function(a){Array.isArray(a)||(a=[a]);var b,c,e;for(b=0,c=a.length;c>b;b++)e=a[b],e.getLeafObjects(d),Human.scene.destroyObject(e.objectId)},n.unloadSubtree=function(a,b,c){Array.isArray(a)||(a=[a]);var e,f,g;for(s={},b.indexOf("geometries")>=0&&(s.geometryId=!0),b.indexOf("transforms")>=0&&(s.transformId=!0),b.indexOf("morphs")>=0&&(s.morphId=!0),b.indexOf("materials")>=0&&(s.materialId=!0),b.indexOf("morph")>=0&&(s.morphId=!0),e=0,f=a.length;f>e;e++)g=a[e],g.getLeafObjects(d);c&&c()}}(),function(){"use strict";function a(){var a=f+e;return e++,a}function b(a,b){i[a]?i[a].push(b):i[a]=[b],j=!0}function c(){var a,b,c,d,e=0;for(a in i)if(++e,d=i[a],b=Human.scene.objects[a],b&&b.isVisible()){for(c=0;c<d.length;c++)d[c].build();delete i[a],--e}j=e>0}var d=Human.scene.markers={},e=0,f="marker_",g=2,h=0;d.markers={};var i={},j=!1,k=vec3.fromValues(.33,.33,.33),l=vec3.create(),m=vec3.create(),n=mat4.create(),o=vec3.create(),p=function(c){var d=this;if(d.id=c.id||a(),d.pos=vec3.create(),this.viewPos=vec3.create(),d.dir=vec3.create(),c.pos&&(d.pos[0]=c.pos[0],d.pos[1]=c.pos[1],d.pos[2]=c.pos[2]),c.dir&&(d.dir[0]=c.dir[0],d.dir[1]=c.dir[1],d.dir[2]=c.dir[2],vec3.normalize(d.dir,d.dir)),d.viewAngle=0,d.canvasPos=vec2.fromValues(0,0),d.built=!1,d.occluded=!1,d.objectCentered=!1,d.renderableIndex=-1,d.primitiveIndex=-1,d.barycentric=null,c.objectId&&Human.scene.objects[c.objectId]){if(d.object=Human.scene.objects[c.objectId],d.modelPos=vec3.create(),void 0!==c.primitiveIndex){d.renderableIndex=void 0!==c.renderableIndex?c.renderableIndex:0,d.primitiveIndex=c.primitiveIndex;var e=c.barycentric||k;d.barycentric=vec3.fromValues(e[0],e[1],e[2])}else c.pos||(d.objectCentered=!0);d.object.isRenderable()?d.build():b(c.objectId,d)}else{if(!c.pos)return void Human.log.error("Human.scene.marker","marker configuration requires 'objectId' or 'pos' parameter.");d.build()}};p.prototype.build=function(){var a=this;if(!a.built){if(-1!==a.primitiveIndex)a.object.barycentricToModelSpace(a.renderableIndex,a.primitiveIndex,a.barycentric,a.modelPos),vec3.transformMat4(a.pos,a.modelPos,a.object.getWorldMatrix());else if(a.object&&!a.objectCentered)mat4.invert(n,a.object.getWorldMatrix()),vec3.transformMat4(a.modelPos,a.pos,n);else if(a.objectCentered){var b=a.object.getCenter();a.pos[0]=b[0],a.pos[1]=b[1],a.pos[2]=b[2],mat4.invert(n,a.object.getWorldMatrix()),vec3.transformMat4(a.modelPos,a.pos,n)}a.updatePosition(),a.updateViewAngle(),a.updateOcclusion(),a.built=!0}},p.prototype.updatePosition=function(){var a=this;-1!==a.primitiveIndex&&a.object.barycentricToModelSpace(a.renderableIndex,a.primitiveIndex,a.barycentric,a.modelPos),a.modelPos&&vec3.transformMat4(a.pos,a.modelPos,a.object.getWorldMatrix()),vec3.transformMat4(a.viewPos,a.pos,Human.renderer.getViewMat()),Human.renderer.worldPositionToCanvas(a.pos,a.canvasPos)},p.prototype.updateViewAngle=function(){if(this.objectCentered)return void(this.viewAngle=0);var a=Human.renderer.camera.eye;o.set([a.x,a.y,a.z]),vec3.subtract(l,o,this.pos),vec3.normalize(l,l),this.viewAngle=57.2957795*Math.acos(vec3.dot(l,this.dir))},p.prototype.updateOcclusion=function(){this.occluded=this.isOccludedByObject()||this.isOffScreen()},p.prototype.isOccludedByObject=function(){if(this.objectCentered)return!1;var a,b,c,d,e;return a=Human.renderer.camera.eye,l[0]=a.x,l[1]=a.y,l[2]=a.z,vec3.sub(m,this.pos,l),b=vec3.length(m),c=Math.min(.1*b,.5),d=1/b,m[0]*=d,m[1]*=d,m[2]*=d,e=Human.math.intersections.rayScene(l,m,function(a){return a.shown&&!a.culled},function(a){return!a.isTransparent()}),!!(e&&e.length&&e[0].t+c<b)},p.prototype.isOffScreen=function(){var a=this.canvasPos,b=Human.renderer.canvas.width,c=Human.renderer.canvas.height;return a[0]<0||a[0]>b||a[1]<0||a[1]>c},d.create=function(a){var b=new p(a);return d.markers[b.id]=b,Human.events.fire("scene.markers.added",{id:b.id}),b.built&&Human.events.fire("scene.markers.built",{id:[b.id]}),b},d["delete"]=function(a){delete d.markers[a],Human.events.fire("scene.markers.deleted",{id:a})},d.buildByObjectId=function(a){var b=[];if(i[a]){var c,d;for(c=0;c<i[a].length;c++)d=i[a][c],d.build(),b.push(d.id);delete i[a]}Human.events.fire("scene.markers.built",{id:b})},d.onFrame=function(){h=(h+1)%g,j&&c();var a,b=0;for(var e in d.markers)a=d.markers[e],a&&a.built&&(a.updatePosition(),a.updateViewAngle(),0===h&&a.updateOcclusion(),++b);b>0&&Human.events.fire("scene.markers.updated")}}(),function(){"use strict";function a(a){var b=a.channels,c=a.mods,d=a.fresnelChannels,l=a.fresnelMods,m=[],n=[],o=0;if(void 0!==b&&null!==b&&(b&g&&m.push({applyTo:"tintColor",value:c.slice(o,o+=3)}),b&h&&m.push({applyTo:"saturation",value:c.slice(o,o+=1)[0]}),b&i&&m.push({applyTo:"contrast",value:c.slice(o,o+=1)[0]}),b&j&&m.push({applyTo:"brightness",value:c.slice(o,o+=1)[0]}),b&k&&n.push({applyTo:"opacity",value:c.slice(o,o+=1)[0]})),o=0,void 0!==d&&null!==d){if(d&g){var p=l.slice(o,o+=9);m.push({applyTo:"tintColor",value:new e([p[0],p[1],p[2]],[p[3],p[4],p[5]],p[6],p[7],p[8])})}if(d&h){var q=l.slice(o,o+=5);m.push({applyTo:"saturation",value:new f(q[0],q[1],q[2],q[3],q[4])})}if(d&i){var r=l.slice(o,o+=5);m.push({applyTo:"contrast",value:new f(r[0],r[1],r[2],r[3],r[4])})}if(d&j){var s=l.slice(o,o+=5);m.push({applyTo:"brightness",value:new f(s[0],s[1],s[2],s[3],s[4])})}if(d&k){var t=l.slice(o,o+=5);n.push({applyTo:"opacity",value:new f(t[0],t[1],t[2],t[3],t[4])})}}return{colorMods:m,opacityMods:n}}function b(a){var b=0,c=[];return a.colorMods.forEach(function(a){"tintColor"===a.applyTo?(b+=g,a.value.forEach(function(a){c.push(a)})):"saturation"===a.applyTo?(b+=h,c.push(a.value[0])):"contrast"===a.applyTo?(b+=i,c.push(a.value[0])):"brightness"===a.applyTo&&(b+=j,c.push(a.value[0]))}),a.opacityMods.forEach(function(a){"opacity"===a.applyTo&&(b+=k,c.push(a.value[0]))}),{channels:b,mods:c}}function c(a,b){return a+"_"+b}var d=Human.scene.colorRecipes={},e=window.ColorFresnel,f=window.ScalarFresnel,g=16,h=8,i=4,j=2,k=1,l={};d.createConfigFromMods=function(a){return b(a)},d.getRecipes=function(){return Object.keys(l)},d.getRecipeMods=function(a){return l.hasOwnProperty(a)?Human.utils.shallowClone(l[a]):void Human.log.error("Human.scene.color-recipes","No such color recipe : "+a)},d.registerRecipe=function(b,c){return l.hasOwnProperty(b)?void Human.log.error("Human.scene.color-recipes","Color mod recipe already exists : "+b):void(l[b]=a(c))},d.clearRecipes=function(){l={}},d.removeRecipe=function(a){delete l[a]},d.setObjectRecipe=function(a,b,d){var e,f,g,h=Human.scene.objects[a],i=l[b];if(h&&i){for(e=0;e<i.colorMods.length;e++)f=i.colorMods[e],g=c(b,f.applyTo),h.setColorModifier(g,d?f:null);for(e=0;e<i.opacityMods.length;e++)f=i.opacityMods[e],g=c(b,f.applyTo),d?h.setOpacityModifier(g,f):!d&&h.opacityModifiers[g]&&h.setOpacityModifier(g,null)}},d.hasTarget=function(a,b){var c=Human.scene.objects[b],d=l[a];if(c&&d){var e=Object.keys(c.colorModifiers).reduce(function(b,c){return b||c.startsWith(a)},!1);return Object.keys(c.opacityModifiers).reduce(function(b,c){return b||c.startsWith(a)},e)}},d.serializeRecipe=function(a){var c=d.getRecipeMods(a);return b(c)}}(),function(){"use strict";var a=Human.timeline={objectVisibilityUpdates:{}};a.animations={},a.leafTimelines={},a.branchTimelines={},a.rootTimelines={},a.activeRoot=null,a.FRAME_LENGTH=.033,a.TIME_CONSTANT=.001,a.borderConditions={start:{which:"second",direction:a.direction},middle:{which:"both",direction:a.direction},end:{which:"first",direction:a.direction}},a.playing=!1,a.playfree=!0,a._lastWorldTime=0,a._time1=0,a._time2=0,a._freeTime=0,a.time=0,a.playQueue=[],a.loop=!1,a.scale=1,a.direction="forwards",a._playParams=null,a._scrubParams=null,a.chapters={};var b,c,d,e,f;a.addAnimation=function(b,c){return c.update?(a.animations[b]&&a.removeAnimation(b),a.animations[b]=c,void Human.events.fire("Timeline.Loaded")):void Human.log.error("Human.timeline.addAnimation","Param expected: update")},a.removeAnimation=function(b){var c=a.animations[b];return c?(delete a.animations[b],c.destroy&&c.destroy(),void(Human.utils.isEmpty(a.animations)&&Human.events.fire("Timeline.Empty"))):void Human.log.warn("Human.timeline.removeAnimation","Animation not found: "+b)};var g=function(){return"forwards"===a.direction?a._time2:a._time1},h=function(){return"forwards"===a.direction?a._time1:a._time2},i=function(){var b=g();return a.time===b?!0:!1},j=function(){var b=h();return a.time===b?!0:!1},k=function(b){var c={},d="backwards"===b?-1:1,e=["forwards","backwards"];return e.indexOf(b)<0?(Human.log.warn("timeline.setBorderConditions","invalid direction :"+b),null):(c.start={which:"second",direction:b},c.middle={which:"both",direction:b},c.end={which:"first",direction:b},a.direction=b,a.borderConditions=c,void(a.scale=d*Math.abs(a.scale)))};a.initTransparencies=function(){Human.log.error("timeline.initTransparencies() is deprecated and no longer required for loading")},a.onFrame=function(){if(b=a.activeRoot,null!==b&&void 0!==b){if(c=(new Date).getTime(),d=(c-a._lastWorldTime)*a.TIME_CONSTANT,e=d/a.FRAME_LENGTH,a._lastWorldTime=c,a.time>a._time2?a.time=a._time2:a.time<a._time1&&(a.time=a._time1),a.playfree&&(b.updateFreeAnimations(a._freeTime),a._freeTime+=a.scale*e*a.FRAME_LENGTH),a.playing){f=a.borderConditions.middle;var g=!0;i()?a.loop===!0?(f=a.borderConditions.start,a.time=h()):(f=a.borderConditions.end,g=!1):j()&&(f=a.borderConditions.start),b.update(a.time,f),g?(a.playing=!0,Human.events.fire("timeline.playing",{time:a.time}),a.time+=a.scale*e*a.FRAME_LENGTH):(Human.events.fire("timeline.completed"),a.playing=!1,Human.events.fire("timeline.stopped",{time:a.time}))}Human.renderer.camera.fly.onFrame(),Human.utils.isEmpty(a.objectVisibilityUpdates)||(Human.scene.setEnabledObjects({objectIds:a.objectVisibilityUpdates,replace:!1}),a.objectVisibilityUpdates={})}},Human.events.on("timeline.stopped",function(){if(a.playQueue.shift(),a.playQueue.length>0){var b=a.playQueue[0];a._play(b)}else Human.events.fire("timeline.paused",{time:Human.timeline.time})}),a.parsePlayInstruction=function(b){b=b||{};var c=b.root||a.activeRoot,d="forwards";c.getTimeFrame();var e,f,g,h,i,j,k=null,m=null,n=null,o=b.hasOwnProperty("align")?b.align:!0,p=["nextChapter","prevChapter","startChapterId","startTime"],q=["nextChapter","prevChapter","finishChapterId","finishTime","numChapters"],r=null,s=!1;switch(a._playParams=b,e=l(p,b)[0]||"default",f=l(q,b)[0]||"default",e){case"nextChapter":h=0,g=c.getNeighborChapter(c._nowBranch,"next");break;case"prevChapter":h=0,g=c.getNeighborChapter(c._nowBranch,"previous");break;case"startChapterId":if(h=0,g=c.getBranch({id:b.startChapterId}),Human.utils.isEmpty(g))return void Human.log.warn("timeline.play","Invalid chapter id: "+b.startChapterId);break;case"startTime":r=c.mapGlobalTime(b.startTime,{tie:"later"}),g=r.branch,h=r.time;break;case"default":g=c._chapters[0],h=0}switch(f){case"nextChapter":i=g,j=i.getTimeFrame().lastTime;break;case"prevChapter":i=g,j=i.getTimeFrame().lastTime;break;case"finishChapterId":if(i=c.getBranch({id:b.finishChapterId}),Human.utils.isEmpty(i))return void Human.log.warn("timeline.play","Invalid chapter id: "+b.finishChapterId);j=i.getTimeFrame().lastTime;break;case"finishTime":if(0===b.finishTime)i=c._chapters[0],j=0;else{var t={tie:"earlier"};r=c.mapGlobalTime(b.finishTime,t),i=r.branch,j=r.time}break;case"numChapters":var u=c.whereIsBranch(g,{chapters:!0}),v=c._chapters.length-u,w=b.numChapters||1;w=Math.min(w,v),i=c._chapters[u+w-1],j=i.getTimeFrame().lastTime;break;case"default":i=c._chapters[c._chapters.length-1],j="end"}if(k=c.mapBranchTime(g,h),m=c.mapBranchTime(i,j),m>=k?(d="forwards",n=k):(r=k,k=m,m=r,n=m,d="backwards"),o&&("forwards"===d?(k=c.mapBranchTime(g,0),m=c.mapBranchTime(i,"end")):"backwards"===d&&(k=c.mapBranchTime(i,0),m=c.mapBranchTime(g,"end"))),b.hasOwnProperty("loop"))s=b.loop;else{var x=["startChapterId","nextChapter","prevChapter"],y=["numChapters","nextChapter","finishChapterId"];x.indexOf(e)>=0&&y.indexOf(f)>=0&&g.id===i.id&&(s=g.animation.loop)}return{t:n,t1:k,t2:m,loop:s,direction:d}},a.play=function(b){b=b||{},b.queue&&a.playing?a.playQueue.push(b):(a.playQueue=[b],a._play(b))},a._play=function(b){var c=a.parsePlayInstruction(b||{});a._time1=c.t1,a._time2=c.t2,a.time=c.t,a.loop=c.loop,k(c.direction),a.playing=!0,a._lastWorldTime=(new Date).getTime(),Human.events.fire("timeline.played",{time:a.time})};var l=function(a,b){var c=Object.keys(b),d=function(a){return c.indexOf(a)>=0};return a.filter(d)};a.stop=function(){a.playing=!1,a.playQueue=[],Human.events.fire("timeline.stopped",{time:a.time})},a.scrub=function(b){var c,d=a.activeRoot,e=0,f={which:"first",direction:"forwards"};if(a.playQueue=[],a._scrubParams=b,b.hasOwnProperty("time"))e=b.time;else if(b.hasOwnProperty("chapterId")){var g=d.getBranch({id:b.chapterId});g?(e=d.mapBranchTime(g,0),f={which:"second",direction:"forwards"}):e=a.time}else e=a.time;if(b.hasOwnProperty("borderCondition")){var h=b.borderCondition,i=["first","both","second"],j=["forwards","backwards"];i.indexOf(h.which)>=0&&(f.which=h.which),j.indexOf(h.direction)>=0&&(f.direction=h.direction)}0===e?f={which:"second",direction:"forwards"}:e===d.getTimeFrame.lastTime&&(f={which:"first",direction:"forwards"}),(e<a._time1||e>a._time2)&&(c=d.mapGlobalTime(e,f),a._time1=d.mapBranchTime(c.branch,0),a._time2=d.mapBranchTime(c.branch,"end")),a.playing=!1,a.time=e,d.update(e,f),Human.events.fire("timeline.scrubbed",{time:a.time})},a.next=function(){var b=a.activeRoot,c=Human.properties.properties["timeline.prevNextMode"],d=b._nowBranch,e=b.getNeighborChapter(d,"next");if(b.isLast(d))return void Human.log.warn("timeline.next","can't proceed beyond last chapter");var f=b.mapBranchTime(d,"end")+.001;if("play"===c){var g;g=e.animation.loop?{startTime:b.mapBranchTime(e,0),align:!0,finishTime:b.mapBranchTime(e,"end"),loop:e.animation.loop,queue:!1}:{startTime:a.time,align:!1,finishTime:f,loop:!1,queue:!0},a.play(g)}else a.scrub({time:f})},a.prev=function(){var b=a.activeRoot,c=Human.properties.properties["timeline.prevNextMode"],d=b._nowBranch;if(b.isFirst(d))return void Human.log.warn("timeline.next","can't go to chapter before first chapter");var e,f=b.getNeighborChapter(d,"previous"),g=b.mapBranchTime(f,"start")+.001;"play"===c?(e=d.animation.loop?{startTime:b.mapBranchTime(f,"start"),align:!0,finishTime:b.mapBranchTime(f,"end"),loop:f.animation.loop,queue:!1}:{startTime:b.mapBranchTime(f,"end"),align:!1,finishTime:b.mapBranchTime(f,"start"),loop:!1,queue:!1},a.play(e)):a.scrub({time:g})},a.getBookmark=function(){var b={};return Human.timeline.activeRoot&&(b.rootName=Human.timeline.activeRoot.id),a.playing?(b.play=a._playParams,b.play.root&&delete b.play.root):b.scrub=a._scrubParams,b},a.setBookmark=function(b){if(b.rootName&&a.rootTimelines.hasOwnProperty(b.rootName))a.activeRoot=a.rootTimelines[b.rootName];else if(b.modules&&b.modules.activeModules){var c=b.modules.activeModules;c=c.filter(function(a){return Human.timeline.rootTimelines.hasOwnProperty(a)}),c.length>1&&(c=c.filter(function(a){return!Human.modules.isBaseModule(a)}));var d=c[0];Human.timeline.activeRoot=Human.timeline.rootTimelines[d]}else Human.log.warn("Human.timeline.setBookmark: Unable to set appropriate root timeline")},a.pause=function(){a.playing=!1,Human.events.fire("timeline.paused",{time:a.time})},a.unpause=function(){var b={startTime:a.time,numChapters:1,loop:a.activeRoot._nowBranch.animation.loop};a.play(b),Human.events.fire("timeline.unpaused",{time:a.time})},a.playFreeAnimations=function(){a.playfree=!0},a.pauseFreeAnimations=function(){a.playfree=!1},a.getTimeFrame=function(){return Human.utils.isEmpty(a.activeRoot)?0:a.activeRoot.getTimeFrame()},a.getCurrentChapterCamera=function(){return Human.timeline.activeRoot._nowBranch.getCamera(0)},a._convertPlayParams=function(a){var b=a;return a.hasOwnProperty("endTime")&&(b.finishTime=b.endTime),a.hasOwnProperty("endChapterId")&&(b.finishChapterId=a.endChapterId),b},a.query=function(){if(!a.activeRoot)return{};var b=a.activeRoot._assembleQueryChapters();return{chapters:b,time:a.time,timeFrame:a.getTimeFrame(),playing:a.playing,paused:!a.playing}},a.destroyChapterSet=function(b){if(a.stop(),a.rootTimelines.hasOwnProperty(b))a.rootTimelines[b].destroy();else if(b)for(var c in a.rootTimelines)a.rootTimelines.hasOwnProperty(c)&&(Human.modules.isBaseModule(c)||a.rootTimelines[c].destroy());else Human.log.warn("timeline.destoryChapterSet","Invalid argument: "+b)},Human.events.on("timeline.chapters.updated",function(b){var c,d=0;if(a.chapters={},null!==a.activeRoot)for(d=0;d<b.length;d++)c=a.activeRoot._chapters[d].id,a.chapters[c]=b[d]})}(),function(){"use strict";Human.timeline.TweenAnimation=function(a){this._options=a.options||{},this._tweens=a.tweens,this.timeline=a.timeline,this.firstTime=1e6,this.lastTime=-1e6;for(var b,c=0,d=this._tweens.length;d>c;c++)b=this._tweens[c],b.firstTime<this.firstTime&&(this.firstTime=b.firstTime),b.lastTime>this.lastTime&&(this.lastTime=b.lastTime)},Human.timeline.TweenAnimation.prototype.update=function(a,b){for(var c=0,d=this._tweens.length;d>c;c++)this._tweens[c].update(a,b)},Human.timeline.TweenAnimation.prototype.destroy=function(){for(var a,b=0,c=this._tweens.length;c>b;b++)a=this._tweens[b],a.destroy&&a.destroy()}}(),function(){"use strict";function a(a){for(var b in a)if(a.hasOwnProperty(b)&&!Human.utils.isObject(a[b]))return!1;return!0}Human.timeline.Tween=function(b){this._control=b.control,this._tweenList=[];for(var c,d,e,f,g,h,i={},j=0,k=b.targets.length;k>j;j++){c=b.targets[j],d=b.keys[j],Human.utils.isObject(c.attr)&&a(c.attr)&&(c=c.attr),e=c;for(var l in e)e.hasOwnProperty(l)&&(f=e[l],g=i[l],g||(h=this._control.attr[l],g=new Human.timeline.TweenAttr(h,b.options),i[l]=g,this._tweenList.push(g)),g.addTarget(d,f))}this.firstTime=b.keys[0],this.lastTime=b.keys[b.keys.length-1]},Human.timeline.Tween.prototype._run=function(a,b){for(var c=0,d=this._tweenList,e=0,f=d.length;f>e;e++)d[e].update(a,b)&&c++;return c},Human.timeline.Tween.prototype.query=function(a,b){return this._run(a,b),this._control.attr},Human.timeline.Tween.prototype.update=function(a,b){this._run(a,b)>0&&this._control.update(a)}}(),function(){"use strict";function a(a,b,c,d){"number"!=typeof c&&(c=c.value);var e=a.controlPoints,f=Math.floor(50*(b-d));a.bezier=new Human.math.bezier(d,c,e.x[0],e.y[0],e.x[1],e.y[1],b,a.value),a.lookUp=a.bezier.getLUT(f)}function b(a,b,c,d,e){var f=(a-b)/(c-b),g=e-d,h=f*g;return d+h}function c(a,c){var d,e,f,g=c.lookUp,h=0,i=g.length-1;if(a<=g[h].x)return g[h].y;if(a>=g[i].x)return g[i].y;for(;i>=h;){if(d=Math.floor((h+i)/2),e=g[d],f=g[d+1],e.x<=a&&f.x>=a)return b(a,e.x,f.x,e.y,f.y);e.x>a?i=d-1:h=d+1}}Human.timeline.TweenAttr=function(a,b){this.attr=a,this.attrNames=null,b=b||{},this.keys=[],this.attrTargetLists={},this._tweens=[],this._key1=0,this._key2=1,this._firstKey=null,this._lastKey=null,this._keyDiff=null,this._loop=!!b.loop,this._timeOffset=b.timeOffset||0,this._paddingDirty=!0},Human.timeline.TweenAttr.prototype.addTarget=function(b,c){b+=this._timeOffset,this.keys.push(b);var d,e,f,g,h,i=this.keys.length-1;for(var j in c)if(c.hasOwnProperty(j)){if(d=this.attrTargetLists[j],!d){if(this.keys.length>1)throw"First target in tween must contain a value for each animated attribute on target";d=this.attrTargetLists[j]=[]}if(f=c[j],d[i]=f,"number"!=typeof f&&a(f,b,d[i-1],this.keys[i-1]),i>0)for(e=!1,g=i-1;!e&&g>=0;)h=d[g],void 0===h&&null===h?(d[g]=f,g--):e=!0}(null===this._firstKey||this._firstKey>b)&&(this._firstKey=b),(null===this._lastKey||this._lastKey<b)&&(this._lastKey=b),this._keyDiff=this._lastKey-this._firstKey,this._paddingDirty=!1},Human.timeline.TweenAttr.prototype._padTargets=function(){var a,b,c,d=this.attrTargetLists,e=this.keys.length;for(a in d)if(d.hasOwnProperty(a)){if(b=d[a],b.length===e)continue;for(c=b[b.length-1];b.length<e;)b.push(c)}this._paddingDirty=!1},Human.timeline.TweenAttr.prototype.update=function(a,d){this._paddingDirty&&this._padTargets();var e=this.keys,f=this.attrNames?this.attrNames:this.attrNames=Object.keys(this.attrTargetLists);if(this._loop)d=this._firstKey+d%this._keyDiff;else{if(d<e[0])return this._key1=0,this._key2=1,this._clampToTarget(f,0),!0;if(d>e[e.length-1])return this._key1=e.length-2,this._key2=this._key1+1,this._clampToTarget(f,this.keys.length-1),!0}for(;e[this._key1]>d;)this._key1--,this._key2--;for(;e[this._key2]<d;)this._key1++,this._key2++;var g,h,i,j,k,l,m=this.attrTargetLists,n=this._key1,o=this._key2,p=this.attr,q=!1;for(j=0,k=f.length;k>j;j++)l=f[j],g=m[l],h=g[n],"number"!=typeof h&&(h=h.value),i="number"==typeof g[o]?b(d,e[n],e[o],h,g[o]):c(d,g[o]),p[l]=i,q=!0;return q},Human.timeline.TweenAttr.prototype._clampToTarget=function(a,b){
var c,d,e,f,g=this.attr,h=this.attrTargetLists;for(d=0,e=a.length;e>d;d++)f=a[d],c=h[f][b],"number"!=typeof c&&(c=c.value),g[f]=c}}(),function(){"use strict";var a=1,b=2,c=3,d=4;Human.timeline.Switch=function(a){this._keys=a.keys,this._targets=a.targets,this._control=a.control,this._options=a.options||{},this._key=0,this._lastKey=null,this.firstTime=a.keys[0],this.lastTime=a.keys[a.keys.length-1]},Human.timeline.Switch.prototype.query=function(a,b){return this._findTarget(b),this._targets[this._key]},Human.timeline.Switch.prototype.update=function(d,e){var f=this._findTarget(e);switch(f){case a:return;case b:break;case c:}this._control.attr=this._targets[this._key],this._control.update(d),this._lastKey=this._key},Human.timeline.Switch.prototype._findTarget=function(e){if(e<this._keys[0])return this._key=0,a;if(e===this._keys[0])return this._key=0,b;if(e>this._keys[this._keys.length-1])return this._key=this._keys.length-1,c;for(;this._keys[this._key]>e;)this._key--;for(;void 0!==this._keys[this._key+1]&&null!==this._keys[this._key+1]&&this._keys[this._key+1]<e;)this._key++;return d}}(),function(){"use strict";Human.timeline.CameraControl=function(){this.attr={up:{x:0,y:1,z:0},eye:{x:0,y:0,z:0},look:{x:0,y:0,z:0}}},Human.timeline.CameraControl.prototype.update=function(a){return a.cameraEnabled!==!1?(Human.renderer.camera.setLookAt(this.attr),!0):void 0}}(),function(){"use strict";Human.timeline.MaterialControl=function(a){this._materialId=a.modelId+"/"+a.materialId,this.attr={},a.attributes.hasOwnProperty("attr")&&(a.attributes=a.attributes.attr);var b,c={r:0,g:0,b:0,a:1},d={r:1,g:1,b:1},e={r:0,g:0,b:0},f={"float":1};for(b in a.attributes)a.attributes.hasOwnProperty(b)&&("baseColor"===b?this.attr.baseColor=c:"specularColor"===b?this.attr.specularColor=d:"emitColor"===b?this.attr.emitColor=e:"alphaColor"===b&&(this.attr.alphaColor=f))},Human.timeline.MaterialControl.prototype.update=function(){var a=Human.assets.materials.materials[this._materialId];if(!a)return void(this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._targetMissing=!0));if(a.material){var b=a.material,c=this.attr;return c.baseColor&&b.setBaseColor(c.baseColor),c.specularColor&&b.setSpecularColor(c.specularColor),c.emitColor&&b.setEmitColor(c.emitColor),c.alphaColor&&b.setAlpha(c.alphaColor["float"]),!0}}}(),function(){"use strict";function a(d,e,f){var g=e.attr,h=e.tnt,i=e.cst,j=e.sat,k=e.brt,l=e.o;if(g&&(void 0!==g.pickable&&d.setPickable(g.pickable),void 0!==g.opacity&&d.setOpacity(g.opacity),void 0!==g.shown&&(Human.timeline.objectVisibilityUpdates[d.objectId]=g.shown)),l&&void 0!==l.val&&(c.value=l.val,void 0!==l.x&&(c.range={center:[l.x,l.y,l.z],minRadius:l.rmin,maxRadius:l.rmax}),d.setOpacityModifier("__OPACITY_TWEEN_"+f,c)),h&&void 0!==h.r&&(b.applyTo="tintColor",b.value=[h.r,h.g,h.b],void 0!==h.x&&(b.range={center:[h.x,h.y,h.z],minRadius:h.rmin,maxRadius:h.rmax}),d.setColorModifier("__TINT_COLOR_TWEEN_"+f,b)),i&&void 0!==i.val&&(b.applyTo="contrast",b.value=i.val,void 0!==i.x&&(b.range={center:[i.x,i.y,i.z],minRadius:i.rmin,maxRadius:i.rmax}),d.setColorModifier("_CONTRAST_TWEEN_"+f,b)),j&&void 0!==j.val&&(b.applyTo="saturation",b.value=j.val,void 0!==j.x&&(b.range={center:[j.x,j.y,j.z],minRadius:j.rmin,maxRadius:j.rmax}),d.setColorModifier("__SATURATION_TWEEN_"+f,b)),k&&void 0!==k.val&&(b.applyTo="brightness",b.value=k.val,void 0!==k.x&&(b.range={center:[k.x,k.y,k.z],minRadius:k.rmin,maxRadius:k.rmax}),d.setColorModifier("__BRIGHTNESS_TWEEN_"+f,b)),d.objects.length>0)for(var m=d.objects,n=0,o=m.length;o>n;n++)a(m[n],e,f)}Human.timeline.ObjectControl=function(a){var b=null;b=a.objectId?[a.objectId]:a.objectIds;for(var c=0,d=b.length;d>c;++c){var e=b[c];e.indexOf(".")<0&&e.indexOf("-")<0&&(b[c]=a.modelId+"-"+e)}this._objectIds=b,this.id=a.id,this.attr={attr:{},tnt:{},cst:{},sat:{},brt:{},o:{}}},Human.timeline.ObjectControl.prototype.update=function(){for(var b=0,c=this._objectIds.length;c>b;++b){var d=this._objectIds[b],e=Human.scene.objects[d];if(!e)return void(this._targetMissing||(Human.log.warn("Human.timeline.TweenAnimation","'lerp:objectAttr' tween can't find object: "+d),this._targetMissing=!0));var f=Human.timeline.activeRoot._nowBranch.synchronization[d];f&&f.shown===!1||a(e,this.attr,this.id)}};var b={applyTo:null,value:0,range:null},c={value:0,range:null}}(),function(){"use strict";Human.timeline.ObjectTransformControl=function(a){var b=a.objectId,c=a.initial;b.indexOf(".")<0&&b.indexOf("-")<0&&(b=a.modelId+"-"+a.objectId),this._objectId=b;var d=this.attr={};["translate","rotate","scale","pivot"].forEach(function(a){var b="scale"===a?1:0;void 0!==c[a]&&(d[a]={},void 0!==c[a].x&&(d[a].x=b),void 0!==c[a].y&&(d[a].y=b),void 0!==c[a].z&&(d[a].z=b))})},Human.timeline.ObjectTransformControl.prototype.update=function(){var a=Human.scene.objects[this._objectId];if(!a)return void(this._targetMissing||(Human.log.warn("Human.timeline.ObjectTransformControl","Can't find object: "+this._objectId),this._targetMissing=!0));var b=!0;(void 0===b||null===b||b===!0)&&a.setTransform(this.attr)}}(),function(){"use strict";Human.timeline.TextureControl=function(a){return this._material=a.modelId+"/"+a.materialId,void 0===a.targetLayer||null===a.targetLayer?void Human.log.error("Human.timeline.TweenAnimation","'texture' tween attribute expected: 'targetLayer'"):(this._targetLayer=a.targetLayer,void(this.attr={rotate:{z:0},translate:{x:0,y:0},scale:{x:1,y:1},blend:{factor:1}}))},Human.timeline.TextureControl.prototype.update=function(){var a=Human.assets.materials.materials[this._material];if(!a)return void(this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._material),this._targetMissing=!0));var b=a.textures;if(this._targetLayer>=0&&this._targetLayer<b.length){var c=b[this._targetLayer],d=this.attr;d.scale&&c.setScale(d.scale),d.translate&&c.setTranslate(d.translate),void 0!==d.rotate&&null!==d.rotate&&c.setRotate(d.rotate.z),void 0!==d.blend&&null!==d.blend&&c.setBlendFactor(d.blend.factor)}}}(),function(){"use strict";Human.timeline.FresnelControl=function(a){this._materialId=a.modelId+"/"+a.materialId,this._fresnelType=a.fresnelType,"baseFresnel"===this._fresnelType&&(this._fresnelType="colorFresnel"),this.attr={bias:{edge:0,center:.7,power:1},edge:{r:.8,g:.7,b:.7},center:{r:.05,g:.05,b:.09}}},Human.timeline.FresnelControl.prototype.update=function(){if(!this._fresnel){var a=Human.assets.materials.materials[this._materialId];if(!a)return void(this._materialMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._materialMissing=!0));var b=this._fresnelType.length<=7?this._fresnelType:this._fresnelType.substring(0,this._fresnelType.length-7);if(this._fresnel=a.fresnels[b],!this._fresnel)return void(this._fresnelMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find fresnel type: "+this._fresnelType),this._fresnelMissing=!0))}var c=this.attr.bias;return this._fresnel.setEdgeBias(c.edge),this._fresnel.setCenterBias(c.center),this._fresnel.setPower(c.power),this._fresnel.setEdgeColor(this.attr.edge),this._fresnel.setCenterColor(this.attr.center),!0}}(),function(){"use strict";Human.timeline.ParticleSystemControl=function(a){this.particleSystemId=a.particleSystemId,this.attr={attr:{}},this._targetMissing=!1},Human.timeline.ParticleSystemControl.prototype.update=function(){var a=Human.particles.systems[this.particleSystemId];if(!a)return void(this._targetMissing||(Human.log.warn("ParticleSystemControl: can't find system: "+this.particleSystemId),this._targetMissing=!0));var b=this.attr.attr;a.enabled&&b&&(void 0!==b.emissionAverage&&(a.emissionAverage=b.emissionAverage),void 0!==b.emissionVariance&&(a.emissionVariance=b.emissionVariance))}}(),function(){"use strict";var a=vec3.create(),b=vec3.create();Human.timeline.ParticleComponentControl=function(a){this.particleSystemId=a.particleSystemId,this.componentId=a.componentId,this.attr={attr:{},position:{},translate:{},scale:{},rotate:{},directionAverage:{},shapeTranslate:{},shapeScale:{},shapeRotate:{}},this._targetMissing=!1},Human.timeline.ParticleComponentControl.prototype.update=function(){var c=Human.particles.systems[this.particleSystemId];if(!c)return void(this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find system: "+this.particleSystemId),this._targetMissing=!0));var d=c.components[this.componentId];if(!c)return void(this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find component: "+this.componentId),this._targetMissing=!0));var e=d.shape;if(c.enabled){var f=this.attr.attr,g=this.attr.position,h=this.attr.translate,i=this.attr.scale,j=this.attr.rotate,k=this.attr.directionAverage,l=this.attr.shapeTranslate,m=this.attr.shapeRotate,n=this.attr.shapeScale;if(f&&(void 0!==f.average&&(d.average=f.average),void 0!==f.variance&&(d.variance=f.variance),void 0!==f.forceAverage&&(d.forceAverage=f.forceAverage),void 0!==f.forceVariance&&(d.forceVariance=f.forceVariance),void 0!==f.frequency&&(d.frequency=f.frequency),void 0!==f.friction&&(d.friction=1-f.friction),void 0!==f.radius&&(d.radius=f.radius),void 0!==f.directionVariance&&(d.directionVariance=f.directionVariance)),g&&void 0!==g.x&&(a[0]=g.x,a[1]=g.y,a[2]=g.z,d.position.set(a)),h&&void 0!==h.x&&(a[0]=h.x,a[1]=h.y,a[2]=h.z,d.translate.set(a)),(i||j)&&d.xform){var o=null,p=null;i&&void 0!==i.x&&(o=a,o[0]=i.x,o[1]=i.y,o[2]=i.z),j&&void 0!==j.x&&(p=b,p[0]=j.x,p[1]=j.y,p[2]=j.z),Human.math.buildRotationScaleMat3(d.xform,p,o)}k&&void 0!==k.x&&(a[0]=k.x,a[1]=k.y,a[2]=k.z,vec3.normalize(d.directionAverage,a)),e&&(l&&void 0!==l.x&&(a[0]=l.x,a[1]=l.y,a[2]=l.z,e.translate.set(a)),m&&void 0!==m.x&&(a[0]=m.x,a[1]=m.y,a[2]=m.z,e.rotate.set(a)),n&&void 0!==n.x&&(a[0]=n.x,a[1]=n.y,a[2]=n.z,e.scale.set(a)),e.updateXform())}}}(),function(){"use strict";var a=Human.timeline.LeafTimeline=function(a,b){var c=this;b=b||{},c.level="leaf",c.id=a,c.animations={},c.timelineAnimations={},c.freeAnimations={},c.cameraTween=null,c.animationCtx={cameraEnabled:!0},Human.timeline.leafTimelines[c.id]=c};a.prototype.addAnimation=function(a,b){var c=this;if(!b)return void Human.log.error("LeafTimeline.addAnimation","null or undefined animation object");if(!b.update)return void Human.log.error("LeafTimeline.addAnimation","Param expected: update");if(c.animations[a]&&c.removeAnimation(a),c.animations[a]=b,b.timeline===!1?c.freeAnimations[a]=b:c.timelineAnimations[a]=b,!c.cameraTween){var d,e,f,g=!1,h=b._tweens||[],i=Human.timeline.CameraControl;for(d=0,e=h.length;e>d&&!g;d++)f=h[d],f._control&&f._control instanceof i&&(g=!0,c.cameraTween=f)}Human.events.fire("Timeline.Loaded")},a.prototype.removeAnimation=function(a){var b=this,c=b.animations[a];return c?(a in b.freeAnimations?delete b.freeAnimations[a]:delete b.timelineAnimations[a],delete b.animations[a],void(c.destroy&&c.destroy())):void Human.log.warn("Human.timeline.LeafTimeline.removeAnimation","Animation not found: "+a)},a.prototype.getTimeFrame=function(){var a,b,c=this,d=!1,e=0,f=c.timelineAnimations;for(var g in f)f.hasOwnProperty(g)&&(d=!0,b=f[g].lastTime,e=Math.max(e,b));return a={firstTime:0,lastTime:e}},a.prototype.update=function(a,b,c){var d=this;c=c||{};var e,f={cameraEnabled:a===!1?a:d.animationCtx.cameraEnabled},g=d.timelineAnimations;for(var h in g)g.hasOwnProperty(h)&&(e=g[h],"lerp:camera"===e.type?e.update(b):e.update(f,b))},a.prototype.destroy=function(){var a=this;a.animations={},a.freeAnimations={},a.timelineAnimations={},a.cameraTween=null,delete Human.timeline.leafTimelines[a.id]},a.prototype.unload=function(a){var b,c=this,d="tweens"===a?Human.timeline.TweenAnimation:Human.assets.morphs.Animation;for(b in c.animations)c.animations.hasOwnProperty(b)&&c.animations[b]instanceof d&&(delete c.animations[b],Human.timeline.removeAnimation(b))},a.prototype.getCamera=function(a){var b=this;return null===b.cameraTween||void 0===b.cameraTween?null:b.cameraTween.query(b.cameraTween._control,a)}}(),function(){"use strict";var a=Human.timeline.BranchTimeline=function(a){var b=this;b._onEndOptions=["loop","freeze"],b.level="branch",b.timeRange=null,b.id=a.id,b.maps={},a.timelineMap.forEach(function(a,c){b.makeMapComponent(a,c)}),b.media={};for(var c in a.media)a.media.hasOwnProperty(c)&&b.addClip(c,a.media[c]);b.info={displayName:a.displayName||"",description:a.description||""},b.synchronization=a.synchronization,b.properties=a.properties||{},b.annotations=a.annotations||[],b.hotspots=a.hotspots||[],"alphaToCoverage"===a.transparencyMode&&(a.transparencyMode=null),b.transparencyMode=a.transparencyMode||"alpha","weightedOIT"!==b.transparencyMode||SceneJS.WEBGL_INFO.floatTexturesSupported||(b.transparencyMode=a.fallbackTransparency||"alpha"),b.viewModes=a.viewModes||{},b.options=a.options||{},a.hasOwnProperty("xray")&&(b.viewModes.xray=a.xray),b.camera={},a.camera?b.camera=a.camera:(a.jumpTo?(b.camera.action="jumpTo",b.camera.location=a.jumpTo,a.jumpTo.hasOwnProperty("screenPan")&&(b.camera.screenPan=a.jumpTo.screenPan),a.jumpTo.hasOwnProperty("rotationCenter")&&(b.camera.rotationCenter=a.jumpTo.rotationCenter)):a.flyTo&&(b.camera.action="flyTo",b.camera.location=a.flyTo,a.flyTo.hasOwnProperty("screenPan")&&(b.camera.screenPan=a.flyTo.screenPan),a.flyTo.hasOwnProperty("rotationCenter")&&(b.camera.rotationCenter=a.flyTo.rotationCenter)),a.options&&a.options.screenPan?b.camera.screenPan=a.options.screenPan:a.hasOwnProperty("screenPan")&&(b.camera.screenPan=a.screenPan)),b.animation={loop:!1},a.loop&&(b.animation.loop=!0),b.background=a.background||{},b.clippingPlanes=a.clippingPlanes||{},b.effects=a.effects,b.ui=a.ui||{},b.lights=a.lights,b.graph=a.graph||{},b.firstUpdate=!0,b.initializedCamera=!1,b.initializedAnnotations=!1,b.initializedProperties=!1,b.initializedGraph=!1,b.initializedHotspots=!1,b.initializedParticles=!1,b.initializedClippingPlanes=!1,b.initializedPostprocess=!1,b.initializedTransparencyMode=!1,b.customData=a.customData||{},b.particleSystems=b.customData.particleSystems||[],b.postprocess=b.customData.postprocess||[],b.translations=b.translations||{},Human.timeline.branchTimelines[b.id]=b};a.prototype.addClip=function(a,b){var c=this;c.media.hasOwnProperty(a)&&delete c.media[a];var d={data:b,published:!1};d.publish=function(){Human.events.fire(b.streamType+".suggestedClipInfo",this.data),Human.events.fire(b.streamType+".suggestedClips",[this.data.clipId],!0),this.published=!0},d.update=function(a){this.data.time1<=a&&a<=this.data.time2&&(this.published||this.publish())},c.media[a]=d},a.prototype.makeMapComponent=function(a,b){var c=this,d={};if(d.mapId=a.data.timeline+"_"+b,d.start=a.start,d.end=a.end,d.data=a.data,Human.timeline.leafTimelines.hasOwnProperty(a.data.timeline))d.data.timeline=Human.timeline.leafTimelines[a.data.timeline];else{var e=new Human.timeline.LeafTimeline(a.data.timeline);d.data.timeline=e}var f,g;if(d.data.fit){var h=d.data.end-d.data.start,i=d.end-d.start;f=h/i,g=d.data.start,d.calcChildTime=function(a){return f*(a-d.start)+g}}else f=1,g=d.data.start,"freeze"===d.data.onEnd?d.calcChildTime=function(a){var b=f*(a-d.start)+g;return Math.min(b,d.data.end)}:"loop"===d.data.onEnd?d.calcChildTime=function(a){var b=d.data.end-d.data.start,c=a-d.start;return c-b*Math.floor(c/b)+g}:Human.log.warn("WARNING: invalid onEnd property for branch timeline map data.");c.maps[d.mapId]=d,c.timeRange=c.getTimeFrame()},a.prototype._getAudio=function(){var a=this,b=[];for(var c in a.media)a.media.hasOwnProperty(c)&&"audio"===a.media[c].data.streamType&&b.push(a.media[c].data);return b},a.prototype.getTimeFrame=function(){var a=this,b=0;for(var c in a.maps)a.maps.hasOwnProperty(c)&&a.maps[c].end>b&&(b=a.maps[c].end);0===b&&(b=2);var d={firstTime:0,lastTime:b};return d},a.prototype.getCamera=function(a){var b=this;"end"===a?a=b.getTimeFrame().lastTime:"start"===a&&(a=0);var c=b.getAnimatedCamera(a);if(c)return c.screenPan=c.screenPan||b.options.screenPan,c;if(!Human.utils.isEmpty(b.camera))return c=b.camera.location,c.screenPan=b.options.screenPan,c;var d=Human.renderer.camera._startcamera;return d.screenPan=b.options.screenPan,d},a.prototype.getAnimatedCamera=function(a){var b=this,c=b.getTimeFrame();"start"===a||a<c.startTime?a=c.startTime:("end"===a||"last"===a||a>c.lastTime)&&(a=c.lastTime);var d=b.whichCameraMap(0);if(null===d||void 0===d)return null;if(!(a>=d.start&&a<=d.end))return null;var e=d.data.timeline,f=d.calcChildTime(a),g=e.getCamera(f);return null!==g&&void 0!==g?g:void 0},a.prototype.whichCameraMap=function(a){var b,c=this,d=c.whichMaps(a);for(b=0;b<d.length;b++)if(d[b].map.data.timeline.cameraTween)return d[b].map;return null},a.prototype.reset=function(){var a=this;a.firstUpdate=!0,a.initializedGraph=!1,a.initializedCamera=!1,a.initializedHotspots=!1,a.initializedProperties=!1,a.initializedAnnotations=!1,a.initializedParticles=!1,a.initializedClippingPlanes=!1,a.initializedPostprocess=!1,a.initializedTransparencyMode=!1;var b,c,d=a.media;for(b in d)d.hasOwnProperty(b)&&(c=d[b],c.published=!1)},a.prototype.whichMaps=function(a){var b=this,c=[],d=[];"start"===a?a=0:"end"===a&&(a=b.getTimeFrame().lastTime);for(var e in b.maps)if(b.maps.hasOwnProperty(e)){var f=b.maps[e];a>=f.start&&a<=f.end&&c.push(e)}return c.every(function(a){var c=b.maps[a],e={map:c};return"leaf"===c.data.timeline.level?(e.camera=!0,d.push(e)):(e.camera=!1,d.unshift(e)),!0}),d},a.prototype.getChildLeafTimelines=function(a){var b=this,c=b.whichMaps(a),d={};return c.every(function(b){var c=b.map.data.timeline.id,e=b.map.calcChildTime(a);return d[c]=e,!0}),d},a.prototype.getUniqueLeafTimelines=function(){var a=this,b={};for(var c in a.maps)if(a.maps.hasOwnProperty(c)){var d=a.maps[c];b[d.data.timeline.id]=d.data.timeline}return b},a.prototype.initCamera=function(a,b){var c=this,d=c.whichCameraMap(a);d||c.camera.ignore?d?"flyTo"===c.camera.action?Human.renderer.camera.fly.flyTo(c.getCamera(a),function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}):Human.renderer.camera.fly.jumpTo(c.getCamera(a),function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}):b&&b():(c.camera.screenPan&&Human.renderer.camera.setScreenPan(c.camera.screenPan),"flyTo"===c.camera.action?Human.renderer.camera.fly.flyTo(c.camera.location,function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}):Human.renderer.camera.fly.jumpTo(c.camera.location,function(){if(c.camera.rotationCenter){var a=c.camera.rotationCenter;Human.renderer.camera.setRotationCenter(a[0],a[1],a[2])}b()}))},a.prototype.initAnnotations=function(a){var b=this;Human.view&&(Human.view.annotations.clearAnnotations(),a.forEach(function(a,c){var d="___"+b.id+"."+c;if(!a.pos&&a.objectId){var e=Human.scene.objects[a.objectId];e&&(a.pos=e.getCenter())}a.annotationId=d,a.title=a.title||"",a.description=a.description||"",a.dir=a.pinVec||a.dir,a.type=a.type||"default",a.enabled="secondary"!==a.type,a.shown="secondary"!==a.type,a.labelShown="secondary"!==a.type,a.labelOffset=a.labelOffset||null,a.saved=!0,Human.view.annotations.createAnnotation(a)}))},a.prototype.initGraph=function(a){Human.scene.setObjectProperties(a)},a.prototype.initProperties=function(){var a=this;Human.renderer.lights.clearEnabled(),Human.renderer.lights.setEnabled(unpackChapterLights(a.lights)),Human.view&&Human.view.setViewModes(a.viewModes),Human.properties.applyDefaults(),Human.properties.set(a.properties)},a.prototype.initParticles=function(){for(var a=0,b=this.particleSystems.length;b>a;++a)Human.particles.enable(this.particleSystems[a])},a.prototype.initClippingPlanes=function(){Human.renderer.clip.reset();var a;for(a in this.clippingPlanes.clips)if(this.clippingPlanes.clips.hasOwnProperty(a)){var b=Human.utils.shallowClone(this.clippingPlanes.clips[a]);b.boundary=this.clippingPlanes.boundary,Human.renderer.clip.setClip(b)}},a.prototype.initPostprocess=function(){Human.renderer.postprocess.parse(this.postprocess)},a.prototype.initTransparencyMode=function(){Human.renderer.setTransparencyMode(this.transparencyMode)},a.prototype.init=function(a,b,c){var d=this;Human.events.fire("timeline.chapters.activate.start",{chapterId:d.id,params:b}),d.timeRange=d.getTimeFrame(),b.camera&&!d.initializedCamera&&(d.initializedCamera=!0,d.initCamera(a,b.cameraCallback||function(){})),b.graph&&!d.initializedGraph&&(d.initializedGraph=!0,d.initGraph(d.synchronization)),b.properties&&!d.initializedProperties&&(d.initializedProperties=!0,d.initProperties()),b.particles&&!d.initializedParticles&&(Human.particles.disableAll(),Human.particles.resetAll(),d.initializedParticles=!0,d.initParticles()),b.clipping&&!d.initializedClippingPlanes&&(d.initializedClippingPlanes=!0,d.initClippingPlanes()),b.postprocess&&!d.initializedPostprocess&&(d.initializedPostprocess=!0,d.initPostprocess()),b.transparencyMode&&!d.initializedTransparencyMode&&(d.initializedTransparencyMode=!0,d.initTransparencyMode()),Human.events.fire("timeline.chapters.initializing",{chapterId:d.id,params:b}),c&&c(),Human.events.fire("timeline.chapters.activate.finish",{chapterId:d.id})},a.prototype.uninit=function(a,b){var c=this;Human.events.fire("timeline.chapter.deactivate.start"),c.initGraph({}),c.initAnnotations([]),b&&b(),Human.events.fire("timeline.chapter.deactivate.finish")},a.prototype.update=function(a,b,c){b=b||{};var d=this;d.firstUpdate&&(d.firstUpdate=!1,b.hasOwnProperty("camera")||(b.camera=!d.initializedCamera),b.hasOwnProperty("annotations")||(b.annotations=!d.initializedAnnotations),b.hasOwnProperty("properties")||(b.properties=!d.initializedProperties),b.hasOwnProperty("graph")||(b.graph=!d.initializedGraph),b.hasOwnProperty("particles")||(b.particles=!d.initializedParticles),b.hasOwnProperty("clipping")||(b.clipping=!d.initializedClippingPlanes),b.hasOwnProperty("postprocess")||(b.postprocess=!d.initializedPostprocess),b.hasOwnProperty("transparencyMode")||(b.transparencyMode=!d.initializedTransparencyMode),d.init(a,b,function(){})),d._update2(a),c&&c()},a.prototype._update2=function(a){var b=this;(null===b.timeRange||void 0===b.timeRange)&&(b.timeRange=b.getTimeFrame());var c=b.timeRange;"start"===a||a<c.startTime?a=c.startTime:("end"===a||"last"===a||a>c.lastTime)&&(a=c.lastTime);var d=b.whichMaps(a);d.forEach(function(b){var c=b.map,d=b.camera,e=c.data.timeline,f=c.calcChildTime(a);return e.update(d,f),!0});for(var e in b.media)b.media.hasOwnProperty(e)&&b.media[e].update(a)},a.prototype.destroy=function(){var a=this,b=a.getUniqueLeafTimelines();for(var c in b)b.hasOwnProperty(c)&&"dummy"!==c&&b[c].destroy();delete Human.timeline.branchTimelines[a.id]}}(),function(){"use strict";var a=Human.timeline.RootTimeline=function(a,b){b=b||{};var c=this;c.id=a,c.level="root",c.animationOptions={},c._theQueue=[],c._chapters=[],c._times=[],c._timeFrame=null,c.freeAnimations={},c._firstUpdate=!0,c._prevBranch=null,c._prevTime=null,c._nowBranch=null,c._nowTime=null};a.prototype.setAnimationOptions=function(a,b){var c=this;b=b||{},a.animation&&(c.animationOptions=a.animation)},a.prototype.addChapter=function(a,b){var c=this;b=b||{};var d=b.hasOwnProperty("rebuild")?b.rebuild:!0,e=b.position||c._chapters.length;(0>e||e>c._chapters.length)&&Human.log.warn("RootTimeline.addChapter(): Invalid index "+e+"position"),c._chapters.splice(e,0,a),d&&c.build()},a.prototype.activate=function(a,b,c){var d=this;Human.timeline.activeRoot=d;var e=d.mapGlobalTime(a,{which:"second",direction:"forwards"});Human.events.fire("timeline.chapters.updated",d._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:d._timeFrame.firstTime,lastTime:d._timeFrame.lastTime}),Human.timeline.stop(),e.branch.init(e.time,b,function(){}),Human.timeline.activeRoot.update(a,{which:"second",direction:"forwards"}),Human.timeline.time=a,Human.timeline._time1=a,Human.timeline._time2=a,Human.timeline._freeTime=a,c()},a.prototype.deactivate=function(a,b){var c=this;null!==Human.timeline.activeRoot&&Human.timeline.activeRoot.id===c.id&&(Human.events.fire("timeline.chapters.updated",[]),Human.events.fire("timeline.timeFrame.updated",{firstTime:0,lastTime:0}),Human.timeline.activeRoot=null,Human.timeline.stop(),Human.timeline.time=0,Human.timeline._time1=0,Human.timeline._time2=0,Human.timeline._freeTime=0,c._nowBranch.uninit(a,b))},a.prototype.getDescendentLeaves=function(){var a=this,b={};return a._chapters.forEach(function(a){var c=a.getChildLeafTimelines(0);for(var d in c)c.hasOwnProperty(d)&&(b.hasOwnProperty(d)||(b[d]=Human.timeline.leafTimelines[d]))}),b},a.prototype.getTimeFrame=function(a){var b=this;a=a||{};var c=0,d=b._chapters;return d.forEach(function(a){c+=a.getTimeFrame().lastTime}),{firstTime:0,lastTime:c}},a.prototype.whereIsBranch=function(a,b){var c=this;b=b||{};var d=0,e=!1,f=null,g=[];for(g=b.chapters===!0?c._chapters:c._theQueue;!e&&d<g.length;)e=g[d].id===a.id?!0:!1,e?f=d:d++;return f},a.prototype.getBranch=function(a){var b=this;a=a||{};var c,d,e=!1,f=0,g={};if(Human.utils.isEmpty(a))return null;for(Object.keys(a).length>1&&Human.log.warn("timeline.RootTimeline.getBranch","too many parameters, using only the first."),c=Object.keys(a)[0],d=a[c];!e&&f<b._theQueue.length;)g=b._theQueue[f],b._theQueue[f][c]===d&&(e=!0),f++;var h;return h=e?g:null},a.prototype.mapGlobalTime=function(a,b){var c=this;b=b||{},"end"===a?a=c.getTimeFrame().lastTime:"start"===a&&(a=0),0>a?a=0:a>c.getTimeFrame().lastTime&&(a=c.getTimeFrame().lastTime);var d="earlier";b.tie?d=b.tie:b.which&&b.direction&&("forwards"===b.direction?d="second"===b.which?"later":"earlier":"backwards"===b.direction&&(d="first"===b.which?"later":"earlier"));var e={branch:null,time:null,index:null},f=c._times.indexOf(a);if(f>=0){var g="later"!==d?f-1:f;g=0>g?c._theQueue.length-1:g,g=g>=c._times.length-1?0:g,e.branch=c._theQueue[g],e.time="later"!==d?a-c._times[g]:0,e.index=g}else{var h=Human.utils.binarySearch(c._times,a);e.branch=c._theQueue[h.index1],e.time=a-h.value1,e.index=h.index1}return e},a.prototype.mapBranchTime=function(a,b,c){var d=this;c=c||{};var e=0,f=d.whereIsBranch(a);return"end"===b?b=a.getTimeFrame().lastTime:"start"===b&&(b=0),e=null===f?null:d._times[f]+b},a.prototype.getNeighborChapter=function(a,b,c){var d=this;c=c||{};var e=null,f=null;if(b="previous"===b?"previous":"next",a instanceof Human.timeline.BranchTimeline)e=a;else{if("number"!=typeof a)return Human.log.warn("timeline.root.getNeighborChapter","invalid 'now' argument :"+JSON.stringify(a)),null;var g="later"===c.tie?"later":"earlier";e=d.mapGlobalTime(a,{tie:g})}if(f=d.whereIsBranch(e),0===f&&"previous"===b)return null;if(f===d._theQueue.length-1&&"next"===b)return null;var h=f;return"next"===b?h++:h--,d._theQueue[h]},a.prototype.isFirst=function(a){var b=this;return a.id===b._theQueue[0].id?!0:!1},a.prototype.isLast=function(a){var b=this,c=b._theQueue.length-1;return a.id===b._theQueue[c].id?!0:!1},a.prototype.buildFreeAnimations=function(a){var b=this;a=a||{};var c=b.getDescendentLeaves();for(var d in c)if(c.hasOwnProperty(d)){var e=c[d].freeAnimations;for(var f in e)e.hasOwnProperty(f)&&!b.freeAnimations.hasOwnProperty(f)&&(b.freeAnimations[f]=e[f])}},a.prototype.buildQueue=function(a){var b=this;a=a||{},b._theQueue=[];var c=0;b._times=[c],b._chapters.forEach(function(a){c+=a.getTimeFrame().lastTime,b._theQueue.push(a),b._times.push(c)})},a.prototype.build=function(a){var b=this;a=a||{},b._theQueue=[],b._times=[],b.buildFreeAnimations(),b.buildQueue(),Human.timeline.rootTimelines[b.id]&&delete Human.timeline.rootTimelines[b.id],Human.timeline.rootTimelines[b.id]=b,b._timeFrame=b.getTimeFrame(),null===b._nowBranch?(b._nowBranch=b._theQueue[0],b._nowTime=0,b._prevBranch=b._nowBranch,b._prevTime=0):null===b.whereIsBranch(b._nowBranch)&&(b._nowBranch=b._theQueue[0],b._nowTime=0,null===b._prevBranch?(b._prevBranch=b._nowBranch,b._prevTime=b._nowTime):null===b.whereIsBranch(b._prevBranch)&&(b._prevBranch=b._nowBranch,b._prevTime=b._nowTime)),Human.events.fire("timeline.chapters.updated",b._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:b._timeFrame.firstTime,lastTime:b._timeFrame.lastTime})},a.prototype.destroy=function(){var a=this;a._theQueue.forEach(function(a){Human.timeline.branchTimelines.hasOwnProperty(a.id)&&a.destroy()}),Human.timeline.rootTimelines.hasOwnProperty(a.id)&&delete Human.timeline.rootTimelines[a.id]},a.prototype.updateFreeAnimations=function(a){var b=this;for(var c in b.freeAnimations)b.freeAnimations.hasOwnProperty(c)&&b.freeAnimations[c].update({cameraEnabled:!1},a);for(var d=b._nowBranch.particleSystems,e=0,f=d.length;f>e;++e)Human.particles.update(d[e],a)},a.prototype.update=function(a,b,c){var d=this;b=b||{};var e={},f=[];"function"!=typeof c&&(c=function(){}),e={which:"both",direction:"forwards"},b.hasOwnProperty("which")&&(e.which=b.which),b.hasOwnProperty("direction")&&(e.direction=b.direction),0>a?(a=0,Human.log.warn("Time violates lower bound. Updating to time = 0.0")):a>d._timeFrame.lastTime&&(a=d._timeFrame.lastTime,Human.log.warn("Time violates upper bound. Updating to time = "+a)),f=d._getBranchesToUpdate(a,e),d._firstUpdate&&(d._nowBranch=f[0].branch,d._nowTime=f[0].time,d._firstUpdate=!1);var g=!1;f.forEach(function(a){d._prevBranch=d._nowBranch,d._prevTime=d._nowTime,g=a.branch.firstUpdate,d._nowBranch=a.branch,d._nowTime=a.time,a.branch.update(a.time,{},c),g&&Human.events.fire("timeline.chapters.activated",d._assembleChaptersActivated())}),d._prevBranch.id!==d._nowBranch.id&&d._prevBranch.reset()},a.prototype._getBranchesToUpdate=function(a,b){var c=this;return c._times.indexOf(a)>=0?c._getBorderBranches(a,b):[c.mapGlobalTime(a,{tie:"earlier"})]},a.prototype._getBorderBranches=function(a,b){var c=this,d=c.mapGlobalTime(a,{tie:"earlier"}),e=c.mapGlobalTime(a,{tie:"later"}),f=[d,e];return"backwards"===b.direction&&(f=[e,d]),"first"===b.which?f.splice(1,1):"second"===b.which&&f.splice(0,1),f},a.prototype._assembleChaptersUpdated=function(){var a,b,c,d,e=this,f=[],g=e._chapters;for(a=0,b=g.length;b>a;a++)c=g[a],d={chapterId:c.id,time:e.mapBranchTime(c,0),duration:c.getTimeFrame().lastTime,displayName:c.info.displayName,description:c.info.description,loop:c.animation.loop,index:a},f.push(d);return f},a.prototype._assembleChaptersActivated=function(){var a=this,b={};return b.oldChapterIndex=a.whereIsBranch(a._prevBranch,{chapters:!0}),b.newChapterIndex=a.whereIsBranch(a._nowBranch,{chapters:!0}),b.time=a.mapBranchTime(a._nowBranch,a._nowTime),b.loop=a._nowBranch.animation.loop||!1,b.branchID=a._nowBranch.id,b},a.prototype._assembleQueryChapters=function(){var a,b,c,d=this,e=[],f=d._chapters;for(a=0,b=f.length;b>a;a++)c=f[a],e.push({chapterId:c.id,time:d.mapBranchTime(c,0),displayName:c.info.displayName,description:c.info.description,type:"branch",tags:c.tags||[],annotations:c.annotations,hotspots:null,flyTo:c.camera.location,active:d._nowBranch.id===c.id,sounds:c._getAudio(),translations:c.translations||null});return e}}(),function(){"use strict";function a(a,d){var e=a.id||"ps"+b++,f=a.numParticles,g={properties:a.properties,material:a.material,textures:a.textures,spriteRows:a.spriteRows||0,spriteCols:a.spriteCols||0,spriteStartFrame:a.spriteStartFrame||0,spriteEndFrame:a.spriteEndFrame||0};0===g.spriteEndFrame&&g.spriteRows>0&&g.spriteCols>0&&(g.spriteEndFrame=g.spriteRows*g.spriteCols-1);var h,i,j,k,l,m,n,o,p,q=[],r=[],s=[],t={},u=0,v=a.creators||[],w=a.updaters||[],x=a.constraints||[],y=0,z=null,A=null;for(j=0,k=v.length;k>j;++j)o=v[j],m=o.id||"__CR"+ ++u,t[m]?Human.log.error("Component "+m+" already exists. Skipping."):(l=o.type,n=new c.creators[l](o,g),q.push(n),t[m]=n,"Lifetime"===l?g.lifetimes=!0:"SolidColor"===l?g.colors=!0:"RandomScale"===l||"RandomRotation"===l?g.scaleRotations=!0:"RandomRotationSpeed"===l?(g.scaleRotations=!0,g.rotationSpeeds=!0):"SpriteAnimationDuration"===l&&(g.uvTranslates=!0,
g.spriteFrameDuration=!0,g.spriteFrameCounter=!0,g.spriteCurrentTime=!0));var B=null,C=null;for(j=0,k=w.length;k>j;++j)if(p=w[j],m=p.id||"__UP"+ ++u,t[m])Human.log.error("Component "+m+" already exists. Skipping.");else{if(l=p.type,p.shape&&(h=p.shape,i=h.type,z=new c.shapes[i](h),A=h.direction||"in"),B=new c.updaters[l](p,g),"AgeColorBlend"===l)g.colors=!0,g.lifetimes=!0;else if("Path"===l){C=B;for(var D=p.nodes,E=0;E<D.length;++E)B.addNode(D[E]);g.paths=!0}else"SpriteAnimation"===l&&(g.uvTranslates=!0);z&&(B.shape=z,B.shapeDirection=A),r.push(B),t[m]=B}var F=null;for(j=0,k=x.length;k>j;++j)if(o=x[j],m=o.id||"__CN"+ ++u,t[m])Human.log.error("Component "+m+" already exists. Skipping.");else{l=o.type;var G;switch(o.shape&&(h=o.shape,i=h.type,z=new c.shapes[i](h),A=h.direction||"in"),o.trap?(G=y++,g.traps=!0):G=-1,l){case"LifetimeKill":case"LifetimeStop":F=new c.constraints[l](g);break;case"PathKill":case"PathRadius":case"PathStop":F=new c.constraints[l](C,g);break;case"ShapeBounce":case"ShapeStop":case"ShapeKill":F=new c.constraints[l](z,A,G,g)}s.push(F),t[m]=F}var H=g.textures||[];for(j=0,k=H.length;k>j;++j)H[j].src=window.localBaseDirectory+"content/states/"+H[j].src.replace(/^\/+/,"");Human.assets.textures.load(H,function(){var b=new c.ParticleSystem(f,g);b.creators=q,b.updaters=r,b.constraints=s,b.components=t,void 0!==a.emissionAverage&&(b.emissionAverage=a.emissionAverage),void 0!==a.emissionVariance&&(b.emissionVariance=a.emissionVariance),void 0!==a.maxSpeed&&(b.maxSpeed=a.maxSpeed),void 0!==a.pointSize&&b.pointSize(a.pointSize),c.systems[e]=b,d&&d()})}var b=0,c=Human.particles={creators:{},updaters:{},constraints:{},shapes:{},systems:{}},d={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};c.parse=function(b,c){function d(){0===--e&&c&&c()}b=Human.utils.deepClone(b);var e=b.length;if(0===e)return void(c&&c());for(var f=0,g=b.length;g>f;++f)a(b[f],d)},c.getBoundary=function(){d.xmin=Number.POSITIVE_INFINITY,d.ymin=Number.POSITIVE_INFINITY,d.zmin=Number.POSITIVE_INFINITY,d.xmax=Number.NEGATIVE_INFINITY,d.ymax=Number.NEGATIVE_INFINITY,d.zmax=Number.NEGATIVE_INFINITY;for(var a in c.systems){var b=c.systems[a].getBoundary();d.xmin=Math.min(d.xmin,b.xmin),d.ymin=Math.min(d.ymin,b.ymin),d.zmin=Math.min(d.zmin,b.zmin),d.xmax=Math.max(d.xmax,b.xmax),d.ymax=Math.max(d.ymax,b.ymax),d.zmax=Math.max(d.zmax,b.zmax)}return d},c.update=function(a,b){c.systems[a].update(b),Human.renderer.camera.nearFarDirty=!0},c.updateAll=function(a){for(var b in c.systems)c.systems.hasOwnProperty(b)&&c.update(b,a)},c.enable=function(a){c.systems[a].enable()},c.enableAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.enable(a)},c.disable=function(a){c.systems[a].disable()},c.disableAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.disable(a)},c.reset=function(a){c.systems[a].reset()},c.resetAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.reset(a)},c.destroy=function(a){c.systems[a]&&(c.systems[a].destroy(),delete c.systems[a])},c.destroyAll=function(){for(var a in c.systems)c.systems.hasOwnProperty(a)&&c.destroy(a)}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Uint8Array(4),d=new Float32Array(2),e=new Float32Array(1),f=new Float32Array(2),g={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},h=Human.particles.ParticleSystem=function(a,b){b=b||{};var c=b.material,d=b.textures,e=b.properties||{},f=e.layer||0,g=e.addBlend||!1,h=!!b.colors,i=!!b.lifetimes,j=!!b.paths,k=!!b.traps,l=Human.renderer.getScene(),m=!!b.scaleRotations,n=!!b.rotationSpeeds,o=!!b.uvTranslates,p=!!b.spriteFrameDuration,q=!!b.spriteFrameCounter,r=!!b.spriteCurrentTime;this.activeParticlesBegin=0,this.numParticles=0,this.maxSpeed=0,this.maxNumParticles=a,this.spriteRows=b.spriteRows||0,this.spriteCols=b.spriteCols||0,this.spriteStartFrame=b.spriteStartFrame||0,this.spriteEndFrame=b.spriteEndFrame||0,this.attributes={stopped:new Array(a),dead:new Array(a),positions:new Float32Array(3*a),velocities:new Float32Array(3*a),colors:h?new Uint8Array(4*this.maxNumParticles):null,lifetimes:i?new Float32Array(this.maxNumParticles):null,ages:i?new Float32Array(this.maxNumParticles):null,paths:j?new Uint8Array(this.maxNumParticles):null,traps:k?new Uint32Array(this.maxNumParticles):null,scaleRotations:m?new Float32Array(2*a):null,rotationSpeeds:n?new Float32Array(a):null,uvTranslates:o?new Float32Array(2*a):null,spriteFrameDuration:p?new Float32Array(a):null,spriteFrameCounter:q?new Uint8Array(a):null,spriteCurrentTime:r?new Float32Array(a):null},this.rootNode=null,this.properties=null,this.material=null,this.geometry=null;var s;if(e.enabled=!1,e.picking=!1,e.depthMask===!1&&(e.noDepthMask=!0),this.rootNode=this.properties=s=l.addNode({type:"properties",properties:e}),c&&(c.type="material",this.material=s=s.addNode(c)),d)for(var t=0,u=d.length;u>t;++t)d[t].type="texture",d[t].src=window.localBaseDirectory+"content/states/"+d[t].src,s=s.addNode(d[t]);var v=null;this.spriteRows>0&&this.spriteCols>0&&(v=new Float32Array([1/this.spriteCols,1/this.spriteRows])),this.geometry=s.addNode({type:"geometry",positions:this.attributes.positions,colors:this.attributes.colors,pointScaleRotations:this.attributes.scaleRotations,pointUVTranslates:this.attributes.uvTranslates,pointUVScale:v,layer:f,addBlend:g,primitive:"points"}),this.enabled=!1,this.emissionAverage=0,this.emissionVariance=0,this.creators=[],this.updaters=[],this.constraints=[],this.components={},this.previousTime=null};h.prototype.pointSize=function(a){this.geometry.setPointSize(a)},h.prototype.getBoundary=function(){return g},h.prototype.update=function(a){if(this.enabled){g.xmin=Number.POSITIVE_INFINITY,g.ymin=Number.POSITIVE_INFINITY,g.zmin=Number.POSITIVE_INFINITY,g.xmax=Number.NEGATIVE_INFINITY,g.ymax=Number.NEGATIVE_INFINITY,g.zmax=Number.NEGATIVE_INFINITY;var c=Math.max,d=Math.min,e=Math.sqrt,f=Math.floor,h=Math.random;this.previousTime=this.previousTime||a;var i=d(a-this.previousTime,.04);0>i&&(this.previousTime=a,i=0);var j,k,l,m,n,o,p,q,r=this.attributes,s=r.positions,t=r.velocities,u=r.ages,v=r.lifetimes,w=!!u,x=this.maxSpeed*i,y=x*x,z=r.scaleRotations,A=r.rotationSpeeds;if(this.numParticles<this.maxNumParticles){var B=this.emissionAverage*i,C=this.emissionVariance*i,D=c(B+2*h()*C-C,0);D=D>=1?f(D):h()<D?1:0;var E=d(this.numParticles+D,this.maxNumParticles);for(j=this.numParticles;E>j;++j)l=3*j,q=2*j,s[l]=0,s[l+1]=0,s[l+2]=0,t[l]=0,t[l+1]=0,t[l+2]=0,r.dead[j]=!1,r.stopped[j]=!1,r.paths&&(r.paths[j]=0),r.traps&&(r.traps[j]=0),r.traps&&(r.traps[j]=0),r.scaleRotations&&(r.scaleRotations[q]=1,r.scaleRotations[q+1]=0),r.rotationSpeeds&&(r.rotationSpeeds[j]=0),r.uvTranslates&&(r.uvTranslates[q]=this.spriteStartFrame%this.spriteCols*1/this.spriteCols,r.uvTranslates[q+1]=1*(this.spriteRows-1-f(this.spriteStartFrame/this.spriteCols))/this.spriteRows),r.spriteFrameCounter&&(r.spriteFrameCounter[j]=0),r.spriteFrameDuration&&(r.spriteFrameDuration[j]=0),r.spriteCurrentTime&&(r.spriteCurrentTime[j]=0);for(k=0,m=this.creators.length;m>k;++k)this.creators[k].create(this.numParticles,E,r);this.numParticles=E}for(k=0,m=this.updaters.length;m>k;++k)this.updaters[k].update(this.activeParticlesBegin,this.numParticles,r,i);for(j=this.activeParticlesBegin;j<this.numParticles;++j){if(l=3*j,q=2*j,n=l,o=l+1,p=l+2,b[0]=t[n]*i,b[1]=t[o]*i,b[2]=t[p]*i,y>0){var F=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];if(F>y){var G=e(F),H=x/G;b[0]*=H,b[1]*=H,b[2]*=H,t[n]=b[0],t[o]=b[1],t[p]=b[2]}}s[n]+=b[0],s[o]+=b[1],s[p]+=b[2],A&&(z[q+1]+=A[j]*i),g.xmin=d(g.xmin,s[n]),g.ymin=d(g.ymin,s[o]),g.zmin=d(g.zmin,s[p]),g.xmax=c(g.xmax,s[n]),g.ymax=c(g.ymax,s[o]),g.zmax=c(g.zmax,s[p]),w&&u[j]<v[j]&&(u[j]=d(u[j]+i,v[j]))}for(j=0;j<this.activeParticlesBegin;++j)l=3*j,n=l,o=l+1,p=l+2,g.xmin=d(g.xmin,s[n]),g.ymin=d(g.ymin,s[o]),g.zmin=d(g.zmin,s[p]),g.xmax=c(g.xmax,s[n]),g.ymax=c(g.ymax,s[o]),g.zmax=c(g.zmax,s[p]);for(k=0,m=this.constraints.length;m>k;++k)this.constraints[k].constrain(this.activeParticlesBegin,this.numParticles,r);var I=r.stopped,J=r.dead;for(j=this.activeParticlesBegin;j<this.numParticles;++j)J[j]?(this.kill(j),--j):I[j]&&this.stop(j);this.geometry.setPositions(r.positions.subarray(0,3*this.numParticles)),r.colors&&this.geometry.setColors(r.colors.subarray(0,4*this.numParticles)),r.scaleRotations&&this.geometry.setPointScaleRotations(r.scaleRotations.subarray(0,2*this.numParticles)),r.uvTranslates&&this.geometry.setPointUVTranslates(r.uvTranslates.subarray(0,2*this.numParticles)),this.properties.setEnabled(this.numParticles>0?!0:!1),this.previousTime=a}},h.prototype.kill=function(a){var b=this.attributes,c=2*a,d=3*a,e=4*a,f=a,g=2*(this.numParticles-1),h=3*(this.numParticles-1),i=4*(this.numParticles-1),j=this.numParticles-1,k=b.positions,l=b.velocities,m=b.colors,n=b.ages,o=b.lifetimes,p=b.paths,q=b.dead,r=b.stopped,s=b.traps,t=b.scaleRotations,u=b.rotationSpeeds,v=b.uvTranslates;k[d]=k[h],k[d+1]=k[h+1],k[d+2]=k[h+2],l[d]=l[h],l[d+1]=l[h+1],l[d+2]=l[h+2],q[f]=q[j],r[f]=r[j],m&&(m[e]=m[i],m[e+1]=m[i+1],m[e+2]=m[i+2],m[e+3]=m[i+3]),t&&(t[c]=t[g],t[c+1]=t[g+1]),u&&(u[f]=u[j]),v&&(v[c]=v[g],v[c+1]=v[g+1]),o&&(n[f]=n[j],o[f]=o[j]),p&&(p[f]=p[j]),s&&(s[f]=s[j]),this.numParticles--},h.prototype.stop=function(g){var h=this.attributes,i=2*g,j=3*g,k=4*g,l=g,m=2*this.activeParticlesBegin,n=3*this.activeParticlesBegin,o=4*this.activeParticlesBegin,p=this.activeParticlesBegin,q=h.positions,r=h.velocities,s=h.colors,t=h.ages,u=h.lifetimes,v=h.paths,w=h.stopped,x=h.traps,y=h.scaleRotations,z=h.rotationSpeeds,A=h.uvTranslates;a[0]=q[n],a[1]=q[n+1],a[2]=q[n+2],q[n]=q[j],q[n+1]=q[j+1],q[n+2]=q[j+2],q[j]=a[0],q[j+1]=a[1],q[j+2]=a[2],b[0]=r[n],b[1]=r[n+1],b[2]=r[n+2],r[n]=r[j],r[n+1]=r[j+1],r[n+2]=r[j+2],r[j]=b[0],r[j+1]=b[1],r[j+2]=b[2],s&&(c[0]=s[o],c[1]=s[o+1],c[2]=s[o+2],c[3]=s[o+3],s[o]=s[k],s[o+1]=s[k+1],s[o+2]=s[k+2],s[o+3]=s[k+3],s[k]=c[0],s[k+1]=c[1],s[k+2]=c[2],s[k+3]=c[3]),y&&(d[0]=y[m],d[1]=y[m+1],y[m]=y[i],y[m+1]=y[i+1],y[i]=d[0],y[i+1]=d[1]),z&&(e[0]=z[p],z[p]=z[g],z[g]=e[0]),A&&(f[0]=A[m],f[1]=A[m+1],A[m]=A[i],A[m+1]=A[i+1],A[i]=f[0],A[i+1]=f[1]);var B;u&&(B=t[p],t[p]=t[l],t[l]=B,B=u[p],u[p]=u[l],u[l]=B),v&&(B=v[p],v[p]=v[l],v[l]=B),x&&(B=x[p],x[p]=x[l],x[l]=B),w[l]=!1,this.activeParticlesBegin++},h.prototype.reset=function(){this.numParticles=0,this.activeParticlesBegin=0},h.prototype.enable=function(){this.properties.setEnabled(!0),this.enabled=!0},h.prototype.disable=function(){this.properties.setEnabled(!1),this.enabled=!1},h.prototype.destroy=function(){this.rootNode.destroy()}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.creators.DirectionalVelocity=function(a){this.directionAverage=new Float32Array(a.directionAverage),this.directionVariance=a.directionVariance||0,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,vec3.normalize(this.directionAverage,this.directionAverage)};b.prototype.create=function(b,c,d){for(var e=d.velocities,f=Math.random,g=vec3.normalize,h=b;c>h;++h){var i=3*h,j=this.forceAverage+2*f()*this.forceVariance-this.forceVariance;a[0]=this.directionAverage[0]+2*f()*this.directionVariance-this.directionVariance,a[1]=this.directionAverage[1]+2*f()*this.directionVariance-this.directionVariance,a[2]=this.directionAverage[2]+2*f()*this.directionVariance-this.directionVariance,g(a,a),e[i]=a[0]*j,e[i+1]=a[1]*j,e[i+2]=a[2]*j}}}(),function(){"use strict";var a=Human.particles.creators.Lifetime=function(a){this.average=a.average,this.variance=a.variance||0};a.prototype.create=function(a,b,c){for(var d=c.ages,e=c.lifetimes,f=Math.random,g=a;b>g;++g)d[g]=0,e[g]=this.average,this.variance>0&&(e[g]+=2*f()*this.variance-this.variance)}}(),function(){"use strict";var a=Human.particles.creators.PointPosition=function(a){this.position=new Float32Array(a.position)};a.prototype.create=function(a,b,c){for(var d=c.positions,e=a;b>e;++e){var f=3*e;d[f]=this.position[0],d[f+1]=this.position[1],d[f+2]=this.position[2]}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.creators.RandomVelocity=function(a){this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0};b.prototype.create=function(b,c,d){for(var e=d.velocities,f=Math.random,g=vec3.normalize,h=b;c>h;++h){var i=3*h,j=this.forceAverage;this.forceVariance>0&&(j+=2*f()*this.forceVariance-this.forceVariance),a[0]=2*f()-1,a[1]=2*f()-1,a[2]=2*f()-1,g(a,a),e[i]=a[0]*j,e[i+1]=a[1]*j,e[i+2]=a[2]*j}}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.creators.SpherePosition=function(a){this.translate=null,this.xform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,a.rotate,a.scale))};b.prototype.create=function(b,c,d){for(var e=d.positions,f=Math.random,g=Math.PI,h=Math.sin,i=Math.cos,j=b;c>j;++j){var k=3*j,l=f()*g,m=f()*g*2,n=f();a[0]=n*h(l)*h(m),a[1]=n*i(l),a[2]=n*h(l)*i(m),this.xform&&vec3.transformMat3(a,a,this.xform),this.translate&&(a[0]+=this.translate[0],a[1]+=this.translate[1],a[2]+=this.translate[2]),e[k]=a[0],e[k+1]=a[1],e[k+2]=a[2]}}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.creators.CubePosition=function(a){this.translate=null,this.xform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,a.rotate,a.scale))};b.prototype.create=function(b,c,d){for(var e=d.positions,f=Math.random,g=b;c>g;++g){var h=3*g;a[0]=f()-.5,a[1]=f()-.5,a[2]=f()-.5,this.xform&&vec3.transformMat3(a,a,this.xform),this.translate&&(a[0]+=this.translate[0],a[1]+=this.translate[1],a[2]+=this.translate[2]),e[h]=a[0],e[h+1]=a[1],e[h+2]=a[2]}}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.creators.CylinderPosition=function(a){this.translate=null,this.xform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,a.rotate,a.scale))};b.prototype.create=function(b,c,d){for(var e=d.positions,f=Math.random,g=Math.PI,h=Math.sin,i=Math.cos,j=b;c>j;++j){var k=3*j,l=f()*g*2,m=f(),n=2*f()-1;a[0]=m*i(l),a[1]=n,a[2]=m*h(l),this.xform&&vec3.transformMat3(a,a,this.xform),this.translate&&(a[0]+=this.translate[0],a[1]+=this.translate[1],a[2]+=this.translate[2]),e[k]=a[0],e[k+1]=a[1],e[k+2]=a[2]}}}(),function(){"use strict";var a=Human.particles.creators.RandomScale=function(a){this.average=a.average,this.variance=a.variance||0};a.prototype.create=function(a,b,c){for(var d=c.scaleRotations,e=Math.random,f=2*a,g=2*b,h=f;g>h;h+=2){var i=this.average;this.variance>0&&(i+=2*e()*this.variance-this.variance),d[h]=i}}}(),function(){"use strict";var a=Human.particles.creators.RandomRotation=function(a){this.average=a.average*Human.math.TO_RADIANS,this.variance=(a.variance||0)*Human.math.TO_RADIANS};a.prototype.create=function(a,b,c){for(var d=c.scaleRotations,e=Math.random,f=2*a+1,g=2*b+1,h=f;g>h;h+=2){var i=this.average;this.variance>0&&(i+=2*e()*this.variance-this.variance),d[h]=i}}}(),function(){"use strict";var a=Human.particles.creators.RandomRotationSpeed=function(a){this.average=a.average*Human.math.TO_RADIANS,this.variance=(a.variance||0)*Human.math.TO_RADIANS};a.prototype.create=function(a,b,c){for(var d=c.rotationSpeeds,e=Math.random,f=a;b>f;f++){var g=this.average;this.variance>0&&(g+=2*e()*this.variance-this.variance),d[f]=g}}}(),function(){"use strict";var a=Human.particles.creators.SpriteAnimationDuration=function(a,b){this.rows=b.spriteRows,this.cols=b.spriteCols,this.startFrame=b.spriteStartFrame,this.endFrame=b.spriteEndFrame,this.average=a.average,this.variance=a.variance};a.prototype.create=function(a,b,c){for(var d=c.spriteFrameDuration,e=Math.random,f=Math.max,g=a;b>g;g++){var h=this.average;this.variance>0&&(h+=2*e()*this.variance-this.variance),d[g]=f(h/(this.endFrame-this.startFrame),0)}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.BrownianMotion=function(a){this.frequency=a.frequency,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=vec3.normalize,j=!!this.shape,k=this.frequency*e,l=this.forceAverage*e,m=this.forceVariance*e,n=b;c>n;++n)if((!j||this.shape[this.shapeDirection](f,n))&&h()<k){var o=3*n,p=l;m>0&&(p+=2*h()*m-m),a[0]=2*h()-1,a[1]=2*h()-1,a[2]=2*h()-1,i(a,a),g[o]+=a[0]*p,g[o+1]+=a[1]*p,g[o+2]+=a[2]*p}}}(),function(){"use strict";var a=Human.particles.updaters.Friction=function(a){this.friction=1-a.friction,this.shape=null,this.shapeDirection="in"};a.prototype.update=function(a,b,c,d){for(var e=c.positions,f=c.velocities,g=!!this.shape,h=Math.pow(this.friction,d),i=a;b>i;++i)if(!g||this.shape[this.shapeDirection](e,i)){var j=3*i;f[j]*=h,f[j+1]*=h,f[j+2]*=h}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.UniformForce=function(a){this.directionAverage=new Float32Array(a.directionAverage),this.directionVariance=a.directionVariance||0,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in",vec3.normalize(this.directionAverage,this.directionAverage)};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=vec3.normalize,j=!!this.shape,k=this.forceAverage*e,l=this.forceVariance*e,m=b;c>m;++m)if(!j||this.shape[this.shapeDirection](f,m)){var n=3*m,o=k;l>0&&(o+=2*h()*l-l),a[0]=this.directionAverage[0],a[1]=this.directionAverage[1],a[2]=this.directionAverage[2],this.directionVariance&&(a[0]+=2*h()*this.directionVariance-this.directionVariance,a[1]+=2*h()*this.directionVariance-this.directionVariance,a[2]+=2*h()*this.directionVariance-this.directionVariance,i(a,a)),g[n]+=a[0]*o,g[n+1]+=a[1]*o,g[n+2]+=a[2]*o}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.RadialForce=function(a){this.position=new Float32Array(a.position),this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=vec3.normalize,j=!!this.shape,k=this.forceAverage*e,l=this.forceVariance*e,m=b;c>m;++m)if(!j||this.shape[this.shapeDirection](f,m)){var n=3*m,o=k;l&&(o+=2*h()*l-l),a[0]=f[n]-this.position[0],a[1]=f[n+1]-this.position[1],a[2]=f[n+2]-this.position[2],i(a,a),g[n]+=a[0]*o,g[n+1]+=a[1]*o,g[n+2]+=a[2]*o}}}(),function(){"use strict";var a=Human.particles.updaters.AgeColorBlend=function(a){this.colors=new Array(a.colors.length);for(var b=0,c=a.colors.length;c>b;++b)this.colors[b]=new Uint8Array(a.colors[b]);this.shape=null,this.shapeDirection="in"};a.prototype.update=function(a,b,c){for(var d=c.positions,e=c.ages,f=c.lifetimes,g=c.colors,h=!!this.shape,i=this.colors.length-1,j=Math.floor,k=a;b>k;++k)if(!h||this.shape[this.shapeDirection](d,k)){var l=4*k,m=e[k]/f[k]*i,n=j(m),o=n+1,p=this.colors[n],q=this.colors[o]||this.colors[n],r=m-n,s=1-r;g[l]=s*p[0]+r*q[0],g[l+1]=s*p[1]+r*q[1],g[l+2]=s*p[2]+r*q[2],g[l+3]=s*p[3]+r*q[3]}}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=Human.particles.updaters.Path=function(){this.nodes=[],this.shape=null,this.shapeDirection="in"};d.prototype.addNode=function(a){if(a.first=0===this.nodes.length,a.position=new Float32Array(a.position),a.forceVariance=a.forceVariance||0,this.nodes.push(a),a.first)a.vec=null,a.dir=null,a.length=null;else{var b=this.nodes[this.nodes.length-2];a.vec=vec3.subtract(vec3.create(),a.position,b.position),a.dir=vec3.normalize(vec3.create(),a.vec),a.length=vec3.length(a.vec)}},d.prototype.updateNode=function(a,b){var c=this.nodes[a];if(b.position){if(c.position=b.position,!c.first){var d=this.nodes[a-1];vec3.subtract(c.vec,c.position,d.position),vec3.normalize(c.dir,c.vec),c.length=vec3.length(c.vec)}if(a<this.nodes.length-1){var e=this.nodes[a+1];vec3.subtract(e.vec,e.position,c.position),vec3.normalize(e.dir,e.vec),e.length=vec3.length(e.vec)}}b.radius&&(c.radius=b.radius),b.forceAverage&&(c.forceAverage=b.forceAverage)},d.prototype.update=function(d,e,f,g){for(var h,i=f.positions,j=f.velocities,k=f.paths,l=!!this.shape,m=Math.random,n=vec3.distance,o=vec3.normalize,p=vec3.subtract,q=vec3.dot,r=vec3.length,s=vec3.scale,t=d;e>t;++t)if((!l||this.shape[this.shapeDirection](i,t))&&(h=this.nodes[k[t]])){var u=3*t;a[0]=i[u],a[1]=i[u+1],a[2]=i[u+2];var v;if(h.first){if(n(a,h.position)<h.radius&&(k[t]++,h=this.nodes[k[t]],!h))continue;v=p(c,h.position,a),o(v,v)}else{var w=this.nodes[k[t]-1],x=p(c,a,w.position),y=q(x,h.dir);if(y>h.length){if(k[t]++,h=this.nodes[k[t]],!h)continue;b[0]=j[u],b[1]=j[u+1],b[2]=j[u+2];var z=r(b);s(b,h.dir,z),j[u]=b[0],j[u+1]=b[1],j[u+2]=b[2]}v=h.dir}var A=h.forceAverage*g,B=h.forceVariance*g,C=A;B>0&&(C+=2*m()*B-B),j[u]+=v[0]*C,j[u+1]+=v[1]*C,j[u+2]+=v[2]*C}}}(),function(){"use strict";var a=new Float32Array(3),b=Human.particles.updaters.Gravity=function(a){this.position=new Float32Array(a.position),this.radius=a.radius,this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};b.prototype.update=function(b,c,d,e){for(var f=d.positions,g=d.velocities,h=Math.random,i=Math.max,j=vec3.length,k=!!this.shape,l=this.forceAverage*e,m=this.forceVariance*e,n=b;c>n;++n)if(!k||this.shape[this.shapeDirection](f,n)){var o=3*n,p=l;m&&(p+=2*h()*m-m),a[0]=this.position[0]-f[o],a[1]=this.position[1]-f[o+1],a[2]=this.position[2]-f[o+2];var q=i(j(a),this.radius);a[0]/=q,a[1]/=q,a[2]/=q,p/=q*q,g[o]+=a[0]*p,g[o+1]+=a[1]*p,g[o+2]+=a[2]*p}}}(),function(){"use strict";var a=Human.particles.updaters.SpriteAnimation=function(a,b){this.rows=b.spriteRows,this.cols=b.spriteCols,this.startFrame=b.spriteStartFrame,this.endFrame=b.spriteEndFrame};a.prototype.update=function(a,b,c,d){for(var e=c.uvTranslates,f=c.spriteFrameCounter,g=c.spriteFrameDuration,h=c.spriteCurrentTime,i=a;b>i;i++)h[i]+=d,h[i]>=g[i]&&(h[i]=0,f[i]++,e[2*i]+=1/this.cols,1===e[2*i]&&(e[2*i]=0,e[2*i+1]-=1/this.rows),e[2*i+1]===-1/this.rows&&(e[2*i]=this.startFrame%this.cols*1/this.cols,e[2*i+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows),f[i]>this.endFrame&&(f[i]=this.startFrame,e[2*i]=this.startFrame%this.cols*1/this.cols,e[2*i+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows))}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),e=new Float32Array(3),f=Human.particles.updaters.AxisForce=function(a){this.position=new Float32Array(a.position),vec3.normalize(a.direction,a.direction),this.direction=new Float32Array(a.direction),this.forceAverage=a.forceAverage,this.forceVariance=a.forceVariance||0,this.shape=null,this.shapeDirection="in"};f.prototype.update=function(f,g,h,i){for(var j=h.positions,k=h.velocities,l=Math.random,m=!!this.shape,n=this.forceAverage*i,o=this.forceVariance*i,p=f;g>p;++p)if(!m||this.shape[this.shapeDirection](j,p)){var q=3*p,r=n;o&&(r+=2*l()*o-o),b[0]=j[q],b[1]=j[q+1],b[2]=j[q+2],vec3.sub(c,b,this.position);var s=vec3.dot(c,this.direction);vec3.scale(d,this.direction,s),vec3.add(e,d,this.position),vec3.sub(a,b,e),vec3.normalize(a,a),k[q]+=a[0]*r,k[q+1]+=a[1]*r,k[q+2]+=a[2]*r}}}(),function(){"use strict";var a=Human.particles.constraints.LifetimeKill=function(){};a.prototype.constrain=function(a,b,c){for(var d=c.ages,e=c.lifetimes,f=c.dead,g=a;b>g;++g)d[g]>=e[g]&&(f[g]=!0)}}(),function(){"use strict";var a=Human.particles.constraints.LifetimeStop=function(){};a.prototype.constrain=function(a,b,c){for(var d=c.ages,e=c.lifetimes,f=c.stopped,g=a;b>g;++g)d[g]>=e[g]&&(f[g]=!0)}}(),function(){"use strict";var a=Human.particles.constraints.ShapeKill=function(a,b,c){this.shape=a,this.direction=b,c>=0?(this.trap=!0,this.trapMask=1<<c):(this.trap=!1,this.trapMask=0)};a.prototype.constrain=function(a,b,c){for(var d=c.positions,e=c.dead,f=c.traps,g=this.trap,h=this.trapMask,i=a;b>i;++i)if(this.shape[this.direction](d,i)){if(g&&0===(f[i]&h))continue;e[i]=!0}else g&&(f[i]|=h)}}(),function(){"use strict";var a=Human.particles.constraints.ShapeStop=function(a,b,c){this.shape=a,this.direction=b,c>=0?(this.trap=!0,this.trapMask=1<<c):(this.trap=!1,this.trapMask=0)};a.prototype.constrain=function(a,b,c){for(var d=c.positions,e=c.stopped,f=c.traps,g=this.trap,h=this.trapMask,i=a;b>i;++i)if(this.shape[this.direction](d,i)){if(g&&0===(f[i]&h))continue;e[i]=!0}else g&&(f[i]|=h)}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),e=new Float32Array(3),f=Human.particles.constraints.PathRadius=function(a){this.nodes=a.nodes};f.prototype.constrain=function(f,g,h){for(var i=h.positions,j=h.paths,k=vec3.normalize,l=vec3.subtract,m=vec3.dot,n=vec3.length,o=vec3.scale,p=f;g>p;++p){var q=3*p;if(!(j[p]<1)){var r=this.nodes[j[p]];if(r){a[0]=i[q],a[1]=i[q+1],a[2]=i[q+2];var s=this.nodes[j[p]-1],t=l(b,a,s.position),u=m(t,r.dir),v=o(c,r.dir,u),w=l(d,t,v),x=n(w);if(x>r.radius){k(w,w);var y=o(e,w,r.radius-x);i[q]+=y[0],i[q+1]+=y[1],i[q+2]+=y[2]}}}}}}(),function(){"use strict";var a=Human.particles.constraints.PathKill=function(a){this.nodes=a.nodes};a.prototype.constrain=function(a,b,c){for(var d=this.nodes.length,e=c.paths,f=c.dead,g=a;b>g;++g)e[g]>=d&&(f[g]=!0)}}(),function(){"use strict";var a=Human.particles.constraints.PathStop=function(a){this.nodes=a.nodes};a.prototype.constrain=function(a,b,c){for(var d=this.nodes.length,e=c.paths,f=c.stopped,g=a;b>g;++g)e[g]>=d&&(f[g]=!0)}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=new Float32Array(3),d=new Float32Array(3),e=new Float32Array(3),f=Human.particles.constraints.ShapeBounce=function(a,b,c){this.shape=a,this.direction=b,c>=0?(this.trap=!0,this.trapMask=1<<c):(this.trap=!1,this.trapMask=0)};f.prototype.constrain=function(f,g,h){for(var i=h.positions,j=h.velocities,k=h.traps,l=this.trap,m=this.trapMask,n=vec3.subtract,o=vec3.dot,p=vec3.length,q=vec3.scale,r=f;g>r;++r)if(this.shape[this.direction](i,r)){if(l&&0===(k[r]&m))continue;var s=3*r;this.shape.surfaceProjection(i,r,d,e),i.set(d,s),a[0]=j[s],a[1]=j[s+1],a[2]=j[s+2];var t=p(a);a[0]/=t,a[1]/=t,a[2]/=t;var u=o(a,e),v=q(b,e,2*u),w=n(c,a,v);q(w,w,t),j[s]=w[0],j[s+1]=w[1],j[s+2]=w[2]}else l&&(k[r]|=m)}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.shapes.Sphere=function(a){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),a.rotate&&(this.rotate=new Float32Array(a.rotate)),a.scale&&(this.scale=new Float32Array(a.scale)),this.updateXform())};b.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},b.prototype["in"]=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return 1>=e*e+f*f+g*g},b.prototype.out=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return e*e+f*f+g*g>=1},b.prototype.surfaceProjection=function(a,b,c,d){var e=3*b;c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],this.translate&&(c[0]-=this.translate[0],c[1]-=this.translate[1],c[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(c,c,this.inverseXform),vec3.normalize(c,c),d.set(c),this.xform&&(vec3.transformMat3(c,c,this.xform),vec3.transformMat3(d,d,this.normalXform),vec3.normalize(d,d)),this.translate&&(c[0]+=this.translate[0],c[1]+=this.translate[1],c[2]+=this.translate[2])}}(),function(){"use strict";var a=new Float32Array(3),b=new Float32Array(3),c=mat3.create(),d=new Float32Array([0,1,0]),e=Human.particles.shapes.Plane=function(a){this.translate=new Float32Array(a.translate||Human.math.VEC3_ZEROS),this.rotate=new Float32Array(a.rotate||Human.math.VEC3_ZEROS),this.normal=vec3.create(),this.distance=0};e.prototype.updateXform=function(){this.normal.set(d),Human.math.buildRotationScaleMat3(c,this.rotate,null),vec3.transformMat3(this.normal,this.normal,c),this.distance=vec3.dot(this.translate,this.normal)},e.prototype["in"]=function(a,b){var c=3*b,d=a[c],e=a[c+1],f=a[c+2],g=this.normal[0],h=this.normal[1],i=this.normal[2];return d*g+e*h+f*i<=this.distance},e.prototype.out=function(a,b){var c=3*b,d=a[c],e=a[c+1],f=a[c+2],g=this.normal[0],h=this.normal[1],i=this.normal[2];return d*g+e*h+f*i>=this.distance},e.prototype.surfaceProjection=function(c,d,e,f){var g=3*d;a[0]=c[g],a[1]=c[g+1],a[2]=c[g+2],f[0]=this.normal[0],f[1]=this.normal[1],f[2]=this.normal[2],vec3.scale(b,f,this.distance-vec3.dot(a,f)),vec3.add(e,a,b)}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.shapes.Cube=function(a){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),a.rotate&&(this.rotate=new Float32Array(a.rotate)),a.scale&&(this.scale=new Float32Array(a.scale)),this.updateXform())};b.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},b.prototype["in"]=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return e>=-.5&&.5>=e&&f>=-.5&&.5>=f&&g>=-.5&&.5>=g},b.prototype.out=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return-.5>=e||e>=.5||-.5>=f||f>=.5||-.5>=g||g>=.5},b.prototype.surfaceProjection=function(a,b,c,d){var e=3*b,f=Math.abs;c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],this.translate&&(c[0]-=this.translate[0],c[1]-=this.translate[1],c[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(c,c,this.inverseXform);var g=c[0],h=c[1],i=c[2],j=f(g+.5),k=f(g-.5),l=f(h+.5),m=f(h-.5),n=f(i+.5),o=f(i-.5);k>j&&l>j&&m>j&&n>j&&o>j?(g=-.5,d[0]=-1,d[1]=0,d[2]=0):l>k&&m>k&&n>k&&o>k?(g=.5,d[0]=1,d[1]=0,d[2]=0):m>l&&n>l&&o>l?(h=-.5,d[0]=0,d[1]=-1,d[2]=0):n>m&&o>m?(h=.5,d[0]=0,d[1]=1,d[2]=0):o>n?(i=-.5,d[0]=0,d[1]=0,d[2]=-1):(i=.5,d[0]=0,d[1]=0,d[2]=1),-.5>g?g=-.5:g>.5&&(g=.5),-.5>h?h=-.5:h>.5&&(h=.5),-.5>i?i=-.5:i>.5&&(i=.5),c[0]=g,c[1]=h,c[2]=i,this.xform&&(vec3.transformMat3(c,c,this.xform),vec3.transformMat3(d,d,this.normalXform),vec3.normalize(d,d)),this.translate&&(c[0]+=this.translate[0],c[1]+=this.translate[1],c[2]+=this.translate[2])}}(),function(){"use strict";var a=vec3.create(),b=Human.particles.shapes.Cylinder=function(a){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,a.translate&&(this.translate=new Float32Array(a.translate)),(a.scale||a.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),a.rotate&&(this.rotate=new Float32Array(a.rotate)),
a.scale&&(this.scale=new Float32Array(a.scale)),this.updateXform())};b.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},b.prototype["in"]=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return 1>=e*e+g*g&&f>=-1&&1>=f},b.prototype.out=function(b,c){var d=3*c;a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],this.translate&&(a[0]-=this.translate[0],a[1]-=this.translate[1],a[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(a,a,this.inverseXform);var e=a[0],f=a[1],g=a[2];return e*e+g*g>=1||-1>=f||f>=1},b.prototype.surfaceProjection=function(a,b,c,d){var e=3*b;c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],this.translate&&(c[0]-=this.translate[0],c[1]-=this.translate[1],c[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(c,c,this.inverseXform);var f,g,h=c[0],i=c[1],j=c[2];-1>i?(d[0]=0,d[1]=-1,d[2]=0):i>1?(d[0]=0,d[1]=1,d[2]=0):(g=h*h+j*j,f=Math.sqrt(g),d[0]=h/f,d[1]=0,d[2]=j/f),-1>i&&(i=-1),i>1&&(i=1),g=g||h*h+j*j,g>1&&(f=f||Math.sqrt(f),h/=f,j/=f),c[0]=h,c[1]=i,c[2]=j,this.xform&&(vec3.transformMat3(c,c,this.xform),vec3.transformMat3(d,d,this.normalXform),vec3.normalize(d,d)),this.translate&&(c[0]+=this.translate[0],c[1]+=this.translate[1],c[2]+=this.translate[2])}}(),Human.media=Human.media||{},Human.media.Clips=function(a){"use strict";var b=this;this._streamType=a,this.clips={},this.clipsList=[],this.libraries={},this.suggestedClips=[],Human.events.fire(this._streamType+".clips",b.clipsList,!0),b.getClipById=function(a){var b=null;return this.clipsList.forEach(function(c){c.clipId===a&&(b=c)}),b},this.createLibrary=function(a,b){if(this.libraries[a])return void Human.log.warn("Human.media."+this._streamType+".createLibrary","Library already loaded: "+a);for(var c,d,e=a.split("/"),f=e[0],g=e[1],h=this.libraries[a]={libraryId:a,clips:{}},i=0,j=b.length;j>i;i++)if(c=b[i],c.clipId)if(c.type)if(c.src){(void 0===c.time1||null===c.time1)&&(c.time1=null),(void 0===c.time2||null===c.time2)&&(c.time2=null),this.clips[c.clipId]&&Human.log.error("Human.media."+this._streamType+".createLibrary","Clip 'clipId' clashes with another clip: '"+c.clipId+"' - replacing existing clip");var k=[f,this._streamType,g,c.src].join("/");d={clipId:c.clipId,modelId:f,streamType:this._streamType,subasset:g,displayName:c.displayName,description:c.description||"",time1:c.time1,time2:c.time2,type:c.type||"",src:c.src,fullUrl:k,alternatives:c.alternatives||[],length:c.length||0,suggested:!1,status:"closed"},h.clips[c.clipId]=d,this.clips[c.clipId]=d}else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: src");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: type");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: clipId");this._rebuildClipList()},this._rebuildClipList=function(){this.clipsList=[];for(var a in this.clips)this.clips.hasOwnProperty(a)&&this._insertClipIntoList(this.clipsList,this.clips[a]);Human.events.fire(this._streamType+".clips",this.clipsList,!0)},this._insertClipIntoList=function(a,b){if(0===a.length)a.push(b);else{for(var c,d=a.length-1;d>=0;d--)if(c=a[d],c.time1<b.time1)return void a.splice(d+1,0,b);a.splice(0,0,b)}},this.destroyLibrary=function(a){var b=this.libraries[a];if(!b)return void Human.log.warn("Human.media."+this._streamType+".destroyLibrary","Library not found: "+a);for(var c in b.clips)b.clips.hasOwnProperty(c)&&(delete this.clips[c],Human.events.fire(this._streamType+".status",{clipId:c,status:"destroyed"}));delete this.libraries[a],this._rebuildClipList()},this.open=function(a,b){Human.events.fire(this._streamType+".status",{clipId:a,status:"open"},!0),b()},this.play=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"playing"},!0)},this.scrub=function(a,b){Human.events.fire(this._streamType+".scrubbed",{clipId:a,time:b})},this.pause=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"paused"},!0)},this.stop=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"stopped"},!0)},this.close=function(a){Human.events.fire(this._streamType+".status",{clipId:a,status:"closed"},!0)},this.reset=function(){for(var a in this.libraries)this.libraries.hasOwnProperty(a)&&this.destroyLibrary(a)}},Human.media.audio=new Human.media.Clips("audio"),Human.media.videos=new Human.media.Clips("videos"),function(){"use strict";function a(a){return void 0===j[a]?void(j[a]=1):void j[a]++}function b(a){return void 0===h.assetUseCounts[a]?void(h.assetUseCounts[a]=1):void h.assetUseCounts[a]++}function c(a){return i[a]||a+"s"}function d(a,d,e,g){f(d,a);var i,j,k;if(!e||e===h.server.TIMEOUT){for(e||(h.nullAssets[d]=!0),h.loadedAssets[d]=null,i=m[d],j=0,k=i.length;k>j;j++)i[j](null);return void delete m[d]}try{if(g){var l="morph"===a||"geometry"===a,n=new XMLHttpRequest;n.open("PUT","/assets/"+d,!0),n.send(l?e:JSON.stringify(e))}if("transform"===a){for(i=m[d],j=0,k=i.length;k>j;j++)i[j](e);delete h.loadedAssets[d],delete m[d]}else{var o=Human.assets[c(a)];o.parseAsset(d,e,function(a){for(h.loadedAssets[d]=a,i=m[d],j=0,k=i.length;k>j;j++)b(d),i[j](a);delete m[d]})}}catch(p){Human.log.error("Error parsing asset: "+d+" - "+p.message),h.loadedAssets[d]=null,h.nullAssets[d]=!0;for(var i=m[d],j=0,k=i.length;k>j;j++)i[j](null);delete m[d]}}function e(){Human.events.fire("assets.load.start"),Human.stats.loadSequence.assetsRequested=Human.timer.now(),Human.stats.loadTimes.preAsset=Human.stats.loadSequence.assetsRequested-Human.stats.loadSequence.startTime}function f(a,b){o++,Human.events.fire("assets.load.progress",{assetId:a,assetType:b,requestedAssets:n,receivedAssets:o}),o===n&&g()}function g(){Human.events.fire("assets.load.finish"),n=0,o=0,Human.stats.loadSequence.assetsLoaded=Human.timer.now(),Human.stats.loadTimes.assetDownload=Human.stats.loadSequence.assetsLoaded-Human.stats.loadSequence.assetsRequested,Human.renderer.resetFrameThrottling()}var h=Human.assets={loadedAssets:{},nullAssets:{},assetUseCounts:{}},i={geometry:"geometries",audio:"audio",videos:"video"},j={},k={},l={},m={},n=0,o=0;h.init=function(){this.server.init(),this.geometries.init(),this.materials.init(),this.morphs.init(),this.reflections.init()},h.getAsset=function(a,c,f){if(h.nullAssets[a])return void(f&&Human.utils.async(function(){f(null)}));if("LOADING"===h.loadedAssets[a])return void(f&&m[a].push(f));if(h.loadedAssets[a])return b(a),void(f&&Human.utils.async(function(){f(h.loadedAssets[a])}));if(0===n&&e(),n++,h.loadedAssets[a]="LOADING",m[a]=[],f&&m[a].push(f),window.localContentOnly||Human.mobile.iOS||Human.mobile.android){var g="morph"===c||"geometry"===c,i=new XMLHttpRequest;i.responseType=g?"arraybuffer":"text",i.open("GET",window.localBaseDirectory+"assets/"+a,!0),i.onload=function(){if(200===i.status||window.localContentOnly){var b=i.response,e=g?b:JSON.parse(b);d(c,a,e,!1)}else h.server.getAsset(c,a,function(b){d(c,a,b,!0)})},i.send(null)}else h.server.getAsset(c,a,function(b){d(c,a,b,!1)})},h.getAssetLibrary=function(b,d,e,f,g,i){return l[e]?void Human.utils.async(i):j[e]?(a(e),void Human.utils.async(i)):void h.server.getAssetLibrary(d,e,f,function(d){var f;if(!d)return l[e]=!0,void(i&&i());if(j[e])return a(e),void(i&&i());if("animation"===b){if("binary"===d.format)return void(i&&i());f=Human.assets.tweens}else f=Human.assets[c(b)];f?f.parseLibrary(e,d,g,function(){a(e),k[e]=f,i&&i()}):(Human.log.error("Unknown asset library type: "+b),i&&i())})},h.putAssetLibrary=function(a){if(void 0!==j[a]&&--j[a]<=0){delete this.assetUseCounts[a];var b=k[a];b&&b.unloadLibrary&&b.unloadLibrary(a),delete k[a]}},h.putAsset=function(a){if(void 0!==this.assetUseCounts[a]&&--this.assetUseCounts[a]<=0){var b=h.loadedAssets[a],d=Human.assets[c(b.type)];d.destroyAsset(a),delete h.loadedAssets[a],delete this.assetUseCounts[a]}}}(),function(){"use strict";function a(){var a=new WebSocket(h);return a.binaryType="arraybuffer",a.addEventListener("open",function(){a.send(JSON.stringify({open:"sesame!"}));for(var b=0,c=l.length;c>b;b++)l[b]();l.length=0}),a.addEventListener("close",function(a){Human.log.log("Socket closed",a.code,a.reason)}),a.addEventListener("error",function(){Human.log.error("Socket error")}),a.addEventListener("message",function(a){var b,f,g=a.data;if(e=Date.now(),"string"==typeof g){if("🍺"===g)return;var h=JSON.parse(g);f=h.id,c(f,g),h.error?(Human.log.error("Asset not found: "+f),b=null):h.asset?b=h.asset:(Human.log.error("Null asset: "+f),b=null)}else{b=g;var i,j,k=new DataView(b),l=k.getUint32(0,!0);17===l?(j=new Uint32Array(b,0,2)[1],i=11*Uint32Array.BYTES_PER_ELEMENT):(j=k.getUint32(4,!0),i=k.getUint32(12,!0)),f=Human.utils.atos(b,i,j).trim(),d(f,g)}var n=m[f];if(n){for(var o=0,p=n.length;p>o;o++)n[o](b);delete m[f]}}),a}function b(){if(0!==n.length){if(e=Date.now(),g.readyState===WebSocket.OPEN)return g.send(JSON.stringify({assets:n})),void(n.length=0);l.push(function(){g.send(JSON.stringify({assets:n})),n.length=0}),(g.readyState===WebSocket.CLOSING||g.readyState===WebSocket.CLOSED)&&(g=a())}}function c(a,b){if(Human.stats.trackingDownloadSize){var c=Human.utils.textGzipSize(b);Human.stats.jsonDownloadSizes[a]=c,Human.stats.jsonDownloadTotal+=c}}function d(a,b){if(Human.stats.trackingDownloadSize){var c=Human.utils.binaryGzipSize(b);Human.stats.geometryDownloadSizes[a]=c,Human.stats.geometryDownloadTotal+=c}}var e,f,g,h,i=Human.assets.server={TIMEOUT:1},j=12e4,k="true"===Human.request.getSearchParam("__bdh_engine_draco"),l=[],m={},n=[],o={geometry:"geometry"},p={},q={},r=!1;Human.properties.subscribe({propId:"assetDomain",value:"assets-human.biodigital.com",callback:function(a){f=a}}),i.init=function(){if(!r){var c="https:"===window.location.protocol?"wss:":"ws:";(Human.mobile.android||Human.mobile.iOS)&&(c="wss:"),h=c+"//"+f+"/assets/ws"+(k?4:3),g=a(),setInterval(function(){b();var a=Date.now();if(a-e>j)for(var c in m)if(m.hasOwnProperty(c)){Human.log.error("Server timeout on asset: "+c);for(var d=m[c],f=0,g=d.length;g>f;f++)d[f](i.TIMEOUT);delete m[c]}},100),r=!0}},i.cacheModuleDefinition=function(a,b){return p[a]?void 0:b?void(p[a]=JSON.stringify(b)):void i.getModuleDefinition(a)},i.getModuleDefinition=function(a,b,d){return p[a]?void(b&&b(JSON.parse(p[a]))):(Human.stats.loadSequence.moduleRequest=Human.timer.now(),Human.stats.loadTimes.preModule=Human.stats.loadSequence.moduleRequest-Human.stats.loadSequence.startTime,void Human.utils.getText(window.localBaseDirectory+"content/modules/"+a,function(d){c(a,d),p[a]=d,Human.stats.loadSequence.moduleLoaded=Human.timer.now(),Human.stats.loadTimes.moduleDownload=Human.stats.loadSequence.moduleLoaded-Human.stats.loadSequence.moduleRequest,b&&b(JSON.parse(d))},function(b,c,e){Human.events.fire("net.error",{id:a,type:"modules",status:b.status,statusText:b.statusText}),d&&d(e)}))},i.cacheStateIndex=function(a,b){return q[a]?void 0:b?void(q[a]=JSON.stringify(b)):void Human.utils.getText(window.localBaseDirectory+"content/states/"+a+"/index?v="+Human.VERSION+"&locale="+Human.locale,function(b){c(a+"/index",b),q[a]=b})},i.getStateIndex=function(a,b,d){return q[a]?void(b&&b(JSON.parse(q[a]))):void Human.utils.getText(window.localBaseDirectory+"content/states/"+a+"/index?v="+Human.VERSION+"&locale="+Human.locale,function(d){c(a+"/index",d),b(JSON.parse(d))},d)},i.getAnimationManifest=function(a,b,d){var e=a.split("/");Human.utils.getText(window.localBaseDirectory+"content/states/"+e[0]+"/animations/"+e[1]+"/manifest",function(d){c(a,d),b(JSON.parse(d))},d)},i.getAsset=function(a,b,c){var d=b.split("/"),e=d[0],f=d[1],g=d[2],h=e+"/"+(o[a]||a+"s")+"/"+f;return g&&(h+="/"+g),m[h]?void m[h].push(c):(m[h]=[c],void n.push(h))},i.getAssetLibrary=function(a,b,c,d){var e=b.split("/");Human.utils.getJSON(window.localBaseDirectory+"content/states/"+e[0]+"/"+a+"/"+e[1]+"/"+c,d,function(){Human.log.error("Asset library not found: "+b),d(null)})}}(),function(){"use strict";function a(a,b){return function(c){if(Human.stats.trackingDownloadSize){var d=Human.utils.binaryGzipSize(c);Human.stats.textureDownloadSizes[a.compressedSrc]=d,Human.stats.textureDownloadTotal+=d}a.type="texture",a.compressedImage=c,a.src=null,b()}}function b(a,b){return function(){a.compressedSrc=null,c(a,b)}}function c(a,b){if(Human.stats.trackingDownloadSize){var c=a.src;Human.utils.getBinary(c,function(a){Human.stats.textureDownloadSizes[c]=a.byteLength,Human.stats.textureDownloadTotal+=a.byteLength})}var e=new Image;e.onload=d(e,a,b),e.onerror=b,e.src=a.src,a.src=null}function d(a,b,c){return function(){b.type="texture",b.image=a,c()}}function e(a){if(!window.localContentOnly){var b=a.src.replace(/(\.jpg|\.jpeg|\.png)$/,"");return h?(a.compressedSrc=b+"-dxt1.dds",void(a.containerFormat="dds")):i?(a.compressedSrc=b+"-pvrtc.pvr",void(a.containerFormat="pvr")):j?(a.compressedSrc=b+"-etc1.pvr",void(a.containerFormat="pvr")):void 0}}function f(a){return a.image||a.compressedImage}var g=Human.assets.textures={},h=SceneJS.checkExtension("WEBGL_compressed_texture_s3tc"),i=SceneJS.checkExtension("WEBGL_compressed_texture_pvrtc"),j=SceneJS.checkExtension("WEBGL_compressed_texture_etc1"),k={add:"over",hack_add:"add"};g.load=function(d,g){function h(){0===--i&&(Human.utils.filterInPlace(d,f),g())}d=d||[];var i=d.length;if(0===i)return void g();for(var j=0;i>j;++j){var l=d[j];l={src:l.src||l.uri,applyTo:l.applyTo,blendMode:k[l.blendMode]||l.blendMode,blendFactor:l.blendFactor,preloadColor:l.preloadColor,preloadSrc:l.preloadSrc},d[j]=l,e(l),l.compressedSrc?Human.utils.getBinary(l.compressedSrc,a(l,h),b(l,h)):c(l,h)}}}(),function(){"use strict";function a(a){var b=a.data[0],c=a.data[1];if(1===b){var d=a.data[2];m[c](i.createGeometry(c,d))}else{var e=a.data[2];Human.log.error("Human.assets.geometries",e+" : "+c)}delete m[c]}function b(){for(var b=0;n>b;b++){var c=Human.workers.loadWorker(l);c.onmessage=a,o[b]=c}}function c(a,b){var c=b.subarray(0,3),d=b.subarray(3,6),e=mat4.create();return mat4.fromScaling(q,d),mat4.fromTranslation(r,c),mat4.multiply(e,r,q),a.positionTranslate=c,a.positionScale=d,a.geometry.positionDecodeMat=e,a}function d(a,b,c){a.geometry.uvDecodeMats=new Array(c),a.uvTranslates=new Array(c),a.uvScales=new Array(c);for(var d=0;c>d;d++){var e=4*d,f=a.uvTranslates[d]=b.subarray(e,e+2),g=a.uvScales[d]=b.subarray(e+2,e+4);mat3.fromScaling(s,g),mat3.fromTranslation(t,f),a.geometry.uvDecodeMats[d]=mat3.create(),mat3.multiply(a.geometry.uvDecodeMats[d],t,s)}return a}function e(a,b,c,d){var e=new Uint32Array(a,0,11),f=e[1],g=e[2],j=e[3],k=e[4],l=e[5],m=e[6],n=11*Uint32Array.BYTES_PER_ELEMENT,o=n+f,p=o+g,q=p+j,r=q+k,s=r+l,t=0;j>0&&(b.geometry.positions=new Float32Array(a,p,j/Float32Array.BYTES_PER_ELEMENT),b.boundary=h(b.geometry.positions),t=b.geometry.positions.length/3),k>0&&(b.geometry.normals=new Float32Array(a,q,k/Float32Array.BYTES_PER_ELEMENT)),m>0&&(b.geometry.uv=new Float32Array(a,s,m/Float32Array.BYTES_PER_ELEMENT)),l>0&&(b.geometry.indices=new Uint32Array(a,r,l/Uint32Array.BYTES_PER_ELEMENT),256>=t?b.geometry.indices=new Uint8Array(b.geometry.indices):65536>=t&&(b.geometry.indices=new Uint16Array(b.geometry.indices))),d(i.createGeometry(c,b))}function f(a,b,e,f){var g,j,l=new DataView(a),m=l.getUint32(4,!0),n=l.getUint32(8,!0),o=l.getUint32(12,!0),p=l.getUint32(16,!0),q=l.getUint32(20,!0),r=l.getUint32(24,!0),s=l.getUint32(28,!0),t=l.getUint16(32,!0),u=l.getUint8(34),v=l.getUint8(35),w=new Array(v);for(j=0,g=36;v>j;j++,g+=6)w[j]={uvSize:l.getUint32(g,!0),uvDecodeSize:l.getUint16(g+4,!0)};if(g=o+m+n,t>0&&(c(b,new Float32Array(a,g,t/Float32Array.BYTES_PER_ELEMENT)),g+=t),v>0&&(d(b,new Float32Array(a,g,4*v),v),g+=16*v),q>0&&(b.geometry.positions=new Uint16Array(a,g,q/Uint16Array.BYTES_PER_ELEMENT),b.boundary=h(b.geometry.positions,b.positionScale,b.positionTranslate),g+=q),v>0)for(b.geometry.uvs=new Array(v),j=0;v>j;j++)b.geometry.uvs[j]=new Uint16Array(a,g,w[j].uvSize/Uint16Array.BYTES_PER_ELEMENT),g+=w[j].uvSize;if(r>0&&(b.geometry.normals=new Int8Array(a,g,r/Int8Array.BYTES_PER_ELEMENT),g+=r),s>0){var x=k[u];b.geometry.indices=new x(a,p,s/x.BYTES_PER_ELEMENT)}f(i.createGeometry(e,b))}function g(a,b,e,f){var g=new DataView(a),h=g.getUint32(12,!0),i=g.getUint32(4,!0),j=g.getUint32(8,!0),k=24,l=g.getUint8(22,!0),q=16*l,r=h,s=r+i,t=s+j,u=t+k,v=u+l*q,w=g.getUint32(16,!0),x=new Int8Array(a,v,w/Int8Array.BYTES_PER_ELEMENT);c(b,new Float32Array(a,t,k/Float32Array.BYTES_PER_ELEMENT)),l>0&&d(b,new Float32Array(a,u,q/Float32Array.BYTES_PER_ELEMENT),l),m[e]=f;var y=p%n;o[y].postMessage([x,e,b],[x.buffer]),p++}function h(a,b,c){b=b||v,c=c||u;for(var d,e,f,g=1e5,h=1e5,i=1e5,j=-1e5,k=-1e5,l=-1e5,m=0,n=a.length-2;n>m;m+=3)d=a[m]*b[0]+c[0],e=a[m+1]*b[1]+c[1],f=a[m+2]*b[2]+c[2],g>d&&(g=d),h>e&&(h=e),i>f&&(i=f),d>j&&(j=d),e>k&&(k=e),f>l&&(l=f);return{xmin:g,ymin:h,zmin:i,xmax:j,ymax:k,zmax:l}}var i=Human.assets.geometries={};i.geometries={};var j,k={1:Uint8Array,2:Uint16Array,4:Uint32Array},l="draco/worker.js",m={},n=2,o=new Array(n),p=0;i.init=function(){b(),j=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Geometry library"})},i.parseAsset=function(a,b,c){var d=new Uint32Array(b,0,1)[0],h={geometry:{primitive:"triangles"},draco:19===d,compressed:17!==d};h.draco?g(b,h,a,c):h.compressed?f(b,h,a,c):e(b,h,a,c)},i.createGeometry=function(a,b){if(i.geometries[a])return void Human.log.error("Human.assets.geometries.createGeometry","Geometry already loaded: "+a);if(!b.geometry)return void Human.log.error("Human.assets.geometries.createGeometry","Mandatory attribute 'geometryId' expected on geometry: "+a);b.geometry.type="geometry";var c={geometry:j.addNode(b.geometry),type:"geometry",compressed:b.compressed},d=b.boundary;if(!d){var e=null,f=null;if(b.geometry.positionDecodeMat){var g=b.geometry.positionDecodeMat;e=new Float32Array([g[0],g[5],g[10]]),f=new Float32Array([g[12],g[13],g[14]])}d=h(b.geometry.positions,e,f)}return c.boundary=d,c.center=[.5*(d.xmax+d.xmin),.5*(d.ymax+d.ymin),.5*(d.zmax+d.zmin)],c.axisBoundary=new Float32Array([d.xmin,d.ymin,d.zmin,d.xmax,d.ymax,d.zmax]),i.geometries[a]=c,c},i.getCompressionStats=function(){var a={compressed:0,uncompressed:0};for(var b in i.geometries)i.geometries.hasOwnProperty(b)&&(i.geometries[b].compressed?a.compressed++:a.uncompressed++);return a},i.destroyAsset=function(a){if(a){var b=i.geometries[a];b.geometry.destroy(),delete i.geometries[a]}else i.reset()},i.reset=function(){for(var a in i.geometries)i.geometries.hasOwnProperty(a)&&i.destroyAsset(a)};var q=mat4.create(),r=mat4.create(),s=mat3.create(),t=mat3.create(),u=vec3.fromValues(0,0,0),v=vec3.fromValues(1,1,1)}(),function(){"use strict";function a(b,c,e){e=e||{};var f,g;switch(b.id&&(b.id=null),b.type){case"texture":var h;for(f=0,g=b.layers.length;g>f;f++)h=b.layers[f],h.src=h.uri||h.src,d||(h.src=c+h.src),h.preloadURI=h.preloadURI||h.preloadSrc,h.preloadURI&&(d?h.preloadURI+="?v="+Human.VERSION:h.preloadURI=c+h.preloadURI+"?v="+Human.VERSION),h.blendMode=h.blendMode||"over","add"===h.blendMode?h.blendMode="over":"forceAdd"===h.blendMode&&(h.blendMode="add");e&&(e.texture=b);break;case"material":if(e){e.material=b;var i,j,k,l,m;b.reflectionId&&(i=b.reflectionId,k=Human.assets.reflections,l=k.exportedReflectionIds[i],l?(m=Human.assets.reflections.reflections[l],m?e.reflection=m.node:Human.log.error("Human.assets.materials.parseManifest","Reflection not found: "+i)):Human.log.error("Human.assets.materials.parseManifest","Reflection not found: "+i)),b.lightmapId&&(j=b.lightmapId,k=Human.assets.reflections,l=k.exportedReflectionIds[j],l?(m=Human.assets.reflections.reflections[l],m?e.lightmap=m.node:Human.log.error("Human.assets.materials.parseManifest","Lightmap not found: "+i)):Human.log.error("Human.assets.materials.parseManifest","Lightmap not found: "+i))}break;case"flags":e&&(e.flags=b)}if(b.nodes){for(f=0,g=b.nodes.length;g>f;f++)a(b.nodes[f],c,e);b.nodes=null}return e}var b=Human.assets.materials={};b.materials={};var c,d=!1;b.init=function(){c=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Materials library"})},b.parseAsset=function(c,d,e){var f=c.split("/"),g=f[1].split(".")[0],h=window.localBaseDirectory+"content/states/"+f[0]+"/materials/"+g+"/";b.createMaterial(c,a(d,h),e)},b.findMaterial=function(a){var c=b.materials[a];return c?c:null},b.createMaterial=function(a,d,e){if(b.materials[a])return void Human.log.warn("Human.assets.materials.createMaterial","Material already loaded: "+a);var f={type:"material",textureCompressionStats:{compressed:0,uncompressed:0},hasAlphaTexture:!1,hasAlphaFresnel:!1,partiallyOpaque:!1};if(d.material){f.material=c.addNode({type:"material",workflow:d.material.workflow,baseColor:d.material.baseColor,specularColor:d.material.specularColor,emitColor:d.material.emitColor,shine:d.material.shine,alpha:d.material.alpha,emit:d.material.emit,metallic:d.material.metallic,roughness:d.material.roughness,specularf0:d.material.specularf0}),f.glassFactor=void 0!==d.material.glassFactor&&null!==d.material.glassFactor?d.material.glassFactor:1,f.murkiness=void 0!==d.material.murkiness&&null!==d.material.murkiness?d.material.murkiness:1;var g,h,i;d.material.baseFresnel&&(g=d.material.baseFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:{r:1,g:1,b:1},i=void 0!==g.center?g.center:{r:0,g:0,b:0},f.fresnels.color=c.addNode({type:"fresnel",applyTo:"color",edgeBias:g.biasEdge,centerBias:g.biasCenter,power:g.power||1,edgeColor:h,centerColor:i,blendMode:g.blendMode||"multiply"})),d.material.alphaFresnel&&(g=d.material.alphaFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:0,i=void 0!==g.center?g.center:1,f.fresnels.alpha=c.addNode({type:"fresnel",applyTo:"alpha",edgeBias:g.biasEdge,centerBias:g.biasCenter,power:g.power||1,edgeColor:{r:h,g:h,b:h},centerColor:{r:i,g:i,b:i},blendMode:g.blendMode||"multiply"}),f.hasAlphaFresnel=!0),d.material.transparencyFresnel&&(g=d.material.transparencyFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:0,i=void 0!==g.center?g.center:1,f.fresnels.transparency=c.addNode({type:"fresnel",applyTo:"transparency",edgeBias:g.biasEdge,centerBias:g.biasCenter,power:g.power||1,edgeColor:{r:h,g:h,b:h},centerColor:{r:i,g:i,b:i},blendMode:g.blendMode||"multiply"}),f.hasAlphaFresnel=!0),d.material.reflectionFresnel&&(g=d.material.reflectionFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:1,i=void 0!==g.center?g.center:0,f.fresnels.reflect=c.addNode({type:"fresnel",applyTo:"reflect",centerBias:g.biasCenter,edgeBias:g.biasEdge,power:g.power||1,edgeColor:{r:h,g:h,b:h},centerColor:{r:i,g:i,b:i},blendMode:g.blendMode||"multiply"})),d.material.specularFresnel&&(g=d.material.specularFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:{r:0,g:0,b:0},i=void 0!==g.center?g.center:{r:1,g:1,b:1},f.fresnels.specular=c.addNode({type:"fresnel",applyTo:"specular",centerBias:g.biasCenter,edgeBias:g.biasEdge,power:g.power||1,edgeColor:h,centerColor:i,blendMode:g.blendMode||"multiply"})),d.material.emitFresnel&&(g=d.material.emitFresnel,f.fresnels=f.fresnels||{},h=void 0!==g.edge?g.edge:{r:0,g:0,b:0},i=void 0!==g.center?g.center:{r:1,g:1,b:1},f.fresnels.emit=c.addNode({type:"fresnel",applyTo:"emit",centerBias:g.biasCenter,edgeBias:g.biasEdge,power:g.power||1,edgeColor:h,centerColor:i,blendMode:g.blendMode||"multiply"}))}else f.glassFactor=1,f.murkiness=1;d.reflection&&(f.reflection=c.addNode({type:"cubemap",applyTo:"reflect",coreId:d.reflection.getCoreId()})),d.lightmap&&(f.lightmap=c.addNode({type:"cubemap",applyTo:"light",coreId:d.lightmap.getCoreId()}));var j,k;d.flags&&d.flags.flags.skybox&&(j=!1,k=Number.MIN_SAFE_INTEGER),d.flags&&(f.flags={skybox:d.flags.flags.skybox,billboard:d.flags.flags.billboard,frontface:d.flags.flags.frontface,backfaces:d.flags.flags.backfaces,addBlend:d.flags.flags.addBlend},f.partiallyOpaque=!!f.flags.partiallyOpaque);var l=d.texture?d.texture.layers:[];Human.assets.textures.load(l,function(){f.textures=new Array(l.length);for(var d=0,g=l.length;g>d;++d)l[d].compressedSrc?f.textureCompressionStats.compressed++:f.textureCompressionStats.uncompressed++,("alpha"===l[d].applyTo||"transparency"===l[d].applyTo)&&(f.hasAlphaTexture=!0),f.textures[d]=c.addNode(l[d]);b.materials[a]=f,e(f)})},b.getTextureCompressionStats=function(){var a={compressed:0,uncompressed:0};for(var c in b.materials)b.materials.hasOwnProperty(c)&&(a.compressed+=b.materials[c].textureCompressionStats.compressed,a.uncompressed+=b.materials[c].textureCompressionStats.uncompressed);return a},b.destroyAsset=function(a){if(a){var c=b.materials[a];for(var d in c)c.hasOwnProperty(d)&&"function"==typeof c[d].destroy&&c[d].destroy();delete b.materials[a]}else b.reset()},b.reset=function(){for(var a in b.materials)b.materials.hasOwnProperty(a)&&b.destroyAsset(a)}}(),function(){"use strict";function a(a){for(var b,c={morphGeometry:{}},d=new Uint32Array(a,0,11),e=d[1],f=d[2],g=d[3],h=d[4],i=d[5],j=d[6],k=11*Uint32Array.BYTES_PER_ELEMENT,l=k+e,m=l+f,n=m+g,o=n+h,p=o+i,q=c.morphGeometry.keys=Human.utils.atoj(a,l,f),r=q.length,s=c.morphGeometry.targets=[],t=g/r,u=t/Float32Array.BYTES_PER_ELEMENT,v=h/r,w=v/Float32Array.BYTES_PER_ELEMENT,x=j/r,y=j/Float32Array.BYTES_PER_ELEMENT,z=0;r>z;z++)b={},g>0&&(b.positions=new Float32Array(a,m+z*t,u)),h>0&&(b.normals=new Float32Array(a,n+z*v,w)),j>0&&(b.uvs=new Float32Array(a,p+z*x,y)),s.push(b);return c}function b(a){var b,c,d={},g=new DataView(a),h=g.getUint32(4,!0),i=g.getUint32(8,!0),j=g.getUint32(12,!0),k=g.getUint32(20,!0),l=g.getUint32(24,!0),m=g.getUint16(32,!0),n=g.getUint8(34),o=new Array(n);for(c=0,b=36;n>c;c++,b+=5)o[c]={uvSize:g.getUint32(b,!0),uvDecodeSize:g.getUint8(b+4)};b=j+h,d.morphGeometry=Human.utils.atoj(a,b,i);var p,q=d.morphGeometry.keys,r=q.length,s=d.morphGeometry.targets=new Array(r);for(c=0;r>c;c++)s[c]={};d.positionTranslates=new Array(r),d.positionScales=new Array(r);var t=m/r,u=k/r,v=u/Uint16Array.BYTES_PER_ELEMENT,w=l/r,x=w/Int8Array.BYTES_PER_ELEMENT;if(b+=i,m>0)for(c=0;r>c;c++){p=s[c];var y=d.positionTranslates[c]=new Float32Array(a,b,3),z=d.positionScales[c]=new Float32Array(a,b+12,3);mat4.fromScaling(e,z),mat4.fromTranslation(f,y),p.positionDecodeMat=mat4.create(),mat4.multiply(p.positionDecodeMat,f,e),b+=t}if(k>0){for(c=0;r>c;c++)s[c].positions=new Uint16Array(a,b+c*u,v);b+=k}if(l>0)for(c=0;r>c;c++)s[c].normals=new Int8Array(a,b+c*w,x);return d}var c=Human.assets.morphs={};c.morphs={};var d;c.init=function(){d=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Morphs library"})},c.parseAsset=function(c,d,e){var f,g=new Uint32Array(d,0,1)[0];f=17===g?a(d):b(d),e(Human.assets.morphs.createMorph(c,f))},c.findMorph=function(a){var b=c.morphs[a];return b?b:null},c.createMorph=function(a,b){var e=c.morphs[a];if(e)return Human.log.warn("Human.assets.morphs.createMorph","Morph already loaded: "+a),e;b.morphGeometry.type="morphGeometry";for(var f=d.addNode(b.morphGeometry),g=f.getTargets(),h={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},i=vec3.create(),j=Human.math.decompressPosition,k=0,l=g.length;l>k;++k)for(var m=g[k],n=m.positions,o=m.positionDecodeMat,p=0,q=n.length;q>p;p+=3)i[0]=n[p],i[1]=n[p+1],i[2]=n[p+2],o&&j(i,i,o),i[0]<h.xmin&&(h.xmin=i[0]),i[0]>h.xmax&&(h.xmax=i[0]),i[1]<h.ymin&&(h.ymin=i[1]),i[1]>h.ymax&&(h.ymax=i[1]),i[2]<h.zmin&&(h.zmin=i[2]),i[2]>h.zmax&&(h.zmax=i[2]);e={type:"morph",morphGeometry:f,boundary:h,center:[.5*(h.xmax+h.xmin),.5*(h.ymax+h.ymin),.5*(h.zmax+h.zmin)],positionTranslates:b.positionTranslates,positionScales:b.positionScales};var r=new Human.assets.morphs.Animation,s=b.morphGeometry.keys;r.addMorph(s[0],s[s.length-1],function(a){e.morphGeometry.setFactor(a)}),r.calculateTimeFrame(),Human.timeline.addAnimation(a,r);var t=a.split("/")[0],u=Human.timeline.leafTimelines[t]||new Human.timeline.LeafTimeline(t);return u.addAnimation(a,r),c.morphs[a]=e,e},c.destroyAsset=function(a){if(a){var b=c.morphs[a];if(!b)return void Human.log.warn("Human.assets.morphs.destroyMorph","Morph not found: "+a);b.morphGeometry.destroy(),delete c.morphs[a]}else c.reset()},c.reset=function(){for(var a in c.morphs)c.morphs.hasOwnProperty(a)&&c.destroyAsset(a)};var e=mat4.create(),f=mat4.create()}(),function(){"use strict";Human.assets.morphs.Animation=function(a){a=a||{},this.type="morph-animation",this._loop=a.loop!==!1,this._morphList=[],this.timeline=a.timeline,this.firstTime=null,this.lastTime=null},Human.assets.morphs.Animation.prototype.addMorph=function(a,b,c){this._morphList.push({firstTime:a,lastTime:b,update:c})},Human.assets.morphs.Animation.prototype.calculateTimeFrame=function(){for(var a,b=1e6,c=-1e6,d=this._morphList,e=0,f=this._morphList.length;f>e;e++)a=d[e],a.firstTime<b&&(b=a.firstTime),a.lastTime>c&&(c=a.lastTime);this.firstTime=b,this.lastTime=c},Human.assets.morphs.Animation.prototype.update=function(a,b){for(var c,d,e=0,f=this._morphList.length;f>e;e++)c=this._morphList[e],this._loop?d=b===c.lastTime?b:c.firstTime+b%(c.lastTime-c.firstTime):(d<c.firstTime&&(d=c.firstTime),d>c.lastTime&&(d=c.lastTime)),c.update(d)},Human.assets.morphs.Animation.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";var a=Human.assets.lights={lightIds:{}};a.parseLibrary=function(b,c,d,e){var f=a.lightIds[b];if(f)return Human.log.warn("Human.assets.lights.parseLibrary","library already loaded"),void e();var g=c.lights;if(!g)return Human.log.error("Human.assets.lights.parseLibrary","'lights' section expected in lights library"),void e();f=a.lightIds[b]=[],Human.renderer.lights.clearEnabled();for(var h,i,j=0,k=g.length;k>j;j++)h=g[j],h.lightId?(i=b+"."+h.lightId,h.lightId=i,h.enabled=!0,Human.renderer.lights.addLight(h),f.push(i)):(Human.log.error("Human.assets.lights.load","'lightId' missing on light"),e());e&&e()},a.unloadLibrary=function(b){var c=a.lightIds[b];if(!c)return void Human.log.warn("Human.assets.lights.unloadLibrary","library not loaded");var d,e,f=Human.renderer.lights;for(d=0,e=c.length;e>d;d++)f.removeLight(c[d]);delete a.lightIds[b]}}(),function(){"use strict";function a(a,b){return a&&b?b.indexOf(".")<0?a+"-"+b:b:null}var b=Human.assets.tweens={};b.parseLibrary=function(b,c,d,e){var f,g,h,i,j,k,l,m,n=c.tweens||{},o=[],p=b.split("/")[0];Human.timeline.leafTimelines.hasOwnProperty(p)||(m=new Human.timeline.LeafTimeline(p));for(var q in n)if(n.hasOwnProperty(q)){if(f=n[q],!f.keys){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'keys'");continue}if(!f.targets){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'targets'");continue}if(f.keys.length<2||f.targets.length<2){Human.log.error("Human.timeline.tweenAnimationLoader","tween has insufficient keys or targets - minimum of two required");continue}if(f.keys.length!==f.targets.length){Human.log.error("Human.timeline.tweenAnimationLoader","tween has mismatching numbers of keys and targets");continue}if(f.options=Human.utils.applyIf(this.options,f.options||{}),g=f.type,!g){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'type'");continue}if(j=g.split(":"),h=j[0],i=j[1],"lerp"===h&&(h="tween"),!h||!i){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute invalid: 'type'");continue}switch(i){case"objectAttr":k=new Human.timeline.ObjectControl({modelId:p,objectId:a(p,f.objectId||f.targetId),objectIds:f.objectIds,id:q});break;case"objectXForm":k=new Human.timeline.ObjectTransformControl({modelId:p,objectId:a(p,f.objectId||f.targetId),initial:f.targets[0]});break;case"material":k=new Human.timeline.MaterialControl({modelId:p,materialId:a(p,f.materialId||f.targetId),attributes:f.targets[0]});break;case"texture":k=new Human.timeline.TextureControl({modelId:p,
materialId:a(p,f.materialId||f.targetId),targetLayer:f.targetLayer});break;case"fresnel":k=new Human.timeline.FresnelControl({modelId:p,materialId:a(p,f.materialId),fresnelType:f.fresnelType});break;case"particleSystem":k=new Human.timeline.ParticleSystemControl({particleSystemId:f.particleSystemId});break;case"particleComponent":k=new Human.timeline.ParticleComponentControl({particleSystemId:f.particleSystemId,componentId:f.componentId});break;case"camera":k=new Human.timeline.CameraControl;break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+g);continue}switch(h){case"tween":l=new Human.timeline.Tween({keys:f.keys,targets:f.targets,control:k});break;case"switch":l=new Human.timeline.Switch({keys:f.keys,targets:f.targets,control:k});break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+g);continue}o.push(l)}if(o.length>0){var r=new Human.timeline.TweenAnimation({tweens:o});Human.timeline.addAnimation(b,r)}m=Human.timeline.leafTimelines[p],m.addAnimation(b,Human.timeline.animations[b]),e&&e()},b.unloadLibrary=function(a){var b=a.split("/")[0];Human.timeline.leafTimelines[b].unload("tweens")}}(),function(){"use strict";var a=Human.assets.reflections={},b={};a.reflections={},a.exportedReflectionIds={};var c;a.init=function(){c=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Reflections library"})},a.parseLibrary=function(c,d,e,f){var g=b[c];if(g)return Human.log.warn("Human.assets.reflections.parseLibrary","library already loaded"),void f();g=[],b[c]=g;var h,i,j,k,l=c.split("/"),m=window.localBaseDirectory+"content/states/"+l[0]+"/reflections/"+l[1]+"/",n=Human.renderer.graph;for(var o in d)if(d.hasOwnProperty(o)){if(h=d[o],h.type="reflect",h.blendMode=h.blendMode||"add",i=h.src,!i){Human.log.error("Human.assets.reflections.loader","Reflection property missing: src");continue}if(!Human.utils.isArray(i)){Human.log.error("Human.assets.reflections.loader","Reflection property should be array: src");continue}for(var p=0,q=i.length;q>p;p++)i[p]=m+i[p]+"?v="+Human.VERSION;j=c+"."+o,k={node:n.insertNode(Human.renderer.getLibraryRoot(),h)},a.reflections[j]=k,g.push(j)}Human.renderer.compile(),f&&f()},a.exportReflections=function(b){b=b||{};for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];-1===d.indexOf("/")&&(b[c]=d.replace(/^([^\.]+)\./,"$1/"))}a.exportedReflectionIds=b||{}},a.unloadLibrary=function(c){var d=b[c];if(!d)return void Human.log.warn("Human.assets.reflections.unloadLibrary","library not loaded");var e,f,g,h;for(e=0,f=d.length;f>e;e++)g=d[e],h=a.reflections[g],h.node.destroy();delete b[c]}}(),function(){"use strict";var a=Human.assets.audio={};a.parseLibrary=function(a,b,c,d){Human.media.audio.createLibrary(a,b),d&&d()},a.unloadLibrary=function(a){Human.media.audio.destroyLibrary(a)}}(),function(){"use strict";var a=Human.assets.video={};a.parseLibrary=function(a,b,c,d){Human.media.videos.createLibrary(a,b),d&&d()},a.unloadLibrary=function(a){Human.media.videos.destroyLibrary(a)}}(),function(){"use strict";function a(a,b){return a?a[b]===!0?!0:a[b]===!1?!1:!1:!0}function b(){var a=Human.modules.moduleLibs,b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}function c(){var a=[];if(Human.modules.numActiveModules>0){var b=Human.modules.activeModules;for(var c in b)b.hasOwnProperty(c)&&a.push(c)}return a}function d(){return Human.renderer.camera.getLookAt()}function e(){return Human.renderer.clip.serialize()}function f(){var a,b,c,d={},e=Human.scene,f=e.objects,h=e.enabledObjects;for(var i in f)f.hasOwnProperty(i)&&(a=f[i],c=null,0===a.objects.length&&h[i]&&(c=c||{},c.enabled=!0,b=g(a),b&&(c.transform=b),c.opacity=a.opacity),c&&(d[i]=c));for(var j=0;j<Human.scene.rootObjects.length;j++)a=Human.scene.rootObjects[j],i=a.objectId,a.shown||(d[i]={enabled:a.shown,opacity:a.opacity});return Human.events.fire("bookmarks.captureObjectStates",{data:d}),d}function g(a){if(null===a.pivot)return null;var b={};return 0!==a.pivot.x&&(b.pivot=b.pivot||{},b.pivot.x=a.pivot.x),0!==a.pivot.y&&(b.pivot=b.pivot||{},b.pivot.y=a.pivot.y),0!==a.pivot.z&&(b.pivot=b.pivot||{},b.pivot.z=a.pivot.z),0!==a.translate.x&&(b.translate=b.translate||{},b.translate.x=a.translate.x),0!==a.translate.y&&(b.translate=b.translate||{},b.translate.y=a.translate.y),0!==a.translate.z&&(b.translate=b.translate||{},b.translate.z=a.translate.z),1!==a.scale.x&&(b.scale=b.scale||{},b.scale.x=a.scale.x),1!==a.scale.y&&(b.scale=b.scale||{},b.scale.y=a.scale.y),1!==a.scale.z&&(b.scale=b.scale||{},b.scale.z=a.scale.z),0!==a.rotate.x&&(b.rotate=b.rotate||{},b.rotate.x=a.rotate.x),0!==a.rotate.y&&(b.rotate=b.rotate||{},b.rotate.y=a.rotate.y),0!==a.rotate.z&&(b.rotate=b.rotate||{},b.rotate.z=a.rotate.z),Object.keys(b).length>0?b:null}function h(a){var b,c=[],d={},e=a.objects;for(b in e)if(e[b].shown||e[b].enabled){var f=Human.modules.convertBaseAnatomyObjectId(b);if(!d[f]){d[f]=!0;var g=Human.scene.objects[f];if(!g){if(f=Human.modules.convertBaseAnatomyObjectId(l(b)),d[f])continue;d[f]=!0,g=Human.scene.objects[f]}g&&g.isLeaf()&&c.push(g)}}return c}function i(a,b){var c=0,d=Human.timeline.rootTimelines[a];if(b.timeline)if(b.timeline.hasOwnProperty("scrub"))try{c=b.timeline.scrub.time}catch(e){c=0}else if(b.timeline.hasOwnProperty("play")){var f=b.timeline.play;try{c=Human.timeline.parsePlayInstruction(f).t}catch(e){c=0}}var g=d.mapGlobalTime(c).index;d._chapters=[d._chapters[g]],d.build()}function j(a,b,c){if(s(a.objects),r(a.modes),q(a.camera,function(){}),Human.renderer.resumeCompilation(),Human.renderer.popPause(),!b||void 0===b)return void(c&&c());var d=h(a),e=["tweens","reflections","audio","videos","lights","skyBoxes","geometry","material","transform","morph"];Human.modules.load(b,d,e,function(){u(a.objects),t(a.clips),p(a),Human.events.fire("bookmarks.restored",a),c&&c()})}function k(a,b){var c=Human.timeline.rootTimelines[b];c._chapters[0].info.displayName=a.title,c._chapters[0].info.description=a.description;var d=Human.modules.modules[b].displayName,e=Human.modules.modules[b].description,f=Human.utils.shallowClone(c._chapters[0].annotations);return c._chapters[0].annotations=a.annotations,Human.modules.modules[b].displayName=a.title,Human.modules.modules[b].description=a.description,Human.modules.modules[b].chapters[0].displayName=a.title,Human.modules.modules[b].chapters[0].description=a.description,{title:d,description:e,annotations:f}}function l(a){return a.replace(/_ID[0-9]+$/,"_ID")}function m(a){var b,c,d,e,f,g={};for(b in Human.scene.objects)Human.scene.objects[b]&&!Human.scene.objects[b].anonymous&&(g[b]={shown:!1});for(b in a)if(a.hasOwnProperty(b)){d=a[b],c=Human.modules.convertBaseAnatomyObjectId(b),c=l(c);var h=Human.scene.objects[c];if(h&&(d.hasOwnProperty("enabled")&&(d.shown=d.enabled,delete d.enabled),d.hasOwnProperty("pickable")||(d.pickable=h.pickable),d.hasOwnProperty("backfaces")||(d.backfaces=h.backfaces),d.hasOwnProperty("opacity")||(d.opacity=h.opacity),d.glassFactor=h.glassFactor,d.murkiness=h.murkiness,g[c]=d),b.match("_ID[0-9]+$"))for(e=Human.scene.getLeaves(c),f=0;f<e.length;f++)Human.scene.objects[e[f]].anonymous&&(a[e[f]]?a[e[f]].shown=d.shown:a[e[f]]={shown:d.shown})}return g}function n(a){a.modules={},a.modules.activeModules=[],a.modules.moduleLibs=[],Human.utils.isObject(a.objects)||(a.objects={});var b=o(a.objects);b&&a.modules.activeModules.unshift(b)}function o(a){var b,c=null;for(var d in a)if(a.hasOwnProperty(d)&&(b=d.match(/^(fe)?maleAdult/))){c=["production",b[0],b[0]+".json"].join("/");break}return c}function p(a){return a.timeline?void(a.timeline.scrub?Human.timeline.scrub(a.timeline.scrub):a.timeline.play&&Human.timeline.play(a.timeline.play)):void Human.timeline.scrub({time:0})}function q(a,b){Human.renderer.camera.fly.flyTo(a,function(){b&&b()})}function r(a){a&&(void 0!==a.highlight&&null!==a.highlight&&Human.rpc.call(null,"highlight.setEnabled",{enable:a.highlight}),Human.scene.anySelected()&&a.isolate?void 0!==a.isolate&&null!==a.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:a.isolate}):void 0!==a.isolate&&null!==a.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:!1}),void 0!==a.labels&&null!==a.labels&&Human.rpc.call(null,"labels.setEnabled",{enable:a.labels}),void 0!==a.singlePick&&null!==a.singlePick&&Human.rpc.call(null,"pick.single.setEnabled",{enable:a.singlePick}),void 0!==a.multiPick&&null!==a.multiPick&&Human.rpc.call(null,"pick.multi.setEnabled",{enable:a.multiPick}),void 0!==a.xray&&null!==a.xray&&Human.rpc.call(null,"xray.setEnabled",{enable:a.xray}))}function s(a){a=m(a),Human.scene.setObjectProperties(a)}function t(a){Human.renderer.clip.reset();for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];void 0!==c.state&&(("clipping"===c.state||3===c.state||"visible"===c.state||4===c.state)&&(c.enabled=!0),"number"==typeof c.clipId&&c.clipId--),Human.renderer.clip.setClip(a[b])}}function u(a){a=a||{};var b,c,d;for(c in a)a.hasOwnProperty(c)&&(b=Human.scene.objects[c],d=a[c].transform,b&&d&&b.setTransform(v(b,d)))}function v(a,b){var c=a.pivot||{x:0,y:0,z:0},d=a.translate||{x:0,y:0,z:0},e=a.scale||{x:1,y:1,z:1},f=a.rotate||{x:0,y:0,z:0};return b.pivot=b.pivot||{},b.translate=b.translate||{},b.scale=b.scale||{},b.rotate=b.rotate||{},b.pivot.x=void 0===b.pivot.x?c.x:b.pivot.x,b.pivot.y=void 0===b.pivot.y?c.y:b.pivot.y,b.pivot.z=void 0===b.pivot.z?c.z:b.pivot.z,b.translate.x=void 0===b.translate.x?d.x:b.translate.x,b.translate.y=void 0===b.translate.y?d.y:b.translate.y,b.translate.z=void 0===b.translate.z?d.z:b.translate.z,b.scale.x=void 0===b.scale.x?e.x:b.scale.x,b.scale.y=void 0===b.scale.y?e.y:b.scale.y,b.scale.z=void 0===b.scale.z?e.z:b.scale.z,b.rotate.x=void 0===b.rotate.x?f.x:b.rotate.x,b.rotate.y=void 0===b.rotate.y?f.y:b.rotate.y,b.rotate.z=void 0===b.rotate.z?f.z:b.rotate.z,b}var w,x,y=Human.bookmarks={};y.capture=function(g){var h={engineVersion:Human.VERSION};a(g,"modules")&&(h.modules={moduleLibs:b(),activeModules:c()}),a(g,"camera")&&(h.camera=d()),a(g,"clips")&&(h.clips=e()),a(g,"objects")&&(h.objects=f()),a(g,"timeline")&&(h.timeline=Human.timeline.getBookmark()),a(g,"background")&&(h.background={colors:Human.renderer.bg.getBGColor()}),h.plugins={};var i,j=Human.plugins;for(var k in j)j.hasOwnProperty(k)&&(i=j[k],i.writeBookmark&&i.writeBookmark(h));return Human.events.fire("bookmarks.capture",{bookmark:h}),h},y.restore=function(a,b){Human.events.fire("bookmarks.restoring"),Human.utils.isObject(a.modules)||n(a);for(var c=a.modules.activeModules,d=c.length>1,e=[],f=0,g=c.length;g>f;f++)e[f]=Human.modules.convertBaseAnatomyModuleId(c[f]);Human.utils.filterInPlace(e,function(a){return Human.modules.activeModules[a]?!1:d&&Human.modules.isBaseModule(a)?!1:!0});var h=e[0],l={camera:!0,graph:!0,annotations:!0,properties:!0,time:!0,hotspots:!0};if(a.theModuleId=h,Human.renderer.pushPause(),Human.renderer.pauseCompilation(),h)if(Human.modules.modules.hasOwnProperty(h)){var m=Human.modules.moduleData[h];Human.modules.create(h,m,function(){i(h,a);var c=k(a,h);w=c.title,x=c.description,Human.modules.activate(h,0,l,function(){j(a,h,b)})})}else Human.modules.fetch(h,function(){var c=Human.modules.moduleData[h];Human.modules.create(h,c,function(){i(h,a);var c=k(a,h);w=c.title,x=c.description,Human.modules.activate(h,0,l,function(){j(a,h,b)})})});else j(a,h,b)}}(),function(){"use strict";var a=5,b=Human.modules={},c=new Human.utils.IDPool;b.modules={},b.moduleData={},b.moduleLibs={},b.activeModules={},b.numActiveModules=0,b.history=[],b.fetch=function(a,c,d){Human.events.fire("modules.fetch.start",{moduleId:a}),Human.assets.server.getModuleDefinition(a,function(d){d.moduleId=a,b.moduleData[a]=d,Human.events.fire("modules.fetch.finish",{moduleId:a,moduleData:d}),c&&c()},function(b){Human.log.info("Human.modules.activateModules","Failed to activate module: '"+a+"' - "+b),d&&d(b)})},b.create=function(c,d,e){d=Human.utils.deepClone(d),Human.events.fire("modules.create.start",{moduleId:c,moduleData:d}),b.modules[c]&&delete b.modules[c];var f=new b.Module(d),g=function(){b.modules[c]=f,Human.events.fire("modules.created",d),Human.events.fire("modules.create.finish",{moduleId:c,module:b.modules[c]}),e&&e()};f.create(g),b.history.unshift(c),b.history.length>a&&b.history.pop()},b.activate=function(a,c,d,e){Human.events.fire("modules.activate.start",{moduleId:a,config:d}),Human.events.fire("modules.activating",{moduleId:a});var f=function(){b.activeModules[a]=b.modules[a],b.numActiveModules++,Human.events.fire("modules.activated",{moduleId:a}),Human.events.fire("modules.activate.finish",{moduleId:a}),e&&e()};b.modules[a].activate(c,d,f)},b.load=function(a,c,d,e){Human.events.fire("modules.load.start",{moduleId:a,graphNodes:c,assetTypes:d});var f=function(){Human.renderer.prepareFrame(),Human.events.fire("modules.load.finish",{moduleId:a,graphNodes:c,assetTypes:d}),e&&e()};b.modules[a].load(c,d,f)},b.unload=function(a,c,d,e){Human.events.fire("modules.unload.start",{moduleId:a,graphNodes:c,assetTypes:d});var f=function(){Human.events.fire("modules.unload.finish",{moduleId:a,graphNodes:c,assetTypes:d}),e&&e()};b.modules[a].unload(c,d,f)},b.deactivate=function(a,c,d){Human.events.fire("modules.deactivate.start",{moduleId:a,config:c});var e=function(){delete b.activeModules[a],b.numActiveModules--,Human.events.fire("modules.deactivated",{moduleId:a}),Human.events.fire("modules.deactivate.finish",{moduleId:a}),d&&d()};b.modules[a].deactivate(c,e)},b.destroy=function(a,d){if(Human.events.fire("modules.destory.start",{moduleId:a}),b.modules[a]){var e=function(){delete b.moduleData[a],delete b.modules[a],c.putId(a),Human.events.fire("modules.destroy.finish",{moduleId:a}),d&&d()};b.modules[a].destroy(e)}else Human.log.warn("Human.modules.destroyModule","Module does not exist, cannot be destoryed: + "+a)},b.isBase=function(a){var b=a.match(/^(femaleAdult|maleAdult|female_complete_anatomy_[0-9]+\.json|male_complete_anatomy_[0-9]+\.json)/);return b&&b[0]},b.isBaseModule=function(a){var c=a.split("/");return b.isBase(c[c.length-1])?a:!1},b.requiresBase=function(a){for(var c=!1,d=0;d<a.length&&!(c=b.isBase(a[d]));d++);return c};var d=b.MALE_STATE_ID="maleAdult_standard",e=b.FEMALE_STATE_ID="femaleAdult_standard",f={"production/maleAdult/maleAdult.json":"production/maleAdult/maleAdult_standard.json","production/femaleAdult/femaleAdult.json":"production/femaleAdult/femaleAdult_standard.json"};b.convertBaseAnatomyModuleId=function(a){return f[a]||a},b.convertBaseAnatomyStateId=function(a){return a.replace(/^femaleAdult$/,e).replace(/^maleAdult$/,d)},b.convertBaseAnatomyObjectId=function(a){if(b.isBase(a)){var c=a.split("-"),d=b.convertBaseAnatomyStateId(c[0]);a=[d,c[1]].join("-"),/_ID$/.test(a)||(a+="_ID")}return a}}(),function(){"use strict";function a(a,b){var c,d;b=b||{showObjects:{},selectObjects:{},pickThroughObjects:{},colorRecipeObjects:{}};var e=a.showObjects||b.showObjects||{},f=a.selectObjects||b.selectObjects||{},g=a.pickThroughObjects||b.pickThroughObjects||{},h=a.opacityObjects||b.opacityObjects||{},i=a.colorRecipeObjects||b.colorRecipeObjects||{},j=a.synchronization||{};d="shown";for(c in e)e.hasOwnProperty(c)&&(j.hasOwnProperty(c)||(j[c]={}),j[c][d]=e[c]);d="selected";for(c in f)f.hasOwnProperty(c)&&(j.hasOwnProperty(c)||(j[c]={}),j[c][d]=f[c]);d="pickable";for(c in g)g.hasOwnProperty(c)&&(j.hasOwnProperty(c)||(j[c]={}),j[c][d]=!g[c]);d="opacity";for(c in h)j[c]||(j[c]={}),j[c][d]=h[c];for(var k in i)for(c in i[k])j[c]||(j[c]={}),j[c][k]=i[k][c];return j}function b(a){return function(b){return a.indexOf(b)>-1}}var c=Human.modules.Module=function(a){this.moduleId=a.moduleId,this.displayName=a.displayName||"",this.description=a.description||"",this.translations=a.translations||{},this.tags=a.tags||[],this.ui=a.ui||{},this.active=!1,this.timeActivated=-1,this.rootObjects=[],this.animation=a.animation||{},this.camera=a.camera,this.jumpTo=a.jumpTo,this.flyTo=a.flyTo;var b=a.modelIds||a.stateId;this.modelIds=b?Human.utils.isArray(b)?b:[b]:[],this.showObjects=a.showObjects,this.selectObjects=a.selectObjects,this.pickThroughObjects=a.pickThroughObjects,this.opacityObjects=a.opacityObjects,this.xray=a.xray,this.properties=a.properties,this.swapped=!1,this.swappedObjectId=null,this.background=a.background||null,this.customData=a.customData||{},this.cache=!1,this.chapters=a.chapters||null,this.sceneGraph=a.sceneGraph,this.particleSystems=a.customData&&a.customData.particleSystems?a.customData.particleSystems:[],this.assetLibraries=a.assetLibraries,this.hasAssetLights=this.assetLibraries.hasOwnProperty("lights")&&this.assetLibraries.lights.length>0,this.lights=a.lights,this.hasLights=this.hasAssetLights||!!this.lights,this.reflections=a.reflections||{};for(var c in this.reflections)if(this.reflections.hasOwnProperty(c)){var d=this.reflections[c],e=d.split(".");d=e[0]+"/"+e.slice(1).join("."),Human.assets.reflections.exportedReflectionIds[c]=d}this.layers=a.layers||{},this.objectState=a.objects||{},this.clips=a.clips||{},this.modes=a.modes||{},this.colorRecipes=a.colorRecipes||{}};c.prototype.create=function(c){var d,e,f,g=this;for(Human.scene.graph.buildGraph(g.sceneGraph,null,{}),d=0;d<g.sceneGraph.length;d++)g.rootObjects.push(Human.scene.objects[g.sceneGraph[d].objectId]);this.lights&&Human.renderer.lights.addLights(this.lights);var h;for(d=0;d<g.chapters.length;d++)if(h=g.chapters[d],h.lights)if(this.hasAssetLights){var i=h.lights.libraries;Human.utils.filterInPlace(i,b(this.assetLibraries.lights)),0===i.length&&i.push("default")}else h.lights.libraries=["default"];else h.lights={libraries:[],lights:[]},h.lights.libraries=g.hasAssetLights?Human.utils.deepClone(g.assetLibraries.lights):["default"];f=new Human.timeline.RootTimeline(g.moduleId);var j={showObjects:g.showObjects,pickThroughObjects:g.pickThroughObjects,selectObjects:g.selectObjects,opacityObjects:g.opacityObjects};for(d=0;d<g.chapters.length;d++)g.chapters[d].synchronization=a(g.chapters[d],j),g.chapters[d].hasOwnProperty("id")||(g.chapters[d].id=g.moduleId+"_"+d),e=new Human.timeline.BranchTimeline(g.chapters[d]),f.addChapter(e,{rebuild:!1});f.build(),g.rootTimeline=f,Human.particles.parse(g.particleSystems,c)},c.prototype.activate=function(a,b,c){var d=this;if(d.timeActivated=Date.now(),d.active=!0,d.properties&&Human.properties.set(d.properties),d.colorRecipes){Human.scene.colorRecipes.clearRecipes();for(var e in d.colorRecipes)Human.scene.colorRecipes.registerRecipe(e,d.colorRecipes[e])}a!==!1&&d.rootTimeline.activate(a,b,c)},c.prototype.load=function(a,b,c){var d,e=this,f=0,g=0;this.customData.tweens&&Human.assets.tweens.parseLibrary(this.customData.tweenId,this.customData.tweens);for(d in e.assetLibraries)e.assetLibraries.hasOwnProperty(d)&&b.indexOf(d)>=0&&(g+=e.assetLibraries[d].length);if(g>0){var h=function(){g--,0===g&&Human.scene.graph.attachAssetSetsToSubtree(a,[b],c)};if(e.assetLibraries.tweens&&b.indexOf("tweens")>=0)for(f=0;f<e.assetLibraries.tweens.length;f++)Human.assets.getAssetLibrary("animation","animations",e.assetLibraries.tweens[f],"manifest",{},h);if(e.assetLibraries.reflections&&b.indexOf("reflections")>=0)for(f=0;f<e.assetLibraries.reflections.length;f++)Human.assets.getAssetLibrary("reflection","reflections",e.assetLibraries.reflections[f],"outline",{},h);if(e.assetLibraries.lights&&e.assetLibraries.lights.length>0&&b.indexOf("lights")>=0)for(f=0;f<e.assetLibraries.lights.length;f++)Human.assets.getAssetLibrary("light","lights",e.assetLibraries.lights[f],"outline",{},h)}else Human.scene.graph.attachAssetSetsToSubtree(a,[b],c)},c.prototype.unload=function(a,b,c){var d=this,e=0;if(d.assetLibraries.tweens&&b.indexOf("tweens")>=0)for(e=0;e<d.assetLibraries.tweens.length;e++)Human.assets.putAssetLibrary(d.assetLibraries.tweens[e]);if(d.assetLibraries.reflections&&b.indexOf("reflections")>=0)for(e=0;e<d.assetLibraries.reflections.length;e++)Human.assets.putAssetLibrary(d.assetLibraries.reflections[e]);if(d.assetLibraries.lights&&b.indexOf("lights")>=0)for(e=0;e<d.assetLibraries.lights.length;e++)Human.assets.putAssetLibrary(d.assetLibraries.lights[e]);Human.scene.graph.unloadSubtree(a,b,c)},c.prototype.deactivate=function(a,b){var c=this;c.timeActivated=-1,c.active=!1,c.rootTimeline.deactivate(a,b)},c.prototype.destroy=function(a){var b=this;b.rootTimeline.destroy(),Human.scene.graph.destroySubtree(b.rootObjects),b=null,a&&a()}}(),function(){"use strict";var a=Human.mobile={android:void 0!==window.HumanKitAndroid,iOS:void 0!==window.webkit,bundleid:void 0!==window.mobilebundleid?window.mobilebundleid:null};a.getAnnotations=function(){var a=[],b=Human.view.annotations.annotations;for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e={annotationId:d.annotationId,title:d.label.title,description:d.label.description,objectId:d.object?d.object.objectId:""};a.push(e)}return a},(a.android||a.iOS)&&(Human.events.on("modules.created",function(b){if(a.android?window.HumanKitAndroid.moduleInfo(JSON.stringify({title:b.displayName,description:b.description,playPause:b.ui.playPause,scrubber:b.ui.scrubber})):window.webkit.messageHandlers.moduleHandler.postMessage({title:b.displayName,description:b.description,playPause:b.ui.playPause,scrubber:b.ui.scrubber}),null!==b.chapters){for(var c=[],d=0;d<b.chapters.length;d++)c.push(b.chapters[d].id+":::::"+b.chapters[d].displayName+":::::"+b.chapters[d].description);a.android?window.HumanKitAndroid.chaptersInfo(JSON.stringify(c)):window.webkit.messageHandlers.chaptersHandler.postMessage(c)}}),Human.events.on("timeline.chapters.activated",function(b){a.android?window.HumanKitAndroid.chapterTransition(b.branchID):window.webkit.messageHandlers.chapterHandler.postMessage(b.branchID)}),Human.events.on("timeline.playing",function(b){a.android?window.HumanKitAndroid.timelineUpdate(JSON.stringify({time:b.time})):window.webkit.messageHandlers.timelineHandler.postMessage(b.time)}),Human.events.on("timeline.completed",function(){a.android?window.HumanKitAndroid.timelineCompleted():window.webkit.messageHandlers.timelineHandler.postMessage("done")}),Human.events.on("pick.picked",function(b){b.objectId&&(a.android?window.HumanKitAndroid.onObjectSelected(b.objectId):window.webkit.messageHandlers.selectHandler.postMessage(b.objectId))}),Human.events.on("pick.doubleClick",function(){a.android?window.HumanKitAndroid.onObjectDeselected("hi"):window.webkit.messageHandlers.deselectHandler.postMessage("hi")}))}(),function(){"use strict";var a=Human.workers={},b="";a.setPath=function(a){b=a},a.loadWorker=function(a){var c=b+"/"+a;return new Worker(c)}}(),function(){"use strict";Human.plugins={},Human.addPlugin=function(a,b){Human.plugins[a]=b}}(),function(){"use strict";Human.actions={parse:function(){},addAction:function(){}},Human.events.on("loaded",function(){Human.view.init(),Human.input.init()}),Human.events.on("tick",function(){Human.input.onFrame()}),Human.events.on("cull",function(a){Human.view.annotations.onFrame(),Human.view.labels.onFrame(),Human.view.explode.onFrame(a.timeNow-a.timeLast),Human.view.onFrame()}),Human.events.on("timeline.chapters.initializing",function(a){var b=Human.timeline.branchTimelines[a.chapterId],c=a.params;c.annotations&&!b.initializedAnnotations&&(b.initializedAnnotations=!0,b.initAnnotations(b.annotations))}),Human.events.on("timeline.chapter.deactivate.finish",function(){Human.view.annotations.clearAnnotations()})}(),function(){"use strict";var a=Human.scene;a.selectedObjects={},a.showSelectedObjects=!1,a.setSelectedObjects=function(b){var c=b.objects||b.objectIds||{};b.objectId&&(c[b.objectId]=!!b.select);var d={},e={},f=b.replace?!1:void 0,g=b.fetchAssets?[]:null;a.setSelectedSubtree(Human.scene.rootObjects,c,f,g,d,e),g&&Human.scene.graph.attachAssetSetsToSubtree(g),Human.utils.isEmpty(d)||Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:d,showSelectedObjects:a.showSelectedObjects}),Human.utils.isEmpty(e)||Human.events.fire("scene.objectsSelected",{selectedObjectsUpdate:e,showSelectedObjects:a.showSelectedObjects})},a.setSelectedSubtree=function(b,c,d,e,f,g){for(var h=0,i=b.length;i>h;++h){var j=b[h],k=void 0!==c[j.objectId]?c[j.objectId]:d;j.isLeaf()?k===!0?(a.enabledObjects[j.objectId]||(a.enabledObjects[j.objectId]=j,f[j.objectId]=!0,j.show(!0)),a.selectedObjects[j.objectId]||(a.selectedObjects[j.objectId]=j,g[j.objectId]=!0,j.select(!0),e&&!j.isRenderable()&&e.push(j))):k===!1&&a.selectedObjects[j.objectId]&&(delete a.selectedObjects[j.objectId],g[j.objectId]=!1,j.select(!1)):a.setSelectedSubtree(j.objects,c,k,e,f,g)}},a.anySelected=function(b){var c;for(var d in a.selectedObjects)if(a.selectedObjects.hasOwnProperty(d))return c=a.selectedObjects[d],!b||c.isLeaf();return!1},a.setShowSelectedObjects=function(b){a.showSelectedObjects=b;var c,d;for(var e in a.objects)a.objects.hasOwnProperty(e)&&(c=a.objects[e],d=!!a.enabledObjects[e],a.showSelectedObjects&&(d=d&&!!a.selectedObjects[e]),c.isLeaf()&&c.shown!==d&&c.show(d))},Human.events.on("scene.objectsShown",function(b){var c={},d=b.enabledObjectsUpdate;for(var e in d)d[e]===!1&&a.selectedObjects[e]&&(c[e]=!1,delete a.selectedObjects[e]);Human.utils.isEmpty(c)||Human.events.fire("scene.objectsSelected",{selectedObjectsUpdate:c,showSelectedObjects:a.showSelectedObjects})}),Human.events.on("scene.objectPropertiesSet",function(b){function c(a){var b=!1;d[a.objectId]&&void 0!==d[a.objectId].selected?b=d[a.objectId].selected:a.parent&&(b=e[a.parent.objectId]),e[a.objectId]=b,a.isLeaf()&&(a.selected!==b&&(g[a.objectId]=b),b&&(f[a.objectId]=a),a.select(b))}for(var d=b.instructions||{},e={},f={},g={},h=Human.scene.rootObjects,i=0,j=h.length;j>i;i++)h[i].traverseDown(c);Human.scene.selectedObjects=f,Human.events.fire("scene.objectsSelected",{selectedObjectsUpdate:g,showSelectedObjects:a.showSelectedObjects})}),Human.scene.Object.prototype.select=function(a){if(this.selected!==a&&(this.selected=a,this._propertiesNode)){var b="scene.object"+(this.selected?"Selected":"Deselected");Human.events.fire(b,{objectId:this.objectId})}},Human.events.on("scene.objectDestroyed",function(b){Human.view.annotations.destroyByObjectId(b.objectId),delete a.selectedObjects[b.objectId]}),Human.events.on("scene.objectRenderable",function(a){for(var b=Human.scene.objects[a.objectId];b;)Human.view.annotations.showByObjectId(b.objectId),b=b.parent}),Human.events.on("scene.objectShown",function(a){Human.view.annotations.showByObjectId(a.objectId)}),Human.events.on("scene.objectHidden",function(a){Human.view.annotations.showByObjectId(a.objectId)})}(),function(){"use strict";var a=Human.view={camera:Human.renderer.camera,clip:Human.renderer.clip,lights:Human.renderer.lights,pick:Human.renderer.pick},b=["Highlight","Xray","Isolate"],c={},d=b.map(function(a,b){return a=a.toLowerCase(),c[a]=b,a});a.currentMode=b[0],a.init=function(){this.annotations.init(),this.labels.init(),this.highlight.setEnabled(!0)},a.setModeEnabled=function(a){if(a=a.toLowerCase(),"isolate"===a&&!Human.scene.anySelected())return void alert("Please select an object before Isolating.");var b=c[a];void 0!==b&&(d.forEach(function(a,c){b!==c&&Human.view[a].enabled&&Human.view[a].setEnabled(!1)}),Human.view[a].setEnabled(!0))},a.parseViewInstruction=function(a){var b=a.xray||!1,c=a.dissect||!1,d=a.hasOwnProperty("singlePick")?a.singlePick:!0,e=a.hasOwnProperty("labels")?a.labels:!0,f=a.isolate||!1,g=a.hasOwnProperty("highlight")?a.highlight:!0;return b&&(g=!1,f=!1),c&&(d=null),f&&(g=!1,b=!1,c||(d=!0)),g&&(b=!1,f=!1),{xray:b,dissect:c,singlePick:d,labels:e,isolate:f,highlight:g}},a.setViewModes=function(b){b=a.parseViewInstruction(b),Human.view.xray.setEnabled(b.xray),b.singlePick?(Human.renderer.pick.setSinglePickEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1)):b.singlePick||null===b.singlePick?(Human.renderer.pick.setSinglePickEnabled(!1),Human.renderer.pick.setMultiPickEnabled(!1)):(Human.renderer.pick.setSinglePickEnabled(!1),Human.renderer.pick.setMultiPickEnabled(!0)),Human.view.labels.setEnabled(b.labels),Human.view.isolate.setEnabled(b.isolate),Human.view.dissect.setEnabled(b.dissect),Human.view.highlight.setEnabled(b.highlight)},a.onFrame=function(){Human.view.isolate.enabled?Human.view.isolate.onFrame():Human.view.xray.enabled?Human.view.xray.onFrame():Human.view.highlight.enabled&&Human.view.highlight.onFrame()}}(),function(){"use strict";function a(a){for(var b=Human.scene.objects[a];b&&b.anonymous;)b=b.parent;return b}var b=Human.renderer.pick.corePick=Human.renderer.pick.pick,c=Human.renderer.pick;c.onSingleClick=null,c.onDoubleClick=function(a){if(a){Human.scene.setSelectedObjects({objectId:a.objectId,select:!0,replace:c.singleEnabled});var b=Human.scene.getBoundary({objects:Human.scene.selectedObjects,clipped:!0}),d=[];d[0]=.5*(b.xmax+b.xmin),d[1]=.5*(b.ymax+b.ymin),d[2]=.5*(b.zmax+b.zmin),Human.view.labels.createLabel({objectId:a.objectId,afterDelay:!0,replace:!0,offset:d}),Human.renderer.camera.fly.flyTo({boundary:b})}else Human.view.xray.enabled||Human.view.isolate.enabled||(Human.events.fire("pick.doubleClick"),Human.scene.setSelectedObjects({select:!1,replace:!0}))},c.onHover=null,c.onQuery=null,c.singleEnabled=!0,c.multiEnabled=!1;var d=!1;c.setSinglePickEnabled=function(a){c.singleEnabled!==a&&(c.singleEnabled=a),a&&(c.multiEnabled&&(c.multiEnabled=!1),Human.events.fire("pick.multi.toggled",{enabled:c.multiEnabled})),Human.events.fire("pick.single.toggled",{enabled:c.singleEnabled})},c.getSinglePickEnabled=function(){return c.singleEnabled},c.setMultiPickEnabled=function(a){c.multiEnabled!==a&&(c.multiEnabled=a),a&&(c.singleEnabled&&(c.singleEnabled=!1),Human.events.fire("pick.single.toggled",{enabled:c.singleEnabled})),Human.events.fire("pick.multi.toggled",{enabled:c.multiEnabled})},c.getMultiPickEnabled=function(){return c.multiEnabled},c.hoverPick=function(a){return c._pick(a,!0,!1,!1,d)},c.pick=function(a){return c._pick(a,!1,!1,!1,d)},c.doublePick=function(a){return c._pick(a,!1,!0,!1,d)},c.queryPick=function(a){return c._pick(a,!1,!1,!0,a.rayPick||d)},c._pick=function(c,d,e,f,g){var h,i,j=c.canvasX,k=c.canvasY,l=c.mouseDownLeft,m=c.mouseDownRight,n=c.ctrlDown;h=b(j,k,{rayPick:g});var o={mouseDownLeft:l,mouseDownRight:m,ctrlDown:n};return h.objectId&&(o=Human.utils.apply(h,o),i=a(h.objectId)),d?(o.mode="hover",this.onHover&&this.onHover(i,o),i&&Human.events.fire("pick.hoverPicked",o)):f?(o.mode="query",this.onQuery&&this.onQuery(i,o)):e?(o.mode="doubleClick",this.onDoubleClick&&this.onDoubleClick(i,o)):(o.mode="singleClick",this.onSingleClick&&this.onSingleClick(i,o)),o}}(),function(){"use strict";function a(){var a={};return Human.renderer.pick.getSinglePickEnabled&&(a.singlePick=Human.renderer.pick.getSinglePickEnabled(),a.multiPick=Human.renderer.pick.getMultiPickEnabled()),Human.view&&(a.dissect=Human.view.dissect.getEnabled(),a.highlight=Human.view.highlight.getEnabled(),a.isolate=Human.view.isolate.getEnabled(),a.labels=Human.view.labels.getEnabled(),a.xray=Human.view.xray.getEnabled()),a}function b(){var a,b,c=[],d=Human.view.annotations.annotations,e=Array.prototype.slice;for(var f in d)d.hasOwnProperty(f)&&(a=d[f],a.saved&&(b={annotationId:f,title:a.label.title,description:a.label.description,pos:e.call(a.pin.marker.pos),pinVec:e.call(a.pin.marker.dir),shown:a.pin.shown,labelShown:a.label.shown,labelOffset:e.call(a.label.offset),occludable:a.occludable,primitiveIndex:a.pin.marker.primitiveIndex,barycentric:a.pin.marker.barycentric},a.object&&(b.objectId=a.object.objectId),c.push(b)));return c}Human.events.on("bookmarks.capture",function(c){c.bookmark.modes=a(),c.bookmark.annotations=b()}),Human.events.on("bookmarks.captureObjectStates",function(a){var b=Human.scene.objects,c=Human.scene.selectedObjects,d=a.data,e=null;for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];0===g.objects.length&&Human.scene.enabledObjects[f]&&(e=d[f]||{},e.selected=!!c[f],d[f]=e)}for(var h=0;h<Human.scene.rootObjects.length;h++)g=Human.scene.rootObjects[h],f=g.objectId,g.shown||(d[f].selected=g.selected)})}(),function(){"use strict";var a=Human.view.labels={container:null};a.enabled=!0;var b={},c=0,d=!0;Human.events.on("scene.objectDestroyed",function(e){
if(a.enabled&&c>0){var f=e.objectId;if(b[f]){a._destroyLabel(f);var g={};g[f]=!1,Human.events.fire("labels.updated",{enabledLabels:b})}}d=!0}),Human.events.on("scene.objectsSelected",function(e){if(a.enabled&&c>0){var f=e.selectedObjectsUpdate,g=Human.scene.objects;for(var h in f)f.hasOwnProperty(h)&&0===g[h].objects.length&&f[h]===!1&&b[h]&&a._destroyLabel(h);Human.events.fire("labels.updated",{enabledLabels:b})}d=!0}),Human.events.on("scene.objectsShown",function(d){if(a.enabled&&c>0){var e=d.enabledObjectsUpdate;for(var f in e)e.hasOwnProperty(f)&&e[f]===!1&&b[f]&&a._destroyLabel(f);Human.events.fire("labels.updated",{enabledLabels:b})}}),Human.events.on("camera.updated",function(){d=!0}),Human.events.on("canvas.resized",function(){d=!0});var e=vec4.create(),f=vec4.create(),g=vec2.create();a.init=function(){this.container=document.getElementById(Human.containerId)},a.onFrame=function(){if(d){var a=Human.renderer.getViewMat(),c=Human.renderer.getProjMat();for(var h in b)if(b.hasOwnProperty(h)){var i=b[h];vec3.transformMat4(e,i.offset,a),e[3]=1,vec4.transformMat4(f,e,c);var j=f[0],k=f[1],l=f[3];g[0]=(1+j/l)*Human.renderer.canvas.width/2,g[1]=(1-k/l)*Human.renderer.canvas.height/2,i.updatePos(g,e)}d=!1}},a._destroyLabel=function(a){var d=b[a];d&&(d.destroy(),delete b[a],c--)},a.createLabel=function(d){var e=d.objectId,f=Human.scene.objects[e];if(!f)return void Human.log.warn("Human.view.labels.createLabel","Scene object not found: '"+e+"'");if(d.replace&&a._clearLabels(),!f.displayName)return void Human.log.warn("Human.view.labels.createLabel","Scene object has no displayName: '"+e+"'");var g=d.offset||f.getCenter();b[e]=new Human.view.labels.Label({labelId:e,text:f.displayName,style:null,offset:g,nodeId:e,objectId:e,enabled:a.enabled,onHide:function(){a._destroyLabel(e)}}),Human.events.fire("labels.updated",{enabledLabels:b}),c++},a.clearLabels=function(){c>0&&(a._clearLabels(),Human.events.fire("labels.updated",{enabledLabels:b}))},a._clearLabels=function(){for(var d in b)b.hasOwnProperty(d)&&a._destroyLabel(d);c=0},a.setEnabled=function(b){a.enabled!==b&&(a.enabled=b,b||a._clearLabels(),Human.events.fire("labels.toggled",{enabled:b}))},a.getEnabled=function(){return a.enabled}}(),function(){"use strict";var a={};Human.view.labels.Label=function(b){this.nodeId=b.nodeId,this.objectId=b.objectId,this.animationId=b.animationId,this.offset=b.offset,this.shown=b.shown,this.enabled=b.enabled,this._style=b.style||"labelStyleDefault",this.labelId=b.labelId?b.labelId:this.animationId?"a."+this.objectId:this.objectId?"o."+this.objectId:"n."+this.nodeId,this._labelElement=document.createElement("div"),this._labelElement.id=this.labelId,this._labelElement.classList.add("label-container","right","hidden"),this._labelElement.innerHTML=['<div class="label-container-header ',this.style,'">',"<span>",b.text,"</span>",'<img src="img/shim.gif" alt="Close" class="icon-close icon-inverse" />','<div class="label-toggle-secondary icon-expand"></div>','<ul class="options"></ul>',"</div>"].join(""),Human.view.labels.container.appendChild(this._labelElement),this._elementWidth=this._labelElement.clientWidth,this._elementHeight=this._labelElement.clientHeight;var c=this;a[this.labelId]=this;var d=this._labelElement.getElementsByClassName("icon-close")[0];d.addEventListener("click",b.onHide);var e=this._labelElement.getElementsByClassName("options")[0],f=this._labelElement.getElementsByClassName("label-toggle-secondary")[0];e.style.display="none",f.style.display="none";var g=Human.view.annotations.getAnnotations({objectId:this.objectId,type:"secondary"}),h=Object.keys(g).length>0;if(h){var i=0,j=function(a){n.innerText=a?"Hide Pins":"Show Pins"},k=function(a){a===!0?i++:i>0&&i--,j(0!==i)},l=!1,m=function(){if(l!==!0){i=0;for(var a in g)if(g.hasOwnProperty(a)){var b=g[a];b.label.on("shown",k),b.label.shown===!0&&i++}j(0!==i)}},n=document.createElement("li");n.addEventListener("click",function(){var a=0!==i,b={};b[c.objectId]=!a,Human.view.annotations.setLabelsShown({objects:b,type:"secondary",replace:!0})}),f.addEventListener("click",function(){l!==!0&&(m(),l=!0)}),e.appendChild(n)}if(e.children.length>0){d.style.display="none";var o=document.createElement("li");o.innerText="Hide Label",o.addEventListener("click",b.onHide),e.appendChild(o),f.addEventListener("click",function(){Human.utils.elementVisible(e)?(e.style.display="none",f.setAttribute("class","icon-expand")):(e.style.display="block",f.setAttribute("class","icon-collapse"))}),f.style.display="block"}},Human.view.labels.Label.prototype.updatePos=function(a,b){var c=a[0],d=a[1]+40,e=b[2];return e>0?void(this.shown&&this.setShown(!1)):(c=Math.max(20,Math.min(c,Human.renderer.canvas.width-this._elementWidth-10)),d=Math.max(10,Math.min(d,Human.renderer.canvas.height-this._elementHeight-10)),this._labelElement.style.transform="translate3d("+c+"px,"+d+"px, 0)",void(this.shown||this.setShown(!0)))},Human.view.labels.Label.prototype.update=function(a){var b=a.canvasPos.x,c=a.canvasPos.y;0>=c?this.shown&&this.setShown(!1):(this._labelElement.style.transform="translate3d("+b+"px,"+(c+40)+"px, 0)",a.style&&(this._style&&this._labelElement.classList.remove(this._style),this._labelElement.classList.add(a.style),this._style=a.style),this.shown||this.setShown(!0))},Human.view.labels.Label.prototype.setShown=function(a){this.shown!==a&&(this._labelElement.style.display=a&&this.enabled?"block":"none",this.shown=a)},Human.view.labels.Label.prototype.setEnabled=function(a){this.enabled!==a&&(this._labelElement.style.display=this.shown&&a?"block":"none",this.enabled=a)},Human.view.labels.Label.prototype.destroy=function(){delete a[this.labelId],this.shown&&this.setShown(!1),this._labelElement&&(Human.utils.removeElement(this._labelElement),this._labelElement=null)}}(),function(){"use strict";function a(a,b){if(a){var c,d=b.ctrlDown;if(Human.view.annotations.setLabelsShown({objects:{},type:"secondary",replace:!0}),d)return c={},c[a.objectId]=!1,void Human.view.annotations.setLabelsShown({objects:c,type:"secondary"});var e=!!Human.scene.selectedObjects[a.objectId];Human.scene.setSelectedObjects({objectId:a.objectId,select:!e,replace:!Human.renderer.pick.multiEnabled}),e||(Human.view.labels.createLabel({objectId:a.objectId,afterDelay:!0,replace:!0}),Human.events.fire("object.selected",a.objectId))}}function b(){var a,b,d=Human.utils.isEmpty(Human.scene.selectedObjects);Human.scene.setShowSelectedObjects(!1);for(b in Human.scene.objects)if(Human.scene.objects.hasOwnProperty(b)){if(a=Human.scene.objects[b],!a.isLeaf())continue;d?c.onNeutral&&c.onNeutral(a):Human.scene.selectedObjects[b]?c.onForeground&&c.onForeground(a):c.onBackground&&c.onBackground(a)}}var c=Human.view.highlight={};c.enabled=!0;var d=!1;Human.events.on("scene.objectsSelected",function(){d=c.enabled}),c.setEnabled=function(b){c.enabled=b,Human.events.fire("highlight.toggled",{enabled:c.enabled}),c.enabled?(Human.view.currentMode="Highlight",Human.renderer.pick.onSingleClick=a):Human.renderer.pick.onSingleClick===a&&(Human.renderer.pick.onSingleClick=null),d=!0},c.getEnabled=function(){return c.enabled},c.onFrame=function(){d&&(b(),d=!1)},c.onForeground=function(a){a.setXRay(!1),a.setHighlight(!0)},c.onBackground=function(a){a.setXRay(!1),a.setHighlight(!1)},c.onNeutral=function(a){a.setXRay(!1),a.setHighlight(!1)}}(),function(){"use strict";function a(a){a&&Human.view.labels.createLabel({objectId:a.objectId,afterDelay:!0,replace:!0})}var b=Human.view.isolate={};b.enabled=!1;var c=!0;Human.events.on("scene.objectsSelected",function(){c=b.enabled}),b.setEnabled=function(d){return d&&!Human.scene.anySelected()?void Human.events.fire("isolate.noSelection"):(b.enabled=d,c=!0,b.enabled?(Human.view.currentMode="Isolate",Human.renderer.pick.setSinglePickEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1),Human.renderer.pick.onSingleClick=a):Human.renderer.pick.onSingleClick===a&&(Human.renderer.pick.onSingleClick=null),void Human.events.fire("isolate.toggled",{enabled:b.enabled}))},b.getEnabled=function(){return b.enabled},b.onFrame=function(){if(c){if(Human.scene.setShowSelectedObjects(b.enabled),b.enabled)for(var a in Human.scene.selectedObjects)Human.scene.selectedObjects.hasOwnProperty(a)&&Human.scene.objects[a].setHighlight(!1);c=!1}}}(),function(){"use strict";function a(a){a&&Human.view.dissect.dissect(a.objectId)}var b=Human.view.dissect={};b.enabled=!1;var c=[],d=[];b.setEnabled=function(c){b.enabled=c,c?Human.renderer.pick.onSingleClick=a:Human.renderer.pick.onSingleClick===a&&(Human.renderer.pick.onSingleClick=null),Human.events.fire("dissect.toggled",{enabled:b.enabled})},b.getEnabled=function(){return b.enabled},b.dissect=function(a){if(b.enabled){d.length=0,c.push(a);var e={};e[a]=!1,Human.scene.setEnabledObjects({objectIds:e})}},b.undo=function(){if(!b.enabled,c.length){var a=c.pop(),e={};e[a]=!0,Human.scene.setEnabledObjects({objectIds:e}),d.unshift(a)}},b.redo=function(){if(b.enabled){var a,e;d.length&&(a=d.shift(),e={},e[a]=!1,Human.scene.setEnabledObjects({objects:e}),c.push(a))}},b.reset=function(){d.length=0,c.length=0}}(),function(){"use strict";function a(a){if(a.object){var b=a.object,c=e.objectAnnotations[b.objectId];c||(c=e.objectAnnotations[b.objectId]={annotations:{},numAnnotations:0}),c.annotations[a.annotationId]=a,c.numAnnotations++}}function b(a){if(a.object){var b=a.object,c=e.objectAnnotations[b.objectId];if(c){var d=c.annotations[a.annotationId];d&&(delete c.annotations[a.annotationId],0===--c.numAnnotations&&delete e.objectAnnotations[b.objectId])}}}function c(a,b){Human.events.fire(a,{annotationId:b.id||b.annotationId,type:b.type,styleId:b.styleId,objectId:b.object?b.object.objectId:null,title:b.label.title,description:b.label.description,pos:b.pin.marker.pos,pinVec:b.pin.marker.dir})}function d(a,b,c,d,e,f){var g=Human.renderer.canvas.context2D;g.fillStyle=d,g.lineWidth=f,g.strokeStyle=e,g.beginPath(),g.arc(a,b,c,0,2*Math.PI),d&&g.fill(),e&&g.stroke()}var e=Human.view.annotations={editableOnCreate:!1},f="__a";e.init=function(){this.layouts.init()},e.onFrame=function(){this.layouts.onFrame()};var g=new Human.utils.IDPool({prefix:f});e.enabled=!1,e.shown=!0,e.annotations={},e.objectAnnotations={},e.unsavedAnnotation=null,function(){var a,b=[],c=!1;e.getActiveResponsiveCanvasSize=function(){if(!c)return-1;var d=Human.renderer.canvas.annotationCanvas;for(a=0;a<b.length;a++)if(d.width<b[a][0]||d.height<b[a][1])return a;return-1},e.getResponsiveCanvasSizes=function(){return b},e.setResponsiveCanvasSizes=function(a){b.length=0;for(var c=0;c<a.length;c++)b.push(a[c]);Human.view.annotations.layouts.updateActiveResponsive()},e.setResponsiveEnabled=function(a){c=a,Human.view.annotations.layouts.updateActiveResponsive()},e.getResponsiveEnabled=function(){return c}}(),e.setEnabled=function(a){e.enabled!==a&&(e.enabled=a,Human.events.fire("annotations.toggled",{enabled:a})),e.enabled&&(Human.renderer.pick.onSingleClick=null)};var h=!1,i=!1;e.beginCreation=function(){Human.timeline.playing&&(Human.timeline.playing=!1,h=!0),Human.timeline.playfree&&(Human.timeline.playfree=!1,i=!0)},e.endCreation=function(){h&&(Human.timeline.playing=!0),i&&(Human.timeline.playfree=!0),h=!1,i=!1},e.createAnnotation=function(d){var h;if(d.objectId&&!Human.scene.objects[d.objectId]){var i=d.objectId.replace(/_ID\d+/,"_ID"),j=Human.scene.objects[i];j&&j instanceof Human.scene.Object&&(d.renderableIndex=j.anonymousIdToRenderableIndex[d.objectId],d.objectId=i)}if(d.objectId&&(h=Human.scene.objects[d.objectId],h||Human.log.warn("Human.view.annotations.createAnnotation","Scene object not found: '"+d.objectId+"'")),e.unsavedAnnotation&&(d.title=e.unsavedAnnotation.label.titleField.value,d.description=e.unsavedAnnotation.label.descriptionField.value,d.objectId=e.unsavedAnnotation.object?e.unsavedAnnotation.object.objectId:null,e.unsavedAnnotation.destroy(),e.unsavedAnnotation=null),d.annotationId){if(d.annotationId.toString().slice(0,f.length)===f)d.annotationId=g.getId();else if(e.annotations[d.annotationId])return Human.log.error("Human.view.annotations.createAnnotation","Annotation with this ID already exists: '"+d.annotationId+"'"),null}else d.annotationId=g.getId();var k=new Human.view.annotations.Annotation(h,d);return e.annotations[d.annotationId]=k,a(k),e.unsavedAnnotation=d.saved?null:k,k.setAnnotationsShown(e.shown),k.on("picked",function(){Human.events.fire("annotations.picked",{annotationId:k.annotationId})}),k.label.on("mouseClick",function(){Human.events.fire("annotations.mouseClick",{annotationId:k.annotationId})}),k.label.on("mouseEnter",function(a){Human.events.fire("annotations.mouseEnter",a)}),k.label.on("mouseLeave",function(a){Human.events.fire("annotations.mouseLeave",a)}),k.label.on("mouseDown",function(a){Human.events.fire("annotations.mouseDown",a)}),k.label.on("mouseUp",function(a){Human.events.fire("annotations.mouseUp",a)}),k.on("saved",function(){e.unsavedAnnotation&&e.unsavedAnnotation.annotationId===k.annotationId?(e.endCreation(),c("annotations.created",k)):c("annotations.updated",k),e.unsavedAnnotation=null}),k.on("destroyed",function(){e.unsavedAnnotation=null,delete e.annotations[k.annotationId],b(k),e.endCreation(),Human.events.fire("annotations.destroyed",{annotationId:k.annotationId})}),d.saved?(this.endCreation(),c("annotations.created",k),e.unsavedAnnotation=null):(this.beginCreation(),Human.events.fire("annotations.creating",{annotationId:k.annotationId})),k},e.updateDimensions=function(){for(var a in e.annotations)e.annotations.hasOwnProperty(a)&&e.annotations[a].label.updateWidth()},e.setShown=function(a){if(e.shown!==a){for(var b in e.annotations)e.annotations.hasOwnProperty(b)&&e.annotations[b].setAnnotationsShown(a);e.shown=a,Human.events.fire("annotations.shown",{shown:a})}},e.showByObjectId=function(a){var b=e.objectAnnotations[a];if(b){var c=b.annotations;for(var d in c)if(c.hasOwnProperty(d)){var f=c[d];f.checkObjectVisible(),f.setShown(f.getObjectVisible())}}},e.destroyByObjectId=function(a){var b=e.objectAnnotations[a];if(b){var c=b.annotations;for(var d in c)c.hasOwnProperty(d)&&c[d].destroy()}},e.clearAnnotations=function(a){a=a||{};var b=!!a.keepModuleAnnotations;e.unsavedAnnotation=null;var c;for(var d in e.annotations)e.annotations.hasOwnProperty(d)&&(c=e.annotations[d],b&&c.moduleId||c.destroy())},e.getAnnotations=function(a){var b={},c=e.annotations;a.objectId&&(c=e.objectAnnotations.hasOwnProperty(a.objectId)?e.objectAnnotations[a.objectId].annotations:{});var d=a.type;for(var f in c)if(c.hasOwnProperty(f)){var g=c[f];d&&d!==g.type||(b[f]=g)}return b},e.setLabelsShown=function(a){var b,c,d,f,g={},h=a.type;if(a.annotations){c=a.annotations;for(d in c)c.hasOwnProperty(d)&&(b=e.annotations[d],b&&(h&&h!==b.type||(g[d]=c[d])))}else if(a.objects){c=a.objects;for(var i in c)if(c.hasOwnProperty(i)){var j=Human.scene.objects[i];if(j){var k=e.objectAnnotations[i];if(k){f=c[i];for(d in k.annotations)k.annotations.hasOwnProperty(d)&&(b=k.annotations[d],h&&h!==b.type||(g[d]=f))}}}}else if(a.type){f=a.shown!==!1;for(d in e.annotations)e.annotations.hasOwnProperty(d)&&(b=e.annotations[d],b&&(h&&h!==b.type||(g[d]=f)))}if(a.replace)for(d in e.annotations)e.annotations.hasOwnProperty(d)&&(g[d]||(b=e.annotations[d],h&&h!==b.type||(b.pin.setShown(!1),b.label.setShown(!1))));for(d in g)if(g.hasOwnProperty(d)){var l=g[d];b=e.annotations[d],b.pin.setShown(l),b.label.setShown(l)}},e.updateAnnotation=function(a,b){var d=e.annotations[a];if(d){var f=d.label;b.title&&b.title!==f.title&&f.setTitle(b.title),b.description&&b.description!==f.description&&f.setDescription(b.description),c("annotations.updated",d)}};var j,k,l,m,n={outerPin:{radius:6.5,fillStyle:"rgb(255,255,255)",lineWidth:1,strokeStyle:"rgb(204,204,204)"},innerPin:{radius:3.75,fillStyle:"rgb(153,0,0)"},wire:{lineWidth:1,strokeStyle:"rgb(204,204,204)"}};e.setCanvasStyles=function(a){for(var b in n)n.hasOwnProperty(b)&&a.hasOwnProperty(b)&&Human.utils.apply(a[b],n[b])},e.drawWire=function(a,b,c,f){var g=Human.renderer.canvas.context2D;void 0!==j&&g.clearRect(j,k,l,m),e.clearWire(),a!==c&&b!==f&&(g.beginPath(),g.moveTo(a,b),g.lineTo(c,f),g.lineWidth=n.wire.lineWidth,g.strokeStyle=n.wire.strokeStyle,g.stroke(),j=a,k=b,l=c,m=f);var h=n.outerPin;d(a,b,h.radius,h.fillStyle,h.strokeStyle,h.lineWidth);var i=n.innerPin;d(a,b,i.radius,i.fillStyle,i.strokeStyle,i.lineWidth)},e.clearWire=function(){Human.renderer.canvas.context2D.clearRect(0,0,Human.renderer.canvas.width,Human.renderer.canvas.height)}}(),function(){"use strict";function a(a,b){b.wire.style.display=a?"block":"none"}function b(b){b.label.on("saved",function(){b.publish("saved",b.saved=!0)}),b.label.on("delete",function(){b.destroy()}),b.label.on("shown",function(c){a(b.annotationsShown&&b.pin.enabled&&!b.label.culled&&c&&b.pin.shown&&b.getObjectVisible(),b)}),b.label.on("culled",function(c){a(b.annotationsShown&&b.pin.enabled&&!c&&b.label.shown&&b.pin.shown&&b.getObjectVisible(),b)}),b.label.on("annotationsShown",function(){a(b.annotationsShown&&b.pin.enabled&&!b.label.culled&&b.label.shown&&b.pin.shown&&b.getObjectVisible(),b)}),b.pin.on("picked",function(){return b.label.saved?(-1===Human.view.annotations.getActiveResponsiveCanvasSize()&&(b.label.collapse(!b.label.collapsed),a(b.annotationsShown&&!b.label.culled&&b.label.shown&&b.pin.shown&&b.getObjectVisible(),b)),void b.publish("picked",!0,!0)):void alert("Please save or cancel annotation before hiding label")}),b.pin.on("enabled",function(c){a(b.annotationsShown&&c&&!b.label.culled&&b.label.shown&&b.pin.shown&&b.getObjectVisible(),b)}),b.pin.on("enabled",function(c){a(b.annotationsShown&&c&&!b.label.culled&&b.label.shown&&b.pin.shown&&b.getObjectVisible(),b)})}Human.view.annotations.Annotation=function(c,d){var e=this;this._init(),this.moduleId=d.moduleId,this.type=d.type||"default",this.annotationId=d.annotationId,this.annotationsShown=Human.view.annotations.shown,this.draggable=!!d.labelOffset,this.shown=!0,this.occludable=d.occludable!==!1&&!!d.pos,this.followsObject=d.followsObject!==!1&&!!c,this.pinConfig=null,c&&d.barycentric&&void 0!==d.primitiveIndex?this.pinConfig={renderableIndex:d.renderableIndex,primitiveIndex:d.primitiveIndex,barycentric:d.barycentric,dir:d.dir,objectId:c.objectId}:(this.pinConfig={pos:d.pos,dir:d.dir},c&&(this.pinConfig.objectId=c.objectId)),this.pin=new Human.view.annotations.Pin(this,this.annotationId,this.pinConfig),d.offset=d.labelOffset,this.label=!1,this.setLabel(d);var f=document.getElementById(Human.containerId);if(this.wire=document.createElement("div"),this.wire.classList.add("annotationWire"),f.appendChild(this.wire),this.object=null,this.objectVisible=null,c&&(this.setObject(c),this.checkObjectVisible()),this.saved=void 0!==d.saved&&null!==d.saved?d.saved:!1,b(e),this.on("objectVisible",function(){a(e.annotationsShown&&e.pin.enabled&&!e.label.culled&&e.label.shown&&e.pin.shown&&e.getObjectVisible(),e)}),d.on){var g=d.on;g.mouseClick&&this.label.on("mouseClick",function(){Human.rpc.call(null,g.mouseClick.call,g.mouseClick)})}},Human.utils.extend(Human.view.annotations.Annotation,Human.Component),Human.view.annotations.Annotation.prototype.setLabel=function(a){this.label=new Human.view.annotations.Label(this,a)},Human.view.annotations.Annotation.prototype.setMinimal=function(a){this._minimal=a,!Human.view.annotations.getMinimalActive()&&this.annotationsShown&&!this.label.culled&&this.label.shown&&this.pin.shown&&this.getObjectVisible()?this.wire.show():this.wire.hide()},Human.view.annotations.Annotation.prototype.setObject=function(a){this.publish("object",this.object=a)},Human.view.annotations.Annotation.prototype.checkObjectVisible=function(){this.object&&(this.objectVisible=this.object.isVisible(),this.publish("objectVisible",this.objectVisible))},Human.view.annotations.Annotation.prototype.getObjectVisible=function(){return null===this.objectVisible?!0:this.objectVisible},Human.view.annotations.Annotation.prototype.setAnnotationsShown=function(a){this.annotationsShown=a,this.pin.setAnnotationsShown(a),this.label.setAnnotationsShown(a)},Human.view.annotations.Annotation.prototype.setShown=function(a){this.shown=a},Human.view.annotations.Annotation.prototype.destroy=function(){this.pin.destroy(),this.label.destroy(),Human.utils.removeElement(this.wire),this.publish("destroyed",!0)}}(),function(){"use strict";Human.view.annotations.Pin=function(a,b,c){var d=this,e=document.getElementById(Human.containerId);this._element=document.createElement("div"),e.appendChild(this._element),this._element.addEventListener("click",this.pick.bind(this)),this._init(),this._id=b,this.annotation=a,this.annotationsShown=Human.view.annotations.shown,this.enabled=c.enabled!==!1,this.shown=c.shown!==!1;var f=Human.utils.shallowClone(c);this.marker=Human.scene.markers.create(f),this.setAnnotationsShown(Human.view.annotations.shown),this.setEnabled(void 0!==c.enabled&&null!==c.enabled?c.enabled:!0),this.setShown(void 0!==c.shown&&null!==c.shown?c.shown:!0),this.setOpacity(1),this._element=document.createElement("div"),this._element.className="annotationPin",e.appendChild(this._element),this._element.addEventListener("mouseenter",function(a){d.publish("mouseEnter",{annotationId:d.annotation.annotationId,e:a},!0)}),this._element.addEventListener("mouseleave",function(a){d.publish("mouseLeave",{annotationId:d.annotation.annotationId,e:a},!0)}),this._element.addEventListener("click",this.pick.bind(this))},Human.utils.extend(Human.view.annotations.Pin,Human.Component),Human.view.annotations.Pin.prototype.setAnnotationsShown=function(a){this._showElement(a&&this.enabled&&this.shown&&this.annotation.getObjectVisible()),this.publish("enabled",this.annotationsShown=a)},Human.view.annotations.Pin.prototype.setEnabled=function(a){this._showElement(this.annotationsShown&&a&&this.shown&&this.annotation.getObjectVisible()),this.publish("enabled",this.enabled=a)},Human.view.annotations.Pin.prototype.setShown=function(a){this._showElement(this.annotationsShown&&this.enabled&&a&&this.annotation.getObjectVisible()),this.publish("shown",this.shown=a)},Human.view.annotations.Pin.prototype._showElement=function(a){this._element.style.display=a?"block":"none"},Human.view.annotations.Pin.prototype.transform=function(){this.marker.built&&(this._element.style.transform="translate3d("+this.marker.canvasPos[0]+"px, "+this.marker.canvasPos[1]+"px, 0)")},Human.view.annotations.Pin.prototype.setOpacity=function(a){this._element.style.opacity=this.opacity=a,this.publish("opacity",a)},Human.view.annotations.Pin.prototype.pick=function(){this.publish("picked",!0,!0)},Human.view.annotations.Pin.prototype.destroy=function(){Human.scene.markers["delete"](this.marker.id),Human.utils.removeElement(this._element),this.publish("destroyed",!0)}}(),function(){"use strict";var a=Human.view.annotations.Label=function(a,b){this._init(),this.annotation=a,this.saved=!!b.saved,this.offset=b.offset||[70,70],this.offset2=[this.offset[0],this.offset[1]],this.offset2=[this.offset[0],this.offset[1]],this.collapsed=!1,this.width=0,this.height=0;var d=void 0!==b.editable?b.editable:Human.view.annotations.editableOnCreate,e=this.editing=d&&!this.saved,f=this.saved?null:"new",g=d?"editable":null,h=e?"editing":null,i=Human.view.annotations.layouts.activeLayout,j=i?i:null,k=[f,g,h,j],l=document.getElementById(Human.containerId);this.title="",this.description="",this.element=document.createElement("div"),this.element.classList.add("annotationContainer"),this.element.innerHTML=['<div class="annotationTitle clearfix">','<input type="text" placeholder="">',"<h1></h1>",'<button class="annotationSave"></button>','<button class="annotationDelete"></button>',"</div>",'<div class="annotationDescription">','<textarea placeholder="Description"></textarea>',"<p></p>","</div>"].join(""),this.titleContainer=this.element.getElementsByClassName("annotationTitle")[0],this.titleElement=this.element.getElementsByTagName("H1")[0],this.descriptionElement=this.element.getElementsByTagName("P")[0],this.titleField=this.element.getElementsByTagName("INPUT")[0],this.descriptionField=this.element.getElementsByTagName("TEXTAREA")[0],this.deleteBtn=this.element.getElementsByClassName("annotationDelete")[0],this.saveBtn=this.element.getElementsByClassName("annotationSave")[0],c(this.titleField,100),c(this.descriptionField,300),this.setTitle(b.title||""),this.setDescription(b.description||"");for(var m=0,n=k.length;n>m;++m)k[m]&&this.element.classList.add(k[m]);l.appendChild(this.element),this.bindHandlers(d),this.setAnnotationsShown(Human.view.annotations.shown),this.setEnabled(b.enabled!==!1),this.setShown(b.labelShown!==!1),this.setCulled(!!b.culled),this.setOccluded(!!b.occluded),this.setOffset(b.offset||[70,-70]),this.syncToElement()};Human.utils.extend(Human.view.annotations.Label,Human.Component),a.prototype.bindHandlers=function(a){var b=this,c=a&&b.editing,e=function(a){var d=!0;for(a=a.target;a.parentNode;){if(a.classList.contains("annotationContainer")){d=!1;break}a=a.parentNode}!c&&d&&(b.titleField.value||b.descriptionField.value?(b.save(),document.removeEventListener("click",e)):b.pos&&(b["delete"](),document.removeEventListener("click",e))),c=!1},g=function(){var a=b.annotation;if(a.pin){var c=a.pin,d=b,e=c.marker.canvasPos||[],f=d.offset[0]<0,g=[e[0]+d.offset[0],e[1]+d.offset[1]];f&&(g[0]-=d.width),b.setPos(g)}},h=f(b.titleField),i=f(b.descriptionField),j=0,k=0,l=!1,m=function(){h=f(b.titleField),i=f(b.descriptionField);var a=b.descriptionField.value.split("\n");j=d(b.titleField.value+"X",h,l),k=d(a[0]+"X",i,l),n(l)},n=function(a){var c=b.titleField.value,e=b.descriptionField.value,f=b.descriptionField.value.split("\n");j=d(b.titleField.value+"X",h,a),k=d(f[0]+"X",i,a),0===j&&0===k?(l=a,Human.events.on("tick",m)):Human.events.off("tick",m);var n=parseInt(b.element.style.maxWidth,10),o=n+""=="NaN"?200:n,p=Math.max(j,k);p=Math.min(p,o),b.element.style.width=p+"px",b.descriptionField.style.width=p+"px",""===c&&""===e?b.element.classList.contains("empty")||b.element.classList.add("empty"):b.element.classList.remove("empty"),e?b.element.classList.add("has-description"):b.element.classList.remove("has-description"),g()},o=function(a){n(a)};b.on("title",function(){o(!0)}),b.titleField.addEventListener("keypress",function(){o(!a)}),b.titleField.addEventListener("focus",function(){o(!a)}),b.titleField.addEventListener("input",function(){b.syncToElement()}),b.descriptionField.addEventListener("keypress",function(){o(!a)}),b.descriptionField.addEventListener("focus",function(){o(!a)}),b.descriptionField.addEventListener("input",function(){b.syncToElement()}),a&&this.editing&&(document.addEventListener("click",e),b.titleField.focus(),Human.utils.async(function(){b.titleField.focus()})),b.on("mouseClick",function(c){for(var d=c.e.target,f=!1,g=d;g.parentNode;){if(g===b.titleContainer){f=!0;break}g=g.parentNode}a&&!b.editing&&f&&(b.editing=!0,b.descriptionField.height=b.descriptionHeight,b.element.classList.add("editing"),b.titleField.focus(),b.publish("edit",!0,!0),b.publish("updateWidth",!0,!0),document.addEventListener("click",e))}),b.descriptionField.addEventListener("blur",e),b.deleteBtn.addEventListener("click",function(a){a.preventDefault(),b["delete"]()}),b.saveBtn.addEventListener("click",function(a){a.preventDefault(),b.save()});var p=0,q=0,r=function(a){p=a.clientX,q=a.clientY};b.element.addEventListener("mouseenter",function(a){b.publish("mouseEnter",{annotationId:b.annotation.annotationId,e:a},!0),r(a)}),b.element.addEventListener("mouseleave",function(a){b.publish("mouseLeave",{annotationId:b.annotation.annotationId,e:a},!0),r(a)}),b.element.addEventListener("mousedown",function(a){b.publish("mouseDown",{annotationId:b.annotation.annotationId,x:a.clientX,y:a.clientY,e:a},!0),r(a)}),b.element.addEventListener("mouseup",function(a){var c=a.clientX,d=a.clientY;b.publish("mouseUp",{annotationId:b.annotation.annotationId,x:c,y:d,e:a},!0),p===c&&q===d&&b.publish("mouseClick",{annotationId:b.annotation.annotationId,x:c,y:d,e:a},!0),r(a)}),b.on("updateWidth",this.syncToElement.bind(this))},a.prototype.save=function(){this.editing=!1,this.setTitle(this.titleField.value),this.setDescription(this.descriptionField.value),this.element.classList.remove("new","editing"),this.publish("saved",this.saved=!0),this.publish("updateWidth",!0,!0)},a.prototype["delete"]=function(){this.publish("delete",!0,!0)},a.prototype.collapse=function(a){this.collapsed=a,this.setShown(!a)},a.prototype.setOffset=function(a){this.offset[0]=a[0],this.offset[1]=a[1],this.offset2[0]=a[0],this.offset2[1]=a[1],this.publish("offset",this.offset)},a.prototype.setAnnotationsShown=function(a){this._showElement(a&&this.enabled&&this.shown&&!this.culled&&!this.occluded&&this.annotation.getObjectVisible()),this.publish("annotationsShown",this.annotationsShown=a)},a.prototype.setEnabled=function(a){this._showElement(this.annotationsShown&&a&&this.shown&&!this.culled&&!this.occluded&&this.annotation.getObjectVisible()),this.publish("enabled",this.enabled=a)},a.prototype.setShown=function(a){this._showElement(this.annotationsShown&&this.enabled&&a&&!this.culled&&!this.occluded&&this.annotation.getObjectVisible()),this.shown!==a&&(this.shown=a,this.publish("shown",this.shown))},a.prototype.setCulled=function(a){this._showElement(this.annotationsShown&&this.enabled&&this.shown&&!a&&!this.occluded&&this.annotation.getObjectVisible()),this.publish("culled",this.culled=a)},a.prototype.setOccluded=function(a){this._showElement(this.annotationsShown&&this.enabled&&this.shown&&!this.culled&&!a&&this.annotation.getObjectVisible()),this.publish("occluded",this.occluded=a)},a.prototype.setOpacity=function(a){this.element.style.opacity=a,this.opacity=a,this.publish("opacity",a)},a.prototype._showElement=function(a){this.element.style.display=a?"inline-block":"none",this.elementVisible!==a&&this.syncToElement(),this.elementVisible=a},a.prototype.setTitle=function(a){this.titleField.value=a,this.titleElement.innerHTML=a,this.publish("title",this.title=a),this.syncToElement()},a.prototype.setDescription=function(a){this.descriptionField.value=a,this.descriptionElement.innerHTML=a,this.publish("description",this.description=a),this.syncToElement()},a.prototype.setPos=function(a,b){b&&(a[1]=a[1]-this.titleInnerHeight),a[0]=Math.round(a[0]),a[1]=Math.round(a[1]),this.element.style.transform="translate3d("+a[0]+"px, "+a[1]+"px, 0)",this.publish("pos",this.pos=a)},a.prototype.setSide=function(a){this.side=a,this.element.classList.remove("left"),this.element.classList.remove("right"),this.element.classList.add(a),this.connectionPoint=[this.pos[0]+("left"===a?this.width:0),this.pos[1]+this.titleHeight]},a.prototype.syncToElement=function(){this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,this.titleHeight=this.titleContainer.offsetHeight,this.titleInnerHeight=this.titleContainer.clientHeight,this.descriptionHeight=this.description.offsetHeight},a.prototype.destroy=function(){Human.utils.removeElement(this.element),this.publish("destroyed",!0)};var b,c=function(a,b){b&&b>0&&(a.setAttribute("maxlength",b),a.addEventListener("keyup",function(c){13!==c.keyCode&&a.value.length>=b&&alert("Maximum characters allowed ("+b+")")}))},d=function(a,c,d){b=b||document.createElement("canvas"),d&&(a=e(a));try{var f=b.getContext("2d");return f.font=c,f.measureText(a).width}catch(g){return 0}},e=function(a){var b=document.createElement("div");return b.innerHTML=a,b.innerText},f=function(a){return window.getComputedStyle(a).font}}(),function(){"use strict";var a=Human.view.annotations.placer={},b=vec3.create();a.placeAnnotation=function(a){var c=Human.renderer.camera.eye;b[0]=c.x,b[1]=c.y,b[2]=c.z;var d=vec3.create();vec3.subtract(d,b,a.pos),Human.view.annotations.createAnnotation({objectId:a.objectId,title:a.title||"",description:a.description||"",pos:a.pos,mouseDownPos:a.mouseDownPos,dir:d,enabled:!0,shown:!0,labelShown:!0,labelOffset:a.labelOffset,saved:void 0!==a.saved&&null!==a.saved?a.saved:!1})}}(),function(){"use strict";var a=14,b=12,c="left",d=5,e=4,f=Human.view.annotations.renderer={};

f.render=function(f){var g=f.annotation,h=f.canvasData,i=f.bgColor,j=h.context,k=g.label,l=g.pin,m=k.connectionPoint,n=h.scaleX,o=h.scaleY,p=l.marker.canvasPos[0]*n,q=l.marker.canvasPos[1]*o,r=k.enabled&&k.shown&&!k.occluded&&!k.culled;if(r){var s=k.pos[0]*n,t=m[0]*n,u=m[1]*o,v=Math.min(h.width-s-10,k.width*n);j.fillStyle="white"===i?"rgb(0, 0, 0)":"rgb(255, 255, 255)",j.textAlign=c;var w=Math.round(a*n),x=Math.round(b*n),y=function(a,b,c){for(var d=b.split("<br>"),e=[],f=0;f<d.length;f++){for(var g=d[f].split(" "),h="",i=0;i<g.length;i++){var j=h+g[i],k=a.measureText(j);k.width>c&&i>0?(e.push(h),h=g[i]+" "):h=j+" "}e.push(h)}return e},z=function(a,b,c,d){var e=1.25*b;j.font=(c?"bold ":"")+b+"px Arial";for(var f=y(j,a||"",v),g=u+d(f,e),h=0;h<f.length;h++)j.fillText(f[h],s,g+e*h)};z(k.title,w,!0,function(a,b){return-(a.length-1)*b-b/2}),z(k.description,x,!1,function(a,b){return b});var A=l.opacity;j.strokeStyle="rgba(204, 204, 204, "+A+")",j.beginPath(),j.moveTo(p,q),j.lineTo(t,u);var B="left"===k.side?-v:v;j.lineTo(t+B,u),j.stroke()}var C=function(a,b,c){j.fillStyle=b,j.beginPath(),j.arc(p,q,a,0,2*Math.PI),j.fill(),c&&c()},D=d*n,E=e*n;C(D,"rgb(255, 255, 255)",function(){j.lineWidth=1,j.strokeStyle="rgb(204, 204, 204)",j.stroke()}),C(E,"rgb(153,0,0)")}}(),function(){"use strict";var a,b=Human.view.annotations.layouts={canvas:null,context:null},c={};b.activeLayout=null,b.getLayout=function(a){return c[a]},b.init=function(){return b.canvas=Human.renderer.canvas.annotationCanvas,b.canvas?(b.context=Human.renderer.canvas.context2D,b.context?void Human.properties.subscribe({propId:"annotations.layout.type",value:"columns",callback:function(a){return-1!==Human.view.annotations.getActiveResponsiveCanvasSize()?void(e=a):void b._selectLayout(a)}}):void Human.log.error("Human.view.annotations.layouts","Failed to get 2D canvas context")):void Human.log.error("Human.view.annotations.layouts","DOM element not found: 'annotationCanvas'")},b.onFrame=function(){a&&this.canvas&&this.context&&a.layout(this.canvas,this.context)},b.addLayoutType=function(d,e){return c[d]?void Human.log.error("Human.view.annotations.layouts.addLayoutType","Layout already added: '"+d+"'"):e.setEnabled?e.layout?(c[d]=e,void(a||b._selectLayout(d))):void Human.log.error("Human.view.annotations.layouts.addLayoutType","Layout strategy does not have a 'layout' method"):void Human.log.error("Human.view.annotations.layouts.addLayoutType","Layout strategy does not have a 'setEnabled' method")},b._selectLayout=function(d){if("columns-v2"===d&&(d="columns"),Human.log.info("Human.view.annotations.layouts._selectLayout","Selecting label type: '"+d+"'"),!c[d])return void Human.log.error("Human.view.annotations.layouts._selectLayout","Layout not found: '"+d+"'");if(a!==d){a&&a.setEnabled(!1),a=c[d],a.setEnabled(!0),b.activeLayout=d;var e=[];for(var f in c)c.hasOwnProperty(f)&&e.push("layout-"+f);var g=document.getElementById(Human.containerId);g.classList.remove.apply(g.classList,e),g.classList.add("layout-"+d)}};var d,e,f=-1,g=!1;b.updateActiveResponsive=function(){if(d=Human.view.annotations.getActiveResponsiveCanvasSize(),d!==f){for(var a=document.getElementById(Human.containerId),c=Human.view.annotations.getResponsiveCanvasSizes(),h=0;h<c.length;h++)a.classList.remove("breakpoint-"+h);d>-1&&a.classList.add("breakpoint-"+d),e||(e=Human.view.annotations.layouts.activeLayout);var i=-1===d?e:"floating";b._selectLayout(i),f=d}var j=Human.view.annotations.getResponsiveEnabled();c=Human.view.annotations.getResponsiveCanvasSizes().length,j&&c>0&&!g&&(Human.events.on("canvas.resized",b.updateActiveResponsive),g=!0),j&&0!==c.length||!g||(Human.events.off("canvas.resized",b.updateActiveResponsive),g=!1)}}(),Human.view.annotations.layouts.addLayoutType("columns",function(){"use strict";function a(a,b){var c=d.left,e=b.width-d.right,f=0,g=b.height,h=a.canvasPos;return h[0]<c||h[0]>e||h[1]<f||h[1]>g}function b(a,b){for(var c,d,e=0;b-1>e;e++){d=e;for(var f=e;b>f;f++)a[f].pin.marker.canvasPos[1]<a[d].pin.marker.canvasPos[1]&&(d=f);c=a[e],a[e]=a[d],a[d]=c}}function c(a,b,c,e){for(var f,g,i,j,m=0>e?d.left:a.width-d.right-Human.properties.properties["annotations.labelWidth"],n=d.top,o=d.bottom,p=n,q=a.height-n-o,r=q/c,s=0;c>s;s++){f=b[s],g=f.pin,i=f.label,j=f.wire;var t=1,u=g.marker.viewAngle;u>=l&&(t=1-(u-l)/(k-l),t=Math.max(0,t)),g.transform(),g.setOpacity(t),g.setShown(!0);var v=[m,h?g.marker.canvasPos[1]:p];if(i.setPos(v,h),i.setSide(0>e?"left":"right"),i.setOpacity(t),!i.collapsed){i.setShown(!0);var w,x,y=i.connectionPoint,z=g.marker.canvasPos;z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]),x=Math.sqrt(Math.pow(y[0]-z[0],2)+Math.pow(y[1]-z[1],2)),w=h?0>e?0:180:180*Math.atan2(z[1]-y[1],z[0]-y[0])/Math.PI,j.style.width=x+"px",j.style.left=y[0]+"px",j.style.top=y[1]+"px",j.style.opacity=t,j.style.transform="rotate("+w+"deg)",p+=r}}}var d,e=Human.view.annotations,f={};Human.properties.subscribe({propId:"annotations.margins",value:{top:50,left:50,right:50,bottom:50},callback:function(a){d=a}});var g;Human.properties.subscribe({propId:"annotations.labelWidth",value:150,callback:function(a){g=a}});var h=!1;Human.properties.subscribe({propId:"annotations.horizontalLines",value:h,callback:function(a){h=a}});var i,j,k=100,l=80,m=!1,n=[],o=0,p=[],q=0;return f.setEnabled=function(a){m=a},f.layout=function(d){if(e.shown){o=0,q=0;var f,g,h,k,l=e.annotations;for(var m in l)if(l.hasOwnProperty(m)){f=l[m],g=f.pin,h=f.label;var r=!0;if(r=f.shown&&!a(g.marker,d),r=r&&(!f.occludable||!g.marker.occluded),!r){g.setShown(!1),h.setShown(!1);continue}k=f.pin.marker.canvasPos[0]<d.width/2,k?n[o++]=f:p[q++]=f}b(n,o),b(p,q),c(d,n,o,-1),c(d,p,q,1),i=d.width,j=d.height}},f.snapshot=function(a,b,c){if(e.shown){var d,f,g=a.width,h=a.height,k=g/i,l=h/j,m=e.annotations,n={context:b,width:g,height:h,halfWidth:g/2,scaleX:k,scaleY:l};for(var o in m)m.hasOwnProperty(o)&&(d=m[o],d.pin.enabled&&!d.pin.occluded&&(f=d.label,f.shown&&e.renderer.render({annotation:d,canvasData:n,bgColor:c})))}},f}()),Human.view.annotations.layouts.addLayoutType("radial",function(){"use strict";function a(a,b){for(var c,d,e=0;b-1>e;e++){d=e;for(var f=e;b>f;f++)a[f].pin.pos[1]>a[d].pin.pos[1]&&(d=f);c=a[e],a[e]=a[d],a[d]=c}}function b(a,b,c,d,e){for(var f,g,h,i=a.width/2,j=a.height,k=j/d,l=50,m=0;d>m;m++)f=c[m],g=f.pin,h=f.label,h.setPos([e,l]),b.strokeStyle="rgb(0, 0, 100)",b.beginPath(),b.moveTo(g.marker.canvasPos[0],g.marker.canvasPos[1]),i>e?b.lineTo(e+h.width,l):b.lineTo(e,l),b.closePath(),b.stroke(),l+=k}var c,d,e=Human.view.annotations,f={},g=100,h=200,i=!1,j=!0,k=[],l=0,m=[],n=0;return f.setEnabled=function(a){i=a,j=!0},f.setDirty=function(){j=!0},f.layout=function(f,i){if(j){l=0,n=0;var o,p,q,r,s=e.annotations;for(var t in s)s.hasOwnProperty(t)&&(o=s[t],p=o.pin,q=o.label,p.cullToRectangle(0,0,f.width,f.height),p.culled!==q.culled&&q.setCulled(p.culled),p.enabled&&p.shown&&!p.culled&&q.shown&&o.pin.viewPos&&(r=o.pin.viewPos[0]<0,r?k[l++]=o:m[n++]=o));a(k,l),a(m,n),i.clearRect(0,0,f.width,f.height),b(f,i,k,l,g),b(f,i,m,n,f.width-g-h),c=f.width,d=f.height,j=!1}},f.snapshot=function(a,b){var f,g,h=a.width,i=a.height,j=h/c,k=i/d,l=e.annotations,m={context:b,width:h,height:i,halfWidth:h/2,scaleX:j,scaleY:k};for(var n in l)l.hasOwnProperty(n)&&(f=l[n],f.pin.enabled&&(g=f.label,g.shown&&e.renderer.render({annotation:f,canvasData:m})))},f}()),Human.view.annotations.layouts.addLayoutType("floating",function(){"use strict";function a(){var a=this.annotation.annotationId;i=a===i?"":a}function b(b,c){var d=g.annotations[b].pin;c?d.on("picked",a):d.off("picked",a)}function c(a){b(a.annotationId,!0)}function d(a){for(var d in g.annotations)g.annotations.hasOwnProperty(d)&&b(d,a);a?Human.events.on("annotations.created",c):Human.events.off("annotations.created",c)}function e(a,b,c){var d=a.label,e=a.pin,f=e.marker;if(!a.shown)return e.setShown(!1),void d.setShown(!1);if(!f.built)return e.setShown(!1),void d.setShown(!1);if(a.occludable&&f.occluded)return e.setShown(!1),void d.setShown(!1);if(f.viewAngle>=m)return e.setShown(!1),void d.setShown(!1);if(e.transform(),e.setShown(!0),c){var g=a.pin.marker.canvasPos[0]<b.width/2,h=g?"left":"right";d.setSide(h),d.setShown(!0);var i=f.canvasPos;g&&(i[0]-=d.width),d.setPos(i)}else d.setShown(!1)}var f,g=Human.view.annotations,h={},i="";Human.properties.subscribe({propId:"annotations.labelWidth",value:120,callback:function(a){f=a}});var j,k,l=!1,m=90;return h.setEnabled=function(a){d(a),l=a},h.layout=function(a){var b,c=g.annotations;for(var d in c)if(c.hasOwnProperty(d)){b=c[d];var f=b.annotationId===i;e(b,a,f)}j=a.width,k=a.height},h.snapshot=function(a,b){var c,d,e=a.width,f=a.height,h=e/j,i=f/k,l=g.annotations,m={context:b,width:e,height:f,halfWidth:e/2,scaleX:h,scaleY:i};for(var n in l)l.hasOwnProperty(n)&&(c=l[n],c.pin.enabled&&!c.pin.occluded&&(d=c.label,d.shown&&g.renderer.render({annotation:c,canvasData:m})))},h}()),Human.view.annotations.layouts.addLayoutType("draggable",function(){"use strict";var a,b,c=Human.view.annotations,d={},e=100,f=80,g=!1;return d.setEnabled=function(a){g=a},function(){var a,b=-1,d=-1;Human.events.on("annotations.mouseDown",function(e){g&&(a=c.annotations[e.annotationId],b=e.x,d=e.y)}),document.body.addEventListener("mousemove",function(c){if(g&&a){var e=c.clientX,f=c.clientY,h=a.label.offset;a.label.setOffset([h[0]+e-b,h[1]+f-d]),b=e,d=f}}),document.body.addEventListener("mouseup",function(){g&&(a=null)})}(),d._normalLayout=new function(){function d(a){var b=a.label,c=a.pin,d=a.wire;if(!a.shown)return c.setShown(!1),void b.setShown(!1);if(!a.pin.marker.built)return c.setShown(!1),void b.setShown(!1);if(a.occludable&&c.marker.occluded)return c.setShown(!1),void b.setShown(!1);var g=1,h=c.marker.viewAngle;h>=f&&(g=1-(h-f)/(e-f),g=Math.max(0,g));var i=c.marker.canvasPos;i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]);var j=b.offset[0]<0,k=[Math.floor(i[0]+b.offset[0]),Math.floor(i[1]+b.offset[1])];if(b.syncToElement(),j&&(k[0]-=b.width),c.transform(),c.setOpacity(g),b.setPos(k),b.setOpacity(g),b.setSide(j?"left":"right"),c.setShown(!0),!b.collapsed){b.setShown(!0);var l,m=b.connectionPoint,n=Math.sqrt(Math.pow(m[0]-i[0],2)+Math.pow(m[1]-i[1],2));l=180*Math.atan2(m[1]-i[1],m[0]-i[0])/Math.PI,d.style.width=n+"px",d.style.opacity=c.opacity,d.style.transform="translate3d("+i[0]+"px, "+i[1]+"px, 0) rotate("+l+"deg)"}}this.doLayout=function(e){if(c.shown){var f,g,h=c.annotations;for(g in h)h.hasOwnProperty(g)&&(f=h[g],d(f));a=e.width,b=e.height}}},d.layout=d._normalLayout.doLayout,d.snapshot=function(d,e,f){if(c.shown){var g,h,i=d.width,j=d.height,k=i/a,l=j/b,m=c.annotations,n={context:e,width:i,height:j,halfWidth:i/2,scaleX:k,scaleY:l};for(var o in m)m.hasOwnProperty(o)&&(g=m[o],h=g.pin,h.enabled&&h.shown&&!h.marker.occluded&&c.renderer.render({annotation:g,canvasData:n,bgColor:f}))}},d}()),function(){"use strict";function a(a){if(!c(Human.modules.modules[a.moduleId])){var d=b()?"draggable":"columns-v2";Human.properties.set({"annotations.layout.type":d})}}function b(){var a,b,c=Human.view.annotations.annotations,d=Human.timeline.chapters;for(a in c)if(c.hasOwnProperty(a)&&!c[a].draggable)return!1;for(b in d)if(d.hasOwnProperty(b)){c=d[b].annotations||{};for(a in c)if(c.hasOwnProperty(a)&&!c[a].draggable)return!1}var e=!0;return Human.timeline.activeRoot&&Human.timeline.activeRoot._chapters.forEach(function(a){var b,c;for(c=0;c<a.annotations.length;c++)b=a.annotations[c],b.hasOwnProperty("labelOffset")||(e=!1)}),e}function c(a){return a?a.annotationsLayout?!0:a.properties&&a.properties["annotations.layout.type"]?!0:!1:!1}Human.events.on("bookmarks.restored",a),Human.events.on("modules.activated",a),Human.events.on("modules.deactivated",a)}(),function(){"use strict";function a(a){if(a){var b=!!Human.scene.selectedObjects[a.objectId];Human.scene.setSelectedObjects({objectId:a.objectId,select:!b,replace:!Human.renderer.pick.multiEnabled}),b||Human.view.labels.createLabel({objectId:a.objectId,afterDelay:!0,replace:!0})}}function b(a){var b,c=Human.scene,d=c.objects;Human.scene.setShowSelectedObjects(!1);for(var e in d)if(d.hasOwnProperty(e)){if(b=d[e],!b.isLeaf())continue;a&&(b.setHighlight(!1),b.setXRay(Human.scene.selectedObjects[b.objectId]?!1:!0))}}var c=Human.view.xray={};c.enabled=!1;var d=!0;Human.events.on("scene.objectsSelected",function(){c.enabled&&(d=!0)}),c.setEnabled=function(b){c.enabled=b,Human.events.fire("xray.toggled",{enabled:b}),c.enabled?(Human.view.currentMode="Xray",Human.renderer.pick.onSingleClick=a):Human.renderer.pick.onSingleClick===a&&(Human.renderer.pick.onSingleClick=null),d=!0},c.getEnabled=function(){return c.enabled},c.onFrame=function(){d&&(b(c.enabled),d=!1)}}(),function(){"use strict";function a(){c();var a,d,e,f,g,h;o=0,p=0,q=0;for(a in Human.scene.enabledObjects)if(Human.scene.enabledObjects.hasOwnProperty(a)&&(d=Human.scene.enabledObjects[a],0===d.objects.length)){for(;d&&d.anonymous;)d=d.parent;d&&d.parent&&!b(d)&&(i[n]=d,j[d.objectId]=d,e=k[n],h=d.translate||{x:0,y:0,z:0},e?(e.x=h.x,e.y=h.y,e.z=h.z):e=k[n]={x:h.x,y:h.y,z:h.z},f=d.getCenter(),o+=f[0],p+=f[1],q+=f[2],l[n]=f,n++)}if(n>1){o/=n,p/=n,q/=n;for(var r=0;n>r;r++)f=l[r],d=i[r],m[r]||(m[r]=[0,0,0]),g=vec3.normalize(m[r],[f[0]-o,f[1]-p,f[2]-q]),m[r]=g}u=!1}function b(a){for(;a;){if(j[a.objectId])return!0;a=a.parent}return!1}function c(){for(var a=0;n>a;a++)delete j[i[a].objectId];n=0}var d,e,f,g=Human.view.explode={},h=.5,i=[],j={},k=[],l=[],m=[],n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=!0,v=0,w=1,x=2,y=v,z=!1,A=vec3.create();Human.events.on("scene.objectsShown",function(){g.reset()}),Human.events.on("timeline.played",function(){(y===w||y===x)&&g.reset()}),Human.events.on("timeline.scrubbed",function(){(y===w||y===x)&&g.reset()}),g.onFrame=function(b){if(z){u&&a();var c=b,g=c*h,j=0>d-r?-1:1,l=0>e-s?-1:1,o=0>f-t?-1:1;r+=g*j,s+=g*l,t+=g*o;var p=0,q=0;j>0&&r>d&&(r=d,p++),0>j&&0>r&&(r=0,q++),l>0&&s>e&&(s=e,p++),0>l&&0>s&&(s=0,q++),o>0&&t>f&&(t=f,p++),0>o&&0>t&&(t=0,q++),3===p?(y=x,z=!1):3===q&&(y=v,z=!1);for(var w,B,C=0;n>C;C++){var D=i[C],E=D.getWorldToObjectMatrix();w=k[C],B=m[C],A[0]=B[0]*r,A[1]=B[1]*s,A[2]=B[2]*t,vec3.transformMat4(A,A,E),i[C].setTransform({translate:{x:w.x+A[0],y:w.y+A[1],z:w.z+A[2]}})}Human.events.fire("explode.updated",{scale:Math.round((r+s+t)/3),speed:h})}},g.explode=function(a){a=a||{};var b=a.scale;Human.utils.isArray(b)?(d=b[0],e=b[1],f=b[2]):(b=b||0,0>b&&(b=0),d=b,e=b,f=b),0>d&&(d=0),0>e&&(e=0),0>f&&(f=0),h=a.speed||1,0>h&&(h=1),Human.timeline.stop(),y=w,z=!0},g.reset=function(){r=0,s=0,t=0,d=0,e=0,f=0,n&&this._resetPositions(),y=v,c(),u=!0,z=!1,Human.events.fire("explode.reseted",{scale:0,speed:h})},g._resetPositions=function(){for(var a,b=0;n>b;b++)a=k[b],i[b].setTransform({translate:a})}}(),function(){"use strict";function a(a){var b={keyCode:a.keyCode,altDown:a.altKey,shiftDown:a.shiftKey,ctrlDown:a.ctrlKey||a.metaKey};return y.altDown=b.altDown,y.shiftDown=b.shiftDown,y.ctrlDown=b.ctrlDown,b}function b(a){var b=void 0!==a.buttons?a.buttons:w,c={x:0,y:0,mouseDownLeft:!!(1&b),mouseDownRight:!!(2&b),mouseDownMiddle:!!(4&b),altDown:a.altKey,shiftDown:a.shiftKey,ctrlDown:a.ctrlKey||a.metaKey};if(a){for(var d=a.target,e=0,f=0;d.offsetParent;)e+=d.offsetLeft,f+=d.offsetTop,d=d.offsetParent;c.x=a.pageX-e,c.y=a.pageY-f}else a=window.event,c.x=a.x,c.y=a.y;return y.mouseDownLeft=c.mouseDownLeft,y.mouseDownRight=c.mouseDownRight,y.mouseDownMiddle=c.mouseDownMiddle,y.altDown=c.altDown,y.shiftDown=c.shiftDown,y.ctrlDown=c.ctrlDown,c}var c=Human.input={mouseHoverDelay:500,mouseOrbitRate:.16,mousePanRate:.08,mouseZoomRate:.5,mouseZoomCtrlKey:!1,keyboardOrbitRate:140,keyboardPanRate:40,keyboardZoomRate:15,touchOrbitRate:.3,touchPanRate:.2,touchZoomRate:.05,cameraFriction:.85,disableCameraXRotation:!1},d=[],e=[],f={},g={},h=[],i=[],j=[],k=[],l=[],m=[],n=[];c.enabled=!0;var o=[],p=[],q=[],r=[],s=[],t=150,u=325,v=4,w=0,x=[1,4,2],y={altDown:!1,ctrlDown:!1,shiftDown:!1,mouseDownLeft:!1,mouseDownRight:!1,mouseDownMiddle:!1,keyDown:[],onTick:function(a){e.push(a)},onKeyDown:function(a,b){for(var c,d=0,e=a.length;e>d;d++)c=a[d],(f[c]||(f[c]=[])).push(b)},onKeyUp:function(a,b){for(var c,d=0,e=a.length;e>d;d++)c=a[d],(g[c]||(g[c]=[])).push(b)},onMouseDown:function(a){h.push(a)},onMouseUp:function(a){i.push(a)},onMouseClick:function(a){j.push(a)},onMouseDoubleClick:function(a){k.push(a)},onMouseMove:function(a){l.push(a)},onMouseWheel:function(a){m.push(a)},onReset:function(a){n.push(a)},onTouchStart:function(a){o.push(a)},onTouchMove:function(a){p.push(a)},onTouchEnd:function(a){q.push(a)},onTouchTap:function(a){r.push(a)},onTouchDoubleTap:function(a){s.push(a)}};Human.input.init=function(){var d=Human.renderer.canvas.annotationCanvas;document.addEventListener("contextmenu",function(a){"snapshotPanelImage"!==a.target.id&&"INPUT"!==a.target.tagName&&"TEXTAREA"!==a.target.tagName&&(a.preventDefault(),a.stopPropagation())}),document.addEventListener("keydown",function(b){if("INPUT"!==b.target.tagName&&"TEXTAREA"!==b.target.tagName){var d=a(b);if(!c.enabled)return;var e=b.keyCode;y.keyDown[b.keyCode]=!0;var g=f[e];if(g)for(var h=0,i=g.length;i>h;h++)g[h](d)}},!0),document.addEventListener("keyup",function(b){if("INPUT"!==b.target.tagName&&"TEXTAREA"!==b.target.tagName){var d=a(b);if(!c.enabled)return;var e,f,h=b.keyCode;if(91===h||93===h)for(e=0,f=y.keyDown.length;f>e;++e)y.keyDown[e]=!1;y.keyDown[b.keyCode]=!1;var i=g[h];if(i)for(e=0,f=i.length;f>e;e++)i[e](d)}}),document.addEventListener("mouseup",function(a){void 0===a.buttons&&a.button<x.length&&(w&=~x[a.button]);var d=b(a);if(c.enabled)for(var e=0,f=i.length;f>e;e++)i[e](d)}),d.addEventListener("mousedown",function(a){void 0===a.buttons&&a.button<x.length&&(w|=x[a.button]);var d=b(a);if(c.enabled)for(var e=0,f=h.length;f>e;e++)h[e](d)}),d.addEventListener("click",function(a){var d=b(a);if(c.enabled)for(var e=0,f=j.length;f>e;e++)j[e](d)}),d.addEventListener("dblclick",function(a){var d=b(a);if(c.enabled)for(var e=0,f=k.length;f>e;e++)k[e](d)}),d.addEventListener("mousemove",function(a){var d=b(a);if(c.enabled){a.preventDefault();for(var e=0,f=l.length;f>e;e++)l[e](d)}}),d.addEventListener("wheel",function(a){var d=b(a);if(c.enabled)for(var e=-Human.math.sign(a.deltaY),f=0,g=m.length;g>f;f++)m[f](d,e)}),window.addEventListener("blur",function(){y.altDown=!1,y.ctrlDown=!1,y.shiftDown=!1,y.mouseDownLeft=!1,y.mouseDownRight=!1,y.mouseDownMiddle=!1,y.keyDown.length=0});var e,n=[],z=vec2.create(),A=-1,B=-1;d.addEventListener("touchstart",function(a){function b(){a.preventDefault(),a.stopPropagation()}if(c.enabled){var d,f,g=a.touches,h=a.changedTouches;for(e=Date.now(),1===g.length&&1===h.length?(A=e,z[0]=g[0].pageX,z[1]=g[0].pageY):A=-1;n.length<g.length;)n.push(vec2.create());for(d=0,f=g.length;f>d;++d)n[d][0]=g[d].pageX,n[d][1]=g[d].pageY;for(n.length=g.length,d=0,f=o.length;f>d;++d)o[d](n,b)}}),d.addEventListener("touchmove",function(a){function b(){a.preventDefault(),a.stopPropagation()}if(c.enabled){var d,e,f=a.touches;for(d=0,e=f.length;e>d;++d)n[d][0]=f[d].pageX,n[d][1]=f[d].pageY;for(d=0,e=p.length;e>d;++d)p[d](n,b)}}),d.addEventListener("touchend",function(a){function b(){a.preventDefault(),a.stopPropagation()}if(c.enabled){var d,e,f=Date.now(),g=a.touches,h=a.changedTouches;if(0===g.length&&1===h.length&&A>-1&&t>f-A){if(B>-1&&u>A-B){for(d=0,e=s.length;e>d;++d)s[d](h[0].pageX,h[0].pageY,b);B=-1}else if(vec2.distance(n[0],z)<v)for(B=f,d=0,e=r.length;e>d;++d)r[d](h[0].pageX,h[0].pageY,b);A=-1}for(d=0,e=g.length;e>d;++d)n[d][0]=g[d].pageX,n[d][1]=g[d].pageY;for(n.length=g.length,d=0,e=q.length;e>d;++d)q[d](n,b)}})};var z=null;c.onFrame=function(){if(!c.enabled)return void(z=null);var a=Date.now()/1e3;if(null!==z)for(var b=a-z,d=0,f=e.length;f>d;d++)e[d](a,b);z=a,Human.input.updateCamera()},c.addHandler=function(a){d.push(new a(y))},c.setEnabled=function(a){c.enabled!==a&&(c.enabled=a,Human.events.fire(a?"inputEnabled":"inputDisabled",{}))},c.KEY_BACKSPACE=8,c.KEY_TAB=9,c.KEY_ENTER=13,c.KEY_SHIFT=16,c.KEY_CTRL=17,c.KEY_ALT=18,c.KEY_PAUSE_BREAK=19,c.KEY_CAPS_LOCK=20,c.KEY_ESCAPE=27,c.KEY_PAGE_UP=33,c.KEY_PAGE_DOWN=34,c.KEY_END=35,c.KEY_HOME=36,c.KEY_LEFT_ARROW=37,c.KEY_UP_ARROW=38,c.KEY_RIGHT_ARROW=39,c.KEY_DOWN_ARROW=40,c.KEY_INSERT=45,c.KEY_DELETE=46,c.KEY_NUM_0=48,c.KEY_NUM_1=49,c.KEY_NUM_2=50,c.KEY_NUM_3=51,c.KEY_NUM_4=52,c.KEY_NUM_5=53,c.KEY_NUM_6=54,c.KEY_NUM_7=55,c.KEY_NUM_8=56,c.KEY_NUM_9=57,c.KEY_A=65,c.KEY_B=66,c.KEY_C=67,c.KEY_D=68,c.KEY_E=69,c.KEY_F=70,c.KEY_G=71,c.KEY_H=72,c.KEY_I=73,c.KEY_J=74,c.KEY_K=75,c.KEY_L=76,c.KEY_M=77,c.KEY_N=78,c.KEY_O=79,c.KEY_P=80,c.KEY_Q=81,c.KEY_R=82,c.KEY_S=83,c.KEY_T=84,c.KEY_U=85,c.KEY_V=86,c.KEY_W=87,c.KEY_X=88,c.KEY_Y=89,c.KEY_Z=90,c.KEY_LEFT_WINDOW=91,c.KEY_RIGHT_WINDOW=92,c.KEY_SELECT_KEY=93,c.KEY_NUMPAD_0=96,c.KEY_NUMPAD_1=97,c.KEY_NUMPAD_2=98,c.KEY_NUMPAD_3=99,c.KEY_NUMPAD_4=100,c.KEY_NUMPAD_5=101,c.KEY_NUMPAD_6=102,c.KEY_NUMPAD_7=103,c.KEY_NUMPAD_8=104,c.KEY_NUMPAD_9=105,c.KEY_MULTIPLY=106,c.KEY_ADD=107,c.KEY_SUBTRACT=109,c.KEY_DECIMAL_POINT=110,c.KEY_DIVIDE=111,c.KEY_F1=112,c.KEY_F2=113,c.KEY_F3=114,c.KEY_F4=115,c.KEY_F5=116,c.KEY_F6=117,c.KEY_F7=118,c.KEY_F8=119,c.KEY_F9=120,c.KEY_F10=121,c.KEY_F11=122,c.KEY_F12=123,c.KEY_NUM_LOCK=144,c.KEY_SCROLL_LOCK=145,c.KEY_SEMI_COLON=186,c.KEY_EQUAL_SIGN=187,c.KEY_EQUAL_SIGN_FIREFOX=61,c.KEY_DASH_FIREFOX=173,c.KEY_COMMA=188,c.KEY_DASH=189,c.KEY_PERIOD=190,c.KEY_FORWARD_SLASH=191,c.KEY_GRAVE_ACCENT=192,c.KEY_OPEN_BRACKET=219,c.KEY_BACK_SLASH=220,c.KEY_CLOSE_BRAKET=221,c.KEY_SINGLE_QUOTE=222,c.KEY_SPACE=32}(),function(){"use strict";function a(a){var b=Date.now();return o===k?(o=a,!0):o===a?b-p>j:(o=a,p=b,!1)}var b=Human.renderer.camera.rotateX,c=Human.renderer.camera.rotateY,d=0,e=0,f=0,g=0,h=0,i=.001,j=50,k=0,l=1,m=2,n=4,o=k,p=Date.now(),q=!0;Human.properties.subscribe({propId:"input.mouseOrbitPan",value:"orbit",callback:function(a){q="orbit"===a}});var r=!0;Human.properties.subscribe({propId:"input.touchOrbitPan",value:"orbit",callback:function(a){r="orbit"===a}}),Human.input.updateCamera=function(){var a=Human.input.cameraFriction;if(d*=a,e*=a,Math.abs(d)<i&&(d=0),Math.abs(e)<i&&(e=0),0===d||Human.input.disableCameraXRotation||b(d),0!==e&&c(e),f*=a,g*=a,Math.abs(f)<i&&(f=0),Math.abs(g)<i&&(g=0),0!==f||0!==g){var j=Math.max(Human.renderer.camera.lookDistance/80,.01);Human.renderer.camera.pan({x:f*j,y:g*j})}h*=a,Math.abs(h)<i&&(h=0),0!==h&&Human.renderer.camera.zoom(h)},Human.input.addHandler(function(b){var c,h,i=0,j=0,k=!1,n=!1;b.onMouseDown(function(a){c=a.x,h=a.y,k=!0}),b.onMouseMove(function(a){var b=a.x,d=a.y;k&&(void 0===c&&(c=b,h=d),a.mouseDownLeft||a.mouseDownMiddle||a.mouseDownRight?(i+=b-c,j+=d-h,c=b,h=d):k=!1,n=a.shiftDown||a.mouseDownMiddle||a.mouseDownLeft&&a.mouseDownRight)}),b.onTick(function(){if(Math.abs(i)>0||Math.abs(j)>0){var b=n?!q:q;b&&a(l)?(e=-i*Human.input.mouseOrbitRate,d=j*Human.input.mouseOrbitRate):!b&&a(m)&&(f=i*Human.input.mousePanRate,g=j*Human.input.mousePanRate),i=0,j=0}})});var s=!0;Human.properties.subscribe({propId:"ui.zoom.mouseWheel.enabled",value:s,callback:function(a){s=!!a}}),Human.input.addHandler(function(a){a.onMouseWheel(function(a,b){!s||a.altDown||Human.input.mouseZoomCtrlKey&&!a.ctrlDown||(h=-b*Human.input.mouseZoomRate)})}),Human.input.addHandler(function(a){a.onTick(function(b,c){if(!a.ctrlDown&&!a.altDown){var f=a.keyDown[Human.input.KEY_LEFT_ARROW],g=a.keyDown[Human.input.KEY_RIGHT_ARROW],h=a.keyDown[Human.input.KEY_UP_ARROW],i=a.keyDown[Human.input.KEY_DOWN_ARROW];if(f||g||h||i){var j=0,k=0;g?j=-c*Human.input.keyboardOrbitRate:f&&(j=c*Human.input.keyboardOrbitRate),i?k=-(c*Human.input.keyboardOrbitRate):h&&(k=c*Human.input.keyboardOrbitRate),Math.abs(j)>Math.abs(k)?k=null:j=null,e=j,d=k}}})}),Human.input.addHandler(function(a){a.onTick(function(b,c){if(!a.ctrlDown&&!a.altDown){var d=a.keyDown[Human.input.KEY_W],e=a.keyDown[Human.input.KEY_S],h=a.keyDown[Human.input.KEY_A],i=a.keyDown[Human.input.KEY_D];if(d||e||h||i){var j=0,k=0;e?k=c*Human.input.keyboardPanRate:d&&(k=-c*Human.input.keyboardPanRate),i?j=c*Human.input.keyboardPanRate:h&&(j=-c*Human.input.keyboardPanRate),f=j,g=k}}})}),Human.input.addHandler(function(a){a.onTick(function(b,c){if(!a.ctrlDown&&!a.altDown){var d=a.keyDown[Human.input.KEY_ADD]||a.keyDown[Human.input.KEY_EQUAL_SIGN]||a.keyDown[Human.input.KEY_EQUAL_SIGN_FIREFOX],e=a.keyDown[Human.input.KEY_SUBTRACT]||a.keyDown[Human.input.KEY_DASH]||a.keyDown[Human.input.KEY_DASH_FIREFOX];if(d||e){var f=d?-(c*Human.input.keyboardZoomRate):c*Human.input.keyboardZoomRate;h=f}}})}),Human.input.addHandler(function(b){var c=[],i=0,j=vec2.create(),p=vec2.create();b.onTouchStart(function(a){for(;c.length<a.length;)c.push(vec2.create());for(var b=0,d=a.length;d>b;++b)c[b][0]=a[b][0],c[b][1]=a[b][1];o=k,i=a.length}),b.onTouchMove(function(b,k){var o,q,s,t,u;if(1===i)k(),u=r,u&&a(l)?(o=b[0][0]-c[0][0],q=b[0][1]-c[0][1],s=o*Human.input.touchOrbitRate,t=q*Human.input.touchOrbitRate,d=t,e=-s):!u&&a(m)&&(vec2.sub(j,b[0],c[0]),f=j[0]*Human.input.touchPanRate,g=j[1]*Human.input.touchPanRate);else if(2===i){k(),vec2.sub(j,b[0],c[0]),vec2.sub(p,b[1],c[1]);var v=vec2.dot(j,p)>0;if(v)u=!r,u&&a(l)?(o=b[0][0]-c[0][0],q=b[0][1]-c[0][1],s=o*Human.input.touchOrbitRate,t=q*Human.input.touchOrbitRate,d=t,e=-s):!u&&a(m)&&(vec2.sub(j,b[0],c[0]),f=j[0]*Human.input.touchPanRate,g=j[1]*Human.input.touchPanRate);else if(!v&&a(n)){var w=vec2.distance(b[0],b[1]),x=vec2.distance(c[0],c[1]);h=(x-w)*Human.input.touchZoomRate}}for(var y=0;i>y;++y)c[y][0]=b[y][0],c[y][1]=b[y][1]}),b.onTouchEnd(function(a){for(var b=0,d=a.length;d>b;++b)c[b][0]=a[b][0],c[b][1]=a[b][1];o=k,i=a.length})})}(),Human.input.addHandler(function(a){"use strict";var b,c,d,e=!1,f=null,g=null,h=Human.view.annotations;a.onMouseClick(function(a){var i=a.x,j=a.y;if(e){if(c=d.name,b=Human.scene.objects[c]){var k=Human.renderer.camera.eye,l=new Float32Array(3);l[0]=k.x-d.worldPos[0],l[1]=k.y-d.worldPos[1],l[2]=k.z-d.worldPos[2],vec3.normalize(l,l),Human.view.annotations.createAnnotation({objectId:c,title:"",description:"",pos:d.worldPos,dir:l,renderableIndex:d.renderableIndex,primitiveIndex:d.primitiveIndex,barycentric:d.barycentric,enabled:!0,shown:!0,labelShown:!0,labelOffset:[i-d.canvasPos[0],j-d.canvasPos[1]-30],saved:!1,editable:!0})}Human.view.annotations.clearWire(),d=!1,e=!1}else f=i,g=j,h.enabled&&(d=Human.renderer.pick.queryPick({canvasX:i,canvasY:j,rayPick:!0}),d&&(c=d.name,b=Human.scene.objects[c],b&&(e=!0,Human.view.annotations.drawWire(i,j,i,j),d.objectId=c,d.pos=d.worldPos,Human.events.fire("annotations.pinning",d),Human.view.annotations.beginCreation())))}),a.onMouseMove(function(a){var b=a.x,c=a.y;e&&Human.view.annotations.drawWire(f,g,b,c)})}),Human.input.addHandler(function(a){"use strict";var b,c=!1;a.onKeyDown([Human.input.KEY_X,Human.input.KEY_I,Human.input.KEY_Z,Human.input.KEY_R],function(a){var d=a.keyCode;if(!a.ctrlDown&&!a.altDown&&!a.shiftDown)switch(d){case Human.input.KEY_X:b=!Human.view.xray.enabled,Human.view.xray.setEnabled(b),b||Human.view.highlight.setEnabled(Human.view.highlight.enabled);break;case Human.input.KEY_I:if(b=!Human.view.isolate.enabled,Human.view.isolate.setEnabled(b),b&&!Human.scene.anySelected())return;b?(Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1)):Human.view.highlight.setEnabled(!0);break;case Human.input.KEY_R:confirm("This will reset to the initial view. Are you sure you want to continue?")&&Human.init.reset()}if(a.ctrlDown&&!a.altDown&&!a.shiftDown)switch(d){case Human.input.KEY_X:c||(Human.view.dissect.setEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!1),Human.view.annotations.setEnabled(!1),c=!0);break;case Human.input.KEY_Z:Human.view.dissect.undo()}}),a.onKeyUp([Human.input.KEY_X],function(){c&&(Human.view.dissect.setEnabled(!1),Human.view.xray.setEnabled(Human.view.xray.enabled),Human.view.highlight.setEnabled(Human.view.highlight.enabled),c=!1)})}),Human.input.addHandler(function(a){"use strict";function b(){f&&(clearTimeout(f),f=null,c=null,d=null)}var c=null,d=null,e=4,f=null;a.onReset(function(){b()}),a.onMouseMove(function(a){var g=a.x,h=a.y;return a.mouseDownLeft||a.mouseDownMiddle||a.mouseDownRight?void b():(null!==c&&(Math.abs(g-c)>e||Math.abs(h-d)>e?b():(f&&(clearTimeout(f),f=null),f=setTimeout(function(){Human.renderer.pick.hoverPick({canvasX:g,canvasY:h}),clearTimeout(f),f=null,c=null,d=null},Human.input.mouseHoverDelay))),c=g,void(d=h))})}),Human.input.addHandler(function(a){"use strict";var b,c,d=null,e=null,f=4,g=!1,h=!1,i=!1,j=!1,k=!1;a.onKeyDown([Human.input.KEY_SHIFT],function(){a.ctrlDown||a.CTRL||Human.renderer.pick.setMultiPickEnabled(!0)}),a.onKeyUp([Human.input.KEY_SHIFT],function(){a.ctrlDown||a.CTRL||Human.renderer.pick.setSinglePickEnabled(!0)}),a.onMouseDown(function(a){d=a.x,e=a.y}),a.onMouseUp(function(a){var h=a.x,l=a.y;Math.abs(d-h)<f&&Math.abs(e-l)<f&&(b=h,c=l,g=!0,i=a.mouseDownLeft,j=a.mouseDownRight,k=a.ctrlDown)}),a.onMouseDoubleClick(function(a){var l=a.x,m=a.y;Math.abs(d-l)<f&&Math.abs(e-m)<f&&(b=l,c=m,g=!0,h=!0,i=a.mouseDownLeft,j=a.mouseDownRight,k=a.ctrlDown)}),a.onTick(function(){if(g){var a={canvasX:b,canvasY:c,mouseDownLeft:i,mouseDownRight:j,ctrlDown:k};h?Human.renderer.pick.doublePick(a):Human.renderer.pick.pick(a),g=!1,h=!1,d=null,e=null}})}),Human.input.addHandler(function(a){"use strict";a.onTouchTap(function(a,b,c){c(),Human.renderer.pick.pick({canvasX:a,canvasY:b})}),a.onTouchDoubleTap(function(a,b,c){c(),Human.renderer.pick.doublePick({canvasX:a,canvasY:b})})}),function(a){"use strict";a.module("humanUI",["humanUI.config","humanUI.utilities","humanUI.parse","humanUI.background","humanUI.load","humanUI.camera","humanUI.timeline","humanUI.crossSection","humanUI.annotations","humanUI.hotspots","humanUI.actions","humanUI.dissect","humanUI.modes","humanUI.info","humanUI.media","humanUI.scene","humanUI.bookmark","humanUI.fullscreen","humanUI.snapshot","humanUI.rpc","humanUI.templates"]).constant("MIN_HUMAN_VERSION","10.6.0").run(["$rootScope","Human","RpcDefinitions","ConfigCreator",function(b,c,d,e){c.properties.subscribe({propId:"locale",callback:function(a){b.$broadcast("human.locale",a)}});var f=["modules.activate.finish","modules.deactivate.finish","timeline.timeFrame.updated","timeline.chapters.activated","bookmarks.restored","annotations.shown","dissect.toggled","isolate.toggled","xray.toggled"];a.forEach(f,function(a){c.events.on(a,function(){b.$applyAsync()})}),e.init(),d.init()}]).factory("currentModule",["$window","Human",function(a,b){var c={id:null,data:null};return b.events.on("modules.create.start",function(b){c.id!==b.moduleId&&(c.id=b.moduleId,c.data=a.JSON.parse(a.JSON.stringify(b.moduleData)))}),c}]).factory("Human",["$window","MIN_HUMAN_VERSION",function(b,c){var d,e,f,g=[];a.forEach([Human.VERSION,c],function(a){a.replace(/^(\d+)\.(\d+)\.(\d+)-?(\w+)?$/,function(a,b,c,d,e){g.push({major:b,minor:c,patch:d,client:e||null})})});var h=["Human",Human.VERSION,"is not reliably supported! Use",c,"or higher."].join(" "),i=function(a){0!==a.length&&(f=a.shift(),d=Number(g[0][f]),e=Number(g[1][f]),e>d?b.console.warn(h):d===e&&i(a))};return 2===g.length?i(["major","minor","patch"]):b.console.warn(h),Human}]),a.module("humanUI.utilities",[]).factory("isBaseAnatomy",function(){return function(b){var c=a.isObject(b)?b.moduleId:b;return c?Human.modules.isBaseModule(c):!1}}).factory("touchTarget",["$document",function(a){return function(b,c){b.addEventListener("touchmove",function(b){var d=b.changedTouches[0],e=a[0].elementFromPoint(d.pageX,d.pageY);c(e)})}}]).factory("destroyInterval",["$interval",function(b){return function(c){a.isDefined(c)&&(b.cancel(c),c=void 0)}}]).factory("checkModule",function(){return function(b){try{a.module(b)}catch(c){return!1}return!0}}).factory("doTween",["$window",function(b){return function(c,d,e,f,g){a.isArray(c)||(c=[c]),a.isArray(d)||(d=[d]);var h,i=[],j=[];for(h=0;h<c.length;h++)j.push(c[h]),i.push((d[h]-c[h])/e);var k,l,m=0,n=function(a){
for(l||(l=a),k=a-l,m+=k,l=a,h=0;h<i.length;h++)j[h]+=k*i[h];e>m?(f(j),b.requestAnimationFrame(n)):(f(d),g(),b.cancelAnimationFrame(o))},o=b.requestAnimationFrame(n)}}]).factory("ElementDisplay",["OutsideListen",function(a){return{create:function(b){if(b.trigger&&b.target){var c,d=b.action||"toggle",e=d[0].toUpperCase()+d.slice(1),f=b.eventName||"element"+e,g="show"===d?"removeClass":"hide"===d?"addClass":"toggleClass";b.globalClose&&(c=a.create(b.target),c.excludedEls=[b.trigger[0],b.target[0]]);var h=function(a){b.target[a]("ng-hide");var d=!b.target.hasClass("ng-hide");c&&(d?c.add(h.bind(null,"addClass")):c.remove()),b.trigger.triggerHandler(f,d),b.target.triggerHandler(f,d)};b.trigger.on("click",h.bind(null,g))}}}}]).factory("OutsideListen",["$document",function(b){var c=function(c,d){d=d||{},this.element=c,this.excludedEls=[this.element[0]],a.isArray(d.exclude)&&a.forEach(d.exclude,function(a){var c=b[0].querySelectorAll(a);c=Array.prototype.slice.call(c),this.excludedEls=this.excludedEls.concat(c)},this)};return c.prototype._checkContainment=function(a){for(var b=0;b<this.excludedEls.length;b++)if(this.excludedEls[b].contains(a))return!0;return!1},c.prototype.add=function(a){var c=function(b){this._checkContainment(b.target)||(a(),this.remove())};this.checkOutside=c.bind(this),b[0].addEventListener("touchstart",this.checkOutside,!0),b[0].addEventListener("mousedown",this.checkOutside,!0)},c.prototype.remove=function(){b[0].removeEventListener("touchstart",this.checkOutside,!0),b[0].removeEventListener("mousedown",this.checkOutside,!0),this.checkOutside=null},{create:function(a,b){return new c(a,b)}}}]).filter("translate",function(){return function(a,b,c){var d=a[b];return c&&a.translations&&a.translations[c]&&(d=a.translations[c][b]||d),d}}).filter("excludeBaseAnatomy",["isBaseAnatomy",function(a){return function(b){return a(b)?null:b}}]).filter("escapeHtml",function(){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=[];a.forEach(b,function(a,b){c.push(b)});var d=new RegExp("(?:"+c.join("|")+")","g"),e=function(a){return b[a]};return function(a){return a.replace(d,e)}}).filter("dashNormalize",function(){return function(a){return/^[a-z]+([_[A-Z])[a-z]+/.test(a)?a.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/([a-zA-Z])_/g,"$1-").toLowerCase():a}}).filter("camelCaseNormalize",function(){return function(b){return a.isString(b)&&(b=b.replace(/[-_]([a-z])/g,function(a){return a[1].toUpperCase()})),b}}).filter("formatPosition",function(){return function(a,b){var c,d="array"===b?[]:{},e=["x","y","z"];switch(b){case"array":if(a.hasOwnProperty("length"))d=a;else for(c=0;c<e.length;c++)a.hasOwnProperty(e[c])&&d.push(a[e[c]]);break;case"object":if(a.hasOwnProperty("length"))for(c=0;c<a.length;c++)d[e[c]]=a[c];else d=a;break;default:d=a}return d}}).directive("toggleButton",function(){return{restrict:"A",scope:{config:"=toggleButton"},link:function(b,c,d){"on"===d.toggleDefault&&(b.config.model=!0);var e,f=function(d){if(b.config.model=a.isDefined(d)?!!d:!b.config.model,b.config.model!==e){var f=b.config.model?"on":"off";a.isFunction(b.config[f])&&b.config[f](),c[b.config.model?"addClass":"removeClass"]("on"),e=b.config.model}};c.on("click",function(){f(),b.$digest()}),b.$watch("config.model",function(b){a.isDefined(b)&&f(b)})}}}),a.module("humanUI.utilities").factory("HumanCollection",["$interpolate",function(b){var c,d,e,f=function(a,b){b=b||{},this.element=a,this.lis={},this.collapseTemplate=b.collapseTemplate||"<span collapse></span>",this.element.data("humanCollection",this)},g=f;return g.create=function(a){return new g(a)},g.compare=function(a,b,c){var d,e,f,g=[],h=[],i={},j={};if(b){for(d=0;d<a.length;d++)i[a[d][c]]=a[d];for(d=0;d<b.length;d++)j[b[d][c]]=b[d];for(e in i)i.hasOwnProperty(e)&&!j.hasOwnProperty(e)&&g.push(i[e]);for(e in j)j.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&h.push(j[e]);f={toAdd:g,toRemove:h}}else f={toAdd:a,toRemove:h};return f},g.sort=function(a){return function(b,c){var d=b[a].toLowerCase(),e=c[a].toLowerCase();return e>d?-1:d>e?1:0}},g.prototype.buildClasses=function(a,b,c){var f;d=[],e=c?c(a):{},b&&(e["tree-leaf"]=!0);for(f in e)e.hasOwnProperty(f)&&e[f]&&d.push(f);return d.join(" ")},g.prototype._buildObjectGroups=function(b){var c,d,e,f,h,i={},j="abcdefghijklmnopqrstuvwxyz".split("");a.forEach(j,function(a){i[a]=[]});for(h in b)if(b.hasOwnProperty(h)){if(f=b[h],c=!1,f.displayName)for(d=0;!c&&d<f.displayName.length;)e=f.displayName[d].toLowerCase(),c=j.indexOf(e)>=0,d++;if(!c)continue;i[e].push(f)}var k=g.sort("displayName");for(h in i)i.hasOwnProperty(h)&&i[h].sort(k);return i},g.prototype.buildDOMString=function(a,d,e){var f,g,h,i,j,k,l,m=this._buildObjectGroups(d),n="<ul>";f=e.itemId?' id="{{'+e.itemId+' | escapeHtml }}"':"";var o="<li"+f+' class="{{ classes }}">';for(i in m)if(m.hasOwnProperty(i)){for(l=m[i],l.length>0&&(f='id="letter-group-'+i+'"',j='<h1 class="letter-header">',j+=i.toUpperCase()+"</h1>",n+="<li "+f+' class="letter-group">'+j+"<ul>"),k=0;k<l.length;k++){if(c=l[k],!c.objectId||!c.displayName)return;g=e.itemClasses,c.classes=this.buildClasses(c,!1,g),h=o+a,h=b(h)(c),delete c.classes,n+=h+"</li>"}l.length>0&&(n+="</ul></li>")}return n+="</ul>"},g.prototype._buildTreeDOMString=function(a,d,e,f){var g,h,i,j,k,l=f?"<ul>":"";i=e.itemId?' id="{{'+e.itemId+' | escapeHtml }}"':"";var m="<li"+i+' class="{{ classes }}">';for(k=0;k<d.length;k++){if(c=d[k],!c.objectId||!c.displayName)return;g=e.isLeaf?e.isLeaf(c):!1,j=e.itemClasses,c.classes=this.buildClasses(c,g,j),h=m+(g?"":this.collapseTemplate)+a,h=b(h)(c),delete c.classes,g||(h+=this._buildTreeDOMString(a,c.objects,e,!0)),l+="</li>"+h}return l+=f?"</ul>":""},g.prototype.buildTreeDOMString=function(a,b,c,d){return this._buildTreeDOMString(a,b,c,d)},g.prototype.buildLis=function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.lis[a[b].id]=a[b];this.element.triggerHandler("humanCollection.built")},g.prototype.emptyLis=function(){for(var a in this.lis)this.lis.hasOwnProperty(a)&&delete this.lis[a];this.element.triggerHandler("humanCollection.emptied")},g.prototype.getLi=function(b){return this.lis[b]?a.element(this.lis[b]):void 0},g.prototype.removeLi=function(a){this.lis[a]&&(this.lis[a].remove(),delete this.lis[a])},g}]).factory("TreeCollapse",["$timeout",function(b){var c={animate:!0};return{show:function(d,e){if(!d.data("transitioning")){var f=d.parent();e=a.extend({},c,e);var g=e.animate;f.removeClass("collapsed").addClass("opening"),g&&d.addClass("transitioning"),d.css("height",0),d.data("transitioning",!0),f.data("collapsed",!1);var h=function(){g&&d.removeClass("transitioning"),f.addClass("open").removeClass("opening"),d.css("height","auto"),d.data("transitioning",!1)};g?b(h,350):b(h),d.css("height",d[0].scrollHeight+"px")}},hide:function(d,e){var f;if(!d.data("transitioning")){var g=d.parent();e=a.extend({},c,e);var h=e.animate;f=d.css("height",d[0].offsetHeight+"px")[0].offsetHeight,h&&d.addClass("transitioning"),g.removeClass("open").addClass("collapsing"),d.data("transitioning",!0);var i=function(){d.data("transitioning",!1),h&&d.removeClass("transitioning"),g.addClass("collapsed").removeClass("collapsing"),g.data("collapsed",!0)};d.css("height",0),h?b(i,350):b(i)}},toggle:function(a){this[a.parent().data("collapsed")?"show":"hide"](a)},getTarget:function(b){if(b)for(var c=b.children(),d=0;d<c.length;d++)if("ul"===c[d].tagName.toLowerCase())return a.element(c[d])},globalBind:function(b){var c=this;b.off("click.collapseToggle"),b.on("click.collapseToggle",function(b){if(b.target.hasAttribute("collapse")){b.stopPropagation();var d=a.element(b.target),e=d.parent();c.toggle(c.getTarget(e))}})},init:function(a){a.find("li").addClass("collapsed").data("collapsed",!0),a.children().find("ul").css("height","0px")}}}]).directive("collapse",["TreeCollapse",function(a){return{restrict:"A",link:function(b,c){c.off("click.collapseToggle"),c.on("click.collapseToggle",function(b){b.stopPropagation();var d=c.parent();a.toggle(a.getTarget(d))})}}}]).directive("humanList",["HumanCollection",function(a){return{restrict:"E",scope:{listData:"=",listConfig:"="},compile:function(b){var c=b[0].innerHTML;b.addClass("human-collection").empty();var d=function(b,d){var e=a.create(d),f=function(a){var f=b.listConfig||{},g=e.buildDOMString(c,a,f);d.empty().append(g),f.letterHeaders&&d.addClass("letter-headers"),e.emptyLis(),e.buildLis(d.find("li"))};b.$watch("listData",function(a){a&&f(a)})};return d}}}]).directive("humanTree",["$compile","HumanCollection","TreeCollapse",function(b,c,d){return{restrict:"E",scope:{treeData:"=",treeConfig:"="},compile:function(e){var f=e[0].innerHTML;e.addClass("human-collection").empty();var g=function(e,g){var h=c.create(g),i=function(i,j){var k,l=e.treeConfig||{};if(l.compare&&l.itemId){for(var m,n,o,p=c.compare(i,j,l.itemId),q=0;q<p.toRemove.length;q++)h.removeLi(p.toRemove[q][l.itemId]);m=g[0].firstChild,n=m&&"ul"===m.tagName.toLowerCase(),o=n?a.element(m):g,k=h.buildTreeDOMString(f,p.toAdd,l,!n),o.append(k)}else k=h.buildTreeDOMString(f,i,l,!0),g.empty().append(k);l.compile===!1?d.globalBind(g):b(g.contents())(e),d.init(g),h.emptyLis(),h.buildLis(g.find("li"))};e.$watch("treeData",function(a,b){a&&i(a,b)})};return g}}}]),a.module("humanUI.utilities").factory("Draggable",["$window","$document",function(b,c){var d,e,f,g="touchstart mousedown",h="touchmove mousemove",i="touchend touchcancel mouseup",j=[],k=function(d,e){var f={element:null,axis:!1,elementBounds:!1};if(a.isString(d.element)){var g=d.element.split(".");f.element="parent"===g[0]?e.parent()[0]:"window"===g[0]?b:c[0].querySelector(g[0]),("width"===g[1]||"height"===g[1])&&(f.elementBounds=g[1])}else"boolean"==typeof d.element&&(d.element||(f.element=!1));return("x"===d.axis||"y"===d.axis)&&(f.axis=d.axis),f},l=function(b){this.element=b.element,this.handle=b.handle||b.element,this.x=this.y=0,this.constraints=k(b.constraints||{},this.element),this.callbacks={onStart:b.onStart||a.noop,onMove:b.onMove||a.noop,onEnd:b.onEnd||a.noop},a.forEach(g.split(" "),function(a){this.handle.on(a+".draggable",this.onStart.bind(this))},this)};return l.prototype.setElCoords=function(){if(this.width=this.element[0].offsetWidth,this.height=this.element[0].offsetHeight,d=b.parseInt(this.element.css("margin-left")),e=b.parseInt(this.element.css("margin-top")),this.x=this.element[0].offsetLeft-d,this.y=this.element[0].offsetTop-e,this.constraints.element){var a={};this.constraints.element===b?(a.left=0,a.top=0,a.right=b.innerWidth,a.bottom=b.innerHeight):a=this.constraints.element.getBoundingClientRect();var c=this.element[0].offsetParent.getBoundingClientRect();this.xMin=a.left-c.left,this.xMax=c.width+(a.right-c.right),this.yMin=a.top-c.top,this.yMax=c.height+(a.bottom-c.bottom)}else this.xMin=this.yMin=-(1/0),this.xMax=this.yMax=1/0},l.prototype.setEventCoords=function(a){a=a.originalEvent||a,a=a.changedTouches?a.changedTouches[0]:a,this.deltaX=a.clientX-this.eventX||0,this.deltaY=a.clientY-this.eventY||0,this.eventX=a.clientX,this.eventY=a.clientY},l.prototype.constrainX=function(a){return this.constraints.element&&(a<this.xMin&&(a=this.xMin),f="width"===this.constraints.elementBounds?0:this.width,a+f>this.xMax&&(a=this.xMax-f)),"y"===this.constraints.axis&&(a=this.x),a},l.prototype.constrainY=function(a){return this.constraints.element&&(a<this.yMin&&(a=this.yMin),f="height"===this.constraints.elementBounds?0:this.height,a+f>this.yMax&&(a=this.yMax-f)),"x"===this.constraints.axis&&(a=this.y),a},l.prototype.onStart=function(b){b.stopPropagation(),b.preventDefault(),this.setElCoords(),this.setEventCoords(b),a.forEach(h.split(" "),function(a){c.on(a+".draggable",this.onMove.bind(this))},this),a.forEach(i.split(" "),function(a){c.on(a+".draggable",this.onEnd.bind(this))},this),this.callbacks.onStart(this.x,this.y)},l.prototype.move=function(a,b){(a!==this.x||b!==this.y)&&(this.x=a,this.y=b,this.element.css({left:this.x+"px",top:this.y+"px"}))},l.prototype.onMove=function(a){a.stopPropagation(),a.preventDefault(),this.setEventCoords(a),this.move(this.constrainX(this.x+this.deltaX),this.constrainY(this.y+this.deltaY)),this.callbacks.onMove(this.x,this.y)},l.prototype.onEnd=function(){a.forEach(h.split(" "),function(a){c.off(a+".draggable")},this),a.forEach(i.split(" "),function(a){c.off(a+".draggable")},this),this.callbacks.onEnd()},{create:function(a){var b=new l(a);return j.push(b),b}}}]).directive("draggable",["Draggable",function(b){return{restrict:"A",link:function(c,d,e){var f,g,h=d.find("drag-handle");f=a.isDefined(e.constrainElement)?"false"===e.constrainElement?!1:e.constrainElement:"window",("x"===e.constrainAxis||"y"===e.constrainAxis)&&(g=e.constrainAxis),b.create({element:d,handle:h.length?h:d,constraints:{element:f,axis:g}})}}}]),a.module("humanUI.utilities").factory("HumanKeySelect",["$window",function(b){var c=function(a){return"ArrowUp"===a.key||38===a.keyCode||38===a.which},d=function(a){return"ArrowDown"===a.key||40===a.keyCode||40===a.which},e=function(a){return"Enter"===a.key||13===a.keyCode||13===a.which},f=function(a){return a.clientHeight>0&&a.clientWidth>0},g=function(a){for(var c=a.getBoundingClientRect().height,d=b.getComputedStyle(a),e=["marginTop","marginBottom"],f=0;f<e.length;f++)d[e[f]]&&/px$/.test(d[e[f]])&&(c+=b.parseInt(d[e[f]]));return c},h=function(b,c,d){this.$selectedItem=null,this.enabled=!1,this.$element=b,this.items=this.setItems(c),this.config=a.extend({cycle:!0,selectedClass:"user-selected",onSelected:a.noop},d),this.bindHandlers()};return h.create=function(a,b,c){return new h(a,b,c)},h.prototype._findScrollParent=function(){for(var a=this.items[0],b=null;!b&&a&&a!==this.$element[0];)a=a.parentNode,a&&a.scrollHeight>a.clientHeight&&(b=a);return b},h.prototype._selectItem=function(b){var c=this.config.selectedClass;return this._clearSelectedItem(),b&&(this.$selectedItem=a.element(b),this.$selectedItem.addClass(c)),this.$selectedItem},h.prototype._clearSelectedItem=function(){var a=this.config.selectedClass;this.$selectedItem&&(this.$selectedItem.removeClass(a),this.$selectedItem=null)},h.prototype._isFirstVisibleItem=function(a){for(var b=this.items.indexOf(a),c=b-1;c>=0;c--)if(f(this.items[c]))return!1;return!0},h.prototype._isLastVisibleItem=function(a){for(var b=this.items.indexOf(a),c=b+1;c<this.items.length;c++)if(f(this.items[c]))return!1;return!0},h.prototype._selectNextItem=function(a){var b;for(b=a+1;b<this.items.length;b++)if(f(this.items[b]))return this._selectItem(this.items[b]);if(this.config.cycle)for(b=0;a>b;b++)if(f(this.items[b]))return this._selectItem(this.items[b])},h.prototype._selectPreviousItem=function(a){var b;for(b=a-1;b>=0;b--)if(f(this.items[b]))return this._selectItem(this.items[b]);if(this.config.cycle)for(b=this.items.length-1;b>a;b--)if(f(this.items[b]))return this._selectItem(this.items[b])},h.prototype._handleScroll=function(b,c){var d,e,f,h,i=this.$selectedItem[0],j=g(i),k=2;if(d=i.offsetTop-j*k,e=this._scrollParent.scrollTop,f=i.offsetTop+j*(k+1),h=this._scrollParent.scrollTop+this._scrollParent.clientHeight,this._scrollParent.scrollHeight>this._scrollParent.clientHeight&&(1===b&&f>h||-1===b&&e>d)){a.element(this._scrollParent).one("scroll",c);var l=this._scrollParent.scrollTop,m=j*k*b;if(this._scrollParent.scrollTop=l+m,l===this._scrollParent.scrollTop){var n=this.config.cycle;n&&1===b&&this._isLastVisibleItem(i)?this._scrollParent.scrollTop=0:n&&-1===b&&this._isFirstVisibleItem(i)?this._scrollParent.scrollTop=this._scrollParent.scrollHeight:(a.element(this._scrollParent).off("scroll",c),c())}}else c()},h.prototype.selectItem=function(a){if(a=a||{},a.hasOwnProperty("index")&&this._selectNextItem(a.index-1),a.hasOwnProperty("dir")){if(!this.$selectedItem)return;var b=a.dir,c=this.items.indexOf(this.$selectedItem[0]),d=this[1===b?"_selectNextItem":"_selectPreviousItem"];d=d.bind(this,c),this._scrollParent||(this._scrollParent=this._findScrollParent()),this._scrollParent?this._handleScroll(b,d):d()}},h.prototype.setItems=function(b){this.items=b||[],a.isArray(this.items)||(this.items=Array.prototype.slice.call(this.items))},h.prototype.bindHandlers=function(){var a=this;a.$element.on("focus",function(){a.enabled=!0}),a.$element.on("blur",function(){a.enabled=!1,a._clearSelectedItem()}),a.$element[0].addEventListener("click",function(b){a.enabled&&a.items.length&&a.items.indexOf(b.target)>=0&&a._selectItem(b.target)},!0),b.addEventListener("keydown",function(b){a.enabled&&a.items.length&&(b.stopImmediatePropagation(),c(b)||d(b)?a.selectItem(a.$selectedItem?{dir:d(b)?1:-1}:{index:0}):e(b)&&a.$selectedItem&&a.config.onSelected(a.$selectedItem))},!0)},h}]),a.module("humanUI.utilities").constant("SLIDER_TEMPLATE",['<div class="track">','<div class="progress"></div>','<div class="handle">','<div class="progress-label" style="display:none"></div>',"</div>","</div>"].join("")).factory("HumanSlider",["SLIDER_TEMPLATE","Draggable",function(b,c){var d,e,f=[],g=function(d){this.value=d.value||0,this.axis=d.axis||"x",this.callbacks={onMove:d.onMove||a.noop},this.label=d.label,d.element.innerHTML=b,d.element.setAttribute("axis",this.axis);var e=d.element.children[0];this.elements={container:d.element,track:e,progress:e.children[0],handle:e.children[1],label:e.children[1].children[0]},this.draggable=c.create({element:a.element(this.elements.handle),constraints:{axis:this.axis,element:"x"===this.axis?"parent.width":"parent.height"},onMove:this.onMove.bind(this)});var f=this;this.elements.track.addEventListener("mousedown",function(a){var b=a.target.getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;f.onMove(c,d)}),a.isFunction(this.label)&&(this.elements.handle.addEventListener("mouseover",function(){f.elements.label.style.display="block"}),this.elements.handle.addEventListener("mouseleave",function(){f.elements.label.style.display="none"}))};g.prototype.toOffset=function(a){return d="x"===this.axis?h:i,e="x"===this.axis?"offsetWidth":"offsetHeight",a*this.elements.track[e]},g.prototype.fromOffset=function(a,b){return d="x"===this.axis?a:b,e="x"===this.axis?"offsetWidth":"offsetHeight",d/this.elements.track[e]};var h,i,j,k;return g.prototype.move=function(b){this.value=b,j=this.toOffset(this.value),"x"===this.axis?(h=j,i=this.draggable.y,k="width"):(h=this.draggable.x,i=j,k="height"),h===h&&i===i&&(this.draggable.move(h,i),this.elements.progress.style[k]=j+"px",a.isFunction(this.label)&&(this.elements.label.textContent=this.label()))},g.prototype.onMove=function(a,b){this.move(this.fromOffset(a,b)),this.callbacks.onMove(this.value)},{create:function(a){var b=new g(a);return f.push(b),b}}}]),a.module("humanUI.hotspots",[]).directive("humanHotspots",["$window","$compile","HumanActions","HotspotData","Hotspot","HotspotInfo",function(b,c,d,e,f,g){return{restrict:"E",scope:!0,link:function(c,d){f.parentElement=d[0];var h=function(b){a.forEach(b,function(a){var b=f.create(a);b.template&&b.render()})},i=function(a){a=a.toString();var b=e.byChapter;b.hasOwnProperty(a)&&h(b[a])},j=function(b){a.forEach(b,function(a){f.destroy(a)})},k=function(){j(f.hotspots.slice(0)),l=!0},l=!0;Human.events.on("timeline.chapters.activated",function(a){l&&(h(e.global),l=!1);var c=f.hotspots.filter(function(a){return!e.global[a.id]});j(c),i(a.newChapterIndex),b.innerWidth<g.breakPoint?g.hideLabels(f.hotspots):g.showLabels(f.hotspots)}),Human.events.on("modules.deactivate.finish",k),Human.events.on("modules.destroy.finish",k);var m=!1,n=function(){g.testBreakpoint(f.hotspots),m=!1};b.addEventListener("resize",function(){m||(m=!0,b.requestAnimationFrame(n))})}}}]),a.module("humanUI.hotspots").factory("HotspotData",["$timeout","Human","currentModule",function(b,c,d){var e={all:{},global:{},byChapter:{},byName:{}},f=Object.keys(e),g=1;e.getCurrentId=function(){return g},e.add=function(b,c){a.isDefined(b.id)&&(b.name=b.id,delete b.id),b.id=g,this.all[b.id.toString()]=b,a.isDefined(c)&&(b.chapterScope=c),a.isDefined(b.chapterScope)?(c=b.chapterScope.toString(),this.byChapter[c]||(this.byChapter[c]=[]),this.byChapter[c].push(b)):this.global[b.id.toString()]=b,a.isDefined(b.name)&&(this.byName[b.name]=b),g++},e.update=function(b,c){var d=this.all[b.toString()];if(c.hasOwnProperty("chapterScope")){var e=d.chapterScope,f=c.chapterScope;if(d.hasOwnProperty("chapterScope")){var g=this.byChapter[e].indexOf(d);this.byChapter[e].splice(g,1)}else delete this.global[d.id];a.isDefined(f)?(this.byChapter[f]||(this.byChapter[f]=[]),this.byChapter[f].push(d)):(delete c.chapterScope,delete d.chapterScope,this.global[d.id]=d)}if(c.hasOwnProperty("name")){var h=d.name,i=c.name;d.hasOwnProperty("name")&&delete this.byName[h],a.isDefined(i)?this.byName[i]=d:(delete c.name,delete d.name)}a.extend(d,c)},e.remove=function(b){delete this.all[b],this.global[b]&&delete this.global[b];var c,d,e;for(c in this.byChapter)if(this.byChapter.hasOwnProperty(c)){var f=this.byChapter[c];for(d=0;d<f.length;d++)if(b===f[d].id){e=d;break}if(a.isDefined(e)){f.splice(e,1);break}}for(c in this.byName)if(this.byName.hasOwnProperty(c)&&b===this.byName[c].id){delete this.byName[c];break}},e.removeAll=function(){for(var a,b,c=0;c<f.length;c++){b=this[f[c]];for(a in b)b.hasOwnProperty(a)&&(b[a]=void 0,delete b[a])}};var h=function(){var b=d.data;b.hotspots&&b.hotspots.length&&a.forEach(b.hotspots,function(a){e.add(a)}),b.chapters&&b.chapters.length&&a.forEach(b.chapters,function(b,c){b.hotspots&&b.hotspots.length&&a.forEach(b.hotspots,function(a){e.add(a,c)})})};return c.events.on("modules.activate.start",function(a){c.modules.activeModules[a.moduleId]||(e.removeAll(),h())}),e}]),a.module("humanUI.hotspots").factory("HotspotInfo",["$window","Info",function(a,b){var c={},d={},e={breakPoint:400,current:null,setCurrent:function(c){this.current=c,a.innerWidth<e.breakPoint&&(this.current?this.setInfoPanel(this.current):b.update()),this.current&&this.current.setDepth(-1)},setInfoPanel:function(a){(a.title||a.description)&&(b.setTitle(a.title||""),b.setDescription(a.description||""))},getLabel:function(a){return a.element?a.element.getElementsByClassName("label-outer")[0]:void 0},isHideable:function(a){return a.element&&a.hasClass("label")&&a.hasClass("circle")&&!a.hasClass("show-hover")},showLabel:function(a){var b=this.getLabel(a);b&&(b.style.display="block")},hideLabel:function(a){var b=this.getLabel(a);b&&(b.style.display="none")},showLabels:function(a){for(var b=0;b<a.length;b++){var d=a[b];c.hasOwnProperty(d.id)&&(d.removeClass("show-hover"),this.showLabel(d),delete c[d.id])}},hideLabels:function(a){for(var b=0;b<a.length;b++){var d=a[b];this.isHideable(d)&&(d.addClass("show-hover"),this.hideLabel(d),c[d.id]=!0)}},testBreakpoint:function(c){a.innerWidth<e.breakPoint&&!f?(f=!0,this.hideLabels(c),this.current&&this.setInfoPanel(this.current)):a.innerWidth>=e.breakPoint&&f&&(f=!1,this.showLabels(c),b.update())},testLabel:function(b){if(b.element&&b.canvasPos){var c,e=this.getLabel(b),f=e.getBoundingClientRect();if(b.hasClass("left"))Math.ceil(f.left)<0&&!d.hasOwnProperty(b.id)?(c=Math.floor(b.canvasPos[0])-Math.ceil(f.left),b.addClass("flipped"),d[b.id]=c):d.hasOwnProperty(b.id)&&Math.floor(b.canvasPos[0])>d[b.id]&&(b.removeClass("flipped"),delete d[b.id]);else{var g=a.innerWidth-Math.floor(b.canvasPos[0]);Math.floor(f.right)>a.innerWidth&&!d.hasOwnProperty(b.id)?(c=g+(Math.floor(f.right)-a.innerWidth),b.addClass("flipped"),d[b.id]=c):d.hasOwnProperty(b.id)&&g>d[b.id]&&(b.removeClass("flipped"),delete d[b.id])}}}},f=a.innerWidth<e.breakPoint;return e}]),a.module("humanUI.hotspots").constant("HOTSPOT_TEMPLATES",{circle:['<div class="outer">','<div class="inner">{{ symbol }}</div>',"</div>"].join(""),label:['<div class="label-outer">','<h1 class="title">{{ title }}</h1>','<p class="description">{{ description }}</p>',"</div>"].join("")}).constant("HOTSPOT_CLASSES",{circle:"circle",plus:"plus",minus:"minus",label:"label",left:"left",singleLine:"single-line",pulse:"pulse",pulseHover:"pulse-hover",showHover:"show-hover",transitionShow:"transition-show",transitionHide:"transition-hide"}).factory("HOTSPOT_TYPES",["HOTSPOT_TEMPLATES","HOTSPOT_CLASSES",function(a,b){return{circle:{template:a.circle,classes:[b.circle],variations:[b.pulse,b.pulseHover,b.transitionShow,b.transitionHide]},circlePlus:{template:a.circle,classes:[b.circle,b.plus],variations:[b.pulse,b.pulseHover,b.transitionShow,b.transitionHide]},circleMinus:{template:a.circle,classes:[b.circle,b.minus],variations:[b.pulse,b.pulseHover,b.transitionShow,b.transitionHide]},label:{template:a.label,classes:[b.label],variations:[b.left,b.singleLine,b.transitionShow,b.transitionHide]},circleLabel:{template:a.circle+a.label,classes:[b.circle,b.label],variations:[b.plus,b.minus,b.pulse,b.pulseHover,b.showHover,b.left,b.singleLine,b.transitionShow,b.transitionHide]}}}]),a.module("humanUI.hotspots").factory("Hotspot",["$window","$filter","$interpolate","HOTSPOT_TYPES","HOTSPOT_CLASSES","HotspotData","HotspotInfo","Human","HumanParser","HumanActions","currentModule","doTween",function(b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q,r,s,t=1,u=80,v=100,w=500,x=[],y=[],z=[],A=b.document.getElementById(i.canvasId||i.CANVAS_ID),B=function(c){var d=a.copy(c);for(var e in d)d.hasOwnProperty(e)&&(this[e]=d[e]);if(a.isDefined(this.shown)||(this.shown=!0),!this.pos&&this.objectId){var f=i.scene.objects[this.objectId];f&&(this.pos=i.scene.objects[this.objectId].getCenter())}a.isArray(this.dir)&&b.vec3.normalize(this.dir,this.dir),this._buildType(),this.createElement(),this.bindEngineHandlers(),this._displayUpdate={id:this.id},this._positionUpdate={id:this.id},this._userUpdate={id:this.id},this.setObjectShown(),this.setCanvasPos()};B.TAG_NAME="human-hotspot",B.parentElement=null,B.hotspots=[],B.hotspotDepths=[],B.create=function(a){var b=new B(a);return B.hotspots.push(b),B.hotspotDepths.push(b),b},B.get=function(a){for(var b=0;b<B.hotspots.length;b++)if(B.hotspots[b].id===a)return B.hotspots[b];return null},B.destroy=function(a){var b=B.hotspots.indexOf(a);B.hotspots.splice(b,1),b=B.hotspotDepths.indexOf(a),B.hotspotDepths.splice(b,1),a.unRender(),a.unbindEngineHandlers(),a=void 0},B.prototype._buildType=function(){var a=c("camelCaseNormalize")(this.type);if(a&&e[a]){var b=e[a],d=b.classes.slice();if(this.className)for(var f=this.className.split(" "),g=0;g<f.length;g++)-1===d.indexOf(f[g])&&d.push(f[g]);this.title&&d.push("has-title"),this.description&&d.push("has-description"),this.className=d.join(" "),this.template=b.template}},B.prototype._setCanvasDims=function(){p=A.getBoundingClientRect(),this._canvasWidth=p.width,this._canvasHeight=p.height};var C,D,E;B.prototype._getViewAngle=function(){return this.dir?(C=i.view.camera.eye,z[0]=C.x,z[1]=C.y,z[2]=C.z,b.vec3.subtract(z,z,this.pos),b.vec3.normalize(z,z),D=b.Math.min(b.vec3.dot(z,this.dir),1),E=b.Math.acos(D)*(180/b.Math.PI)):0},B.prototype._getViewPos=function(){return n=i.renderer.getViewMat(),x=b.vec3?b.vec3.transformMat4(x,this.pos,n):i.math.transformPoint3(n,this.pos),x[3]=1,x},B.prototype._getCanvasPos=function(a){return o=i.renderer.getProjMat(),y=b.vec4?b.vec4.transformMat4(y,a,o):i.math.transformPoint4(o,a),q=y[0],r=y[1],s=y[3],this._setCanvasDims(),[(1+q/s)*this._canvasWidth/2,(1-r/s)*this._canvasHeight/2]},B.prototype.getContext=function(){var b=g.byName,c={self:g.all[this.id]||{}};return a.extend({},b,c)},B.prototype.doActions=function(){this.actions&&k.parse(this.actions,this.getContext(),a.noop)},B.prototype.createElement=function(){var e=b.document.createElement(B.TAG_NAME);if(this.name&&e.setAttribute("name",this.name),this.className&&(e.className=this.className),this.template&&(e.innerHTML=d(this.template)(this)),this.actionsSrc){var f=l.data;this.actions=j.parse(this.actionsSrc)(f)}if(this.actions){var g=k.JOIN_CHARACTER,h="";a.isArray(this.actions)?h=this.actions.join(g):a.isObject(this.actions)&&(h=this.actions.actions.join(g)),e.setAttribute("actions",h)}if(this.pos&&e.setAttribute("pos",this.pos.join(",")),this.objectId&&e.setAttribute("object-id",this.objectId),a.isObject(this.data)){var i,m;a.forEach(this.data,function(b,d){i=c("dashNormalize")(d),m=a.isObject(b)?a.toJson(b):b,e.setAttribute("data-"+i,m)})}return a.element(e).data("hotspot",this),this.element=e,e},B.prototype.hasClass=function(a){return a=" "+a+" ",(" "+this.className+" ").indexOf(a)>-1},B.prototype.addClass=function(a){this.hasClass(a)||(this.className+=" "+a,this.element&&(this.element.className+=" "+a))},B.prototype.removeClass=function(a){a=" "+a+" ";var b=" "+this.className+" ";this.className=b.replace(a," ").trim(),this.element&&(b=" "+this.element.className+" ",this.element.className=b.replace(a," ").trim())},B.prototype.render=function(){this._rendered||(B.parentElement.appendChild(this.element),this.setCanvasPos(),this.unbindDOMHandlers(),this.bindDOMHandlers(),this._rendered=!0)},B.prototype.unRender=function(){this._rendered&&(this.unbindDOMHandlers(),B.parentElement.removeChild(this.element),this._rendered=!1)},B.prototype.setDepth=function(a){this.element&&(-1===a&&(a=B.hotspotDepths.length),this.element.style["z-index"]=a)};var F,G,H,I;B.prototype._getOpacity=function(){return this.dir&&this._viewAngle>=u?(G=this._viewAngle-u,H=v-u,I=G/H*t,F=b.Math.max(1-I,0)):F=t,F},B.prototype._setOpacity=function(){this.dir&&(this.element.style.opacity=this._getOpacity())},B.prototype._setTranslation=function(){this.element.style.transform="translate("+this.canvasPos[0]+"px,"+this.canvasPos[1]+"px)"};var J,K,L,M,N=function(a){this.element.style.opacity=a[0]},O=function(){this.element.style.display="none",this._notifyDisplayUpdated()};B.prototype._transitionDisplay=function(a){J=this._getOpacity(),K=w*J,L=N.bind(this),a?(this.element.style.opacity=0,this.element.style.display="block",M=this._notifyDisplayUpdated.bind(this),m(0,J,K,L,M)):(M=O.bind(this),m(J,0,K,L,M))},B.prototype._notifyDisplayUpdated=function(){this._displayUpdate.inView=this.inView,this._displayUpdate.shown=this.shown,a.isDefined(this.objectShown)&&(this._displayUpdate.objectShown=this.objectShown),this.hasClass("label")&&h.testLabel(this),i.events.fire("hotspots.displayUpdated",this._displayUpdate)};var P,Q,R,S,T;B.prototype.setDisplay=function(b){P=this.objectShown||!a.isDefined(this.objectShown),Q=!!(this.shown&&this.inView&&P),this.element&&(T=!1,b&&(S=Q?f.transitionShow:f.transitionHide,T=this.hasClass(S)),T?this._transitionDisplay(Q):(this.element.style.display=Q?"block":"none",this._notifyDisplayUpdated()))};var U=!1,V=function(a,b){return a._depth-b._depth},W=function(){B.hotspotDepths.sort(V);for(var a=0;a<B.hotspotDepths.length;a++)B.hotspotDepths[a]!==h.current&&B.hotspotDepths[a].setDepth(a);h.current&&h.current.setDepth(-1),U=!1};B.prototype._getInView=function(a){return this._viewAngle<v&&this.canvasPos[0]>0&&this.canvasPos[0]<this._canvasWidth&&this.canvasPos[1]>0&&this.canvasPos[1]<this._canvasHeight&&a[2]<=0},B.prototype.setCanvasPos=function(){this.pos&&(x=this._getViewPos(),this._depth=x[2],this.canvasPos=this._getCanvasPos(x),this._viewAngle=this._getViewAngle(),R=this._getInView(x),R!==this.inView&&(this.inView=R,this.setDisplay()),this.element&&(this._setOpacity(),this._setTranslation(),this.hasClass("label")&&h.testLabel(this)),U||(U=!0,b.setTimeout(W,0)),this._positionUpdate.canvasPos=this.canvasPos,i.events.fire("hotspots.positionUpdated",this._positionUpdate))},B.prototype.setObjectShown=function(){var b=i.scene.objects[this.objectId];if(this.objectId&&b){var c=arguments[0];if(a.isObject(c)&&c.enabledObjectsUpdate){var d=c.enabledObjectsUpdate;if(!d.hasOwnProperty(this.objectId))return;P=d[this.objectId]}else P=b.shown;b.isRenderable()||(P=!1),P!==this.objectShown&&(this.objectShown=P,this.setDisplay())}},B.prototype.setShown=function(a){a!==this.shown&&(this.shown=a,this.setDisplay(!0),this.hasClass("canonical")&&h.setCurrent(this.shown?this:null),!this.shown&&this.hasClass("show-hover")&&h.hideLabel(this))},B.prototype._onObjectRenderable=function(a){this.objectId&&this.objectId===a.objectId&&(this.setCanvasPos(),this.setObjectShown())},B.prototype.bindEngineHandlers=function(){
this._boundSetPos=this.setCanvasPos.bind(this),i.events.on("camera.updated",this._boundSetPos),i.events.on("canvas.resized",this._boundSetPos),this._boundSetObjectShown=this.setObjectShown.bind(this),i.events.on("scene.objectsShown",this._boundSetObjectShown),this._boundOnObjectRenderable=this._onObjectRenderable.bind(this),i.events.on("scene.objectRenderable",this._boundOnObjectRenderable)},B.prototype.unbindEngineHandlers=function(){a.isFunction(this._boundSetPos)&&(i.events.off("camera.updated",this._boundSetPos),i.events.off("canvas.resized",this._boundSetPos),this._boundSetPos=void 0),a.isFunction(this._boundSetObjectShown)&&(i.events.off("scene.objectsShown",this._boundSetObjectShown),this._boundSetObjectShown=void 0),a.isFunction(this._boundOnObjectRenderable)&&(i.events.off("scene.objectRenderable",this._boundOnObjectRenderable),this._boundOnObjectRenderable=void 0)},B.prototype._onClick=function(){this.doActions(),i.events.fire("hotspots.picked",this._userUpdate)};var X=b.document.getElementById(i.containerId||i.CONTAINER_ID),Y=function(){h.current&&b.innerWidth>=h.breakPoint&&h.hideLabel(h.current),h.setCurrent(null),X.removeEventListener("touchstart",Y)};return B.prototype._onTouch=function(a){a.preventDefault(),this.hasClass("show-hover")&&(X.removeEventListener("touchstart",Y),b.innerWidth>=h.breakPoint&&(h.current&&h.hideLabel(h.current),h.showLabel(this),h.testLabel(this)),h.setCurrent(this),X.addEventListener("touchstart",Y)),this._onClick()},B.prototype._onEnter=function(){this!==h.current&&this.hasClass("show-hover")&&(h.showLabel(this),h.testLabel(this)),i.events.fire("hotspots.entered",this._userUpdate)},B.prototype._onLeave=function(){this!==h.current&&this.hasClass("show-hover")&&h.hideLabel(this),i.events.fire("hotspots.left",this._userUpdate)},B.prototype.bindDOMHandlers=function(){this._boundOnClick=this._onClick.bind(this),this.element.addEventListener("click",this._boundOnClick),this._boundOnTouch=this._onTouch.bind(this),this.element.addEventListener("touchstart",this._boundOnTouch),this._boundOnEnter=this._onEnter.bind(this),this.element.addEventListener("mouseenter",this._boundOnEnter),this._boundOnLeave=this._onLeave.bind(this),this.element.addEventListener("mouseleave",this._boundOnLeave)},B.prototype.unbindDOMHandlers=function(){a.isFunction(this._boundOnClick)&&(this.element.removeEventListener("click",this._boundOnClick),this._boundOnClick=void 0),a.isFunction(this._boundOnTouch)&&(this.element.removeEventListener("touchstart",this._boundOnTouch),this._boundOnTouch=void 0),a.isFunction(this._boundOnEnter)&&(this.element.removeEventListener("mouseenter",this._boundOnEnter),this._boundOnEnter=void 0),a.isFunction(this._boundOnLeave)&&(this.element.removeEventListener("mouseleave",this._boundOnLeave),this._boundOnLeave=void 0)},B}]),a.module("humanUI.actions",[]).factory("HumanAction",["$window","Human","currentModule",function(b,c,d){var e={},f={},g={currentTime:function(){return c.timeline.time},currentOpacity:function(){var a=b.document.getElementById(c.containerId||c.CONTAINER_ID),d=b.parseFloat(a.style.opacity);return d===d?d:1}},h=function(){var a;for(a in f)f.hasOwnProperty(a)&&delete f[a];for(a in d.data)d.data.hasOwnProperty(a)&&(f[a]=d.data[a]);for(a in g)g.hasOwnProperty(a)&&(f[a]=g[a])};c.events.on("modules.activate.start",function(a){c.modules.activeModules[a.moduleId]||h()}),c.events.on("timeline.chapters.activated",function(a){f.currentChapter=f.chapters?f.chapters[a.newChapterIndex]:null});var i={baseContext:f,define:function(b,c,d,g){var h={fn:c||a.noop,context:d||f,metaData:g||{}};a.isArray(b)||(b=[b]);for(var i=0;i<b.length;i++)e[b[i]]=h},getNames:function(){return Object.keys(e)},getFunction:function(a){var b=e[a];return b?b.fn:void 0},getContext:function(a){var b=e[a];return b?b.context:void 0},getMetaData:function(a){var b=e[a];return b?b.metaData:void 0}};return i}]).factory("HumanActions",["$window","$timeout","Human","HumanAction","HumanParser",function(b,c,d,e,f){var g=/Async$/,h={asyncActions:!1},i={start:[],finish:[]},j={},k={},l=0,m=function(a){j[a]=!0},n=function(a){delete j[a]},o=function(b,d,i){var k;if(j.hasOwnProperty(this.id)||(k=p.bind(null,i,this.id,this.parentId,-1)),0===b.length&&(n(this.id),k=p.bind(null,i,this.id,this.parentId,0)),k)return void(h.asyncActions?c(k,0):k());var l=b.shift().split(":"),m=l.shift(),q=l,r=o.bind(this,b,d,i);h.asyncActions&&(r=c.bind(null,r,0));var s=!1;g.test(m)&&(m=m.replace(g,""),s=!0);var t=e.getFunction(m);if(t){for(var u=e.getContext(m),v=a.extend({},u,d),w=0;w<q.length;w++)q[w]=f.parse(q[w])(v);var x=s?a.noop:r,y={id:this.id,instruction:m,callback:x};t.apply(y,q),s&&r()}else r()},p=function(a,b,c,d){for(var e={id:b,parentId:c,code:d},f=0;f<i.finish.length;f++)i.finish[f](e);a(e)},q=function(b){b=Array.prototype.slice.call(b);var c,d=b.shift(),e={},f=a.noop;return a.isNumber(b[b.length-1])&&(c=b.pop()),2===b.length?(e=b[0],f=b[1]):1===b.length&&(a.isFunction(b[0])?f=b[0]:e=b[0]),[d,e,f,c]},r={JOIN_CHARACTER:"|",config:h,callbacks:i,currentMetaData:k,registerMetaData:function(a){var b;for(b in k)k.hasOwnProperty(b)&&delete k[b];for(b in a)a.hasOwnProperty(b)&&(k[b]=a[b])},parse:function(){var b=q(arguments),d=b[0],e=b[1],f=b[2],g=b[3],j={};a.isString(d)?d=d.split(this.JOIN_CHARACTER):a.isArray(d)?d=d.slice(0):a.isObject(d)&&d.actions&&(a.extend(j,d),delete j.actions,d=d.actions.slice(0)),this.registerMetaData(j),l++,m(l);var k=function(){for(var a={id:l,parentId:g},b=0;b<i.start.length;b++)i.start[b](a);o.call(a,d,e,f)};h.asyncActions?c(k,0):k()},stop:function(a){if(a)n(a);else for(a in j)j.hasOwnProperty(a)&&n(a)}};return b.document.addEventListener("click",function(a){var b=a.target.getAttribute("actions-src");if(b){var c=f.parse(b)(e.baseContext);r.parse(c)}}),r}]),a.module("humanUI.actions").run(["$window","Human","HumanBackground","HumanAction","HumanActions","Hotspot","HotspotData","Media","Info","doTween",function(b,c,d,e,f,g,h,i,j,k){var l,m=e.baseContext,n=function(a){var b=m.chapters.indexOf(a),d=c.timeline.activeRoot._chapters[b];return d},o=function(a,b){var d=c.view.annotations.annotations,e=m.chapters[a].annotations.indexOf(b),f=new RegExp(a+"\\."+e+"$");for(var g in d)if(d.hasOwnProperty(g)&&f.test(g))return d[g]},p=function(d,e,f){var h=b.document.getElementById(c.containerId||c.CONTAINER_ID);a.isFunction(d)&&(d=d()),a.isFunction(e)&&(e=e());var i=function(a){h.style.opacity=a[0],g.parentElement.style.opacity=a[0]};k(d,e,1e3*f,i,this.callback)};l={arity:3},e.define(["tweenOpacity"],p,m,l);var q=function(a,b,c){var e=[function(a){d.setColors(a)},function(a){d.setColorStops(a)}],f=e[r.indexOf(this.instruction)];k(a,b,1e3*c,f,this.callback)},r=["tweenBackgroundColors","tweenBackgroundColorStops"];l={arity:3},e.define(r,q,m,l);var s=function(a){var c,d,e=1e3*a,f=this.callback,g=function(a){c||(c=a),d=a-c,b.Math.round(d)<e?b.requestAnimationFrame(g):f()};b.requestAnimationFrame(g)};l={arity:1},e.define(["wait"],s,m,l);var t=function(b){var d="showObjects"===this.instruction,e={};a.isArray(b)||(b=[b]);for(var f=0;f<b.length;f++)e[b[f]]=d;c.scene.setEnabledObjects({objects:e}),this.callback()};l={arity:1},e.define(["hideObjects","showObjects"],t,m,l);var u=function(b,d){a.isDefined(d)&&(b.animationDuration=d),c.view.camera.fly[this.instruction](b,this.callback)};l={arity:[1,2]},e.define(["flyTo","jumpTo"],u,m,l);var v=function(b,d){var e=this.instruction.replace(/Object$/,""),f={objectId:b};a.isDefined(d)&&(f.animationDuration=d),c.view.camera.fly[e](f,this.callback)};l={arity:[1,2]},e.define(["flyToObject","jumpToObject"],v,m,l);var w=function(){var b=Array.prototype.slice.call(arguments),d=b[0],e=b[1],f={};f.loop="loop"===this.instruction;var g=!a.isDefined(d)&&!a.isDefined(e),h=a.isDefined(d)&&!a.isDefined(e),i=a.isDefined(d)&&a.isDefined(e);g?f.startTime=c.timeline.time:h?a.isFunction(d)?f.startTime=d():a.isNumber(d)?f.startTime=d:a.isObject(d)&&(f.startChapterId=n(d).id,f.numChapters=1):i&&(a.isFunction(d)?f.startTime=d():a.isNumber(d)?f.startTime=d:a.isObject(d)&&(f.startChapterId=n(d).id),a.isFunction(e)?f.finishTime=e():a.isNumber(e)?f.finishTime=e:a.isObject(e)&&(f.finishChapterId=n(e).id),(a.isNumber(d)||a.isNumber(e))&&(f.align=!1)),f.loop||c.events.once("timeline.stopped",this.callback.bind(this)),c.timeline.play(f),f.loop&&this.callback()};l={arity:[0,2]},e.define(["play","loop"],w,m,l);var x=function(b){var d={};a.isNumber(b)?d.time=b:a.isObject(b)&&(d.chapterId=n(b).id),c.timeline.scrub(d),this.callback()};l={arity:1},e.define(["scrub"],x,m,l);var y=function(){c.timeline.stop(),this.callback()};l={arity:0},e.define(["stop"],y,m,l);var z=function(){var a,b=Array.prototype.slice.call(arguments);if(0===b.length)for(var d in c.view.annotations.annotations)c.view.annotations.annotations.hasOwnProperty(d)&&(a=c.view.annotations.annotations[d],a.setShown("showAnnotations"===this.instruction));else for(var e=c.timeline.activeRoot._nowBranch,f=c.timeline.activeRoot._chapters.indexOf(e),g=0;g<b.length;g++)a=o(f,b[g]),a&&a.setShown("showAnnotations"===this.instruction);this.callback()};l={arity:[1,1/0]},e.define(["hideAnnotations","showAnnotations"],z,m,l);var A=function(){var a,b,c,d,e=Array.prototype.slice.call(arguments);if(0===e.length)for(a=0;a<g.hotspots.length;a++)b=g.hotspots[a],"resetHotspots"===this.instruction?(c=h.all[b.id],d=c.hasOwnProperty("shown")?c.shown:!0,b.setShown(d)):b.setShown("showHotspots"===this.instruction);else for(a=0;a<e.length;a++)b=g.get(e[a].id),b&&("resetHotspots"===this.instruction?(c=h.all[b.id],d=c.hasOwnProperty("shown")?c.shown:!0,b.setShown(d)):b.setShown("showHotspots"===this.instruction));this.callback()};l={arity:[1,1/0]},e.define(["hideHotspots","showHotspots","resetHotspots"],A,m,l);var B=function(a){f.parse(a,{},this.callback,this.id)};l={arity:1},e.define(["doActions"],B,m,l);var C=function(a){var b=this.callback,c=function(){i.audioEl.removeEventListener("ended",c),b()};i.audioEl.addEventListener("ended",c),i.audioEl.src=a};l={arity:1},e.define(["playAudio"],C,m,l);var D=function(){i.audioEl.readyState>0&&i.audioEl.pause(),this.callback()};l={arity:0},e.define(["pauseAudio"],D,m,l);var E=function(a){j.setTitle(a),this.callback()};l={arity:1},e.define(["setInfoTitle"],E,m,l);var F=function(a){j.setDescription(a),this.callback()};l={arity:1},e.define(["setInfoDescription"],F,m,l)}]),a.module("humanUI.actions").factory("HumanActionsTour",["$window","HumanActions","HumanParser","currentModule",function(b,c,d,e){var f,g,h={config:{automateWait:0},data:{tourData:{},firstBranchIndex:null,lastBranchIndex:null},state:{actions:[],index:null,isBeginning:!1,isEnd:!1,title:null,lock:!1,branchIndex:null},callbacks:{actions:[],index:[],title:[],lock:[],automate:[]}},i=h.state,j=!1,k=function(a){i.actions=a,h.callbacks.actions.forEach(function(a){a(i.actions)})},l=function(a){i.index=a,i.index<0&&(i.index=0),i.index>=i.actions.length&&(i.index=i.actions.length-1),o(),p(),h.callbacks.index.forEach(function(a){a(i)})},m=function(a){i.title=a.title?a.title:a.titleSrc?d.parse(a.titleSrc)(e.data):null,h.callbacks.title.forEach(function(a){a(i)})},n=function(a){i.lock=a,h.callbacks.lock.forEach(function(a){a(i)})},o=function(){return i.isBeginning=i.index<=0&&i.branchIndex===h.data.firstBranchIndex,i.isBeginning},p=function(){return i.isEnd=i.index>=i.actions.length-1&&i.branchIndex===h.data.lastBranchIndex,i.isEnd};return h.setAutomate=function(a){j=!!a,j?h.next():(b.clearTimeout(f),f=void 0),h.callbacks.automate.forEach(function(a){a(j)})},h.getAutomate=function(){return j},c.callbacks.start.push(function(d){var e=c.currentMetaData;a.isNumber(e.__index)&&(l(e.__index),m(e),n(!!e.lock),g=d.id,a.isDefined(f)&&(b.clearTimeout(f),f=void 0))}),c.callbacks.finish.push(function(a){if(n(!1),a.id===g&&0===a.code&&j){var c=h.next.bind(h),d=h.config.automateWait;f=b.setTimeout(c,d)}}),h.next=function(b){if(b=b||a.noop,!i.isEnd){var d=i.actions[i.index+1];d&&(c.stop(),c.parse(d,b))}},h.prev=function(b){if(b=b||a.noop,!i.isBeginning){var d=i.actions[i.index-1];d&&(c.stop(),c.parse(d,b))}},Human.events.on("modules.activate.start",function(){for(var b=e.data,c=0;c<b.chapters.length;c++){var f=b.chapters[c],g={};if(f.ui&&f.ui.actionsTour){var i=f.ui.actionsTour.dataSrc;g.actions=d.parse(i)(e.data),g.initParse=f.ui.actionsTour.initParse||!1,g.initIndex=f.ui.actionsTour.initIndex||0}if(g.actions&&g.actions.length){a.isNumber(h.data.firstBranchIndex)||(h.data.firstBranchIndex=c),h.data.lastBranchIndex=c;for(var j=0;j<g.actions.length;j++)g.actions[j].__index=j;h.data.tourData[c.toString()]=g}}}),Human.events.on("timeline.chapters.activated",function(a){var b=a.newChapterIndex;i.branchIndex=b;var d=h.data.tourData[b.toString()];d?(k(d.actions),d.initParse?c.parse(i.actions[d.initIndex]):l(d.initIndex)):k([])}),h}]).directive("humanActionsTour",["HumanActionsTour",function(a){return{restrict:"E",scope:!0,link:function(b){a.callbacks.actions.push(function(a){b.show=a&&a.length>0,b.$applyAsync()})}}}]).directive("actionsTourReset",["Human","HumanActionsTour",function(a,b){return{restrict:"A",scope:!0,link:function(c,d){b.callbacks.index.push(function(a){d[a.isEnd?"addClass":"removeClass"]("is-end")}),d.on("click",function(){var c=b.data.firstBranchIndex,d=a.timeline.activeRoot._chapters[c].id;a.timeline.scrub({chapterId:d})})}}}]).directive("actionsTourAutomate",["HumanActionsTour",function(a){return{restrict:"A",scope:!0,link:function(b,c){a.callbacks.automate.push(function(a){c[a?"addClass":"removeClass"]("automating")}),a.callbacks.index.push(function(a){c[a.isEnd?"addClass":"removeClass"]("is-end")}),c.on("click",function(){var b=a.getAutomate();a.setAutomate(!b)})}}}]).directive("actionsTourPrev",["HumanActionsTour",function(a){return{restrict:"A",scope:!0,link:function(b,c){var d=function(a){var b=a.lock||a.isBeginning?"addClass":"removeClass";c[b]("disabled")};a.callbacks.index.push(d),a.callbacks.lock.push(d),c.on("click",function(){a.prev()})}}}]).directive("actionsTourNext",["HumanActionsTour",function(a){return{restrict:"A",scope:!0,link:function(b,c){var d=function(a){var b=a.lock||a.isEnd?"addClass":"removeClass";c[b]("disabled")};a.callbacks.index.push(d),a.callbacks.lock.push(d),c.on("click",function(){a.next()})}}}]).directive("actionsTourTitle",["HumanActionsTour",function(a){return{restrict:"A",scope:!0,link:function(b,c){a.callbacks.title.push(function(a){c[0].innerHTML=a.title||"",c[a.title?"addClass":"removeClass"]("has-title")})}}}]),a.module("humanUI.annotations",[]).directive("humanAnnotations",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/annotations/panel.html",link:function(b){b.info="Toggle Annotations",b.config={model:a.view.annotations.shown,on:function(){a.view.annotations.setShown(!0)},off:function(){a.view.annotations.setShown(!1)}},a.events.on("annotations.shown",function(){b.config.model=a.view.annotations.shown}),a.events.on("timeline.chapters.activated",function(){b.config.model=a.view.annotations.shown}),b.$watch("uiComponents.config.annotations",function(a){b.show=!!a})}}}]),a.module("humanUI.background",[]).factory("HumanBackground",["$window",function(a){return a.HumanBackground||a.console.warn("HumanBackground not found."),a.HumanBackground||{}}]),a.module("humanUI.bookmark",[]).constant("THUMBNAIL_URL","thumbnails/bookmarks?eid").filter("BookmarkTour",["THUMBNAIL_URL",function(b){return function(c){var d=c.tour;return delete c.tour,d.unshift(c),a.forEach(d,function(a){a.tourMember=!0,a.thumbnailSrc=[b,a.eid].join("=")}),d}}]).constant("BOOKMARK_TOUR_BASE_STATE",{isTour:!1,isTourMember:!1,restoring:!1,captures:[],curCapture:null,curCaptureIndex:null}).provider("BookmarkTour",["BOOKMARK_TOUR_BASE_STATE",function(b){var c={compare:!1},d=a.extend({},b),e={newModules:null,oldModules:null},f=function(f,g,h,i,j){var k,l,m,n={},o=function(b){a.forEach(b,function(a){j.modules.isBaseModule(a)&&(l=a.split("/"),m=l[l.length-1].replace(/\.json$/,""),n[m]||j.assets.server.cacheStateIndex(m))})},p=function(b){k=[],a.forEach(b,function(b){o(b.modules.activeModules),k.push(a.copy(b.modules.activeModules))})},q=function(a){d.curCapture=d.captures[a]||null,d.curCaptureIndex=d.curCapture?a:null},r=function(){var b=Object.keys(j.modules.activeModules);a.forEach(b,function(a){j.modules.deactivate(a,{},function(){if(!j.modules.isBaseModule(a)){var b=j.modules.modules[a].rootObjects,c=["tweens","reflections","audio","videos","lights","skyBoxes","geometries","materials","transforms","morph"];j.modules.unload(a,b,c,function(){j.modules.destroy(a)})}})})},s=function(){a.equals(e.oldModules,e.newModules)||j.modules.deactivateModules()},t=function(a){e.oldModules=e.newModules,e.newModules=k[a],c.compare?s():r()};return d.reset=function(){a.extend(d,b)},d.restore=function(b,c){var e=d.captures[b];e&&(d.restoring=!0,q(b),h(function(){t(b),j.bookmarks.restore(e,function(){a.isFunction(c)&&c()})}))},d.onRestored=function(){d.isTour||d.isTourMember||(d.captures=[])},j.events.on("bookmarks.restored",function(b){d.restoring=!1,d.isTour=!(!b.tour||!b.tour.length),d.isTourMember=!!b.tourMember,d.isTour&&(d.captures=g("BookmarkTour")(b),p(d.captures),q(0));var c=a.isArray(d.captures)&&!!d.captures.length;d.bookmarkTour=(d.isTour||d.isTourMember)&&c,d.onRestored(b),f.$broadcast("bookmarkTour.state",d)}),{state:d}};return f.$inject=["$rootScope","$filter","$timeout","$q","Human"],{$get:f,config:function(b){a.extend(c,b)},extend:function(b){a.extend(d,b)}}}]).directive("updateScroll",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e,f,g,h,i=d.updateScroll,j=function(b){a(function(){e=c[0].offsetWidth,f=c[0].scrollWidth,f>e&&(g=f/c.children().length,h=f-e,c[0].scrollLeft=g*(b+1)-h)})};b.$watch(i,j)}}}]).directive("prevNextBookmark",["Human","BookmarkTour",function(a,b){return{restrict:"A",link:function(a,c,d){var e,f="next"===d.prevNextBookmark?1:-1;a.state=b.state,c.on("click",function(){e||b.state.restore(a.state.curCaptureIndex+f)});var g={expressions:["state.curCaptureIndex","state.captures.length"],callback:function(a){e=!!(1===f&&a[0]===a[1]-1||-1===f&&0===a[0]),c[e?"addClass":"removeClass"]("disabled")}};a.$watchGroup(g.expressions,g.callback)}}}]).directive("humanBookmarkTour",["$timeout","$document","Human","BookmarkTour",function(a,b,c,d){return{restrict:"E",templateUrl:"templates/bookmark/tour.html",scope:!0,link:function(a){a.show=!1;var b,c,e=function(){a.show=b&&c};a.restore=function(a){d.state.restore(a)},a.reset=function(){d.state.reset()},a.$on("bookmarkTour.state",function(a,b){c=b.bookmarkTour,e()}),a.$watch("uiComponents.config.bookmarkTour",function(a){b=!!a,e()})}}}]),a.module("humanUI.camera",[]).factory("HumanCamera",["$window","Human",function(a,b){var c,d=new Float64Array(3),e=new Float64Array(3),f=new Float64Array(3),g=function(a,b){b[0]=a.x,b[1]=a.y,b[2]=a.z},h=null,i=null,j=!1;b.events.on("bookmarks.restored",function(a){a.camera&&(i=a.camera),j=!0});var k=function(){j&&(i=null,j=!1)};return b.events.on("modules.deactivate.finish",k),b.events.on("modules.destroy.finish",k),{getCenterCamera:function(){return h||i},setCenterCamera:function(a){h=a},getPanRate:function(){return g(b.view.camera.getEye(),d),g(b.view.camera.getLook(),e),a.vec3?(a.vec3.sub(f,d,e),c=a.vec3.length(f)):(b.math.subVec3(d,e,f),c=b.math.lenVec3(f)),.12*c}}}]).directive("centerCamera",["Human","HumanCamera",function(a,b){return{restrict:"A",link:function(c,d){d.on("click",function(){var c=b.getCenterCamera();c?a.view.camera.fly.flyTo(c):a.init.resetCamera()})}}}]).directive("humanCameraCenter",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/center.html",link:function(a){a.$watch("uiComponents.config.center",function(b){a.show=!!b})}}}).directive("panCamera",["$interval","Human","HumanCamera","touchTarget","destroyInterval",function(b,c,d,e,f){var g={interval:10},h="touchstart mousedown",i="touchend touchcancel mouseleave mouseup";return{restrict:"A",link:function(j,k,l){var m,n,o,p,q,r=l.panCamera||"up",s=function(){p=g.interval/1e3*d.getPanRate(),q=b(function(){switch(m=0,n=0,o=0,r){case"up":n=-p;break;case"down":n=p;break;case"left":m=-p;break;case"right":m=p}c.view.camera.pan({x:m,y:n,z:o})},g.interval)};e(k[0],function(a){k[0]!==a&&f(q)}),a.forEach(h.split(" "),function(a){k.on(a,function(a){a.preventDefault(),s()})}),a.forEach(i.split(" "),function(a){k.on(a,function(){f(q)})})}}}]).directive("humanCameraPan",function(){var a={up:"W",down:"S",left:"D",right:"A"};return{restrict:"E",scope:!0,templateUrl:"templates/camera/pan.html",link:function(b){b.keys=a,b.$watch("uiComponents.config.pan",function(a){b.show=!!a})}}}).directive("zoomCamera",["Human","touchTarget",function(b,c){var d,e="touchstart mousedown",f="touchend touchcancel mouseleave mouseup",g=.3,h=.001,i=0,j=!1;return b.events.on("tick",function(){return 0!==i?(j&&(i=g*d),i*=b.input.cameraFriction||.85,Math.abs(i)<h?void(i=0):void b.view.camera.zoom(i)):void 0}),{restrict:"A",link:function(b,h,k){var l="out"===k.zoomCamera?1:-1;c(h[0],function(a){h[0]!==a&&(j=!1)}),a.forEach(e.split(" "),function(a){h.on(a,function(a){a.preventDefault(),d=l,i=g*d,j=!0})}),a.forEach(f.split(" "),function(a){h.on(a,function(){j=!1})})}}}]).directive("humanCameraZoomIn",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/zoom-in.html",link:function(a){a.$watch("uiComponents.config.zoomIn",function(b){a.show=!!b})}}}).directive("humanCameraZoomOut",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/zoom-out.html",link:function(a){a.$watch("uiComponents.config.zoomOut",function(b){a.show=!!b})}}}).directive("humanCameraZoom",function(){return{restrict:"E",scope:!0,templateUrl:"templates/camera/zoom.html",link:function(a){var b=["uiComponents.config.zoomOut","uiComponents.config.zoomIn"];a.$watchGroup(b,function(b){a.show=!!b[0]&&!!b[1]})}}}).directive("setCameraMode",["Human",function(a){return{restrict:"A",link:function(b,c){var d={};c.on("click",function(){"pan"===a.properties.properties["input.mouseOrbitPan"]?(d["input.mouseOrbitPan"]="orbit",d["input.touchOrbitPan"]="orbit"):(d["input.mouseOrbitPan"]="pan",d["input.touchOrbitPan"]="pan"),a.properties.set(d)})}}}]).directive("humanCameraMode",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/camera/mode.html",link:function(b,c){var d=function(a){c.attr("mode",b.mode=a)},e=a.properties.subscribe({propId:"input.mouseOrbitPan",callback:d});a.properties.resubscribe(e,"input.mouseOrbitPan"),e=a.properties.subscribe({propId:"input.touchOrbitPan",callback:d}),a.properties.resubscribe(e,"input.touchOrbitPan"),b.$watch("uiComponents.config.cameraMode",function(a){b.show=!!a})}}}]),a.module("humanUI.config",[]).constant("BASE_CONFIG",{bookmarkTour:!1,annotations:!1,audio:!1,info:!1,loadProgress:!0,fullscreen:!0,pan:!0,zoomIn:!0,zoomOut:!0,center:!0,cameraMode:!0,objectTree:!1,objectSlider:!1,playPause:!1,scrubber:!1,tour:!1,crossSection:!1,dissect:!1,isolate:!1,xray:!1,actionsTour:!1}).constant("CONFIG_GROUPS",{nav:["pan","zoomIn","zoomOut","center","cameraMode"],zoom:["zoomIn","zoomOut"],scene:["objectTree","objectSlider"],tools:["crossSection","dissect","isolate","xray"],modes:["isolate","xray"]}).constant("CONFIG_ALIASES",{loader:"loadProgress",panel:"info",tree:"objectTree",fs:"fullscreen",slider:"objectSlider"}).constant("EXPANDABLE_UI_COMPONENTS",{components:{scrubber:{chapters:!1,tour:!1},tour:{chapters:!1},playPause:{tour:!1},objectSlider:{objects:!1}},notes:{"scrubber.chapters":"Display chapters for scrubber","scrubber.tour":"Play one chapter at a time","tour.chapters":"Display chapters for tours","playPause.tour":"Play one chapter at a time","objectSlider.objects":"Display objects for objectSlider"}}).filter("convertDotKeys",function(){return function(b){for(var c in b)if(b.hasOwnProperty(c)&&/\./.test(c)){var d=c.split(".");a.isObject(b[d[0]])||(b[d[0]]={}),b[d[0]][d[1]]=b[c],delete b[c]}return b}}).filter("convertTags",function(){return function(b,c){return a.isArray(c)&&c.length>0&&(c.has=function(a){return this.indexOf(a)>-1},c.has("scrubber")||c.has("scrubber-chapters")?(b.scrubber=!0,c.has("scrubber-chapters")&&(b.scrubber={chapters:!0},c.has("tour")&&(b.scrubber.tour=!0))):(c.has("play-controls")&&(b.playPause=!0),c.has("tour")&&(b.tour=!0)),delete c.has),b}}).filter("extendConfig",["BASE_CONFIG","CONFIG_ALIASES","CONFIG_GROUPS",function(b,c,d){return function(e,f){return f.hasOwnProperty("all")?a.forEach(b,function(a,b){e[b]=f.all}):(a.forEach(d,function(b,c){f.hasOwnProperty(c)&&a.forEach(b,function(a){e[a]=f[c]})}),a.extend(e,f),a.forEach(d,function(a,b){e.hasOwnProperty(b)&&delete e[b]}),a.forEach(c,function(a,b){e.hasOwnProperty(b)&&(e[a]=e[b],delete e[b])})),e}}]).filter("convertUiParams",["CONFIG_ALIASES","convertDotKeysFilter",function(b,c){var d=/^ui-/,e=function(a){return"true"===a?!0:"false"===a||""===a?!1:a};return function(f){var g={};return a.forEach(f,function(a,c){(d.test(c)||b.hasOwnProperty(c))&&(c=c.replace(d,"").replace(/-([a-z])/g,function(a){return a[1].toUpperCase()}),g[c]=e(a))}),c(g),g}}]).provider("ConfigCreator",function(){var b=function(b,c,d,e,f,g){var h=d("extendConfig"),i=d("convertTags"),j=d("convertUiParams"),k=d("convertDotKeys"),l=function(){var a={},c=b.location.search.slice(1);c=c.replace(/&amp;/g,"&");for(var d,e=c.split("&"),f=0;f<e.length;f++)d=e[f].split("="),a[d[0]]=d[1];return a};return{config:{},urlConfig:j(l()),bookmarkConfig:{},contentConfig:{},applicationConfig:{},init:function(){var a=this;c.uiComponents={config:this.config},f.events.on("timeline.chapters.activated",function(b){var c=b.newChapterIndex;a._buildContentConfig(g.data,c),a._extend(),a._apply()});var b=!1;c.$on("bookmarkTour.state",function(c,d){d.bookmarkTour!==b&&(b=d.bookmarkTour,a.bookmarkConfig.bookmarkTour=d.bookmarkTour,a._extend(),a._apply())})},_buildContentConfig:function(b,c){var d=i({},b.tags);h(d,b.ui||{}),a.isNumber(c)&&b.chapters&&h(d,b.chapters[c].ui||{}),d.hasOwnProperty("data")&&delete d.data,this.contentConfig=d},_buildApplicationConfig:function(a){a=k(a||{}),h(this.applicationConfig,a)},_extend:function(){for(var b=a.extend({},e),c=[this.contentConfig,this.bookmarkConfig],d=0;d<c.length;d++)h(b,c[d]);return h(b,this.urlConfig),h(b,this.applicationConfig),this.config=b,this.config},_apply:function(){c.uiComponents.config=this.config,c.$applyAsync()}}};return b.$inject=["$window","$rootScope","$filter","BASE_CONFIG","Human","currentModule"],{$get:b}}),a.module("humanUI.crossSection",[]).factory("Clip",["Human",function(b){return{MAP:[{view:"Anterior",clip:b.view.clip.FRONT},{view:"Posterior",clip:b.view.clip.BACK},{view:"Left",clip:b.view.clip.LEFT},{view:"Right",clip:b.view.clip.RIGHT},{view:"Superior",clip:b.view.clip.TOP},{view:"Inferior",clip:b.view.clip.BOTTOM}],state:{current:null},show:function(a){b.view.clip.setClip({state:"clipping"}),b.view.clip.selectClip(a),b.view.clip.setClip({state:"visible"})},reset:function(){a.forEach(b.view.clip.clips,function(a){a.progress=0}),b.view.clip.reset(),this.state.current=this.MAP[0],this.show(this.state.current.clip)}}}]).directive("humanCameraClip",["$window","Human",function(a,b){var c,d=a.vec3&&a.vec3.create||b.math.vec3,e=d(),f=d(),g=d(),h=b.view.camera,i=h.near,j=function(){return e[0]=h.eye.x,e[1]=h.eye.y,e[2]=h.eye.z,f[0]=h.look.x,f[1]=h.look.y,f[2]=h.look.z,a.vec3?(a.vec3.sub(g,e,f),c=a.vec3.length(g)):(b.math.subVec3(e,f,g),c=b.math.lenVec3(g)),a.Math.abs(c)},k=function(){b.properties.set({"camera.optics.near":.75*j()})};return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/camera-clip.html",link:function(a){a.config={on:function(){b.events.on("camera.updated",k),k()},off:function(){b.events.off("camera.updated",k),b.properties.set({"camera.optics.near":i})}}}}}]).directive("cycleSectionPlane",["Clip",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){var c=a.state.current?a.MAP.indexOf(a.state.current):0;c=c===a.MAP.length-1?0:c+1,a.state.current=a.MAP[c],a.show(a.state.current.clip),b.$digest()})}}}]).directive("resetSectionPlane",["Clip",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.reset(),b.$digest()})}}}]).directive("humanCrossSectionSlider",["Human","HumanSlider",function(a,b){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/slider.html",link:function(c,d){var e=b.create({element:d.find("human-slider")[0],onMove:function(b){a.view.clip.setClip({state:"visible",progress:b}),0===b&&a.view.clip.selectedClip._setProgress(0)}});a.events.on("clip.updated",function(a){e.move(a.progress||0)})}}}]).directive("humanCrossSection",["$parse","$timeout","Clip",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/controls.html",link:function(e,f,g){var h=function(a){c(function(){Human.view.clip.setClip({clipId:d.state.current.clipId,state:a?"visible":"clipping"})})};d.state.current=d.MAP[0],e.state=d.state,e.tooltipText={select:"Select Plane",reset:"Reset"},g.tooltipText&&a.extend(e.tooltipText,b(g.tooltipText)({})),f.on("crossSectionToggle",function(a,b){h(b)})}}}]).directive("humanCrossSectionToggle",["$document","Clip","ElementDisplay",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/cross-section/toggle.html",link:function(c,e,f){var g;g=f.hasOwnProperty("target")?a.element(b[0].querySelector(f.target)):e.next(),d.create({trigger:e,target:g,eventName:"crossSectionToggle",globalClose:f.hasOwnProperty("globalClose")}),c.info="Cross Section",c.config={},c.$watch("uiComponents.config.crossSection",function(a){c.show=!!a})}}}]),a.module("humanUI.dissect",[]).directive("undoDissect",["Human",function(a){return{restrict:"A",scope:!0,link:function(b,c){var d=!0;c.addClass("disabled"),c.on("click",function(){d||a.view.dissect.undo()}),a.events.on("dissect.toggled",function(a){d=!a.enabled,c[d?"addClass":"removeClass"]("disabled")})}}}]).directive("humanDissectUndo",function(){return{restrict:"E",scope:!0,templateUrl:"templates/dissect/undo.html",link:function(a){a.info="Undo Dissect [Ctrl + Z]",a.$watch("uiComponents.config.dissect",function(b){a.show=!!b})}}}).directive("humanDissect",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/dissect/dissect.html",link:function(b){var c=function(b){a.rpc.call(null,"dissect.setEnabled",{enable:b})};b.info="Dissect [Ctrl + X]",b.config={model:a.view.dissect.enabled,on:c.bind(null,!0),off:c.bind(null,!1)},a.events.on("dissect.toggled",function(){b.config.model=a.view.dissect.enabled}),b.$watch("uiComponents.config.dissect",function(a){b.show=!!a})}}}]),a.module("humanUI.fullscreen",[]).factory("Fullscreen",["$document","$rootScope",function(b,c){var d,e=b[0],f=e.documentElement,g={request:[f.requestFullscreen,f.webkitRequestFullscreen,f.mozRequestFullScreen,f.msRequestFullscreen],exit:[e.exitFullscreen,e.webkitExitFullscreen,e.mozCancelFullScreen,e.msExitFullscreen]};return{VENDOR_PREFIXES:["","webkit","moz","ms"],setMethods:function(){var b,c={};for(var d in g)if(g.hasOwnProperty(d)){b=g[d];for(var h=0;h<b.length;h++)if(a.isFunction(b[h])){c[d]=b[h];break}if(!c[d])return!1}return this.request=c.request.bind(f),this.exit=c.exit.bind(e),!0},isActive:function(){return d=e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement||void 0,!!d},bindHandlers:function(){var d,f=this;b.on("keypress",function(a){var b=a.target.nodeName.toLowerCase();"input"!==b&&"textarea"!==b&&70===a.which&&a.shiftKey&&f.toggle()}),a.forEach(this.VENDOR_PREFIXES,function(a){var b=a+"fullscreenchange";e.addEventListener(b,function(){d=f.isActive(),c.$broadcast("fullscreen.change",{active:d,fromUI:f._fromUI}),f._fromUI=!1},!1)})},_fromUI:!1,toggle:function(){this._fromUI=!0,this[this.isActive()?"exit":"request"]()}}}]).directive("humanFullscreen",["$window","Fullscreen",function(a,b){var c=a===a.top;return{restrict:"E",scope:!0,templateUrl:"templates/fullscreen/panel.html",link:function(a){a.config={on:b.toggle.bind(b),off:b.toggle.bind(b)},a.$on("fullscreen.change",function(b,c){
a.config.model=c.active,a.mode=c.active?"fullscreen":"normalscreen",a.$digest()}),a.$watch("uiComponents.config.fullscreen",function(b){a.show=c&&!!b})}}}]).directive("windowLink",["$window",function(a){return{restrict:"A",link:function(b,c){c.attr("href",a.location.href)}}}]).directive("humanWindowLink",["$window",function(a){var b=a===a.top;return{restrict:"E",scope:!0,templateUrl:"templates/fullscreen/window-link.html",link:function(a){a.$watch("uiComponents.config.fullscreen",function(c){a.show=!b&&!!c})}}}]).run(["Fullscreen",function(a){var b=a.setMethods();b&&a.bindHandlers()}]),a.module("humanUI.info",[]).run(["Info",function(a){a._instantiated=!0}]).provider("Info",function(){var b={baseAnatomy:!1,modifyLinks:!0,props:["title","displayName","description"],precedence:["bookmark","chapter","module"]},c={info:{bookmark:null,chapter:null,module:null},bookmarkRestoring:!1,current:null,precedence:a.copy(b.precedence),title:"",description:""},d={title:[],description:[]},e=function(e,f){var g=function(a){a=a||"",b.modifyLinks&&(a=e("modifyLinks")(a)),c.title=a,d.title.forEach(function(a){a(c.title)})},h=function(a){a=a||"",b.modifyLinks&&(a=e("modifyLinks")(a)),c.description=a,d.description.forEach(function(a){a(c.description)})},i=function(){for(var d,e=0;e<b.precedence.length;e++)if(d=c.info[b.precedence[e]],a.isObject(d)&&(d.title||d.description))return c.current=b.precedence[e],g(d.title),void h(d.description);c.current=null,g(""),h("")},j=function(d){b.precedence=a.copy(d),c.precedence=d,i()},k=function(a,d){if(!c.info.hasOwnProperty(a)||!d)return null;"chapter"===a&&d.info&&(d=d.info);for(var e={},f=0;f<b.props.length;f++){var g=b.props[f];if(d.hasOwnProperty(g)){var h=d[g];"displayName"===g&&(g="title"),e[g]=h}}c.info[a]=e,i()},l=function(){for(var a in c.info)c.info.hasOwnProperty(a)&&(c.info[a]=null);g(""),h("")};return f.events.on("bookmarks.restoring",function(){c.bookmarkRestoring=!0}),f.events.on("bookmarks.restored",function(a){c.bookmarkRestoring=!1,k("bookmark",a)}),f.events.on("timeline.chapters.activated",function(a){k("chapter",f.timeline.activeRoot._chapters[a.newChapterIndex])}),f.events.on("modules.activate.finish",function(a){var c=f.modules.activeModules[a.moduleId];b.baseAnatomy||(c=e("excludeBaseAnatomy")(c)),k("module",c)}),f.events.on("modules.deactivate.finish",l),{state:c,callbacks:d,setPrecedence:j,setTitle:g,setDescription:h,update:i}};return e.$inject=["$filter","Human"],{$get:e,config:function(c){a.extend(b,c)}}}).filter("modifyLinks",["$document",function(b){var c=b[0];return function(b){var d=c.createElement("div");d.innerHTML=b;var e=d.querySelectorAll("a");return a.forEach(e,function(a){/^(http)|(\/\/)/.test(a.href)&&a.setAttribute("target","_blank")}),d.innerHTML}}]).directive("humanInfo",["$window","$filter","$sce","Info",function(b,c,d,e){return{restrict:"A",scope:!0,link:function(c,f){var g=function(){var b=e.state.title,f=e.state.description;if(!b&&!f||e.state.bookmarkRestoring)c.info=null;else{var g={title:b,description:f};g.description&&(g.description=a.isString(g.description)?d.trustAsHtml(g.description):""),c.info=g}c.$applyAsync()},h=0,i=0,j=function(){var a=f[0].getBoundingClientRect();h=a.left+a.width,i=a.top+a.height},k=function(){i>b.innerHeight?f.addClass("overflow-height"):f.removeClass("overflow-height"),h>b.innerWidth?f.addClass("overflow-width"):f.removeClass("overflow-width")};c.info=null,c.show=!1,e.callbacks.title.push(g),e.callbacks.description.push(g),c.$watch("info",function(d,e){c.show=!!d,a.equals(d,e)||b.setTimeout(function(){j(),k()})}),b.addEventListener("resize",k)}}}]),a.module("humanUI.load",[]).directive("loadProgress",["Human",function(a){return{restrict:"A",link:function(b,c,d){var e,f="bar"===d.loadProgress,g=function(a){f?c[0].style.width=a:c[0].textContent=a};a.events.on("assets.load.start",function(){g("0%")}),a.events.on("assets.load.progress",function(a){e=a.receivedAssets/a.requestedAssets,g(Math.floor(100*e)+"%")}),a.events.on("assets.load.finish",function(){g("100%")})}}}]).directive("loadStatus",["Human",function(a){return{restrict:"A",link:function(b,c){c[0].textContent="Loading...",a.events.on("modules.activate.start",function(b){var d=a.modules.modules[b.moduleId];c[0].textContent="Loading "+d.displayName+"..."}),a.events.on("assets.load.finish",function(){c[0].textContent=""})}}}]),a.module("humanUI.media",[]).constant("AUDIO_TYPES",{ogg:'audio/ogg;codecs="vorbis"',mp3:"audio/mpeg;"}).constant("AUDIO_PATH","/content/states/{{ fullUrl }}").factory("Media",["$document","$interpolate","AUDIO_TYPES","AUDIO_PATH",function(a,b,c,d){var e={},f={},g=a[0].createElement("audio");return a[0].body.appendChild(g),{audioEl:g,audioAutoplay:!0,supportTest:function(b){if(e.hasOwnProperty(b))return e[b];if(!b&&e.hasOwnProperty("audio"))return e.audio;var d=a[0].createElement("audio"),f=!!d.canPlayType;return b?(f=f&&!!d.canPlayType(c[b]||b),e[b]=f):e.audio=f,f},getSupportedSrc:function(a){if(f[a.clipId])return f[a.clipId];var c=b(d)({fullUrl:a.fullUrl}),e=c.match(/\.(\w+)$/);e=e&&e[1];for(var g=[e].concat(a.alternatives||[]),h=0;h<g.length;h++)if(this.supportTest(g[h]))return f[a.clipId]=c.replace(/\.\w+$/,"."+g[h]),f[a.clipId];return!1}}}]).directive("toggleMuteAudio",["Media",function(a){return{restrict:"A",scope:!0,link:function(b,c){var d=a.audioEl;c.on("click",function(){d.muted=!d.muted}),d.addEventListener("volumechange",function(){c[d.muted?"addClass":"removeClass"]("muted"),b.muted=d.muted,b.$digest()})}}}]).directive("muteReplayAudio",function(){return{restrict:"A",scope:!0,link:function(b,c){c.on("click",function(){b[b.states.ended?"replay":"toggleMute"](),b.$digest()}),b.$watch("states",function(b){a.forEach(["ended","muted"],function(a){c[b[a]?"addClass":"removeClass"](a)})},!0)}}}).directive("playPauseAudio",["Media",function(a){return{restrict:"A",scope:!0,link:function(b,c){b.paused=a.audioEl.paused,a.audioEl.paused&&c.addClass("paused"),c.on("click",function(){a.audioEl.paused?(a.audioEl.play(),a.audioAutoplay=!0):(a.audioEl.pause(),a.audioAutoplay=!1)}),a.audioEl.addEventListener("play",function(){c.removeClass("paused"),b.paused=!1,b.$digest()}),a.audioEl.addEventListener("pause",function(){c.addClass("paused"),b.paused=!0,b.$digest()})}}}]).directive("humanAudio",["$q","Human","Media",function(a,b,c){return{restrict:"E",scope:!0,link:function(a){var d=c.audioEl,e=!1,f=!1,g=function(){a.show=e&&f};a.states={ended:!1,muted:!1},a.replay=function(){d.currentTime=0,d.play(),a.states.ended=!1},a.toggleMute=function(){d.muted=!d.muted,a.states.muted=d.muted},d.addEventListener("ended",function(){a.states.ended=!0,a.$digest()}),d.addEventListener("playing",function(){a.states.ended=!1,a.$digest()}),b.events.on("audio.suggestedClipInfo",function(b){d.src=c.getSupportedSrc(b),f=!!d.src,c.audioAutoplay&&d.play()["catch"](function(){c.audioAutoplay=!1}),g(),a.$digest()}),a.$watch("uiComponents.config.audio",function(a){e=!!a,g()})}}}]),a.module("humanUI.modes",[]).run(["$window",function(a){Human.events.on("isolate.noSelection",function(){a.alert("Please select an object before entering Isolate mode.")})}]).directive("humanXray",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/modes/xray.html",link:function(b){b.info="X-Ray Mode [T]",b.config={model:a.view.xray.enabled,on:a.view.setModeEnabled.bind(a.view,"xray"),off:a.view.setModeEnabled.bind(a.view,"highlight")},a.events.on("xray.toggled",function(){b.config.model=a.view.xray.enabled}),b.$watch("uiComponents.config.xray",function(a){b.show=!!a})}}}]).directive("humanIsolate",["Human",function(a){return{restrict:"E",scope:!0,templateUrl:"templates/modes/isolate.html",link:function(b){b.info="Isolate Mode [I]",b.config={model:a.view.isolate.enabled,on:a.view.setModeEnabled.bind(a.view,"isolate"),off:a.view.setModeEnabled.bind(a.view,"highlight")},a.events.on("isolate.toggled",function(){b.config.model=a.view.isolate.enabled}),b.$watch("uiComponents.config.isolate",function(a){b.show=!!a})}}}]),a.module("humanUI.parse",[]).factory("HumanParser",function(){function b(a){var b=c[a];if(b)return b;var d=a.split("."),e="";d.forEach(function(a){e+="if(s == null) return undefined;\ns=s."+a+";\n"}),e+="return s;";var f=new Function("s",e);return f.toString=function(){return e},b=f,c[a]=b,b}var c={},d={},e=function(a){this.lexer=a};e.prototype={parse:function(b){this.text=b,this.tokens=this.lexer.lex(b);var c=a.noop;if(this.tokens.length>0&&(c=this.primary()),0!==this.tokens.length)throw new Error("Unexpected token");return c},primary:function(){var a;if(this.peek().identifier)a=this.identifier();else{if(!this.peek().constant)throw new Error("Not a valid expression");a=this.constant()}for(var b;b=this.expect("[",".");)"["===b.text?a=this.objectIndex(a):"."===b.text&&(a=this.fieldAccess(a));return a},fieldAccess:function(a){var b=this.identifier();return function(c){var d=a(c);return null==d?void 0:b(d)}},objectIndex:function(a){var b=this.primary();return this.consume("]"),function(c){var d=a(c),e=b(c);return d?d[e]:void 0}},identifier:function(){for(var a=this.consume().text;this.peek(".")&&this.peekAhead(1).identifier;)a+=this.consume().text+this.consume().text;return b(a)},constant:function(){function a(){return b}var b=this.consume().value;return a.constant=!0,a.literal=!0,a},consume:function(a){if(0===this.tokens.length)throw new Error("Unexpected end of expression");var b=this.expect(a);if(!b)throw new Error("Unexpected token");return b},expect:function(a,b,c,d){var e=this.peek(a,b,c,d);return e?(this.tokens.shift(),e):!1},peek:function(a,b,c,d){return this.peekAhead(0,a,b,c,d)},peekAhead:function(a,b,c,d,e){if(this.tokens.length>a){var f=this.tokens[a],g=f.text;if(g===b||g===c||g===d||g===e||!b&&!c&&!d&&!e)return f}return!1}};var f=function(){};return f.prototype={lex:function(a){for(this.text=a,this.index=0,this.tokens=[];this.index<this.text.length;){var b=this.text.charAt(this.index);this.isNumber(b)||"."===b&&this.isNumber(this.peek())?this.readNumber():this.isValidIdentifierStart(this.peekMultichar())?this.readIdentifier():this.is(b,"[].")?(this.tokens.push({index:this.index,text:b}),this.index++):this.index++}return this.tokens},is:function(a,b){return-1!==b.indexOf(a)},peek:function(a){var b=a||1;return this.index+b<this.text.length?this.text.charAt(this.index+b):!1},peekMultichar:function(){var a=this.text.charAt(this.index),b=this.peek();if(!b)return a;var c=a.charCodeAt(0),d=b.charCodeAt(0);return c>=55296&&56319>=c&&d>=56320&&57343>=d?a+b:a},isNumber:function(a){return a>="0"&&"9">=a&&"string"==typeof a},isValidIdentifierStart:function(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a||"_"===a||"$"===a},isValidIdentifierContinue:function(a){return this.isValidIdentifierStart(a)||this.isNumber(a)},readNumber:function(){for(var a="",b=this.index;this.index<this.text.length;){var c=this.text.charAt(this.index).toLowerCase();if("."!==c&&!this.isNumber(c))break;a+=c,this.index++}this.tokens.push({index:b,text:a,constant:!0,value:Number(a)})},readIdentifier:function(){var a=this.index;for(this.index+=this.peekMultichar().length;this.index<this.text.length;){var b=this.peekMultichar();if(!this.isValidIdentifierContinue(b))break;this.index+=b.length}this.tokens.push({index:a,text:this.text.slice(a,this.index),identifier:!0})}},{Lexer:f,parse:function(a){var b,c=a=a.trim();if(b=d[c],!b){var g=new f,h=new e(g);b=h.parse(a),d[c]=b}return b}}}),a.module("humanUI.rpc",[]).factory("RpcDefinitions",["$document","$filter","ConfigCreator","Human","HumanSnapshot","HumanBackground","HotspotData","Hotspot","HOTSPOT_TYPES",function(b,c,d,e,f,g,h,i,j){return{init:function(){var k=b[0].querySelector("[rpc-styles]");e.rpc.define("injectStyles",function(a){k&&(k.styleSheet?k.styleSheet.cssText=a:k.appendChild(b[0].createTextNode(a)),e.view.annotations.updateDimensions(),e.view.annotations.layouts.redrawLayout())},{hidden:!0});var l=["bookmarkTour","loadProgress"];e.rpc.define("ui.getDisplay",function(){var b={};a.forEach(d.config,function(a,c){-1===l.indexOf(c)&&(b[c]=a)}),this.setResult(b)}),e.rpc.define("ui.setDisplay",function(a){d._buildApplicationConfig(a),d._extend(),d._apply()});var m=function(a){var b=this;f.get(a,function(a){b.setResult(a.src)})};e.rpc.define("snapshot.get",m,{hidden:!0}),e.rpc.define("scene.snapshot",m,{hidden:!0}),e.rpc.define("ui.snapshot",m),e.rpc.define("ui.getBackground",function(){var a=g.getBackgroundData(),b={colors:[a.colors[0][255],a.colors[1][255]],colorStops:[a.colors[0].stop,a.colors[1].stop],gradientType:a.gradientType};this.setResult(b)}),e.rpc.define("ui.setBackground",function(a){a.hasOwnProperty("colors")&&g.setColors(a.colors),a.hasOwnProperty("colorStops")&&g.setColorStops(a.colorStops),a.hasOwnProperty("gradientType")&&g.setGradientType(a.gradientType)}),e.rpc.define("ui.getWorldPosition",function(a){var b=a.x,c=a.y,d=e.renderer.pick(b,c,!0);if(d){var f=Array.prototype.slice.call(d.worldPos);d=n(f,"object")}else d=null;this.setResult(d)});var n=c("formatPosition"),o={position:function(a,b){a.pos=n(b,"array")},direction:function(a,b){a.dir=n(b,"array")},chapterScope:function(a,b){a.chapterScope=b},shown:function(a,b){a.shown=b},type:function(a,b){a.type=b},title:function(a,b){a.title=b},objectId:function(a,b){a.objectId=b},data:function(a,b){a.data=b}},p={id:function(a,b){a.id=b},pos:function(a,b){a.position=n(b,"object")},dir:function(a,b){a.direction=n(b,"object")},canvasPos:function(a,b){a.canvasPosition=n(b,"object")},chapterScope:function(a,b){a.chapterScope=b},shown:function(a,b){a.shown=b},type:function(a,b){a.type=b},title:function(a,b){a.title=b},objectId:function(a,b){a.objectId=b},data:function(a,b){a.data=b}},q=function(a,b){var c={};for(var d in b)b.hasOwnProperty(d)&&a.hasOwnProperty(d)&&b[d](c,a[d]);return c};e.rpc.define("hotspots.create",function(b){b=q(b,o),h.add(b);var c=h.getCurrentId()-1,d=e.timeline.activeRoot._chapters,f=e.timeline.activeRoot._nowBranch,g=d.indexOf(f);if(!a.isDefined(b.chapterScope)||b.chapterScope===g){var j=i.create(h.all[c]);j.template&&j.render()}this.setResult(c)}),e.rpc.define("hotspots.info",function(b){a.isObject(b)&&(b=void 0);var c=null;if(b)c=q(i.get(b),p);else{c=[];for(var d=0;d<i.hotspots.length;d++)c.push(q(i.hotspots[d],p))}this.setResult(c)}),e.rpc.define("hotspots.update",function(a){var b=a.id,c=h.all[b];if(c){a=q(a,o),h.update(b,a);var d=i.get(b);d&&(i.destroy(d),d=i.create(c),d.template&&d.render())}}),e.rpc.define("hotspots.destroy",function(a){var b=i.get(a);b&&i.destroy(b),h.remove(a)});var r=function(a,b){if(a)i.get(a).setShown(b);else for(var c=0;c<i.hotspots.length;c++)i.hotspots[c].setShown(b)};e.rpc.define("hotspots.show",function(b){a.isObject(b)&&(b=void 0),r(b,!0)}),e.rpc.define("hotspots.hide",function(b){a.isObject(b)&&(b=void 0),r(b,!1)}),e.rpc.define("hotspots.types",function(){var a=Object.keys(j).map(function(a){return c("dashNormalize")(a)});this.setResult(a)});var s={};e.rpc.defineEvent("hotspots.positionUpdated",{events:["hotspots.positionUpdated"],map:function(a){return p.id(s,a.id),p.canvasPos(s,a.canvasPos),s}}),e.rpc.defineEvent("hotspots.displayUpdated"),e.rpc.defineEvent("hotspots.picked"),e.rpc.defineEvent("hotspots.entered"),e.rpc.defineEvent("hotspots.left")}}}]),a.module("humanUI.scene",[]).provider("ObjectOpacities",function(){var b,c,d,e,f,g,h,i,j,k=[],l=0,m={},n={initIndex:0,minOpacity:0,layerHandlers:{}},o=function(b){a.extend(n,b)},p=function(p,q){var r=function(a){for(var b=[],c=0;c<a.length;c++)b.push({name:a[c],objectIds:[a[c]]});return b},s=function(a){for(var b=[],c={},d=0;d<a.length;d++)"selector"===a[d].definition?(c={name:a[d].name,objectIds:p.scene.select(a[d].selector)},b.push(c)):b.push(a[d]);return b},t=function(a){for(var b=[],c=0;c<a.length;c++){var d=p.scene.objects[a[c]];if(d){var e=d.getLeafObjects();b=b.concat(e)}}return b},u=function(a,b){b=b*(1-n.minOpacity)+n.minOpacity,a.setOpacity(b)};return{data:{layers:[],threshold:1,minOpacity:n.minOpacity,initIndex:n.initIndex},newObjectsEvent:"objectSlider.layers",newPositionEvent:"objectSlider.position",config:function(b){o(b),a.extend(this.data,b)},init:function(j,o,u){this.resetScene(),j||(j=q.getFromRoots().map(function(a){return a.objectId})),j=s(j),a.isNumber(o)&&(n.initIndex=this.data.initIndex=o),a.isNumber(u)&&(n.minOpacity=u),this.data.layers=a.isString(j[0])?r(j):j,l=this.data.threshold=1/j.length,m={},e=n.initIndex,f=0,h=b=c=d=g=void 0;var v=this.data.layers[e];k=v?t(v.objectIds):[],this.data.layers.forEach(function(a){var b=t(a.objectIds);for(g=0;g<b.length;g++)m[b[g].objectId]={opacity:b[g].opacity};for(g=0;g<a.objectIds.length;g++){var c=a.objectIds[g],d=p.scene.enabledObjects.hasOwnProperty(c);m[c]?m[c].enabled=d:m[c]={enabled:d}}}),this.set(n.initIndex*l),i.triggerHandler(this.newObjectsEvent)},resetScene:function(){var a,b,c={};for(var d in m)m.hasOwnProperty(d)&&(a=m[d],b=p.scene.objects[d],a.hasOwnProperty("enabled")&&(c[d]=a.enabled),a.hasOwnProperty("opacity")&&b.setOpacity(a.opacity));p.scene.setEnabledObjects({objects:c})},set:function(a){if(e=Math.floor(a/l),e!==e&&(e=n.initIndex),b=e!==f,c=this.data.layers[e],b){var m,o,q=Math.abs(e-f),r=(e-f)/q,s=[],v=-1===r?1:0;for(g=f;g!==e;){if(m=this.data.layers[g])for(j=n.layerHandlers[m.name]||u,s=t(m.objectIds),o=0;o<s.length;o++)j(s[o],v);g+=r}if(0===n.minOpacity){var w={};for(g=0;g<this.data.layers.length;g++)if(m=this.data.layers[g],!n.layerHandlers[m.name])for(o=0;o<m.objectIds.length;o++)w[m.objectIds[o]]=g>=e;p.scene.setEnabledObjects({objects:w})}k=c?t(c.objectIds):[]}if(k.length)for(j=n.layerHandlers[c.name]||u,d=(a-l*e)/l,o=0;o<k.length;o++)j(k[o],1-d);f=e,h=a,i.triggerHandler(this.newPositionEvent,h)},getIndex:function(){return e},getPosition:function(){return h},setElement:function(a){i=a}}};return p.$inject=["Human","SceneObjects"],{$get:p,config:o}}).directive("humanObjectSlider",["$window","Human","HumanSlider","ObjectOpacities","HumanParser","currentModule",function(b,c,d,e,f,g){return{restrict:"E",templateUrl:"templates/scene/object-slider.html",scope:!0,link:function(c,h,i){var j=h.find("object-slider-layers")[0],k=i.axis||"y",l=function(){for(var a=e.data.threshold,b="x"===k?"left":"top",c=0;c<j.children.length;c++){var d=j.children[c];d.style[b]=c*a*100+"%"}},m=function(b){for(var c="x"===k?"left":"top",d=0;d<j.children.length;d++){var e=a.element(j.children[d]),f=parseInt(e[0].style[c])/100,g=b>=f?"addClass":"removeClass";e[g]("on")}},n=d.create({axis:k,element:h.find("human-slider")[0],onMove:function(a){e.set(a),m(a)}});c.setOpacity=function(a){var b=e.data.threshold,c=a*b;e.set(c),n.move(c),m(c)},e.setElement(h),h.on(e.newPositionEvent,function(a,b){n.move(b),m(b)}),h.on(e.newObjectsEvent,function(){c.layers=e.data.layers;var a=e.data.threshold,d=e.data.initIndex,f=d*a;n.move(f),b.setTimeout(function(){l(),m(f)},0)}),c.$watch("uiComponents.config.objectSlider",function(b){var d=a.isObject(b)&&b.objects;h[d?"addClass":"removeClass"]("layers");var i=a.isObject(b)&&b.data,j=null;i&&(j=b.data,a.isString(j)&&(j=j.split(",")));var k=a.isObject(b)&&b.dataSrc;k&&(j=f.parse(b.dataSrc)(g.data)),c.show=!!b,b&&e.init(j)},!0)}}}]).factory("GraphState",["Human",function(a){function b(b){return Object.keys(a.scene.objects).forEach(function(a){b[a]=!1}),b}function c(b){var c=a.scene.objects[b].parent;return c?c.objects.map(function(a){return a.objectId}):[]}function d(b,c,e){var f=a.scene.objects[c].parent;f&&!b[f.objectId]&&(e[f.objectId]=!0,b[f.objectId]=!0,d(b,f.objectId,e))}function e(b,d,f){var g=a.scene.objects[d].parent,h=c(d).filter(function(a){return b[a]});g&&0===h.length&&b[g.objectId]&&(f[g.objectId]=!1,b[g.objectId]=!1,e(b,g.objectId,f))}function f(a,b){var c,f={};if("shown"===a)c=k;else if("selected"===a)c=l;else{if("pickThrough"!==a)return;c=m,a="pickable"}var g;for(g in b)b.hasOwnProperty(g)&&(b[g]?(f[g]=!0,c[g]=!0,d(c,g,f)):(f[g]=!1,c[g]=!1,e(c,g,f)));return f}function g(c){var f;if("shown"===c)f=k;else if("selected"===c)f=l;else{if("pickThrough"!==c)return;f=m,c="pickable"}f=b(f);var g,h,i=[];return a.scene.rootObjects.forEach(function(b){for(i=a.scene.getLeaves(b.objectId),g=0;g<i.length;g++)h=a.scene.objects[i[g]],h[c]&&d(f,i[g],{})}),f=b(f),a.scene.rootObjects.forEach(function(b){for(i=a.scene.getLeaves(b.objectId),g=0;g<i.length;g++)h=a.scene.objects[i[g]],h[c]?(f[h.objectId]=!0,d(f,i[g],{})):(f[h.objectId]=!1,e(f,i[g],{}))}),f}function h(a){return k[a]}function i(a){return l[a]}function j(a){return m[a]}var k={},l={},m={};return{updateGraphState:f,buildGraphState:g,isShown:h,isSelected:i,isPickThrough:j}}]).factory("ObjectRendered",["$timeout","Human",function(a,b){var c=function(a,b){this.collection=a,this.element=b,this.flagged={},this.liQueue=[],this.assetCount=0,this.maxQueueLength=1,this.boundLoadProgress=this.onAssetLoadProgress.bind(this),this.boundObjectRenderable=this.onObjectRenderable.bind(this),this.boundAssetAttachFinish=this.onAssetAttachFinish.bind(this),this.addHandlers(),this.element.data("objectRendered",this)};return c.create=function(a){var b=a.data("humanCollection");if(b){var d=a.data("objectRendered");return d||new c(b,a)}},c.prototype.setMaxQueueLength=function(){this.maxQueueLength=Math.floor(this.assetCount/100),this.maxQueueLength<1&&(this.maxQueueLength=1),this.maxQueueLength>20&&(this.maxQueueLength=20)},c.prototype.paintAndReset=function(){for(var a=0;a<this.liQueue.length;a++)this.liQueue[a].addClass("anatomy-rendered");this.liQueue.length=0},c.prototype._updateRendered=function(a,c){var d=b.scene.objects[a];if(d&&d.isRenderable())for(;d&&!this.flagged[d.objectId];){var e=this.collection.getLi(d.objectId);e&&(c?(this.liQueue.push(e),this.liQueue.length===this.maxQueueLength&&this.paintAndReset()):e.addClass("anatomy-rendered"),this.flagged[d.objectId]=!0),d=d.parent}},c.prototype.updateRendered=function(){for(var a in this.collection.lis)this.collection.lis.hasOwnProperty(a)&&this._updateRendered(a,!1);this.flagged={}},c.prototype.addHandlers=function(){b.events.off("assets.load.progress",this.boundLoadProgress),b.events.on("assets.load.progress",this.boundLoadProgress),b.events.off("scene.objectRenderable",this.boundObjectRenderable),b.events.on("scene.objectRenderable",this.boundObjectRenderable),b.events.off("graph.assetAttach.finish",this.boundAssetAttachFinish),b.events.on("graph.assetAttach.finish",this.boundAssetAttachFinish)},c.prototype.removeHandlers=function(){b.events.off("assets.load.progress",this.boundLoadProgress),b.events.off("scene.objectRenderable",this.boundObjectRenderable),b.events.off("graph.assetAttach.finish",this.boundAssetAttachFinish)},c.prototype.onAssetLoadProgress=function(a){0===this.assetCount&&(this.assetCount=a.requestedAssets,this.setMaxQueueLength())},c.prototype.onObjectRenderable=function(b){var c=this;a(function(){c._updateRendered(b.objectId,!0)})},c.prototype.onAssetAttachFinish=function(){var b=this;a(function(){b.paintAndReset(),b.flagged={},b.assetCount=0})},c}]).factory("ObjectEnabled",["$timeout","Human","GraphState",function(b,c,d){var e=function(a,b){this.collection=a,this.element=b,this.shownState=d.buildGraphState("shown");var e=this.onObjectShow.bind(this),f=this.onObjectsShown.bind(this);this.element.off("click.objectShow",e),this.element.on("click.objectShow",e),c.events.off("scene.objectsShown",f),c.events.on("scene.objectsShown",f),this.element.data("objectEnabled",this)};return e.create=function(a){var b=a.data("humanCollection");if(b){var c=a.data("objectEnabled");return c||new e(b,a)}},e.toggleEnabledAnatomy=function(a,b){var d={};if(d[b]=a,c.scene.setEnabledObjects({objects:d}),a){var e=c.scene.objects[b].getLeafObjects(),f=[];e.forEach(function(a){a.isRenderable()||f.push(a)}),f.length&&c.scene.graph.attachAssetSetsToSubtree(f)}},e.prototype.update=function(a,b){var c=this.collection.getLi(b);c&&c[a?"addClass":"removeClass"]("anatomy-enabled")},e.prototype.onObjectShow=function(a,b){var c=b&&b.target||a.target;if(c.hasAttribute("object-enabled")){a.stopPropagation();var d=c.getAttribute("object-enabled"),f=this.collection.getLi(d);f.toggleClass("anatomy-enabled");var g=f.hasClass("anatomy-enabled");e.toggleEnabledAnatomy(g,d)}},e.prototype.onObjectsShown=function(c){var e=this,f=d.updateGraphState("shown",c.enabledObjectsUpdate);b(function(){a.forEach(f,e.update,e)})},e}]).provider("ObjectSelected",function(){var b={selectOpen:!0,deselectClose:!0},c=function(c,d,e,f){var g=function(c,f){this.collection=c,this.element=f,this.config=a.copy(b),this.selectedState=e.buildGraphState("selected"),this.throttle=!1;var g=this.onObjectSelect.bind(this),h=this.onObjectsSelected.bind(this);this.element.off("click.objectSelect",g),this.element.on("click.objectSelect",g),d.events.off("scene.objectsSelected",h),d.events.on("scene.objectsSelected",h),this.element.data("objectSelected",this)};return g.create=function(a){var b=a.data("humanCollection");if(b){var c=a.data("objectSelected");return c||new g(b,a)}},g.prototype.selectAnatomy=function(a){var b=this,c=d.view.pick.getMultiPickEnabled();d.scene.setSelectedObjects({objectId:a,select:!0,replace:!c}),c?b.throttle=!1:d.view.camera.fly.flyTo({boundary:d.scene.getBoundary({objects:d.scene.selectedObjects})},function(){b.throttle=!1})},g.prototype.onObjectSelect=function(a,b){var c=b&&b.target||a.target;if(c.hasAttribute("object-selected")){a.stopPropagation();var d=c.getAttribute("object-selected"),e=this.collection.getLi(d);this.throttle=!0,this.selectAnatomy(d);var g=f.getTarget(e);g&&f.show(g)}},g.prototype.update=function(a,b){var c=this.collection.getLi(b),d=f.getTarget(c);c&&(c[a?"addClass":"removeClass"]("anatomy-selected"),d&&(this.config.selectOpen&&a&&!this.throttle&&f.show(d,{animate:!1}),this.config.deselectClose&&!a&&f.hide(d,{animate:!1})))},g.prototype.onObjectsSelected=function(b){var d=this,f=e.updateGraphState("selected",b.selectedObjectsUpdate);c(function(){a.forEach(f,d.update,d)})},g};return c.$inject=["$timeout","Human","GraphState","TreeCollapse"],{$get:c,config:function(c){a.extend(b,c)}}}).factory("SceneObjects",["Human","ObjectEnabled","ObjectSelected","ObjectRendered",function(b,c,d,e){var f=function(a){return/export_ID$/.test(a)};return{getFromRoots:function(){var c=[];return a.forEach(b.scene.rootObjects,function(b){a.forEach(b.objects,function(a){f(a.objectId)?c=c.concat(a.objects):c.push(a)})}),c},getFromList:function(){var c={};return a.forEach(b.scene.objects,function(a,b){a.parent&&!f(b)&&(c[b]=a)}),c},init:function(a){e.create(a),c.create(a),d.create(a)}}}]).directive("humanObjectTree",["$timeout","Human","SceneObjects","HumanKeySelect","GraphState",function(b,c,d,e,f){return{restrict:"E",templateUrl:"templates/scene/object-tree.html",scope:!0,transclude:!0,link:function(g,h,i){var j=h.find("human-tree"),k=function(a){g.show=l()&&a},l=function(){var b=g.rootObjects;return a.isArray(b)&&b.length>0};g.objectTreeConfig={compile:!1,compare:!0,itemId:"objectId",itemClasses:function(a){return{"anatomy-enabled":f.isShown(a.objectId),"anatomy-selected":f.isSelected(a.objectId)}},isLeaf:function(a){return a.isLeaf()}},g.rootObjects=c.scene.rootObjects,g.$watchCollection("rootObjects",function(){var c;l()&&b(function(){g.sceneObjects=d.getFromRoots(),d.init(j)}),c=a.isObject(g.uiComponents.config)?!!g.uiComponents.config.objectTree:!1,k(c)});var m=e.create(h,null,{cycle:!i.hasOwnProperty("noCycle"),onSelected:function(a){j.triggerHandler("click.objectSelect",{target:a[0]})}});g.$on("humanObjectTree.selectItem",function(a,b){m.selectItem(b)}),j.on("humanCollection.built",function(){m.setItems(j.find("a"))}),g.$watch("uiComponents.config.objectTree",function(a){k(!!a)})}}}]).directive("humanObjectListSearch",["$document","$timeout","SceneObjects",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/scene/object-list-search.html",link:function(e,f,g){var h,i,j={};h=g.hasOwnProperty("target")?a.element(b[0].querySelector(g.target)):f.next();var k=function(){var b=h.find("human-list"),c=b.data("humanCollection");a.forEach(e.sceneObjects,function(a,b){a.displayName&&(i=a.displayName.toLowerCase(),j[i]||(j[i]=[]),j[i].push(c.getLi(b)[0]))})},l="Search Current 3D Model";g.searchPlaceholder?g.$observe("searchPlaceholder",function(a){e.searchPlaceholder=a}):e.searchPlaceholder=l,e.clearSearch=function(){var a=f.find("input");a.val(""),a.triggerHandler("change")},e.searchList=function(){var a,b,c,d,f,g=function(a,b){for(d=0;d<a.length;d++)a[d].style.display=b},i=e.searchText.toLowerCase(),k=0;a=new RegExp("^"+i+"|\\s"+i);for(f in j)j.hasOwnProperty(f)&&(c=a.test(f),b=c?"inherit":"none",g(j[f],b),c&&k++);e.noResults=0===k,e.searching=e.searchText.length>0,h.triggerHandler("objectListSearching",e.searching)},e._sceneObjects=Human.scene.objects,e.$watchCollection("_sceneObjects",function(a){Object.keys(a).length>0&&h[0]&&c(function(){e.sceneObjects=d.getFromList(),c(function(){k()})})})}}}]).directive("humanObjectList",["$timeout","$window","HumanKeySelect","SceneObjects","GraphState",function(a,b,c,d,e){return{restrict:"E",templateUrl:"templates/scene/object-list.html",scope:!0,transclude:!0,link:function(b,f,g){var h,i=f.find("human-list"),j=i[0],k=!1,l=function(){for(var a=0;a<n.length;a++)n[a].element.style.display="inherit";h.style["margin-top"]="0px",h.style["margin-bottom"]="0px"},m=function(a){b.searching&&a||(a?(o(),p(),i.off("scroll",p),i.on("scroll",p)):(l(),i.off("scroll",p)),k=a)},n=[],o=function(){var a=i.find("li.letter-group");l(),n=[];for(var b=0;b<a.length;b++)n.push({element:a[b],top:a[b].offsetTop,bottom:a[b].offsetTop+a[b].offsetHeight})},p=function(){if(h&&0!==n.length){var a,b,c=0,d=n.length;for(a=0;a<n.length;a++)b=n[a],b.bottom<j.scrollTop?c=a+1:b.top>j.scrollTop+j.clientHeight&&d===n.length&&(d=a);for(a=0;c>a;a++)n[a].element.style.display="none";for(a=c;d>a;a++)n[a].element.style.display="inherit";var e=0;for(a=d;a<n.length;a++)e+=n[a].bottom-n[a].top,n[a].element.style.display="none";h.style["margin-top"]=n[c].top+"px",h.style["margin-bottom"]=e+"px"}};b.objectListConfig={itemId:"objectId",itemClasses:function(a){return{"anatomy-rendered":a.isRenderable(),"anatomy-enabled":e.isShown(a.objectId),"anatomy-selected":e.isSelected(a.objectId)}},letterHeaders:!0},b._sceneObjects=Human.scene.objects,b.$watchCollection("_sceneObjects",function(c){Object.keys(c).length>0&&a(function(){b.sceneObjects=d.getFromList(),d.init(i),a(function(){h=i.children()[0]})})}),f.on("objectListSearching",function(a,c){b.searching=c,f[c?"addClass":"removeClass"]("searching"),m(!c),j.scrollTop=0}),b.$on("objectListRanges.setCropping",function(a,b){m(b)}),b.$on("objectListRanges.setRanges",o),b.$on("objectListRanges.crop",p),Human.events.on("graph.assetAttach.finish",function(){m(!0)});var q=c.create(f,null,{cycle:!g.hasOwnProperty("noCycle"),onSelected:function(a){i.triggerHandler("click.objectSelect",{target:a[0]})}});b.$on("humanObjectList.selectItem",function(a,b){q.selectItem(b)}),i.on("humanCollection.built",function(){q.setItems(i.find("a"))})}}}]),a.module("humanUI.snapshot",[]).provider("HumanSnapshot",function(){var b={copyrightImagePath:null,copyrightText:{font:"12px Arial",fillStyle:"#666666",textAlign:"center"},copyrightPosition:{x:"center",y:"bottom"},copyrightOffset:{x:0,y:-20}},c=function(c){for(var d in b)if(c.hasOwnProperty(d)){var e=c[d];a.isObject(e)?a.extend(b[d],e):b[d]=e}},d=function(d,e,f,g,h){var i,j=!1,k=function(){i=new d.Image,i.onload=function(){j=!0},i.src=b.copyrightImagePath},l=function(c,d,e){var f,g;a.forEach(b.copyrightText,function(a,b){c[b]=a});var h=[(new Date).getFullYear(),String.fromCharCode(169)].join(" "),k=c.measureText(h);if(f=d/2-k.width/2,g=e-10,c.fillText(h,f,g),j){var l=0,m=0;switch(b.copyrightPosition.x){case"right":l=d-i.width;break;case"center":l=d/2-i.width/2;break;default:l=0}switch(b.copyrightPosition.y){case"bottom":m=e-i.height;break;case"middle":m=e/2-i.height/2;break;default:m=0}var n=l+b.copyrightOffset.x,o=m+b.copyrightOffset.y;c.drawImage(i,n,o)}},m=function(a,b,c,d){var e,f=function(a,c){for(var d=0;d<b.colors.length;d++){var e=b.colors[d][255];e="rgb("+e[0]+", "+e[1]+", "+e[2]+")",
a.addColorStop(c[d],e)}};if("radial"===b.gradientType){var g=c/2,h=d/2,i=Math.max(g,h),j=[g,h,i,g,h,0];e=a.createRadialGradient.apply(a,j),f(e,[1,0])}else e=a.createLinearGradient(0,0,0,d),f(e,[0,1]);a.fillStyle=e,a.fillRect(0,0,c,d)},n=function(a,b){a=a||{};var c=h.renderer.canvas.canvas;c[0]&&(c=c[0]);var f=c.getBoundingClientRect(),g=f.width,i=f.height,j=a.width||g,k=a.height||i;j>=k?k=d.Math.floor(i/g*j):k>j&&(j=d.Math.floor(g/i*k));var n=!1;h.timeline.playing&&(n=!0,h.timeline.pause()),h.renderer.forceRenderFrame();var o=e[0].createElement("canvas"),p=o.getContext("2d");o.width=j,o.height=k;var q,r;"HumanBackground"in d&&(q=d.HumanBackground.getBackgroundData(),r=[p,q,j,k],m.apply(null,r)),r=[c,0,0,j,k],p.drawImage.apply(p,r);var s=a.copyright===!1?!1:!0;s&&l(p,j,k);var t=h.view.annotations.layouts,u=t.getLayout(t.activeLayout);if(u&&u.snapshot){var v;v=q?q.averageGray[1]>.5?"white":"black":"white",u.snapshot(o,p,v)}h.renderer.forceRenderFrame(),n&&h.timeline.unpause();var w=new d.Image;w.width=j,w.height=k,w.onload=b.bind(null,w),w.src=o.toDataURL("image/jpeg")};return b.copyrightImagePath&&k(),{get:function(b,c){n(b,function(e){b.openInTab&&d.open(e.src,"_blank"),a.isFunction(c)&&c(e)})},loadCopyrightImage:k,config:c}};return d.$inject=["$window","$document","$q","$timeout","Human"],{$get:d,config:c}}),a.module("humanUI.timeline",["humanUI.actions"]).factory("HumanTimeline",["Human","HumanActions",function(b,c){function d(a,c){var d=b.timeline.activeRoot;if(d){var e=d._chapters.indexOf(d._nowBranch),f=d._chapters.indexOf(c),g=f-e;1===Math.abs(g)?b.timeline[1===g?"next":"prev"]():c.animation.loop?a.playChapter(c):b.timeline.scrub({chapterId:c.id})}}function e(a){var d;if(a.ui.play.hasOwnProperty("actions")){var e=[];for(d=0;d<a.ui.play.actions.length;d++){var f,g=a.ui.play.actions[d],h=g.split(":");f=b.timeline.activeRoot.mapBranchTime(a,0);var i=f+Number(h[1]),j=f+Number(h[2]);("play"===h[0]||"loop"===h[0])&&e.push([h[0],i,j].join(":"))}c.parse(e)}else if(a.ui.play.hasOwnProperty("count")){var k=a.ui.play.count||1;if(-1===k)b.timeline.play({startChapterId:a.id,numChapters:1,loop:!0});else if(0===k){var l;l=b.timeline.activeRoot.mapBranchTime(a,0),b.timeline.scrub({time:l,borderCondition:{which:"second",direction:"forwards"}})}else for(d=0;k>d;d++)b.timeline.play({startChapterId:a.id,numChapters:1,loop:!1,queue:d>0})}}var f=function(){var c=b.timeline.activeRoot;if(c)for(var d,e,f,g,h=0;h<c._chapters.length;h++){if(d=c._chapters[h].maps,!Object.keys(d).length)return!1;for(g in d)if(d.hasOwnProperty(g)&&(e=d[g].data.timeline,f=a.isObject(e)?e.id:e,"dummy"!==f))return!0}return!1};return{isPlayable:function(a){if(f())return!0;var c=b.timeline.activeRoot;if(!c)return!1;var d=Object.keys(c._chapters).length>1,e=a&&a.lastTime>a.firstTime;return d&&e},playChapter:function(a){b.timeline.play({startChapterId:a.id,loop:!!a.animation.loop,numChapters:1})},handleChapter:function(a){a.ui.play?e(a):d(this,a)}}}]).directive("playPauseTimeline",["Human",function(b){return{restrict:"A",scope:{config:"="},link:function(c,d){var e,f,g,h=function(){e={startTime:b.timeline.time},g=!!b.timeline.activeRoot._nowBranch.animation.loop,(f||g)&&(e.loop=!0);var d=a.isObject(c.config)&&c.config.tour;(d||g)&&(e.numChapters=1),b.timeline.play(e)};d.on("click",function(){b.timeline.playing?b.timeline.stop():h()}),b.events.on("timeline.played",function(){d.addClass("playing")}),b.events.on("timeline.stopped",function(){d.removeClass("playing")}),b.events.on("timeline.scrubbed",function(){d.removeClass("playing")}),b.events.on("modules.activate.start",function(a){var c=b.modules.modules[a.moduleId];c&&(f=!(!c.animation||!c.animation.loop))})}}}]).directive("humanPlayPause",["HumanTimeline",function(b){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/play-pause.html",link:function(c){var d,e,f=function(){c.show=!!d&&!!e};Human.events.on("modules.activate.finish",function(){var a=Human.timeline.getTimeFrame();e=b.isPlayable(a),f()}),Human.events.on("modules.deactivate.finish",function(){c.show=!1}),c.$watch("uiComponents.config.playPause",function(b){var e=c.uiComponents.config;d=!e.scrubber&&!e.tour&&!!b,f(),a.isObject(b)&&(c.config=b)},!0)}}}]).directive("humanChapters",["$window","$sce","$timeout","Human","HumanTimeline","checkModule","translateFilter",function(b,c,d,e,f,g,h){var i=a.element(b);return{restrict:"E",scope:{config:"=?"},templateUrl:"templates/timeline/chapters.html",link:function(b,j,k){var l,m,n,o=k.chaptersMode||"scrubber",p=function(){n=j[0].scrollWidth>j[0].clientWidth,j[n?"addClass":"removeClass"]("overflow")},q=function(){var a=j[0].children[b.curIndex];if("tour"===o&&a){var c=j[0].scrollWidth/b.chapters.length,d=b.curIndex*c;j[0].scrollLeft>d&&(j[0].scrollLeft=d);var e=j[0].scrollLeft+j[0].clientWidth,f=d+c;f>e&&(j[0].scrollLeft=f-j[0].clientWidth)}},r=function(a){if(!b.titles.hasOwnProperty(a.id)){var d=h(a.info,"displayName",m);b.titles[a.id]=c.trustAsHtml(d)}return b.titles[a.id]};b.titles={},b.chapters=[],b.getOffset=function(a){if(e.timeline.activeRoot){var b=e.timeline.activeRoot._times[a];return"scrubber"===o?b/l.lastTime*100+"%":"auto"}};var s=function(){if(e.timeline.activeRoot){var c=e.timeline.activeRoot._chapters;c.length>1&&(l=e.timeline.getTimeFrame(),b.chapters=c,b.titleDisplay=a.isObject(b.config)&&b.config.titleDisplay?b.config.titleDisplay:r,d(p),b.showTitles=!g("ui.bootstrap"),b.toolTipPos="scrubber"===o?"left":"top")}};j.on("click",function(a){if(/chapter/.test(a.target.className)){var b=e.timeline.branchTimelines[a.target.id];"scrubber"===o?f.playChapter(b):f.handleChapter(b)}}),i.on("resize",function(){d(p)}),b.$on("human.locale",function(a,b){m=b}),e.events.on("timeline.chapters.updated",function(){d(s)}),e.events.on("timeline.timeFrame.updated",function(a){l=a}),e.events.on("timeline.chapters.activated",function(a){d(function(){b.curIndex=a.newChapterIndex,q()})})}}}]).directive("humanScrubber",["Human","HumanTimeline","HumanSlider",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/scrubber.html",link:function(e,f){var g,h,i,j,k,l=!1,m=function(){e.show=!!j&&!!k},n=function(b){e.uiConfig=b;var c=a.isObject(e.uiConfig)&&e.uiConfig.chapters;f[c?"addClass":"removeClass"]("chapters")},o=function(a){var b=Math.floor(a/60).toString(),c=Math.floor(a%60).toString();return 1===b.length&&(b="0"+b),1===c.length&&(c="0"+c),b+":"+c},p=function(){return h=o(b.timeline.time),i=o(g.lastTime),h+" / "+i},q=function(a){var b=g.lastTime-g.firstTime;return g.firstTime+b*a},r=function(a){var b=g.lastTime-g.firstTime;return g.firstTime+a/b},s=d.create({element:f.find("human-slider")[0],label:p,onMove:function(a){b.timeline.scrub({time:q(a)})}}),t=function(a){g=a,s.move(r(b.timeline.time)),l||(l=!0,b.events.on("timeline.scrubbed",function(a){s.move(r(a.time))}),b.events.on("timeline.playing",function(a){s.move(r(a.time))}))};b.events.on("timeline.timeFrame.updated",function(a){k=c.isPlayable(a),k&&t(a),m()}),b.events.on("modules.activate.finish",function(){var a=e.uiComponents.config;a.scrubber&&a.tour&&(j=1===b.timeline.activeRoot._chapters.length,m())}),b.events.on("modules.deactivate.finish",function(){e.show=!1}),e.$watch("uiComponents.config.scrubber",function(a){(!a||a&&!e.uiComponents.config.tour)&&(j=!!a,m()),n(a)},!0)}}}]).directive("prevNextChapter",["Human","HumanTimeline",function(a,b){return{restrict:"A",link:function(c,d,e){var f=e.prevNextChapter||"next";f="next"===f?1:-1;var g,h,i,j=function(){i=1===f&&g===h.length-1||-1===f&&0===g,d[i?"addClass":"removeClass"]("disabled")};d.on("click",function(){if(!i){var c=a.timeline.activeRoot._chapters;b.handleChapter(c[g+f])}}),a.events.on("timeline.chapters.updated",function(a){h=a}),a.events.on("timeline.chapters.activated",function(a){g=a.newChapterIndex,j()})}}}]).directive("humanTour",["$q","$timeout","Human",function(b,c,d){return{restrict:"E",scope:!0,templateUrl:"templates/timeline/tour.html",link:function(b,c){var e,f,g=function(){b.show=!!e&&!!f},h=function(d){b.uiConfig=d;var e=a.isObject(b.uiConfig)&&b.uiConfig.chapters;c[e?"addClass":"removeClass"]("chapters")};d.events.on("timeline.timeFrame.updated",function(){if(d.timeline.activeRoot){var a=b.uiComponents.config;f=d.timeline.activeRoot._chapters.length>1,a.scrubber&&a.tour&&(e=f),g()}}),d.events.on("modules.activate.finish",function(){if(d.timeline.activeRoot){var a=b.uiComponents.config;f=d.timeline.activeRoot._chapters.length>1,a.scrubber&&a.tour&&(e=f),g()}}),d.events.on("modules.deactivate.finish",function(){b.show=!1}),b.$watch("uiComponents.config.tour",function(a){(!a||a&&!b.uiComponents.config.scrubber)&&(e=!!a,g()),h(a)},!0)}}}]),a.module("humanUI.templates",["templates/annotations/panel.html","templates/bookmark/tour.html","templates/camera/center.html","templates/camera/mode.html","templates/camera/pan.html","templates/camera/zoom-in.html","templates/camera/zoom-out.html","templates/camera/zoom.html","templates/cross-section/camera-clip.html","templates/cross-section/controls.html","templates/cross-section/slider.html","templates/cross-section/toggle.html","templates/dissect/dissect.html","templates/dissect/undo.html","templates/fullscreen/panel.html","templates/fullscreen/window-link.html","templates/info/panel.html","templates/modes/isolate.html","templates/modes/xray.html","templates/scene/object-list-search.html","templates/scene/object-list.html","templates/scene/object-slider.html","templates/scene/object-tree.html","templates/timeline/chapters.html","templates/timeline/play-pause.html","templates/timeline/scrubber.html","templates/timeline/tour.html"]),a.module("templates/annotations/panel.html",[]).run(["$templateCache",function(a){a.put("templates/annotations/panel.html",'<button class="tool annotations" toggle-button="config"></button>')}]),a.module("templates/bookmark/tour.html",[]).run(["$templateCache",function(a){a.put("templates/bookmark/tour.html",'<div>\n  <button prev-next-bookmark="prev"></button>\n\n  <div id=\'bookmark-tour-captures\' update-scroll="state.curCaptureIndex">\n    <div class="bookmark-tour-capture"\n      ng-repeat="capture in state.captures"\n      ng-class="{ on: $index === state.curCaptureIndex }"\n      ng-click="restore($index)">\n\n      <img ng-src="/{{ capture.thumbnailSrc }}">\n    </div>\n  </div>\n\n  <button prev-next-bookmark="next"></button>\n</div>')}]),a.module("templates/camera/center.html",[]).run(["$templateCache",function(a){a.put("templates/camera/center.html","<div center-camera></div>")}]),a.module("templates/camera/mode.html",[]).run(["$templateCache",function(a){a.put("templates/camera/mode.html","<div set-camera-mode></div>")}]),a.module("templates/camera/pan.html",[]).run(["$templateCache",function(a){a.put("templates/camera/pan.html",'<div pan-camera="up" title="Pan Up [{{ keys.up }}]"></div>\n<div pan-camera="right" title="Pan Right [{{ keys.right }}]"></div>\n<div pan-camera="down" title="Pan Down [{{ keys.down }}]"></div>\n<div pan-camera="left" title="Pan Left [{{ keys.left }}]"></div>\n\n<div center-camera title="Center"></div>')}]),a.module("templates/camera/zoom-in.html",[]).run(["$templateCache",function(a){a.put("templates/camera/zoom-in.html",'<div zoom-camera="in">+</div>')}]),a.module("templates/camera/zoom-out.html",[]).run(["$templateCache",function(a){a.put("templates/camera/zoom-out.html",'<div zoom-camera="out">-</div>')}]),a.module("templates/camera/zoom.html",[]).run(["$templateCache",function(a){a.put("templates/camera/zoom.html",'<div zoom-camera="out">-</div>\n<div zoom-camera="in">+</div>')}]),a.module("templates/cross-section/camera-clip.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/camera-clip.html",'<button class="tool camera-clip" toggle-button="config"></button>')}]),a.module("templates/cross-section/controls.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/controls.html",'<button\n  class="tool"\n  cycle-section-plane\n  uib-tooltip="{{ tooltipText.select }}"></button>\n\n<human-cross-section-slider></human-cross-section-slider>\n<span class="view">{{ state.current.view }}</span>\n\n<button\n  class="tool"\n  reset-section-plane\n  plane="curPlane"\n  uib-tooltip="{{ tooltipText.reset }}"></button>')}]),a.module("templates/cross-section/slider.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/slider.html","<human-slider></human-slider>")}]),a.module("templates/cross-section/toggle.html",[]).run(["$templateCache",function(a){a.put("templates/cross-section/toggle.html",'<button class="cross-section tool" toggle-button="config"></button>')}]),a.module("templates/dissect/dissect.html",[]).run(["$templateCache",function(a){a.put("templates/dissect/dissect.html",'<button class="tool dissect" toggle-button="config"></button>')}]),a.module("templates/dissect/undo.html",[]).run(["$templateCache",function(a){a.put("templates/dissect/undo.html",'<button class="tool dissect-undo" undo-dissect></button>')}]),a.module("templates/fullscreen/panel.html",[]).run(["$templateCache",function(a){a.put("templates/fullscreen/panel.html",'<div toggle-button="config"></div>')}]),a.module("templates/fullscreen/window-link.html",[]).run(["$templateCache",function(a){a.put("templates/fullscreen/window-link.html",'<a window-link target="_blank"></a>')}]),a.module("templates/info/panel.html",[]).run(["$templateCache",function(a){a.put("templates/info/panel.html",'<h1 class="title">{{ infoTitle }}</h1>\n<div class="description" ng-bind-html="infoDescription | parseActions"></div>\n<ng-transclude class="custom-content"></ng-transclude>')}]),a.module("templates/modes/isolate.html",[]).run(["$templateCache",function(a){a.put("templates/modes/isolate.html",'<button class="tool isolate" toggle-button="config"></button>')}]),a.module("templates/modes/xray.html",[]).run(["$templateCache",function(a){a.put("templates/modes/xray.html",'<button class="tool xray" toggle-button="config"></button>')}]),a.module("templates/scene/object-list-search.html",[]).run(["$templateCache",function(a){a.put("templates/scene/object-list-search.html",'<input\n  type="text"\n  placeholder="{{ searchPlaceholder }}"\n  ng-change="searchList()"\n  ng-model="searchText">\n\n<button ng-show="searching" ng-click="clearSearch()">&times;</button>')}]),a.module("templates/scene/object-list.html",[]).run(["$templateCache",function(a){a.put("templates/scene/object-list.html",'<ng-transclude></ng-transclude>\n\n<span class="no-results" ng-show="searching && noResults">No Results</span>\n\n<human-list\n  list-data="sceneObjects"\n  list-config="objectListConfig">\n    <a\n      object-selected="{{ objectId | escapeHtml }}"\n      title="{{ displayName | escapeHtml }}"\n      class="collection-item">\n      <span\n        object-enabled="{{ objectId | escapeHtml }}"\n        class="anatomy-check-icon"></span>{{ displayName | escapeHtml }}\n    </a>\n</human-list>')}]),a.module("templates/scene/object-slider.html",[]).run(["$templateCache",function(a){a.put("templates/scene/object-slider.html",'<object-slider-layers>\n  <button\n    ng-repeat="layer in layers"\n    ng-click="setOpacity($index)"\n    class="object-slider-layer"></button>\n\n  <!-- One at the end to hide the entire scene -->\n  <button\n    class="object-slider-layer"\n    ng-click="setOpacity(layers.length)"></button>\n</object-slider-layers>\n\n<human-slider></human-slider>')}]),a.module("templates/scene/object-tree.html",[]).run(["$templateCache",function(a){a.put("templates/scene/object-tree.html",'<ng-transclude></ng-transclude>\n<human-tree\n  tree-data="sceneObjects"\n  tree-config="objectTreeConfig">\n    <a\n      object-selected="{{ objectId | escapeHtml }}"\n      title="{{ displayName | escapeHtml }}"\n      class="collection-item">\n      <span\n        object-enabled="{{ objectId | escapeHtml }}"\n        class="anatomy-check-icon"></span>{{ displayName | escapeHtml }}\n    </a>\n</human-tree>')}]),a.module("templates/timeline/chapters.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/chapters.html",'<button\n  ng-repeat="chapter in chapters"\n  id="{{ chapter.id }}"\n  class="chapter"\n  ng-class="{ on: $index === curIndex }"\n  uib-tooltip-html="titleDisplay(chapter)"\n  tooltip-placement="{{ toolTipPos }}"\n  title="{{ (showTitles && titleDisplay(chapter)) || \'\' }}"\n  ng-style="{ left: getOffset($index) }">{{ $index + 1 }}</button>\n')}]),a.module("templates/timeline/play-pause.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/play-pause.html",'<button play-pause-timeline config="config"></button>')}]),a.module("templates/timeline/scrubber.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/scrubber.html",'<button play-pause-timeline config="uiConfig"></button>\n\n<human-chapters chapters-mode="scrubber" config="uiConfig"></human-chapters>\n<human-slider></human-slider>')}]),a.module("templates/timeline/tour.html",[]).run(["$templateCache",function(a){a.put("templates/timeline/tour.html",'<div><button prev-next-chapter="prev"></button><human-chapters chapters-mode="tour" config="uiConfig"></human-chapters><button prev-next-chapter="next"></button></div>')}])}(angular),function(a){var b=a.HumanScene={};b.isObject=function(a){return null!==a&&"object"==typeof a},b.extend=function(){var a,b,c,d=Array.prototype.slice.call(arguments,0),e=d[0],f=d.slice(1);for(c=0;c<f.length;c++){a=f[c];for(b in a)a.hasOwnProperty(b)&&(e[b]=a[b])}return e},b.isBase=function(b){if("isBase"in a.Human.modules)return a.Human.modules.isBase(b);var c=b.match(/^(femaleAdult|maleAdult)/);return c&&c[0]},b.isBaseModule=function(c){if("isBaseModule"in a.Human.modules)return a.Human.modules.isBaseModule(c);var d=c.split("/");return b.isBase(d[d.length-1])?c:!1},b.getGenderModule=function(a){var c,d=null;for(var e in a)if(a.hasOwnProperty(e)&&(c=b.isBase(e))){d=["production",c,c+".json"].join("/");break}return d},b.getUrlParams=function(){var b={},c=/[?&]+([^=&]+)=([^&]*)/gi;return a.location.href.replace(c,function(c,d,e){b[d]=a.decodeURIComponent(e)}),b},b.load=function(a,c,d){b.sceneGraph.load(a,function(){b.sceneGraph.stage(a),c()},d)},b.initEngine=function(b){a.Human.init.init(b)},b.startEngine=function(){a.Human.init.start()}}(window),function(a){var b=a.HumanScene,c=b.bookmark={},d=function(a){return a.indexOf("/femaleAdult/")>=0?"female":"male"},e=function(b){var c=b.modules.activeModules||[];if(c.length>1){var d,e;for(e=0;e<c.length;e++)if(!a.Human.modules.isBaseModule(c[e])){d=c[e];break}c=[d]}b.modules.moduleLibs&&(b.modules.moduleLibs=[])};c.normalizeLegacy=function(a){a.modules={},a.modules.activeModules=[],a.modules.moduleLibs=[],b.isObject(a.objects)||(a.objects={});var c=b.getGenderModule(a.objects);c&&a.modules.activeModules.unshift(c)},c.normalizeTour=function(a){for(var b,c=0;c<a.length;c++)b=a[c],e(b)},c.normalize=function(a){var f=a.bookmark||null,g=null;if(f){b.isObject(f.modules)||c.normalizeLegacy(f);var h=Array.isArray(f.tour)&&f.tour.length>0;if(h){var i=[f].concat(f.tour);c.normalizeTour(i)}else e(f);g=f.modules.activeModules.length>0?d(f.modules.activeModules[0]):"male"}return{bookmark:f,streamObjects:{},gender:g}}}(window),function(a){var b=a.HumanScene,c=b.content={},d="male",e="production/{0}Adult",f=c.DEFAULT_LANG="en",g={},h=function(a,b,c){return c=c||e,c=c.replace("{0}",b||d),[c,a+".json"].join("/")},i=function(a,b){var c={};if(a.length)for(var d=0;d<a.length;d++)if(a[d].groups.length){c.id=a[d].id;var e=[b,a[d].groups[0].replace(/\s/g,"_")].join("-");/system$/i.test(e)||(e+="_System"),/ligaments/i.test(e)&&(e=e.replace(/ligaments/i,"Ligament"),c.id=e),c.system=e;break}return c};c.setModule=function(a,b){var c=a.indexOf("/")>=0;return{id:c?a:h(a,b)}},c.setAnatomy=function(a,b){a=a||"",b=b||d;for(var c,e=a.split(","),f=b+"Adult",g={},i=0;i<e.length;i++){c=e[i];var j=c.indexOf("-")>=0?c:[f,c].join("-");g[j]=!0}return{id:h(f,b),baseAnatomyObjects:g}},c.setPrettyAnatomy=function(a,b,c){for(var e=a.input||"",f=a.gender||d,g=a.generations||null,j=e.split("-"),k=[],l=f+"Adult",m={},n=0;n<j.length;n++)j[n].length>2&&k.push(j[n]);var o=[l,"Integumentary_System"].join("-");m[o]=!0;var p="/search/anatomy?q="+f+"+"+k.join("+"),q=new XMLHttpRequest;q.onreadystatechange=function(){if(q.readyState===XMLHttpRequest.DONE)if(200===q.status){var a=JSON.parse(q.responseText),d=i(a.results,l);m[d.system]=!0,b({id:h(l,f),baseAnatomyObjects:m,selectedObject:d.id,generations:g})}else c({message:"Error searching anatomy",type:"search"})},q.open("GET",p),q.send()},c.setBookmark=function(a,c,d,e){var f="/search/bookmarks/data?"+a+"="+c,g=new XMLHttpRequest;g.onreadystatechange=function(){if(g.readyState===XMLHttpRequest.DONE)if(200===g.status){var a=JSON.parse(g.responseText);if(a&&a.bookmark&&a.bookmark.sceneGraph)return b.extend(j,{id:c,moduleData:a.bookmark}),void d(j);if(a=b.bookmark.normalize(a),a.bookmark){var f=a.bookmark.modules.activeModules;d({id:f[f.length-1],gender:a.gender,baseAnatomyObjects:a.streamObjects,bookmark:a.bookmark})}else e({message:"Bookmark was empty.",type:"bookmark"})}else e({message:"Bookmark does not exist",type:"bookmark"})},g.open("GET",f),g.send()},c.setCamera=function(b){var c=null;if(b=b.split(","),Array.isArray(b)&&b.length%3===0){var d={0:"eye",3:"look",6:"up"};c={};for(var e=0;e<b.length;e+=3)d.hasOwnProperty(e)&&(c[d[e]]={x:a.parseFloat(b[e]),y:a.parseFloat(b[e+1]),z:a.parseFloat(b[e+2])})}return{camera:c}};var j={id:null,gender:null,initialChapter:0,baseAnatomyObjects:{},bookmark:null,camera:null,moduleData:null,selectedObject:null,generations:null};c.get=function(){return j},c.set=function(d,e){var g=b.getUrlParams();if(g.s&&(j.gender=g.s),g.camera&&b.extend(j,c.setCamera(g.camera)),g.m||g.o){if(g.o){var h=c.setAnatomy(g.o,j.gender);b.extend(j,h)}if(g.m){var i=c.setModule(g.m,j.gender);b.extend(j,i)}if(g.chapter){var k=a.parseInt(g.chapter,10)-1;k===k&&(j.initialChapter=k)}b.extend(j,{lang:g.lang||f}),g["load-style"]&&b.extend(j,{loadStyle:g["load-style"]}),d(j)}else if(g.a)c.setPrettyAnatomy({input:g.a,gender:j.gender,generations:g.parent},function(a){d(j=a)},e);else if(g.b||g.be){var l=g.b?"b":"be";c.setBookmark(l,g[l],function(a){j=a,b.extend(j,{lang:g.lang||f}),d(j)},e)}else d(j)},c.setLangTitle=function(a,b,c){g[a]=g[a]||{},g[a][c]=b},c.getLangTitle=function(a,b){return g.hasOwnProperty(a)?g[a][b]:null}}(window),function(a){function b(b,c,d,e,f){var g=a.Human,h=j(b,c,d);g.modules.load(b,h,e,f)}function c(c,d,e,f){var g=a.Human;e===d.initialChapter?g.modules.activate(c,t,{},function(){b(c,d,e,v,function(){b(c,d,e,w,function(){g.modules.activate(c,t,{},function(){}),g.events.fire("module.interactive",{moduleId:c}),f()})})}):b(c,d,e,v,function(){b(c,d,e,w,function(){f()})})}function d(a,b,e,f){return s===k?void(f&&f()):void c(a,b,e,function(){s++,e++,e===k&&(e=0),d(a,b,e,f)})}function e(a,b){var c=a.camera||a.flyTo||a.jumpTo;c&&m.extend(c,b)}function f(a,b,c,d){q(a)?setTimeout(function(){d(c)},0):g(a,b,function(a){h(c,a),d(c)},function(){d(c)})}function g(a,b,c,d){var e;if(r[a]&&(e=r[a][b]),e)setTimeout(function(){c(e)},0);else{var f="",g=b.match(".*.json$");f=g?["/tr",a,b].join("/"):["/search","bookmarks","tr",a,b].join("/");var h=new XMLHttpRequest;h.onreadystatechange=function(){2===this.readyState&&200!==this.status&&h.abort(),4===this.readyState&&(200===this.status?(e=JSON.parse(h.responseText),r[a]=r[a]||{},r[a][b]=e,c(e)):d())},h.open("GET",f,!0),h.send()}}function h(a,b){var c=b.iso_639_1,d=a.chapters||[],e=a.sceneGraph||[],f=b.objects||{},g=b.chapters||[],h=["displayName","title","description"],i=function(a,b){"object"==typeof a&&"object"==typeof b&&h.forEach(function(d){var e;if(e="displayName"===d?b.displayName||b.title:b[d],a.hasOwnProperty(d)&&e){var f=a[d];a[d]=e,o.setLangTitle(c,f,e)}})};i(a,b);var j=function(a){var b=a.objectId,c=f[b];c&&i(a,{displayName:c}),a.objects&&a.objects.forEach(j)};e.forEach(function(a){var b=a.objects||[];b.forEach(j)}),d.forEach(function(a,b){var c=g[b];if(c){i(a,c);var d=a.annotations||[],e=c.annotations||[];d.forEach(function(a,b){var c=e[b];c&&i(a,c)});var f=a.hotspots||[],h=c.hotspots||[];f.forEach(function(a,b){var c=h[b];c&&i(a,c)})}});var k=a.hotspots||[],l=b.hotspots||[];k.forEach(function(a,b){var c=l[b];c&&i(a,c)})}function i(b){var c={};for(var d in b)if(b.hasOwnProperty(d)){var e=a.Human.modules.convertBaseAnatomyObjectId(d);c[e]=b[d]}return c}function j(b,c,d){var e=a.Human.modules.modules[b],f=[],g={};g=Object.keys(c.baseAnatomyObjects).length>0?i(c.baseAnatomyObjects):"number"==typeof d?e.chapters[d].showObjects:e.showObjects;for(var h in g)g.hasOwnProperty(h)&&g[h]&&a.Human.scene.objects[h]&&f.push(a.Human.scene.objects[h]);return f}var k,l,m=a.HumanScene,n=m.sceneGraph={},o=m.content,p=o.DEFAULT_LANG,q=function(a){return!a||a===p},r={},s=0,t=0,u=["reflections","lights"],v=["material","geometry","transform"],w=["tweens","morph"],x=u.concat(v).concat(w);n.reset=function(){var b=a.Human,c=m.content.get();if(c.bookmark)b.bookmarks.restore(c.bookmark);else{var d=b.timeline.activeRoot._nowBranch,e=b.timeline.activeRoot._chapters[0];d===e?e.init(0,{camera:!0,annotations:!0,properties:!0,graph:!0,particles:!0},function(){}):b.timeline.scrub({time:0})}},n.load=function(b,c,g){var h,i,m=a.Human;if(b.bookmark)m.bookmarks.restore(b.bookmark,c);else if(b.id){h=b.id;var o=null;o="complete"===b.loadStyle?function(){i=JSON.parse(JSON.stringify(m.modules.moduleData[h])),b.camera&&i.chapters[0]&&e(i.chapters[0],b.camera),m.renderer.pushPause(),m.renderer.pauseCompilation(),m.modules.create(h,i,function(){m.modules.load(h,j(h,b),x,function(){m.renderer.popPause(),m.renderer.resumeCompilation();var d=a.Human.timeline.rootTimelines[h];k=i.chapters.length,l=d._chapters[b.initialChapter],t=d._times[b.initialChapter],m.modules.activate(h,t,{},function(){m.events.fire("module.interactive",{moduleId:h}),c()})})})}:function(){i=JSON.parse(JSON.stringify(m.modules.moduleData[h])),b.camera&&i.chapters[0]&&e(i.chapters[0],b.camera),m.modules.create(h,i,function(){m.modules.load(h,[],u,function(){var e=a.Human.timeline.rootTimelines[h];k=i.chapters.length,l=e._chapters[b.initialChapter],t=e._times[b.initialChapter],d(h,b,b.initialChapter,c)})})};var p=function(){g&&g()};if(b.moduleData){var r=function(a){a.moduleId=b.id,m.modules.moduleData[b.id]=a,setTimeout(o,0)};q(b.lang)?r(b.moduleData):f(b.lang,b.id,b.moduleData,r)}else n.fetchModule(b,o,p)}else c()},n.initTimeline=function(b){var c=a.Human,d=c.modules.modules[b.id].animation;0===t&&d&&!c.utils.isEmpty(d)?c.timeline.play(d):l.animation&&l.animation.loop&&c.timeline.play({startChapterId:l.id,loop:!0,numChapters:1})},n.stage=function(b){if(b.id){var c=a.Human;b.bookmark||c.timeline.time!==t||n.initTimeline(b);var d=Number(c.request.getSearchParam("load-rotate"));if(d){var e,f=a.document.getElementById(c.containerId||c.CONTAINER_ID),g=function(a){e=a.timeNow-a.timeLast,c.view.camera.rotateY(d*e*.001)},h=function(){c.events.off("tick",g),f.removeEventListener("mousedown",h),f.removeEventListener("touchstart",h)};c.events.on("tick",g),f.addEventListener("mousedown",h),f.addEventListener("touchstart",h)}if(m.getUrlParams().o&&Object.keys(b.baseAnatomyObjects).length>0){var j=i(b.baseAnatomyObjects);c.scene.setEnabledObjects({objects:j}),c.view.camera.fly.flyTo({enabledObjects:!0})}}},n.fetchModule=function(b,c,d){var e=b.id,g=b.lang;if(q(g))a.Human.modules.fetch(e,c,d);else{var h=function(){var b=a.Human.modules.moduleData[e];f(g,e,b,c)};a.Human.modules.fetch(e,h,d)}}}(window),function(a,b){"use strict";!function(a,b){var c=a.HumanWidget={},d=c.dashNormalize=function(a){return/^[a-z]+([_[A-Z])[a-z]+/.test(a)?a.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/([a-zA-Z])_/g,"$1-").toLowerCase():a},e=c.params={},f=a.location.href.replace(/&amp;/g,"&"),g=/[?&]+([^=&]+)=([^&]*)/gi;f.replace(g,function(b,c,f){e[d(c)]=a.decodeURIComponent(f)});var h=function(b){var c={};if(b){c.full=a.document.referrer;var d=c.full.match(/:\/\/(.[^\/]+)/);c.domain=d&&d[1]?d[1]:c.full}else c.full=a.location.href,c.domain=a.document.domain||a.location.host;return c},i=function(a){var b=a.split(".").reverse(),c=/^(com|edu|gov|net|mil|org|nom|co|name|info|biz)$/i,d="";return d=b.length>=3&&c.test(b[1])?[b[2],b[1],b[0]].join("."):[b[1],b[0]].join(".")},j=a.top!==a,k=h(j);k.slDomain=i(k.domain),c.data={parentUrl:k,embedded:j,initialDisplay:{},support:null,params:c.params,content:{},developerKey:c.params.dk||null,userAnalyticId:c.params.uaid||null,appProductKey:c.params["app-productkey"]||null,appUserId:c.params["app-userid"]||null};var l=function(){var b=a.document.body,d=c.getDevice(a.navigator.userAgent),e=function(){b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.right="0px",b.style.bottom="0px",b.style.height=a.innerHeight+"px"};"iPhone"!==d&&"iPad"!==d||!c.data.embedded||(a.addEventListener("resize",e,!0),e())},m=function(d){var e=d.EVENTS||{},f=e.onInit||function(){},g=e.onReady||function(){},h=e.onError||function(){},i=a.HumanScene;if(Human.workers){var j=["scripts","engine",Human.VERSION,"workers"].join("/");Human.workers.setPath(j)}i.initEngine(function(){f(),i.content.set(function(e){c.extend(c.data.content,e),i.load(e,function(){i.startEngine(),g(e)},h),b.bootstrap(a.document,[d.NAME])},function(c){b.bootstrap(a.document,[d.NAME]),h(c)})})};c.getDevice=function(a){var b=["iPad","iPhone","iPod","Android"],c=a.match(new RegExp(b.join("|"),"i"));return c&&c[0]},c.serializeRequest=function(b){var c=[];for(var d in b)b.hasOwnProperty(d)&&c.push([a.encodeURIComponent(d),a.encodeURIComponent(b[d])].join("="));return c.join("&")},c.extend=function(){var a,b,c,d=Array.prototype.slice.call(arguments,0),e=d[0],f=d.slice(1);for(c=0;c<f.length;c++){a=f[c];for(b in a)a.hasOwnProperty(b)&&(e[b]=a[b])}return e},c.init=function(d){c.support=c.webgl.runTest(d.WEB_GL.device),c.data.support=c.support;var e=c.buildManifest(d.DEPENDENCIES,d.ENVIRONMENT.files);c.loadScripts(e.scripts,function(){if(c.support.pass){c.webgl.handleError(d.WEB_GL.error),Human.properties.set({assetDomain:d.ENVIRONMENT.assetDomain});var e=d.INIT_SEQUENCE||m;e(d)}else b.bootstrap(a.document,[d.NAME])}),c.loadStyles(e.styles)},l(),b.module("humanWidget",["ngTouch","ui.bootstrap","humanUI","humanWidget.pass","humanWidget.fail","humanWidget.analytics","humanWidget.backgroundColor","humanWidget.backgroundImage","humanWidget.templates"]).constant("EMBEDDED",j).config(["$uibTooltipProvider","BASE_CONFIG","CONFIG_ALIASES",function(a,c,d){if(b.extend(c,{help:!1,infoExpand:!1,menuExpand:!1}),b.extend(d,{keys:"help"}),Modernizr.touch){var e="tooltip-trigger",f=document.body.querySelectorAll("["+e+"]");b.element(f).attr(e,"none"),a.options({trigger:"none"})}}]).run(["WindowDimensions",function(a){a.init()}]).value("widgetParams",c.params).value("widgetData",c.data).provider("WindowDimensions",function(){var a={breakPoints:[480,768,991]},c=function(c,d,e,f){for(var g=b.element(d[0].body),h=a.breakPoints.concat(c.Infinity),i=[],j=0;j<h.length;j++)i.push(["lte",h[j]].join("-"));var k=null,l=function(a,b){k=a,g.removeClass(i.join(" ")),g.addClass(b),e.$broadcast("window.breakpoint",k),e.$apply()},m=function(){for(var a=0;a<h.length;a++)if(c.innerWidth<=h[a])return void(k!==h[a]&&l(h[a],i[a]))};return{init:function(){b.element(c).on("resize",m),f(m)}}};return c.$inject=["$window","$document","$rootScope","$timeout"],{$get:c,config:function(c){b.extend(a,c)}}}).filter("dashNormalize",function(){return c.dashNormalize}).filter("serializeRequest",function(){return c.serializeRequest}).controller("MainController",["$scope","widgetData",function(a,b){a.widgetData=b,a.widgetParams=b.params,a.embedded=b.embedded,a.pass=b.support.pass,a.result=b.support.fullResult,a.tour=!1,a.backgroundImage={},a.$on("human.moduleData",function(b,c){a.moduleData=c}),Human.events.on("modules.activate.finish",function(){a.tour=Human.timeline.activeRoot._chapters.length>1,a.$digest()}),a.$on("human.fallbackTour",function(b,c){a.fallbackTour=c,a.noFallbackTour=!c}),a.$on("backgroundImage.show",function(){
a.backgroundImage.show=!0}),a.$on("backgroundImage.remove",function(){a.backgroundImage.remove=!0}),a.$on("backgroundImage.image",function(b,c){a.backgroundImage.load=!!c,a.backgroundImage.image=c||null})}]).directive("uiBd",["widgetParams",function(a){return{restrict:"A",priority:900,link:function(b,c){"false"===a["ui-bd"]&&c.addClass("ng-hide"),("no-link"===a["ui-bd"]||"false"===a["ui-bd.link"])&&(c.removeAttr("href"),c.removeAttr("target"),c.removeAttr("ga-event")),a["ui-bd.class"]&&c.addClass(a["ui-bd.class"])}}}]).directive("moduleError",["Human",function(a){return{restrict:"E",templateUrl:"templates/module_error.html",scope:!0,link:function(b){a.events.on("net.error",function(){b.show=!0,b.$apply()})}}}]).directive("bindTrustedHtml",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.bindTrustedHtml,function(a){b.html(a||"")})}}}).directive("broadcastUserInteraction",["$document","$rootScope","$timeout",function(a,c,d){var e="touchstart mousedown",f="touchmove mousemove",g="touchend touchcancel mouseup mouseleave",h=b.element(a[0].body);return{restrict:"A",link:function(i,j){var k,l=!1,m=!1,n=function(a){m=a,h[m?"addClass":"removeClass"]("user-interacting");var b="userInteracting.";b+=m?"start":"finish",c.$broadcast(b)},o=function(){l||(l=!0,d.cancel(k),k=void 0,k=d(function(){n(!0)},500)),j.css("cursor","default")},p=function(){l&&(l=!1,d.cancel(k),k=void 0,m&&(k=d(function(){n(!1)},500))),j.css("cursor","auto"),b.forEach(f.split(" "),function(b){a[0].removeEventListener(b,o,!0)}),b.forEach(g.split(" "),function(b){a[0].removeEventListener(b,p,!0)})};b.forEach(e.split(" "),function(c){j[0].addEventListener(c,function(){b.forEach(f.split(" "),function(b){a[0].addEventListener(b,o,!0)}),b.forEach(g.split(" "),function(b){a[0].addEventListener(b,p,!0)})},!0)})}}}]).directive("toggleElement",["$document","$timeout",function(a,c){return{restrict:"A",link:function(d,e,f){var g=a[0].querySelector(f.toggleElement),h=b.element(g),i=function(b){g.contains(b.target)||(e[0].contains(b.target)||h.addClass("ng-hide"),a[0].removeEventListener("touchstart",i,!0),a[0].removeEventListener("click",i,!0))},j=function(){c(function(){h.hasClass("ng-hide")?(a[0].removeEventListener("touchstart",i,!0),a[0].removeEventListener("click",i,!0)):(a[0].addEventListener("touchstart",i,!0),a[0].addEventListener("click",i,!0))})};e.on("click",function(){h.toggleClass("ng-hide"),f.hasOwnProperty("globalClose")&&j()})}}}]).directive("openFrameModal",["$window",function(a){var c=b.element(a);return{restrict:"A",link:function(a,b,d){b.on("click",function(){c.triggerHandler("frameModal.open",{src:d.openFrameModal,className:d.frameModalClass})})}}}]).directive("frameModal",["$window","$sce",function(a,c){var d=b.element(a),e=['<div id="frame-container" ng-class="setFrameClasses()">','  <button class="close" ng-click="closeFrame()">&times;</button>','  <iframe ng-if="src" ng-src="{{ src }}"></iframe>',"</div>"].join("\n");return{restrict:"E",scope:!0,template:e,link:function(e,f){var g,h=a.document.getElementById("frame-container"),i=b.element(h),j=function(){var b=h.getBoundingClientRect(),c=a.innerHeight-b.top-70;h.style["max-height"]=c+"px",g&&(g.style["max-height"]=c+"px")};e.closeFrame=function(){d.off("click",e.closeFrame),f.removeClass("open"),i.removeClass(),e.src=null,e.$applyAsync()},e.$watch("src",function(a){a?(g=h.querySelector("iframe"),j()):g=null}),d.on("frameModal.open",function(d,g){e.$applyAsync(function(){f.addClass("open"),g.className&&i.addClass(g.className),e.src=c.trustAsResourceUrl(g.src),b.element(a).one("click",e.closeFrame)})}),d.on("frameModal.close",e.closeFrame),d.on("resize",function(){e.src&&j()})}}}]).directive("windowBreakpoint",["$parse",function(a){return{restrict:"A",scope:!0,link:function(b,c,d){b.$on("window.breakpoint",function(c,e){b.breakpoint=e,a(d.windowBreakpoint)(b)})}}}])}(a,b),function(a){var c,d,e=a.HumanWidget,f=e.analytics={},g=e.data,h="/ws/developer/apps/access/key",i={app_productkey:g.appProductKey||"",app_userid:g.appUserId||"",app_apikey:g.developerKey||"",app_domain:g.parentUrl.full,app_activity:"",app_activity_status:"",app_activity_data:{},platform:"widget",widget_is_fullscreen:g.embedded?"False":"True"};for(c in g.params)g.params.hasOwnProperty(c)&&"dk"!==c&&(d=g.params[c],i.app_activity_data["url_param_"+c]=d);f.buildDeveloperActivity=function(a,b){a=a||{},b=b||{};var c=e.extend({},i,a),d=c.app_activity_data;return e.extend(d,b),c},f.postDeveloperActivity=function(b,c,d){var f=new XMLHttpRequest;c=c||function(){},d=d||function(){},f.onreadystatechange=function(){if(f.readyState===XMLHttpRequest.DONE){var b=a.JSON.parse(f.responseText),e={status:f.status,data:b};200===f.status?c(e):d(e)}},f.open("POST",h),f.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");var g=b.app_activity_data;b.app_activity_data=a.JSON.stringify(g),b=e.serializeRequest(b),f.send(b)};var j="/ws/user/analytics",k={analytic_id:"",analytic_type:"",analytic_description:"",analytic_data:{parent_analytic_identifier:g.userAnalyticId||"",referer_domain:g.parentUrl.full},analytic_platform:"widget",analytic_app_name:""};for(c in g.params)g.params.hasOwnProperty(c)&&"uaid"!==c&&(d=g.params[c],k.analytic_data["url_param_"+c]=d);f.buildAnalytic=function(a,b){a=a||{},b=b||{};var c=e.extend({},k,a),d=c.analytic_data;return e.extend(d,b),c},f.setAnalyticParent=function(a,b,c){var d=a.analytic_data;return d.parent_analytic_identifier=b,"undefined"!=typeof c&&(d.parent_is_owner=c),a},f.getAnalytic=function(b,c,d){var f=new XMLHttpRequest;c=c||function(){},d=d||function(){},f.onreadystatechange=function(){if(f.readyState===XMLHttpRequest.DONE){var b=a.JSON.parse(f.responseText),e={status:f.status,data:b};200===f.status?c(e):d(e)}};var g=e.serializeRequest({analytic_id:b});f.open("GET",[j,g].join("?")),f.send()},f.postAnalytic=function(b,c,d){var f=new XMLHttpRequest;c=c||function(){},d=d||function(){},f.onreadystatechange=function(){if(f.readyState===XMLHttpRequest.DONE){var b=a.JSON.parse(f.responseText),e={status:f.status,data:b};200===f.status?c(e):d(e)}},f.open("POST",j),f.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");var g=b.analytic_data;b.analytic_data=a.JSON.stringify(g),b=e.serializeRequest(b),f.send(b)},f.ga={};var l={content:"Content"},m={load:"Load",loadChapter:"Load Chapter"},n={contentName:0,chapterName:1,contentId:2,contentType:3,developerKey:4,appDomain:5,userId:6,platformType:7,appName:8,uaId:9},o=new Array(Object.keys(n).length),p=function(a,b){var c=[b+1,a||"unknown"].join(" "),d=l.content,e=m.loadChapter,g="";o[n.chapterName]=c,g=o[n.contentName]+":"+c,f.ga.sendEvent(d,e,g)},q=function(a){var b=a.split("/");return"[unspecified] "+b[b.length-1].replace(".json","")};f.ga.customTracker=null,f.ga.getEventDimensionsObject=function(){for(var a={},b=0;b<o.length;b++)a["dimension"+(b+1)]=o[b];return a},f.ga.init=function(a){var b,c,d=l.content,e=m.load,h="",i=g.content.bookmark?"bookmark":"module";"module"===i?(c=Human.modules.modules[g.content.id].displayName,b=g.content.id,c&&""!==c||(c=q(b))):(c=g.content.bookmark.title,b=g.params.be),h=c,o[n.contentName]=c,o[n.chapterName]=null,o[n.contentId]=b,o[n.contentType]=i,o[n.developerKey]=g.developerKey,Human.mobile&&Human.mobile.bundleid?(o[n.appDomain]=Human.mobile.bundleid,o[n.platformType]=Human.mobile.iOS?"iOS":"Android"):(o[n.appDomain]=g.parentUrl.domain,o[n.platformType]="Web Widget"),o[n.uaId]=g.userAnalyticId,a=a||{};for(var j in a)a.hasOwnProperty(j)&&(o[n[j]]=a[j]);f.ga.sendEvent(d,e,h),Human.events.on("timeline.chapters.activated",function(a){if(!g.content.bookmark){var b,c,d=a.newChapterIndex;Human.timeline.activeRoot?(b=Human.timeline.activeRoot._chapters,c=b[d].info.displayName):(b=Human.timeline.chapterList,c=b[d].displayName),b&&b.length>1&&p(c,d)}})};var r=function(a,b){var c;return c=b?[b,a].join("."):f.ga.customTracker?[f.ga.customTracker,a].join("."):a};f.ga.sendEvent=function(b,c,d,e){var g=f.ga.getEventDimensionsObject();a.ga(r("set",e),g),a.ga(r("send",e),{hitType:"event",eventCategory:b,eventAction:c,eventLabel:d})},b.module("humanWidget.analytics",[]).factory("GaAnalytics",function(){return f.ga}).directive("gaEvent",["$parse","$timeout","GaAnalytics",function(a,c,d){return{restrict:"A",scope:!1,link:function(e,f,g){var h,i=g.gaEventTracker,j=g.gaEventCategory||"UI",k=g.hasOwnProperty("gaUseCapture"),l=function(a){c(function(){d.sendEvent(j,a[0],a[1],i)})},m=function(c){var d=a(g.gaEvent)(e);b.isObject(d)&&!b.isArray(d)?b.forEach(d,function(a,b){h=f[0].querySelector(b),(h===c.target||h.contains(c.target))&&l(a)}):l(d)};f[0].removeEventListener("click",m,k),f[0].addEventListener("click",m,k)}}}])}(a),b.module("humanWidget.backgroundColor",[]).run(["$window",function(a){a.HumanBackground&&(a.HumanBackground.input.enableContentConfig(),a.HumanBackground.synchEngine())}]),b.module("humanWidget.backgroundImage",[]).constant("IMAGE_PARAMS",{large:{threshold:800,"default":{width:1200,height:800}},medium:{threshold:600,"default":{width:800,height:600}},small:{"default":{width:400,height:400}}}).constant("SCREENSHOT_SERVICE","/i").constant("BOOKMARK_SERVICE","/thumbnails/bookmarks").run(["widgetData","BackgroundImage",function(a,b){var c=a.support.pass;(c&&a.initialDisplay.image||!c)&&b.init()}]).factory("BackgroundImage",["$window","$timeout","$rootScope","Human","widgetParams",function(a,c,d,e,f){return{_store:{container:null,image:null},get:function(a){return this._store[a]},set:function(a,b){this._store[a]=b,d.$broadcast(["backgroundImage",a].join("."),b)},show:function(a){d.$broadcast("backgroundImage.show",a)},hide:function(){d.$broadcast("backgroundImage.hide")},remove:function(){d.$broadcast("backgroundImage.remove")},init:function(){var a=this,e=f.s||"male",g=f.m||f.a,h=f.be||f.b,i=f["load-image-src"]||f["image-src"],j=f["initial.image"];j&&"true"!==j&&(i=j),c(function(){var j;if(g||h){if(j={s:e},g)j.src=/\//.test(g)?g.replace(/\.json$/,""):["production",e+"Adult",g].join("/");else{var k=f.be?"eid":"id";j[k]=h}i||(i=b.copy(j))}d.$broadcast("backgroundImage.init",{src:i,base:j}),c(function(){i?a.show(i):a.remove()})})}}}]).directive("sizeBackgroundImage",["IMAGE_PARAMS","BackgroundImage",function(a,b){return{restrict:"A",scope:!0,link:function(c){var d,e,f=function(a){if(d||e)if(c.landscape=a.width>a.height,c.portrait=a.width<a.height,c.square=a.width===a.height,"initial"===c.widgetParams["image-size"]||"initial"===c.widgetParams["load-image-size"]){var b="large"===a.size&&(a.width>d[e]||a.height>d[e]);c.cover=!b}else c.cover=!0},g=function(c){if(c){var g=b.get("container"),h=a[g.size||"small"]["default"];d={width:c.width||h.width,height:c.height||h.height},e=d.width>=d.height?"width":"height",f(g)}else d=null,e=null};c.$watch("backgroundImage.image",g),c.$on("backgroundImage.container",function(a,b){f(b),c.$apply()})}}}]).directive("backgroundImage",["$document","$timeout","BackgroundImage","backgroundImageUrlFilter",function(a,b,c,d){return{restrict:"A",scope:!0,link:function(a,e){var f,g;a.show=!1;var h=function(b){var c,d,f;return b?(d=["progid:DXImageTransform","Microsoft",'AlphaImageLoader(src="'+b.src+'", sizingMethod="scale")'].join("."),c="url("+b.src+")"):c=d="none",f={"background-image":c,"-ms-filter":d,filter:d},a.hasContent=!!b,e.css(f),f},i=function(){h(null),c.set("image",{})},j=function(e){var i=$(new Image),j=!1,k=!1;a.loading=!0,i.load(function(){this.src.indexOf(f)>=0&&!k&&(k=!0,c.set("image",{css:h(this),src:this.src,width:this.width,height:this.height}),a.loading=!1,a.$apply())}),i.error(function(){this.src.indexOf(f)>=0&&(j=!0,h(null),c.set("image",null),a.show=!1,a.loading=!1,a.$apply())});var l=c.get("container").size;f=d(e,l),i[0].src=f,i[0].complete&&b(function(){k||i.trigger("load")}),g&&b.cancel(g),g=b(function(){k||j||i.trigger("load")},3e3)};a.$on("backgroundImage.show",function(b,c){j(c),a.show=!0}),a.$on("backgroundImage.hide",function(){i(),a.show=!1}),a.$on("backgroundImage.remove",function(){e.remove()})}}}]).directive("captureSize",["$window","IMAGE_PARAMS","BackgroundImage",function(a,c,d){return{restrict:"A",link:function(e,f){var g=b.element(a),h=function(){var a={width:f.outerWidth(),height:f.outerHeight()};for(var b in c)if(c.hasOwnProperty(b)){var e=c[b].threshold;if(a.width>=e||a.height>=e){a.size=b;break}}d.set("container",a)};e.$on("backgroundImage.init",h),e.$watch("backgroundImage.load",function(a){a&&(g.off("resize.backgroundImage"),g.on("resize.backgroundImage",h))}),e.$watch("backgroundImage.remove",function(a){a&&g.off("resize.backgroundImage")})}}}]).filter("backgroundImageUrl",["_moduleUrlFilter","_bookmarkUrlFilter","_customUrlFilter",function(a,b,c){return function(d,e){var f;if(d.s){var g=d.src?a:b;f=g(d,e)}else f=c(d);return f}}]).filter("_moduleUrl",["SCREENSHOT_SERVICE",function(a){return function(b){return a+"/"+b.src+".jpg"}}]).filter("_bookmarkUrl",["BOOKMARK_SERVICE",function(a){return function(b,c){var d=c?"&size="+c:"",e=b.eid?"eid":"id",f=["s="+b.s,e+"="+b[e]+d].join("&");return[a,f].join("?")}}]).filter("_customUrl",["$document","SCREENSHOT_SERVICE",function(a,b){var c=function(){var b=a[0],c=b.createElement("a");return c.href=b.referrer,c.hostname}();return function(a){var d;return"!"===a[0]?(d="//"+c,a=a.slice(1)):d=b,/^(http(s)?:)?\/\//.test(a)?a:[d,a].join("/")}}]),b.module("humanWidget.fail",[]).run(["$rootScope","Module","widgetData",function(a,b,c){var d=function(b){a.$broadcast("human.moduleData",b?b.data:null)};c.support.pass||b.get().then(d,d.bind(null,null))}]).factory("Module",["$http","widgetParams",function(a,b){return{get:function(){var c=b.s||"male",d=b.m||b.a,e=/\//.test(d)?d:"production/"+c+"Adult/"+d+".json";return a.get("/content/modules/"+e)}}}]).factory("cacheAssets",["backgroundImageUrlFilter","$timeout",function(a,c){return function(){var d=[],e=[],f=arguments[0],g=arguments[1];if(b.isObject(f)&&b.isDefined(g))for(var h=a(f),i=1;g>i;i++)d.push(h.replace(/(\.(\w{3}))$/,["_",".$2"].join(i)));else b.isArray(f)&&(d=f);b.forEach(d,function(a){if(b.isString(a)||b.isObject(a)&&"image"===a.type){var c=b.isString(a)?a:a.url;e.push((new Image).src=c)}}),c(function(){e=void 0})}}]).factory("FallbackVideo",["$rootScope",function(a){return{show:function(b){a.$broadcast("fallbackVideo.show",b)},hide:function(){a.$broadcast("fallbackVideo.hide")}}}]).directive("fallbackVideo",function(){return{restrict:"A",scope:!0,link:function(a,b){a.show=!1;var c,d=function(){c&&c.remove(),c=null};a.$on("fallbackVideo.show",function(e,f){d(),b.append("<iframe></iframe>"),c=b.children("iframe")[0],c.contentWindow.location.replace(f),a.show=!0}),a.$on("fallbackVideo.hide",function(){d(),a.show=!1})}}}).directive("defaultBackground",function(){return{restrict:"A",link:function(a,b){var c=function(a){return"boolean"==typeof a&&!a},d=function(){b.css({"background-image":'url("img/tiles_layer_50.jpg")',"background-size":"cover"})};a.$watch("backgroundImage.load",function(b){c(b)&&c(a.pass)&&d()}),a.$watch("pass",function(b){c(b)&&c(a.backgroundImage.load)&&d()})}}}).directive("fallbackTour",["$rootScope","BackgroundImage","FallbackVideo","cacheAssets",function(a,c,d,e){return{restrict:"E",scope:!0,template:"<fallback-tour-controls></fallback-tour-controls>",link:function(f){var g,h,i,j,k,l=function(a){a.hasOwnProperty("length")?(f.length=a.length,g&&e(g,a.length)):b.isArray(a.assets)&&(i=a.assets,f.length=i.length,e(i),f.showAsset(f.getAsset(0))),f.length>1&&(f.show=!0)};f.show=!1,f.getAsset=function(a){return k="image",i?(j=i[a],b.isObject(j)?(h=j.url,k=j.type||k):h=i[a]):(h=b.copy(g),a>0&&(h.src=[h.src,a].join("_"))),{src:h,type:k}},f.showAsset=function(a){"image"===a.type?(c.show(a.src),d.hide()):(d.show(a.src),c.hide()),f.curAsset=a},f.$on("human.moduleData",function(c,d){var e=d&&b.isObject(d.fallback);e&&l(d.fallback),a.$broadcast("human.fallbackTour",e)}),f.$on("backgroundImage.init",function(a,b){g=b.base})}}}]).directive("fallbackTourControls",function(){return{restrict:"E",template:'      <div class="arrow arrow-left"        ng-class="{ disabled: checkLimits(-1) === \'start\' }"        ng-click="step(-1)">      </div>      <div class="arrow arrow-right"        ng-class="{ disabled: checkLimits(1) === \'finish\' }"        ng-click="step(1)">      </div>    ',link:function(a){var b=0;a.checkLimits=function(c){return 0===b&&-1===c?"start":b===a.length-1&&1===c?"finish":!1},a.step=function(c){a.checkLimits(c)||(b+=c,a.showAsset(a.getAsset(b)))}}}}).directive("failModuleInfo",["$sce",function(a){return{restrict:"E",scope:!0,template:'      <button ng-show="!!description" ng-click="toggleInfo()"></button>      <h1>{{ displayName }}</h1>      <p ng-bind-html="description"></p>    ',link:function(b,c){b.toggleInfo=function(){c.toggleClass("open")},b.$watch("moduleData",function(c){c&&(b.displayName=c.displayName,b.description=a.trustAsHtml(c.description))})}}}]).directive("failMessage",function(){var a="play.google.com/store/apps/details?id=com.biodigitalhuman.humanAndroid",b="itunes.apple.com/us/app/biodigital-human-anatomy-health/id771825569";return{restrict:"E",scope:!0,templateUrl:"templates/fail_message.html",link:function(c){var d=function(d){if(d){var e=/android/i.test(d)?"android":"ios";c.deviceName="android"===e?"Android":d,c.deviceLink="android"===e?a:b,c.deviceLink="https://"+c.deviceLink,c.imgSrc="android"===e?"Android_App_Store_Get_Badge.png":"Download_on_the_App_Store_Badge_US-UK_135x40.png"}};c.$watch("result.device",d)}}}),function(a){var b=a.HumanWidget,c={min:!1,allowParams:!1,basePath:"scripts"},d=function(){for(var b,c,d=a.document.querySelectorAll("[ie-relink-css]"),e=0;e<d.length;e++)b=d[e],c=b.href,b.href="",b.href=c},e=function(a,b,c,d){return[a,b+"-"+c+d+".js"].join("/")},f=function(a,b,c,d){var e;return e=/engine/.test(b)?[a,"css","engine.css"].join("/"):[a,"css",b+"-"+c+d+".css"].join("/")};b.loadScripts=function(b,c){var d=b.length;if(0===d)return void a.setTimeout(c,0);for(var e=function(){0===--d&&c&&c()},f=function(b){var c=a.document.createElement("script");c.async=!1,c.src=b,c.onload=e,c.onerror=e,a.document.head.appendChild(c)},g=0;g<b.length;g++)f(b[g])},b.loadStyles=function(b,c){var e=a.document.getElementsByTagName("link-human-css")[0];if(e){for(var f=b.length,g=(function(){0===--f&&("ActiveXObject"in a&&d(),c&&c())}),h=function(b){var c=a.document.createElement("link");c.onload=g,c.onerror=g,c.href=b,c.rel="stylesheet",c.type="text/css",e.parentNode.insertBefore(c,e.nextSibling)},i=b.length-1;i>=0;i--)h(b[i]);e.parentNode.removeChild(e)}},b.buildManifest=function(a,d){var g,h,i,j,k,l={},m=b.extend({},a),n=b.extend({},c,d||{});n.allowParams&&(b.params["engine-version"]&&(m.humanEngine=b.params["engine-version"]),b.params["ui-version"]&&(m.humanUI=b.params["ui-version"]));var o=n.min?".min":"";for(g in m)m.hasOwnProperty(g)&&(h=m[g],i=g.replace("human","").toLowerCase(),j=g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),k=[n.basePath,i,h].join("/"),l[i]={lib:k,files:{js:e(k,j,h,o),css:f(k,j,h,o)}});var p,q;if(n.humanScripts?p=n.humanScripts:(p=[],p.push(l.engine.files.js),p.push(l.ui.files.js)),b.params.plugins){for(var r=m.humanEngine,s=[n.basePath,"engine",r].join("/"),t=b.params.plugins.split(","),u=0;u<t.length;u++)t[u]=[s,"plugins",t[u],t[u]+".js"].join("/");p=p.concat(t)}return q=n.humanStyles?n.humanStyles:[l.engine.files.css,l.ui.files.css],{scripts:p,styles:q}}}(a),b.module("humanWidget.pass",[]).run(["widgetParams","widgetData","HumanSnapshot",function(a,c,d){var e,f,g=a.initial,h=a["initial.button"],i=a["initial.hand-hint"],j=a["initial.image"],k=a["load-image-src"]||a["image-src"],l=a["load-hint-hand"];l&&(e="fade"===l?"hand-hint-fade":"hand-hint"),(j||k)&&(e="default",f=!0),"true"===g&&(e="default"),"true"===h&&(e="default"),"true"===i&&(e="hand-hint"),c.initialDisplay.mode=e,c.initialDisplay.image=f,c.initialDisplay.enabled=b.isDefined(e),c.initialDisplay.initial=b.isDefined(e),c.support.pass&&(d.config({copyrightImagePath:"img/bhuman-logo-powered.png"}),d.loadCopyrightImage())}]).factory("ObjectTreeDisplay",["$document","$rootScope",function(a,c){for(var d,e=["human-object-tree","object-tree"],f=0;f<e.length&&!(d=a[0].querySelector(e[f]));f++);var g=b.element(d),h=!1,i=function(a){h="boolean"==typeof a?a:!h,g[h?"removeClass":"addClass"]("ng-hide")};return c.$on("window.breakpoint",function(a,b){480>=b&&i(!1)}),{setDisplay:i}}]).directive("humanLoadProgress",["$timeout",function(a){var c=["material","geometry","transform"],d=["tweens","morph"];return{restrict:"E",scope:!0,link:function(e){var f=[],g=!0;e.show=g,e.currentAssetType=null,Human.events.on("assets.load.start",function(){f.push(null)}),Human.events.on("assets.load.progress",function(a){if(!f[f.length-1]){var b=f.length-1;c.indexOf(a.assetType)>=0?f[b]="static":d.indexOf(a.assetType)>=0&&(f[b]="dynamic"),e.currentAssetType=f[b],e.show=g,(b>1||1===b&&"static"===f[b])&&(e.show=!1),e.$digest()}}),Human.events.on("assets.load.finish",function(){a(function(){e.show=!1})}),e.$watch("uiComponents.config.loadProgress",function(a){g=!b.isDefined(a)||a})}}}]).directive("initialDisplayClass",["$timeout","widgetData",function(a,b){return{restrict:"A",scope:!0,link:function(c,d){b.initialDisplay.mode&&d.addClass(b.initialDisplay.mode),"hand-hint-fade"===b.initialDisplay.mode&&(c.initialDisplay=b.initialDisplay,c.$watch("initialDisplay.enabled",function(c){c&&a(function(){b.initialDisplay.enabled=!1},5e3)}))}}}]).directive("initialDisplay",["widgetData",function(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(){var c=d.initialDisplay;c="true"===c?!0:"false"===c?!1:!a.initialDisplay.enabled,a.initialDisplay.enabled=c,b.$apply()})}}}]).directive("mousewheelInfo",["$window","$timeout","Human","widgetData",function(a,c,d,e){var f=e.params["disable-scroll"],g=e.params["disable-scroll.alert"],h=e.params["disable-scroll.overlay"],i=g&&"false"!==g,j=h&&"false"!==h,k=f&&"false"!==f||i||j;return{restrict:"A",link:function(f,g){if(e.embedded&&k){d.input.mouseZoomCtrlKey=!0,j&&g.addClass("overlay");var h=!0,l=!1,m=function(){g[0].style.display="block",c(function(){g[0].style.opacity=1},0)},n=function(){g[0].style.opacity=0,c(function(){g[0].style.display="none",l=!1},1500)},o=a.document.getElementById("container");b.element(o).on("mousewheel",function(a){a.ctrlKey&&!h&&(h=!0,d.properties.set({"ui.mouseWheel.capture":!0})),!a.ctrlKey&&h&&(h=!1,d.properties.set({"ui.mouseWheel.capture":!1})),a.ctrlKey||l||(l=!0,(j||i)&&m(),c(n,3e3))})}}}}]).directive("globalInfo",["widgetData","Info",function(a,b){return{restrict:"A",scope:!1,link:function(c){var d,e=!1,f=!1,g=function(b){e=a.embedded?b:"false"!==a.params["ui-info"]&&"false"!==a.params["ui-panel"]&&"false"!==a.params["ui-all"]},h=function(a){d=b.state.current,f=a&&d&&a[d]};c.sceneInfo=b.state.info,c.$watchCollection("sceneInfo",function(a){h(a),c.infoEnabled=!(!f||!e)}),c.$watch("uiComponents.config.info",function(a){g(a),c.infoEnabled=!(!f||!e)}),c.$watch("uiComponents.config.infoExpand",function(a){c.infoExpanded=a})}}}]).directive("expandInfo",["$document",function(a){var c=b.element(a[0].querySelector("[human-info]"));return{restrict:"A",scope:!1,link:function(a,b){var d=function(b){c.hasClass("has-description")&&(b.stopPropagation(),a.uiComponents.config.infoExpand=!a.uiComponents.config.infoExpand,a.$apply())};b.on("mouseup",d)}}}]).directive("objectTreeDisplay",["ObjectTreeDisplay",function(a){return{restrict:"A",link:function(b,c,d){var e=d.objectTreeDisplay||"toggle";e="on"===e?!0:"off"===e?!1:void 0,c.on("click",function(){a.setDisplay(e)})}}}]).directive("timelineTouch",["$timeout","Human",function(a,b){return{restrict:"A",scope:!0,link:function(c){c.step=function(c){a(function(){b.timeline[1===c?"next":"prev"]()})}}}}]),function(a){var c=a.HumanWidget,d=c.activity={},e=c.analytics,f=c.data,g={firstInteraction:{api:!0,touch:!0}},h=["bookmark.nextChapter","bookmark.previousChapter","bookmark.set","camera.set","camera.zoom","scene.load","scene.selectObjects","timeline.nextChapter","timeline.pause","timeline.play","timeline.previousChapter","timeline.set","scene.picked","hotspots.picked"],i=[{name:"initial",value:"true"},{name:"initial.button",value:"true"},{name:"initial.hand-hint",value:"true"}],j=function(){var b=0,c=a.setInterval(function(){if(z||!g.firstInteraction.api)return void a.clearInterval(c);var d=Human.rpc.getLog(),e=d.slice(b);b=d.length;for(var f=0;f<e.length;f++){var i=e[f],j=-1!==h.indexOf(i.identifier);if(j){s({type:"api"});break}}},1e3)},k=function(b){var c=a.Human;if(401===b.status||403===b.status){var d=b.data||{},e=d.error||{},f=e.message||"";c.log.error(["Error initializing BioDigital Human API: "+f,"API functionality unavailable for this session.","Please ensure that the developer key parameter (dk)","in your iframe src is correct and registered to this","domain in your BioDigital developer account:","https://developer.biodigital.com/account/apps"].join("\n")),c.rpc.windowClientEnabled=!1}},l=function(){},m=function(b){if(f.embedded){var c=b.status,d=f.userAnalyticId,e={401:{error:"INVALID_CLIENTID",message:(d?"Uaid":"Client id")+" missing or invalid"},403:{error:"DOMAIN_UNREGISTERED",message:"Domain unregistered or not allowed"}},g=function(b,c){var d="/widget-auth-error.html",e=a.encodeURIComponent(c),f="error="+b+"&message="+e;return[d,f].join("?")},h=b.data||{},i=h.error||{},j=i.message||"";switch(c){case 401:case 403:e=e[c],j=j||e.message,a.location.replace(g(e.error,j))}}},n=function(a){if(a[0].intersectionRatio>=d.intersectThreshold){for(;w.length;)w.shift()();v.unobserve(u)}},o=function(){if(p()){for(;w.length;)w.shift()();a.removeEventListener("resize",o)}},p=function(){var a=u.getBoundingClientRect();return a.width>0&&a.height>0},q=function(b){"IntersectionObserver"in a?(v=new a.IntersectionObserver(n,{root:null,threshold:d.intersectThreshold}),w.push(b),v.observe(u)):p()?b():(w.push(b),a.addEventListener("resize",o))},r=function(){u=document.getElementById("container");var a;if(C)a=e.buildDeveloperActivity({app_activity:"view"}),e.postDeveloperActivity(a,l,m);else if(B)if(a=e.buildAnalytic({analytic_type:"view"}),y)e.postAnalytic(a,l,m);else{var b=e.postAnalytic.bind(null,a,l,m);x.push(b)}},s=function(b){if(!z){A||t();var c;if(C)c=e.buildDeveloperActivity({app_activity:"interactionf"},{interactionf_source:b.type}),e.postDeveloperActivity(c,l,m);else if(B)if(c=e.buildAnalytic({analytic_type:"interactionf"},{interactionf_source:b.type}),y)e.postAnalytic(c,l,m);else{var d=e.postAnalytic.bind(null,c,l,m);x.push(d)}a.document.removeEventListener("mousedown",s),a.document.removeEventListener("touchstart",H),a.document.removeEventListener("touchend",I),clearTimeout(D),z=!0}},t=function(){if(!A){var a;if(C)a=e.buildDeveloperActivity({app_activity:"interactionc"}),e.postDeveloperActivity(a,l,m);else if(B)if(a=e.buildAnalytic({analytic_type:"interactionc"}),y)e.postAnalytic(a,l,m);else{var b=e.postAnalytic.bind(null,a,l,m);x.push(b)}A=!0}};d.setConfig=function(a){for(var c in g)if(a.hasOwnProperty(c)){var d=a[c];b.isObject(d)?b.extend(g[c],d):g[c]=d}},d.enableViewEvent=function(){a.addEventListener("DOMContentLoaded",r)},d.disableViewEvent=function(){a.removeEventListener("DOMContentLoaded",r)},d.enableMouseInteractEvent=function(){a.document.addEventListener("mousedown",s)},d.disableMouseInteractEvent=function(){a.document.removeEventListener("mousedown",s)},d.enableContentInteractive=function(a){var b=!1,c=!1;a.events.on("assets.load.progress",function(a){"geometry"===a.assetType&&(b=!0)}),a.events.on("assets.load.finish",function(){b&&!c&&(c=!0,q(t))})},d.initContentInteractive=d.enableContentInteractive,d.verifyAPI=function(b){b=b||{};var c=b.success||j,d=b.failure||k,f=e.buildDeveloperActivity({platform:"widgetapi",app_activity:"init"},{engine_version:a.Human.VERSION,api_version:a.Human.API_VERSION});e.postDeveloperActivity(f,c,d)},d.intersectThreshold=.75;var u,v=null,w=[],x=[],y=!1,z=!1,A=!1,B=!!f.userAnalyticId,C=!B;B&&e.getAnalytic(f.userAnalyticId,function(){for(y=!0;x.length;)x.shift()()},m);var D,E=0,F=0,G=200,H=function(a){var b=a.touches[0];E=b.pageY,F=b.screenY,clearTimeout(D),g.firstInteraction.touch&&(D=setTimeout(function(){s(a)},G))},I=function(a){if(clearTimeout(D),g.firstInteraction.touch){var b=a.changedTouches[0],c=E-b.pageY,d=F-b.screenY,e=c!==d;e&&f.embedded||s(a)}};d.enableViewEvent(),d.enableMouseInteractEvent();for(var J=!0,K=0;K<i.length;K++){var L=i[K];if(f.params[L.name]===L.value){J=!1;break}}J&&(a.document.addEventListener("touchstart",H),a.document.addEventListener("touchend",I))}(a),function(a,b){var c=a.HumanWidget,d=c.webgl={},e={device:{ios:!0,android:!0},error:{post:!0,log:!1,redirect:!1}},f=function(a,b){var d=function(d,e){return("true"===c.params["_"+d]||b[d])&&new RegExp("^"+e,"i").test(a.device)},e=d("ios","iP"),f=d("android","Android"),g=!a.device||e||f,h=a.html5&&a.webgl&&a.human&&g;return{pass:h,fullResult:a}},g=function(){return b.applicationcache&&b.canvas&&b.hashchange&&b.postmessage},h=function(){for(var b='webgl experimental-webgl webkit-3d moz-webgl "moz-glweb20',c=b.split(" "),d=a.document.createElement("canvas"),e=0;e<c.length;e++)try{if(d.getContext(c[e]))return!0}catch(f){}return!1};d.runTest=function(b){var d=c.extend({},e.device,b||{}),i=g(),j=i&&h(),k=i&&j,l={html5:i,webgl:j,human:k,device:c.getDevice(a.navigator.userAgent)};return f(l,d)},d.handleError=function(b){var d;d="true"===c.params["no-error-redirect"]?{post:!1,log:!0,redirect:!1}:c.extend({},e.error,b||{}),Human.events.once("error",function(b){d.log&&a.console.log(b);var e={log:b.log,stack:b.stack,webglInfo:b.webglInfo};if(d.post){var f=c.serializeRequest({category:b.name,log:JSON.stringify(e),message:b.message}),g="/ws/human-error",h="application/x-www-form-urlencoded; charset=UTF-8",i=new XMLHttpRequest;i.open("POST",g),i.setRequestHeader("Content-Type",h),i.send(f)}if(d.redirect){var j=["webgl-error.html?error=",b.name,"&message=["+b.type+"]",b.message].join("");a.location.replace(j)}})}}(a,Modernizr),b.module("humanWidget.templates",["templates/fail_message.html","templates/keypress_modal.html","templates/module_error.html"]),b.module("templates/fail_message.html",[]).run(["$templateCache",function(a){a.put("templates/fail_message.html",'<a ng-if="!!result.device" href="{{ deviceLink }}">\n  <p>Now freely available on {{ deviceName }}</p>\n  <img ng-src="{{ \'/img/\' + imgSrc }}">\n</a>\n\n<div ng-if="!result.device">\n  <div class="logo-image"></div>\n  <p class="error-generic">Sorry, it looks like your browser does not currently support the Human. Give us a try on Chrome or Firefox for your desktop.</p>\n  <div class="error-details" ng-show="!!result">\n      <h5><b>Details</b></h5>\n      <p id="support-webgl"><b>WebGL: {{ result.webgl }}</b><span></span></p>\n      <p id="support-html5"><b>HTML5: {{ result.html5 }}</b><span></span></p>\n      <p id="support-human"><b>Human: {{ result.human }}</b><span></span></p>\n  </div>\n</div>')}]),b.module("templates/keypress_modal.html",[]).run(["$templateCache",function(a){a.put("templates/keypress_modal.html",'<div class="content">\n  <div class="header">\n   <h1>Human Keypresses</h1>\n     <button>\n       <img\n         src="img/shim.gif"\n         alt="Close"\n         title="Close"\n         class="icon-close"\n         ng-click="in = false">\n     </button>\n  </div>\n  <iframe\n   id="keypress-frame"\n   class="modal-frame normal-scroll"\n   frameborder="0"\n   scrolling="auto">\n  </iframe>\n</div>')}]),b.module("templates/module_error.html",[]).run(["$templateCache",function(a){a.put("templates/module_error.html",'<div class="logo-image"></div>\n<p>Sorry, it looks like the module you\'re looking for was not found.</p>')}])}(window,angular),window.engineConfig=function(a){function b(a){var b={};b[a]=!0,d.scene.setEnabledObjects({objects:b,enable:!1,replace:!1})}function c(a){var b=a.split(",");try{return{x:Number.parseFloat(b[0]),y:Number.parseFloat(b[1]),z:Number.parseFloat(b[2])}}catch(c){}}var d=window.Human;if(window.HumanBackground.engineProperties.white.xray.color=[.2,.2,.3],
d.events.on("pick.picked",function(a){if(a.objectId&&a.mouseDownRight){var b={};b[a.objectId]=!0,d.view.annotations.setLabelsShown({objects:b})}}),d.view.annotations.setResponsiveEnabled){var e=window.HumanWidget.params["annotation-collapse"];e=e?window.parseInt(e,10):501,d.view.annotations.setResponsiveCanvasSizes([[e,0]]),d.view.annotations.setResponsiveEnabled(!0)}d.actions.addAction("swapObject",function(a){var b=a.objectId,c=a.moduleId;d.modules.activateModules({moduleId:c,swap:!0,objectId:b},function(){var a={};a[b]=!1,d.scene.setEnabledObjects({objects:a,enable:!1,replace:!1})})}),d.actions.addAction("unswapObject",function(a){var c,e=a.objectId,f=a.moduleId;if(e){c=d.modules.activeModules;for(var g in c)if(c.hasOwnProperty(g)&&c[g].swappedObjectId===e)return d.modules.deactivateModules({moduleId:f}),void b(e)}if(f){var h=d.modules.activeModules[f];if(!h||!h.swapped)return;d.modules.deactivateModules({moduleId:f}),h.swappedObjectId&&b(e)}c=d.modules.activeModules;for(f in c)c.hasOwnProperty(f)&&(h=c[f],h.swapped&&(d.modules.deactivateModules({moduleId:f}),h.swappedObjectId&&b(h.swappedObjectId)))}),d.actions.addAction("loadModule",function(a){var b=a.moduleId;d.modules.activateModules({moduleId:b})}),d.actions.addAction("flyToObject",function(a){d.view.camera.fly.flyTo(a)}),d.actions.addAction("flyToPos",function(a){var b={arc:!1};a.eye&&(b.eye=c(a.eye,"eye")),a.look&&(b.look=c(a.look,"look")),a.up&&(b.up=c(a.up,"up")),d.view.camera.fly.flyTo(b)}),d.actions.addAction("playChapter",function(a){var b=a.chapterId;d.timeline.play({startChapterId:b})}),d.actions.addAction("flyToAnnotation",function(a){var b=a.annotationId;d.modules.activateModules({annotationId:b})}),d.actions.addAction("openAnnotations",function(a){d.view.annotations.setLabelsShown({type:a.type||"secondary",shown:!0,replace:!0})}),d.actions.addAction("focusObject",function(a){a.select=!0,a.replace=!0,a.showLabel="false"!==a.showLabel,a.flyTo="false"!==a.flyTo?"newSelected":"none",d.view.focus.focusObject(a)}),a&&a()},function(a,b){var c=a.HumanWidget,d={NAME:"humanWidget.gary",MODULE_DIR:null,DEPENDENCIES:{humanWidget:"9.2.0",humanEngine:"15.0.0",humanUI:"13.3.0"},ENVIRONMENT:a.ENVIRONMENT,WEB_GL:{device:{ios:!0,android:!0},error:{post:!0,log:!1,redirect:!1}},EVENTS:{onInit:function(){a.engineConfig(),c.activity.initContentInteractive(a.Human),c.data.embedded&&c.activity.verifyAPI(),Human.events.once("modules.activate.start",function(){c.analytics.ga.init({appName:d.NAME.split(".")[1]})})},onReady:function(b){a.setTimeout(function(){a.Human.events.fire("app.module.sceneReady")},1e3),b.id&&a.Human.events.fire("module.ready",{moduleId:b.id}),Human.mobile&&Human.mobile.android?a.HumanKitAndroid.moduleLoaded():Human.mobile&&Human.mobile.iOS&&a.webkit.messageHandlers.assetsHandler.postMessage("loaded"),console.log("Battlestation fully operational.")},onError:function(){}}};b.module(d.NAME,["humanWidget"]).config(["HumanSnapshotProvider",function(a){(Human.mobile.iOS||Human.mobile.android)&&a.config({copyrightPosition:{x:"center",y:"bottom"},copyrightOffset:{x:0,y:-50}})}]).run(["HumanSnapshot",function(b){(Human.mobile.iOS||Human.mobile.android)&&(a.HumanSnapshot=b)}]),a.HumanWidget.init(d),a.ENVIRONMENT=void 0}(window,angular);